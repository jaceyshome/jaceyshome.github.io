/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
 * jQuery JavaScript Library v1.9.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2012 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-2-4
 */

/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */

/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */

/*

StackBlur - a fast almost Gaussian Blur For Canvas

Version: 	0.5
Author:		Mario Klingemann
Contact: 	mario@quasimondo.com
Website:	http://www.quasimondo.com/StackBlurForCanvas
Twitter:	@quasimondo

In case you find this class useful - especially in commercial projects -
I am not totally unhappy for a small donation to my PayPal account
mario@quasimondo.de

Or support me on flattr: 
https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript

Copyright (c) 2010 Mario Klingemann

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
*/

/** @license
 *
 * SoundManager 2: JavaScript Sound for the Web
 * ----------------------------------------------
 * http://schillmania.com/projects/soundmanager2/
 *
 * Copyright (c) 2007, Scott Schiller. All rights reserved.
 * Code provided under the BSD License:
 * http://schillmania.com/projects/soundmanager2/license.txt
 *
 * V2.97a.20130512
 */

// hat tip: Flash Detect library (BSD, (C) 2007) by Carl "DocYes" S. Yestrau - http://featureblend.com/javascript-flash-detection-library.html / http://featureblend.com/license.txt

/**
 * @license AngularJS v1.1.5
 * (c) 2010-2012 Google, Inc. http://angularjs.org
 * License: MIT
 */

/**
	 * splitCSV function (c) 2009 Brian Huisman, see http://www.greywyvern.com/?post=258
	 * Works by spliting on seperators first, then patching together quoted values
	 */

/*
Copyright (c) Copyright (c) 2007, Carl S. Yestrau All rights reserved.
Code licensed under the BSD License: http://www.featureblend.com/license.txt
Version: 1.0.4
*/

!function(){function e(t){this.ok=!1,"#"==t.charAt(0)&&(t=t.substr(1,6)),t=t.replace(/ /g,""),t=t.toLowerCase();var i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in i)t==n&&(t=i[n]);for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],o=0;o<r.length;o++){var a=r[o].re,s=r[o].process,l=a.exec(t);l&&(channels=s(l),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),"#"+e+t+i},this.getHelpXML=function(){for(var t=new Array,n=0;n<r.length;n++)for(var o=r[n].example,a=0;a<o.length;a++)t[t.length]=o[a];for(var s in i)t[t.length]=s;var l=document.createElement("ul");l.setAttribute("id","rgbcolor-examples");for(var n=0;n<t.length;n++)try{var u=document.createElement("li"),h=new e(t[n]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+h.toHex()+"; color:"+h.toHex(),c.appendChild(document.createTextNode("test"));var f=document.createTextNode(" "+t[n]+" -> "+h.toRGB()+" -> "+h.toHex());u.appendChild(c),u.appendChild(f),l.appendChild(u)}catch(d){}return l}}function t(e,t,i,r,o,a){if(!(isNaN(a)||1>a)){a|=0;var s,h=document.getElementById(e),c=h.getContext("2d");try{try{s=c.getImageData(t,i,r,o)}catch(f){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),s=c.getImageData(t,i,r,o)}catch(f){throw alert("Cannot access local image"),new Error("unable to access local image data: "+f)}}}catch(f){throw alert("Cannot access image"),new Error("unable to access image data: "+f)}var d,p,m,g,v,y,x,b,w,_,M,S,C,T,E,A,P,L,D,N,R,O,F,I,k=s.data,B=a+a+1,V=r-1,U=o-1,z=a+1,$=z*(z+1)/2,H=new n,j=H;for(m=1;B>m;m++)if(j=j.next=new n,m==z)var W=j;j.next=H;var G=null,X=null;x=y=0;var q=l[a],Y=u[a];for(p=0;o>p;p++){for(A=P=L=D=b=w=_=M=0,S=z*(N=k[y]),C=z*(R=k[y+1]),T=z*(O=k[y+2]),E=z*(F=k[y+3]),b+=$*N,w+=$*R,_+=$*O,M+=$*F,j=H,m=0;z>m;m++)j.r=N,j.g=R,j.b=O,j.a=F,j=j.next;for(m=1;z>m;m++)g=y+((m>V?V:m)<<2),b+=(j.r=N=k[g])*(I=z-m),w+=(j.g=R=k[g+1])*I,_+=(j.b=O=k[g+2])*I,M+=(j.a=F=k[g+3])*I,A+=N,P+=R,L+=O,D+=F,j=j.next;for(G=H,X=W,d=0;r>d;d++)k[y+3]=F=M*q>>Y,0!=F?(F=255/F,k[y]=(b*q>>Y)*F,k[y+1]=(w*q>>Y)*F,k[y+2]=(_*q>>Y)*F):k[y]=k[y+1]=k[y+2]=0,b-=S,w-=C,_-=T,M-=E,S-=G.r,C-=G.g,T-=G.b,E-=G.a,g=x+((g=d+a+1)<V?g:V)<<2,A+=G.r=k[g],P+=G.g=k[g+1],L+=G.b=k[g+2],D+=G.a=k[g+3],b+=A,w+=P,_+=L,M+=D,G=G.next,S+=N=X.r,C+=R=X.g,T+=O=X.b,E+=F=X.a,A-=N,P-=R,L-=O,D-=F,X=X.next,y+=4;x+=r}for(d=0;r>d;d++){for(P=L=D=A=w=_=M=b=0,y=d<<2,S=z*(N=k[y]),C=z*(R=k[y+1]),T=z*(O=k[y+2]),E=z*(F=k[y+3]),b+=$*N,w+=$*R,_+=$*O,M+=$*F,j=H,m=0;z>m;m++)j.r=N,j.g=R,j.b=O,j.a=F,j=j.next;for(v=r,m=1;a>=m;m++)y=v+d<<2,b+=(j.r=N=k[y])*(I=z-m),w+=(j.g=R=k[y+1])*I,_+=(j.b=O=k[y+2])*I,M+=(j.a=F=k[y+3])*I,A+=N,P+=R,L+=O,D+=F,j=j.next,U>m&&(v+=r);for(y=d,G=H,X=W,p=0;o>p;p++)g=y<<2,k[g+3]=F=M*q>>Y,F>0?(F=255/F,k[g]=(b*q>>Y)*F,k[g+1]=(w*q>>Y)*F,k[g+2]=(_*q>>Y)*F):k[g]=k[g+1]=k[g+2]=0,b-=S,w-=C,_-=T,M-=E,S-=G.r,C-=G.g,T-=G.b,E-=G.a,g=d+((g=p+z)<U?g:U)*r<<2,b+=A+=G.r=k[g],w+=P+=G.g=k[g+1],_+=L+=G.b=k[g+2],M+=D+=G.a=k[g+3],G=G.next,S+=N=X.r,C+=R=X.g,T+=O=X.b,E+=F=X.a,A-=N,P-=R,L-=O,D-=F,X=X.next,y+=r}c.putImageData(s,t,i)}}function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var r,o,a;!function(e){function t(e,t){return b.call(e,t)}function i(e,t){var i,n,r,o,a,s,l,u,h,c,f,d=t&&t.split("/"),p=y.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),e=e.split("/"),a=e.length-1,y.nodeIdCompat&&_.test(e[a])&&(e[a]=e[a].replace(_,"")),e=d.concat(e),h=0;h<e.length;h+=1)if(f=e[h],"."===f)e.splice(h,1),h-=1;else if(".."===f){if(1===h&&(".."===e[2]||".."===e[0]))break;h>0&&(e.splice(h-1,2),h-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||m)&&p){for(i=e.split("/"),h=i.length;h>0;h-=1){if(n=i.slice(0,h).join("/"),d)for(c=d.length;c>0;c-=1)if(r=p[d.slice(0,c).join("/")],r&&(r=r[n])){o=r,s=h;break}if(o)break;!l&&m&&m[n]&&(l=m[n],u=h)}!o&&l&&(o=l,s=u),o&&(i.splice(0,s,o),e=i.join("/"))}return e}function n(t,i){return function(){return d.apply(e,w.call(arguments,0).concat([t,i]))}}function s(e){return function(t){return i(t,e)}}function l(e){return function(t){g[e]=t}}function u(i){if(t(v,i)){var n=v[i];delete v[i],x[i]=!0,f.apply(e,n)}if(!t(g,i)&&!t(x,i))throw new Error("No "+i);return g[i]}function h(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function c(e){return function(){return y&&y.config&&y.config[e]||{}}}var f,d,p,m,g={},v={},y={},x={},b=Object.prototype.hasOwnProperty,w=[].slice,_=/\.js$/;p=function(e,t){var n,r=h(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=u(o)),o?e=n&&n.normalize?n.normalize(e,s(t)):i(e,t):(e=i(e,t),r=h(e),o=r[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return n(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:c(e)}}},f=function(i,r,o,a){var s,h,c,f,d,y,b=[],w=typeof o;if(a=a||i,"undefined"===w||"function"===w){for(r=!r.length&&o.length?["require","exports","module"]:r,d=0;d<r.length;d+=1)if(f=p(r[d],a),h=f.f,"require"===h)b[d]=m.require(i);else if("exports"===h)b[d]=m.exports(i),y=!0;else if("module"===h)s=b[d]=m.module(i);else if(t(g,h)||t(v,h)||t(x,h))b[d]=u(h);else{if(!f.p)throw new Error(i+" missing "+h);f.p.load(f.n,n(a,!0),l(h),{}),b[d]=g[h]}c=o?o.apply(g[i],b):void 0,i&&(s&&s.exports!==e&&s.exports!==g[i]?g[i]=s.exports:c===e&&y||(g[i]=c))}else i&&(g[i]=o)},r=o=d=function(t,i,n,r,o){if("string"==typeof t)return m[t]?m[t](i):u(p(t,i).f);if(!t.splice){if(y=t,y.deps&&d(y.deps,y.callback),!i)return;i.splice?(t=i,i=n,n=null):t=e}return i=i||function(){},"function"==typeof n&&(n=r,r=o),r?f(e,t,i,n):setTimeout(function(){f(e,t,i,n)},4),d},d.config=function(e){return d(e)},r._defined=g,a=function(e,i,n){i.splice||(n=i,i=[]),t(g,e)||t(v,e)||(v[e]=[e,i,n])},a.amd={jQuery:!0}}(),a("../lib/almond/almond.js",function(){}),void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var s=s||function(){var e=[];return{REVISION:"12",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},update:function(t){if(0===e.length)return!1;var i=0;for(t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();i<e.length;)e[i].update(t)?i++:e.splice(i,1);return!0}}}();s.Tween=function(e){var t=e,i={},n={},r={},o=1e3,a=0,l=!1,u=!1,h=!1,c=0,f=null,d=s.Easing.Linear.None,p=s.Interpolation.Linear,m=[],g=null,v=!1,y=null,x=null;for(var b in e)i[b]=parseFloat(e[b],10);this.to=function(e,t){return void 0!==t&&(o=t),n=e,this},this.start=function(e){s.add(this),u=!0,v=!1,f=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),f+=c;for(var o in n){if(n[o]instanceof Array){if(0===n[o].length)continue;n[o]=[t[o]].concat(n[o])}i[o]=t[o],i[o]instanceof Array==!1&&(i[o]*=1),r[o]=i[o]||0}return this},this.stop=function(){return u?(s.remove(this),u=!1,this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=m.length;t>e;e++)m[e].stop()},this.delay=function(e){return c=e,this},this.repeat=function(e){return a=e,this},this.yoyo=function(e){return l=e,this},this.easing=function(e){return d=e,this},this.interpolation=function(e){return p=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return g=e,this},this.onUpdate=function(e){return y=e,this},this.onComplete=function(e){return x=e,this},this.update=function(e){var s;if(f>e)return!0;v===!1&&(null!==g&&g.call(t),v=!0);var u=(e-f)/o;u=u>1?1:u;var b=d(u);for(s in n){var w=i[s]||0,_=n[s];_ instanceof Array?t[s]=p(_,b):("string"==typeof _&&(_=w+parseFloat(_,10)),"number"==typeof _&&(t[s]=w+(_-w)*b))}if(null!==y&&y.call(t,b),1==u){if(a>0){isFinite(a)&&a--;for(s in r){if("string"==typeof n[s]&&(r[s]=r[s]+parseFloat(n[s],10)),l){var M=r[s];r[s]=n[s],n[s]=M,h=!h}i[s]=r[s]}return f=e+c,!0}null!==x&&x.call(t);for(var S=0,C=m.length;C>S;S++)m[S].start(e);return!1}return!0}},s.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,i=.1,n=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=n/4):t=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n)))},Out:function(e){var t,i=.1,n=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=n/4):t=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/n)+1)},InOut:function(e){var t,i=.1,n=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=n/4):t=n*Math.asin(1/i)/(2*Math.PI),(e*=2)<1?-.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n):i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-s.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*s.Easing.Bounce.In(2*e):.5*s.Easing.Bounce.Out(2*e-1)+.5}}},s.Interpolation={Linear:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),o=s.Interpolation.Utils.Linear;return 0>t?o(e[0],e[1],n):t>1?o(e[i],e[i-1],i-n):o(e[r],e[r+1>i?i:r+1],n-r)},Bezier:function(e,t){var i,n=0,r=e.length-1,o=Math.pow,a=s.Interpolation.Utils.Bernstein;for(i=0;r>=i;i++)n+=o(1-t,r-i)*o(t,i)*e[i]*a(r,i);return n},CatmullRom:function(e,t){var i=e.length-1,n=i*t,r=Math.floor(n),o=s.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(0>t&&(r=Math.floor(n=i*(1+t))),o(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],n-r)):0>t?e[0]-(o(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):o(e[r?r-1:0],e[r],e[r+1>i?i:r+1],e[r+2>i?i:r+2],n-r)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=s.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i,n=1;if(e[t])return e[t];for(i=t;i>1;i--)n*=i;return e[t]=n}}(),CatmullRom:function(e,t,i,n,r){var o=.5*(i-e),a=.5*(n-t),s=r*r,l=r*s;return(2*t-2*i+o+a)*l+(-3*t+3*i-2*o-a)*s+o*r+t}}},a("tweenjs",function(){}),function(e,t){function i(e){var t=e.length,i=ue.type(e);return ue.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||"function"!==i&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function n(e){var t=Se[e]={};return ue.each(e.match(ce)||[],function(e,i){t[i]=!0}),t}function r(e,i,n,r){if(ue.acceptData(e)){var o,a,s=ue.expando,l="string"==typeof i,u=e.nodeType,h=u?ue.cache:e,c=u?e[s]:e[s]&&s;if(c&&h[c]&&(r||h[c].data)||!l||n!==t)return c||(u?e[s]=c=ee.pop()||ue.guid++:c=s),h[c]||(h[c]={},u||(h[c].toJSON=ue.noop)),("object"==typeof i||"function"==typeof i)&&(r?h[c]=ue.extend(h[c],i):h[c].data=ue.extend(h[c].data,i)),o=h[c],r||(o.data||(o.data={}),o=o.data),n!==t&&(o[ue.camelCase(i)]=n),l?(a=o[i],null==a&&(a=o[ue.camelCase(i)])):a=o,a}}function o(e,t,i){if(ue.acceptData(e)){var n,r,o,a=e.nodeType,s=a?ue.cache:e,u=a?e[ue.expando]:ue.expando;if(s[u]){if(t&&(o=i?s[u]:s[u].data)){ue.isArray(t)?t=t.concat(ue.map(t,ue.camelCase)):t in o?t=[t]:(t=ue.camelCase(t),t=t in o?[t]:t.split(" "));for(n=0,r=t.length;r>n;n++)delete o[t[n]];if(!(i?l:ue.isEmptyObject)(o))return}(i||(delete s[u].data,l(s[u])))&&(a?ue.cleanData([e],!0):ue.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}function s(e,i,n){if(n===t&&1===e.nodeType){var r="data-"+i.replace(Te,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:Ce.test(n)?ue.parseJSON(n):n}catch(o){}ue.data(e,i,n)}else n=t}return n}function l(e){var t;for(t in e)if(("data"!==t||!ue.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function u(){return!0}function h(){return!1}function c(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function f(e,t,i){if(t=t||0,ue.isFunction(t))return ue.grep(e,function(e,n){var r=!!t.call(e,n,e);return r===i});if(t.nodeType)return ue.grep(e,function(e){return e===t===i});if("string"==typeof t){var n=ue.grep(e,function(e){return 1===e.nodeType});if(je.test(t))return ue.filter(t,n,!i);t=ue.filter(t,n)}return ue.grep(e,function(e){return ue.inArray(e,t)>=0===i})}function d(e){var t=Xe.split("|"),i=e.createDocumentFragment();if(i.createElement)for(;t.length;)i.createElement(t.pop());return i}function p(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function m(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function g(e){var t=ot.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function v(e,t){for(var i,n=0;null!=(i=e[n]);n++)ue._data(i,"globalEval",!t||ue._data(t[n],"globalEval"))}function y(e,t){if(1===t.nodeType&&ue.hasData(e)){var i,n,r,o=ue._data(e),a=ue._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(i in s)for(n=0,r=s[i].length;r>n;n++)ue.event.add(t,i,s[i][n])}a.data&&(a.data=ue.extend({},a.data))}}function x(e,t){var i,n,r;if(1===t.nodeType){if(i=t.nodeName.toLowerCase(),!ue.support.noCloneEvent&&t[ue.expando]){r=ue._data(t);for(n in r.events)ue.removeEvent(t,n,r.handle);t.removeAttribute(ue.expando)}"script"===i&&t.text!==e.text?(m(t).text=e.text,g(t)):"object"===i?(t.parentNode&&(t.outerHTML=e.outerHTML),ue.support.html5Clone&&e.innerHTML&&!ue.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===i&&it.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===i?t.defaultSelected=t.selected=e.defaultSelected:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}}function b(e,i){var n,r,o=0,a=typeof e.getElementsByTagName!==q?e.getElementsByTagName(i||"*"):typeof e.querySelectorAll!==q?e.querySelectorAll(i||"*"):t;if(!a)for(a=[],n=e.childNodes||e;null!=(r=n[o]);o++)!i||ue.nodeName(r,i)?a.push(r):ue.merge(a,b(r,i));return i===t||i&&ue.nodeName(e,i)?ue.merge([e],a):a}function w(e){it.test(e.type)&&(e.defaultChecked=e.checked)}function _(e,t){if(t in e)return t;for(var i=t.charAt(0).toUpperCase()+t.slice(1),n=t,r=Ct.length;r--;)if(t=Ct[r]+i,t in e)return t;return n}function M(e,t){return e=t||e,"none"===ue.css(e,"display")||!ue.contains(e.ownerDocument,e)}function S(e,t){for(var i,n,r,o=[],a=0,s=e.length;s>a;a++)n=e[a],n.style&&(o[a]=ue._data(n,"olddisplay"),i=n.style.display,t?(o[a]||"none"!==i||(n.style.display=""),""===n.style.display&&M(n)&&(o[a]=ue._data(n,"olddisplay",A(n.nodeName)))):o[a]||(r=M(n),(i&&"none"!==i||!r)&&ue._data(n,"olddisplay",r?i:ue.css(n,"display"))));for(a=0;s>a;a++)n=e[a],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?o[a]||"":"none"));return e}function C(e,t,i){var n=yt.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function T(e,t,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===i&&(a+=ue.css(e,i+St[o],!0,r)),n?("content"===i&&(a-=ue.css(e,"padding"+St[o],!0,r)),"margin"!==i&&(a-=ue.css(e,"border"+St[o]+"Width",!0,r))):(a+=ue.css(e,"padding"+St[o],!0,r),"padding"!==i&&(a+=ue.css(e,"border"+St[o]+"Width",!0,r)));return a}function E(e,t,i){var n=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=ct(e),a=ue.support.boxSizing&&"border-box"===ue.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=ft(e,t,o),(0>r||null==r)&&(r=e.style[t]),xt.test(r))return r;n=a&&(ue.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+T(e,t,i||(a?"border":"content"),n,o)+"px"}function A(e){var t=Y,i=wt[e];return i||(i=P(e,t),"none"!==i&&i||(ht=(ht||ue("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(ht[0].contentWindow||ht[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),i=P(e,t),ht.detach()),wt[e]=i),i}function P(e,t){var i=ue(t.createElement(e)).appendTo(t.body),n=ue.css(i[0],"display");return i.remove(),n}function L(e,t,i,n){var r;if(ue.isArray(t))ue.each(t,function(t,r){i||Et.test(e)?n(e,r):L(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==ue.type(t))n(e,t);else for(r in t)L(e+"["+r+"]",t[r],i,n)}function D(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,o=t.toLowerCase().match(ce)||[];if(ue.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function N(e,t,i,n){function r(s){var l;return o[s]=!0,ue.each(e[s]||[],function(e,s){var u=s(t,i,n);return"string"!=typeof u||a||o[u]?a?!(l=u):void 0:(t.dataTypes.unshift(u),r(u),!1)}),l}var o={},a=e===jt;return r(t.dataTypes[0])||!o["*"]&&r("*")}function R(e,i){var n,r,o=ue.ajaxSettings.flatOptions||{};for(r in i)i[r]!==t&&((o[r]?e:n||(n={}))[r]=i[r]);return n&&ue.extend(!0,e,n),e}function O(e,i,n){var r,o,a,s,l=e.contents,u=e.dataTypes,h=e.responseFields;for(s in h)s in n&&(i[h[s]]=n[s]);for(;"*"===u[0];)u.shift(),o===t&&(o=e.mimeType||i.getResponseHeader("Content-Type"));if(o)for(s in l)if(l[s]&&l[s].test(o)){u.unshift(s);break}if(u[0]in n)a=u[0];else{for(s in n){if(!u[0]||e.converters[s+" "+u[0]]){a=s;break}r||(r=s)}a=a||r}return a?(a!==u[0]&&u.unshift(a),n[a]):void 0}function F(e,t){var i,n,r,o,a={},s=0,l=e.dataTypes.slice(),u=l[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l[1])for(r in e.converters)a[r.toLowerCase()]=e.converters[r];for(;n=l[++s];)if("*"!==n){if("*"!==u&&u!==n){if(r=a[u+" "+n]||a["* "+n],!r)for(i in a)if(o=i.split(" "),o[1]===n&&(r=a[u+" "+o[0]]||a["* "+o[0]])){r===!0?r=a[i]:a[i]!==!0&&(n=o[0],l.splice(s--,0,n));break}if(r!==!0)if(r&&e["throws"])t=r(t);else try{t=r(t)}catch(h){return{state:"parsererror",error:r?h:"No conversion from "+u+" to "+n}}}u=n}return{state:"success",data:t}}function I(){try{return new e.XMLHttpRequest}catch(t){}}function k(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function B(){return setTimeout(function(){Jt=t}),Jt=ue.now()}function V(e,t){ue.each(t,function(t,i){for(var n=(oi[t]||[]).concat(oi["*"]),r=0,o=n.length;o>r;r++)if(n[r].call(e,t,i))return})}function U(e,t,i){var n,r,o=0,a=ri.length,s=ue.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=Jt||B(),i=Math.max(0,u.startTime+u.duration-t),n=i/u.duration||0,o=1-n,a=0,l=u.tweens.length;l>a;a++)u.tweens[a].run(o);return s.notifyWith(e,[u,o,i]),1>o&&l?i:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:ue.extend({},t),opts:ue.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:Jt||B(),duration:i.duration,tweens:[],createTween:function(t,i){var n=ue.Tween(e,u.opts,t,i,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(n),n},stop:function(t){var i=0,n=t?u.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)u.tweens[i].run(1);return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),h=u.props;for(z(h,u.opts.specialEasing);a>o;o++)if(n=ri[o].call(u,e,h,u.opts))return n;return V(u,h),ue.isFunction(u.opts.start)&&u.opts.start.call(e,u),ue.fx.timer(ue.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function z(e,t){var i,n,r,o,a;for(r in e)if(n=ue.camelCase(r),o=t[n],i=e[r],ue.isArray(i)&&(o=i[1],i=e[r]=i[0]),r!==n&&(e[n]=i,delete e[r]),a=ue.cssHooks[n],a&&"expand"in a){i=a.expand(i),delete e[n];for(r in i)r in e||(e[r]=i[r],t[r]=o)}else t[n]=o}function $(e,t,i){var n,r,o,a,s,l,u,h,c,f=this,d=e.style,p={},m=[],g=e.nodeType&&M(e);i.queue||(h=ue._queueHooks(e,"fx"),null==h.unqueued&&(h.unqueued=0,c=h.empty.fire,h.empty.fire=function(){h.unqueued||c()}),h.unqueued++,f.always(function(){f.always(function(){h.unqueued--,ue.queue(e,"fx").length||h.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===ue.css(e,"display")&&"none"===ue.css(e,"float")&&(ue.support.inlineBlockNeedsLayout&&"inline"!==A(e.nodeName)?d.zoom=1:d.display="inline-block")),i.overflow&&(d.overflow="hidden",ue.support.shrinkWrapBlocks||f.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(r in t)if(a=t[r],ti.exec(a)){if(delete t[r],l=l||"toggle"===a,a===(g?"hide":"show"))continue;m.push(r)}if(o=m.length){s=ue._data(e,"fxshow")||ue._data(e,"fxshow",{}),"hidden"in s&&(g=s.hidden),l&&(s.hidden=!g),g?ue(e).show():f.done(function(){ue(e).hide()}),f.done(function(){var t;ue._removeData(e,"fxshow");for(t in p)ue.style(e,t,p[t])});for(r=0;o>r;r++)n=m[r],u=f.createTween(n,g?s[n]:0),p[n]=s[n]||ue.style(e,n),n in s||(s[n]=u.start,g&&(u.end=u.start,u.start="width"===n||"height"===n?1:0))}}function H(e,t,i,n,r){return new H.prototype.init(e,t,i,n,r)}function j(e,t){var i,n={height:e},r=0;for(t=t?1:0;4>r;r+=2-t)i=St[r],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function W(e){return ue.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var G,X,q=typeof t,Y=e.document,K=e.location,Z=e.jQuery,Q=e.$,J={},ee=[],te="1.9.1",ie=ee.concat,ne=ee.push,re=ee.slice,oe=ee.indexOf,ae=J.toString,se=J.hasOwnProperty,le=te.trim,ue=function(e,t){return new ue.fn.init(e,t,X)},he=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ce=/\S+/g,fe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,de=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,pe=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,me=/^[\],:{}\s]*$/,ge=/(?:^|:|,)(?:\s*\[)+/g,ve=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ye=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,xe=/^-ms-/,be=/-([\da-z])/gi,we=function(e,t){return t.toUpperCase()},_e=function(e){(Y.addEventListener||"load"===e.type||"complete"===Y.readyState)&&(Me(),ue.ready())},Me=function(){Y.addEventListener?(Y.removeEventListener("DOMContentLoaded",_e,!1),e.removeEventListener("load",_e,!1)):(Y.detachEvent("onreadystatechange",_e),e.detachEvent("onload",_e))};ue.fn=ue.prototype={jquery:te,constructor:ue,init:function(e,i,n){var r,o;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:de.exec(e),!r||!r[1]&&i)return!i||i.jquery?(i||n).find(e):this.constructor(i).find(e);if(r[1]){if(i=i instanceof ue?i[0]:i,ue.merge(this,ue.parseHTML(r[1],i&&i.nodeType?i.ownerDocument||i:Y,!0)),pe.test(r[1])&&ue.isPlainObject(i))for(r in i)ue.isFunction(this[r])?this[r](i[r]):this.attr(r,i[r]);return this}if(o=Y.getElementById(r[2]),o&&o.parentNode){if(o.id!==r[2])return n.find(e);this.length=1,this[0]=o}return this.context=Y,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ue.isFunction(e)?n.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),ue.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return re.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=ue.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return ue.each(this,e,t)},ready:function(e){return ue.ready.promise().done(e),this},slice:function(){return this.pushStack(re.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},map:function(e){return this.pushStack(ue.map(this,function(t,i){return e.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ne,sort:[].sort,splice:[].splice},ue.fn.init.prototype=ue.fn,ue.extend=ue.fn.extend=function(){var e,i,n,r,o,a,s=arguments[0]||{},l=1,u=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[1]||{},l=2),"object"==typeof s||ue.isFunction(s)||(s={}),u===l&&(s=this,--l);u>l;l++)if(null!=(o=arguments[l]))for(r in o)e=s[r],n=o[r],s!==n&&(h&&n&&(ue.isPlainObject(n)||(i=ue.isArray(n)))?(i?(i=!1,a=e&&ue.isArray(e)?e:[]):a=e&&ue.isPlainObject(e)?e:{},s[r]=ue.extend(h,a,n)):n!==t&&(s[r]=n));return s},ue.extend({noConflict:function(t){return e.$===ue&&(e.$=Q),t&&e.jQuery===ue&&(e.jQuery=Z),ue},isReady:!1,readyWait:1,holdReady:function(e){e?ue.readyWait++:ue.ready(!0)},ready:function(e){if(e===!0?!--ue.readyWait:!ue.isReady){if(!Y.body)return setTimeout(ue.ready);ue.isReady=!0,e!==!0&&--ue.readyWait>0||(G.resolveWith(Y,[ue]),ue.fn.trigger&&ue(Y).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===ue.type(e)},isArray:Array.isArray||function(e){return"array"===ue.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?J[ae.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==ue.type(e)||e.nodeType||ue.isWindow(e))return!1;try{if(e.constructor&&!se.call(e,"constructor")&&!se.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}var n;for(n in e);return n===t||se.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||Y;var n=pe.exec(e),r=!i&&[];return n?[t.createElement(n[1])]:(n=ue.buildFragment([e],t,r),r&&ue(r).remove(),ue.merge([],n.childNodes))},parseJSON:function(t){return e.JSON&&e.JSON.parse?e.JSON.parse(t):null===t?t:"string"==typeof t&&(t=ue.trim(t),t&&me.test(t.replace(ve,"@").replace(ye,"]").replace(ge,"")))?new Function("return "+t)():void ue.error("Invalid JSON: "+t)},parseXML:function(i){var n,r;if(!i||"string"!=typeof i)return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(i,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(i))}catch(o){n=t}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||ue.error("Invalid XML: "+i),n},noop:function(){},globalEval:function(t){t&&ue.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(xe,"ms-").replace(be,we)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,o=0,a=e.length,s=i(e);if(n){if(s)for(;a>o&&(r=t.apply(e[o],n),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],n),r===!1)break}else if(s)for(;a>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:le&&!le.call("\ufeffÂ ")?function(e){return null==e?"":le.call(e)}:function(e){return null==e?"":(e+"").replace(fe,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?ue.merge(n,"string"==typeof e?[e]:e):ne.call(n,e)),n},inArray:function(e,t,i){var n;if(t){if(oe)return oe.call(t,e,i);for(n=t.length,i=i?0>i?Math.max(0,n+i):i:0;n>i;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,i){var n=i.length,r=e.length,o=0;if("number"==typeof n)for(;n>o;o++)e[r++]=i[o];else for(;i[o]!==t;)e[r++]=i[o++];return e.length=r,e},grep:function(e,t,i){var n,r=[],o=0,a=e.length;for(i=!!i;a>o;o++)n=!!t(e[o],o),i!==n&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,a=e.length,s=i(e),l=[];if(s)for(;a>o;o++)r=t(e[o],o,n),null!=r&&(l[l.length]=r);else for(o in e)r=t(e[o],o,n),null!=r&&(l[l.length]=r);return ie.apply([],l)},guid:1,proxy:function(e,i){var n,r,o;return"string"==typeof i&&(o=e[i],i=e,e=o),ue.isFunction(e)?(n=re.call(arguments,2),r=function(){return e.apply(i||this,n.concat(re.call(arguments)));
},r.guid=e.guid=e.guid||ue.guid++,r):t},access:function(e,i,n,r,o,a,s){var l=0,u=e.length,h=null==n;if("object"===ue.type(n)){o=!0;for(l in n)ue.access(e,i,l,n[l],!0,a,s)}else if(r!==t&&(o=!0,ue.isFunction(r)||(s=!0),h&&(s?(i.call(e,r),i=null):(h=i,i=function(e,t,i){return h.call(ue(e),i)})),i))for(;u>l;l++)i(e[l],n,s?r:r.call(e[l],l,i(e[l],n)));return o?e:h?i.call(e):u?i(e[0],n):a},now:function(){return(new Date).getTime()}}),ue.ready.promise=function(t){if(!G)if(G=ue.Deferred(),"complete"===Y.readyState)setTimeout(ue.ready);else if(Y.addEventListener)Y.addEventListener("DOMContentLoaded",_e,!1),e.addEventListener("load",_e,!1);else{Y.attachEvent("onreadystatechange",_e),e.attachEvent("onload",_e);var i=!1;try{i=null==e.frameElement&&Y.documentElement}catch(n){}i&&i.doScroll&&!function r(){if(!ue.isReady){try{i.doScroll("left")}catch(e){return setTimeout(r,50)}Me(),ue.ready()}}()}return G.promise(t)},ue.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){J["[object "+t+"]"]=t.toLowerCase()}),X=ue(Y);var Se={};ue.Callbacks=function(e){e="string"==typeof e?Se[e]||n(e):ue.extend({},e);var i,r,o,a,s,l,u=[],h=!e.once&&[],c=function(t){for(r=e.memory&&t,o=!0,s=l||0,l=0,a=u.length,i=!0;u&&a>s;s++)if(u[s].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}i=!1,u&&(h?h.length&&c(h.shift()):r?u=[]:f.disable())},f={add:function(){if(u){var t=u.length;!function n(t){ue.each(t,function(t,i){var r=ue.type(i);"function"===r?e.unique&&f.has(i)||u.push(i):i&&i.length&&"string"!==r&&n(i)})}(arguments),i?a=u.length:r&&(l=t,c(r))}return this},remove:function(){return u&&ue.each(arguments,function(e,t){for(var n;(n=ue.inArray(t,u,n))>-1;)u.splice(n,1),i&&(a>=n&&a--,s>=n&&s--)}),this},has:function(e){return e?ue.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=h=r=t,this},disabled:function(){return!u},lock:function(){return h=t,r||f.disable(),this},locked:function(){return!h},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||o&&!h||(i?h.push(t):c(t)),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ue.extend({Deferred:function(e){var t=[["resolve","done",ue.Callbacks("once memory"),"resolved"],["reject","fail",ue.Callbacks("once memory"),"rejected"],["notify","progress",ue.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return ue.Deferred(function(i){ue.each(t,function(t,o){var a=o[0],s=ue.isFunction(e[t])&&e[t];r[o[1]](function(){var e=s&&s.apply(this,arguments);e&&ue.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[a+"With"](this===n?i.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ue.extend(e,n):n}},r={};return n.pipe=n.then,ue.each(t,function(e,o){var a=o[2],s=o[3];n[o[1]]=a.add,s&&a.add(function(){i=s},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=a.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=re.call(arguments),a=o.length,s=1!==a||e&&ue.isFunction(e.promise)?a:0,l=1===s?e:ue.Deferred(),u=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?re.call(arguments):r,n===t?l.notifyWith(i,n):--s||l.resolveWith(i,n)}};if(a>1)for(t=new Array(a),i=new Array(a),n=new Array(a);a>r;r++)o[r]&&ue.isFunction(o[r].promise)?o[r].promise().done(u(r,n,o)).fail(l.reject).progress(u(r,i,t)):--s;return s||l.resolveWith(n,o),l.promise()}}),ue.support=function(){var t,i,n,r,o,a,s,l,u,h,c=Y.createElement("div");if(c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=c.getElementsByTagName("*"),n=c.getElementsByTagName("a")[0],!i||!n||!i.length)return{};o=Y.createElement("select"),s=o.appendChild(Y.createElement("option")),r=c.getElementsByTagName("input")[0],n.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==c.className,leadingWhitespace:3===c.firstChild.nodeType,tbody:!c.getElementsByTagName("tbody").length,htmlSerialize:!!c.getElementsByTagName("link").length,style:/top/.test(n.getAttribute("style")),hrefNormalized:"/a"===n.getAttribute("href"),opacity:/^0.5/.test(n.style.opacity),cssFloat:!!n.style.cssFloat,checkOn:!!r.value,optSelected:s.selected,enctype:!!Y.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==Y.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===Y.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},r.checked=!0,t.noCloneChecked=r.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!s.disabled;try{delete c.test}catch(f){t.deleteExpando=!1}r=Y.createElement("input"),r.setAttribute("value",""),t.input=""===r.getAttribute("value"),r.value="t",r.setAttribute("type","radio"),t.radioValue="t"===r.value,r.setAttribute("checked","t"),r.setAttribute("name","t"),a=Y.createDocumentFragment(),a.appendChild(r),t.appendChecked=r.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,c.attachEvent&&(c.attachEvent("onclick",function(){t.noCloneEvent=!1}),c.cloneNode(!0).click());for(h in{submit:!0,change:!0,focusin:!0})c.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||c.attributes[l].expando===!1;return c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===c.style.backgroundClip,ue(function(){var i,n,r,o="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=Y.getElementsByTagName("body")[0];a&&(i=Y.createElement("div"),i.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(i).appendChild(c),c.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=c.getElementsByTagName("td"),r[0].style.cssText="padding:0;margin:0;border:0;display:none",u=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",t.reliableHiddenOffsets=u&&0===r[0].offsetHeight,c.innerHTML="",c.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===c.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(c,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(c,null)||{width:"4px"}).width,n=c.appendChild(Y.createElement("div")),n.style.cssText=c.style.cssText=o,n.style.marginRight=n.style.width="0",c.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(n,null)||{}).marginRight)),typeof c.style.zoom!==q&&(c.innerHTML="",c.style.cssText=o+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===c.offsetWidth,c.style.display="block",c.innerHTML="<div></div>",c.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==c.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(i),i=c=r=n=null)}),i=o=a=s=n=r=null,t}();var Ce=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Te=/([A-Z])/g;ue.extend({cache:{},expando:"jQuery"+(te+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?ue.cache[e[ue.expando]]:e[ue.expando],!!e&&!l(e)},data:function(e,t,i){return r(e,t,i)},removeData:function(e,t){return o(e,t)},_data:function(e,t,i){return r(e,t,i,!0)},_removeData:function(e,t){return o(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&ue.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),ue.fn.extend({data:function(e,i){var n,r,o=this[0],a=0,l=null;if(e===t){if(this.length&&(l=ue.data(o),1===o.nodeType&&!ue._data(o,"parsedAttrs"))){for(n=o.attributes;a<n.length;a++)r=n[a].name,r.indexOf("data-")||(r=ue.camelCase(r.slice(5)),s(o,r,l[r]));ue._data(o,"parsedAttrs",!0)}return l}return"object"==typeof e?this.each(function(){ue.data(this,e)}):ue.access(this,function(i){return i===t?o?s(o,e,ue.data(o,e)):null:void this.each(function(){ue.data(this,e,i)})},null,i,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){ue.removeData(this,e)})}}),ue.extend({queue:function(e,t,i){var n;return e?(t=(t||"fx")+"queue",n=ue._data(e,t),i&&(!n||ue.isArray(i)?n=ue._data(e,t,ue.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=ue.queue(e,t),n=i.length,r=i.shift(),o=ue._queueHooks(e,t),a=function(){ue.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),o.cur=r,r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,a,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return ue._data(e,i)||ue._data(e,i,{empty:ue.Callbacks("once memory").add(function(){ue._removeData(e,t+"queue"),ue._removeData(e,i)})})}}),ue.fn.extend({queue:function(e,i){var n=2;return"string"!=typeof e&&(i=e,e="fx",n--),arguments.length<n?ue.queue(this[0],e):i===t?this:this.each(function(){var t=ue.queue(this,e,i);ue._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&ue.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ue.dequeue(this,e)})},delay:function(e,t){return e=ue.fx?ue.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,i){var n,r=1,o=ue.Deferred(),a=this,s=this.length,l=function(){--r||o.resolveWith(a,[a])};for("string"!=typeof e&&(i=e,e=t),e=e||"fx";s--;)n=ue._data(a[s],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(l));return l(),o.promise(i)}});var Ee,Ae,Pe=/[\t\r\n]/g,Le=/\r/g,De=/^(?:input|select|textarea|button|object)$/i,Ne=/^(?:a|area)$/i,Re=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Oe=/^(?:checked|selected)$/i,Fe=ue.support.getSetAttribute,Ie=ue.support.input;ue.fn.extend({attr:function(e,t){return ue.access(this,ue.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ue.removeAttr(this,e)})},prop:function(e,t){return ue.access(this,ue.prop,e,t,arguments.length>1)},removeProp:function(e){return e=ue.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(i){}})},addClass:function(e){var t,i,n,r,o,a=0,s=this.length,l="string"==typeof e&&e;if(ue.isFunction(e))return this.each(function(t){ue(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ce)||[];s>a;a++)if(i=this[a],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Pe," "):" ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");i.className=ue.trim(n)}return this},removeClass:function(e){var t,i,n,r,o,a=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(ue.isFunction(e))return this.each(function(t){ue(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ce)||[];s>a;a++)if(i=this[a],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Pe," "):"")){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");i.className=e?ue.trim(n):""}return this},toggleClass:function(e,t){var i=typeof e,n="boolean"==typeof t;return ue.isFunction(e)?this.each(function(i){ue(this).toggleClass(e.call(this,i,this.className,t),t)}):this.each(function(){if("string"===i)for(var r,o=0,a=ue(this),s=t,l=e.match(ce)||[];r=l[o++];)s=n?s:!a.hasClass(r),a[s?"addClass":"removeClass"](r);else(i===q||"boolean"===i)&&(this.className&&ue._data(this,"__className__",this.className),this.className=this.className||e===!1?"":ue._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(Pe," ").indexOf(t)>=0)return!0;return!1},val:function(e){var i,n,r,o=this[0];{if(arguments.length)return r=ue.isFunction(e),this.each(function(i){var o,a=ue(this);1===this.nodeType&&(o=r?e.call(this,i,a.val()):e,null==o?o="":"number"==typeof o?o+="":ue.isArray(o)&&(o=ue.map(o,function(e){return null==e?"":e+""})),n=ue.valHooks[this.type]||ue.valHooks[this.nodeName.toLowerCase()],n&&"set"in n&&n.set(this,o,"value")!==t||(this.value=o))});if(o)return n=ue.valHooks[o.type]||ue.valHooks[o.nodeName.toLowerCase()],n&&"get"in n&&(i=n.get(o,"value"))!==t?i:(i=o.value,"string"==typeof i?i.replace(Le,""):null==i?"":i)}}}),ue.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,a=o?null:[],s=o?r+1:n.length,l=0>r?s:o?r:0;s>l;l++)if(i=n[l],!(!i.selected&&l!==r||(ue.support.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&ue.nodeName(i.parentNode,"optgroup"))){if(t=ue(i).val(),o)return t;a.push(t)}return a},set:function(e,t){var i=ue.makeArray(t);return ue(e).find("option").each(function(){this.selected=ue.inArray(ue(this).val(),i)>=0}),i.length||(e.selectedIndex=-1),i}}},attr:function(e,i,n){var r,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===q?ue.prop(e,i,n):(o=1!==s||!ue.isXMLDoc(e),o&&(i=i.toLowerCase(),r=ue.attrHooks[i]||(Re.test(i)?Ae:Ee)),n===t?r&&o&&"get"in r&&null!==(a=r.get(e,i))?a:(typeof e.getAttribute!==q&&(a=e.getAttribute(i)),null==a?t:a):null!==n?r&&o&&"set"in r&&(a=r.set(e,n,i))!==t?a:(e.setAttribute(i,n+""),n):void ue.removeAttr(e,i))},removeAttr:function(e,t){var i,n,r=0,o=t&&t.match(ce);if(o&&1===e.nodeType)for(;i=o[r++];)n=ue.propFix[i]||i,Re.test(i)?!Fe&&Oe.test(i)?e[ue.camelCase("default-"+i)]=e[n]=!1:e[n]=!1:ue.attr(e,i,""),e.removeAttribute(Fe?i:n)},attrHooks:{type:{set:function(e,t){if(!ue.support.radioValue&&"radio"===t&&ue.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,i,n){var r,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!ue.isXMLDoc(e),a&&(i=ue.propFix[i]||i,o=ue.propHooks[i]),n!==t?o&&"set"in o&&(r=o.set(e,n,i))!==t?r:e[i]=n:o&&"get"in o&&null!==(r=o.get(e,i))?r:e[i]},propHooks:{tabIndex:{get:function(e){var i=e.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):De.test(e.nodeName)||Ne.test(e.nodeName)&&e.href?0:t}}}}),Ae={get:function(e,i){var n=ue.prop(e,i),r="boolean"==typeof n&&e.getAttribute(i),o="boolean"==typeof n?Ie&&Fe?null!=r:Oe.test(i)?e[ue.camelCase("default-"+i)]:!!r:e.getAttributeNode(i);return o&&o.value!==!1?i.toLowerCase():t},set:function(e,t,i){return t===!1?ue.removeAttr(e,i):Ie&&Fe||!Oe.test(i)?e.setAttribute(!Fe&&ue.propFix[i]||i,i):e[ue.camelCase("default-"+i)]=e[i]=!0,i}},Ie&&Fe||(ue.attrHooks.value={get:function(e,i){var n=e.getAttributeNode(i);return ue.nodeName(e,"input")?e.defaultValue:n&&n.specified?n.value:t},set:function(e,t,i){return ue.nodeName(e,"input")?void(e.defaultValue=t):Ee&&Ee.set(e,t,i)}}),Fe||(Ee=ue.valHooks.button={get:function(e,i){var n=e.getAttributeNode(i);return n&&("id"===i||"name"===i||"coords"===i?""!==n.value:n.specified)?n.value:t},set:function(e,i,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=i+="","value"===n||i===e.getAttribute(n)?i:t}},ue.attrHooks.contenteditable={get:Ee.get,set:function(e,t,i){Ee.set(e,""===t?!1:t,i)}},ue.each(["width","height"],function(e,t){ue.attrHooks[t]=ue.extend(ue.attrHooks[t],{set:function(e,i){return""===i?(e.setAttribute(t,"auto"),i):void 0}})})),ue.support.hrefNormalized||(ue.each(["href","src","width","height"],function(e,i){ue.attrHooks[i]=ue.extend(ue.attrHooks[i],{get:function(e){var n=e.getAttribute(i,2);return null==n?t:n}})}),ue.each(["href","src"],function(e,t){ue.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),ue.support.style||(ue.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),ue.support.optSelected||(ue.propHooks.selected=ue.extend(ue.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),ue.support.enctype||(ue.propFix.enctype="encoding"),ue.support.checkOn||ue.each(["radio","checkbox"],function(){ue.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),ue.each(["radio","checkbox"],function(){ue.valHooks[this]=ue.extend(ue.valHooks[this],{set:function(e,t){return ue.isArray(t)?e.checked=ue.inArray(ue(e).val(),t)>=0:void 0}})});var ke=/^(?:input|select|textarea)$/i,Be=/^key/,Ve=/^(?:mouse|contextmenu)|click/,Ue=/^(?:focusinfocus|focusoutblur)$/,ze=/^([^.]*)(?:\.(.+)|)$/;ue.event={global:{},add:function(e,i,n,r,o){var a,s,l,u,h,c,f,d,p,m,g,v=ue._data(e);if(v){for(n.handler&&(u=n,n=u.handler,o=u.selector),n.guid||(n.guid=ue.guid++),(s=v.events)||(s=v.events={}),(c=v.handle)||(c=v.handle=function(e){return typeof ue===q||e&&ue.event.triggered===e.type?t:ue.event.dispatch.apply(c.elem,arguments)},c.elem=e),i=(i||"").match(ce)||[""],l=i.length;l--;)a=ze.exec(i[l])||[],p=g=a[1],m=(a[2]||"").split(".").sort(),h=ue.event.special[p]||{},p=(o?h.delegateType:h.bindType)||p,h=ue.event.special[p]||{},f=ue.extend({type:p,origType:g,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&ue.expr.match.needsContext.test(o),namespace:m.join(".")},u),(d=s[p])||(d=s[p]=[],d.delegateCount=0,h.setup&&h.setup.call(e,r,m,c)!==!1||(e.addEventListener?e.addEventListener(p,c,!1):e.attachEvent&&e.attachEvent("on"+p,c))),h.add&&(h.add.call(e,f),f.handler.guid||(f.handler.guid=n.guid)),o?d.splice(d.delegateCount++,0,f):d.push(f),ue.event.global[p]=!0;e=null}},remove:function(e,t,i,n,r){var o,a,s,l,u,h,c,f,d,p,m,g=ue.hasData(e)&&ue._data(e);if(g&&(h=g.events)){for(t=(t||"").match(ce)||[""],u=t.length;u--;)if(s=ze.exec(t[u])||[],d=m=s[1],p=(s[2]||"").split(".").sort(),d){for(c=ue.event.special[d]||{},d=(n?c.delegateType:c.bindType)||d,f=h[d]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=f.length;o--;)a=f[o],!r&&m!==a.origType||i&&i.guid!==a.guid||s&&!s.test(a.namespace)||n&&n!==a.selector&&("**"!==n||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,c.remove&&c.remove.call(e,a));l&&!f.length&&(c.teardown&&c.teardown.call(e,p,g.handle)!==!1||ue.removeEvent(e,d,g.handle),delete h[d])}else for(d in h)ue.event.remove(e,d+t[u],i,n,!0);ue.isEmptyObject(h)&&(delete g.handle,ue._removeData(e,"events"))}},trigger:function(i,n,r,o){var a,s,l,u,h,c,f,d=[r||Y],p=se.call(i,"type")?i.type:i,m=se.call(i,"namespace")?i.namespace.split("."):[];if(l=c=r=r||Y,3!==r.nodeType&&8!==r.nodeType&&!Ue.test(p+ue.event.triggered)&&(p.indexOf(".")>=0&&(m=p.split("."),p=m.shift(),m.sort()),s=p.indexOf(":")<0&&"on"+p,i=i[ue.expando]?i:new ue.Event(p,"object"==typeof i&&i),i.isTrigger=!0,i.namespace=m.join("."),i.namespace_re=i.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,i.result=t,i.target||(i.target=r),n=null==n?[i]:ue.makeArray(n,[i]),h=ue.event.special[p]||{},o||!h.trigger||h.trigger.apply(r,n)!==!1)){if(!o&&!h.noBubble&&!ue.isWindow(r)){for(u=h.delegateType||p,Ue.test(u+p)||(l=l.parentNode);l;l=l.parentNode)d.push(l),c=l;c===(r.ownerDocument||Y)&&d.push(c.defaultView||c.parentWindow||e)}for(f=0;(l=d[f++])&&!i.isPropagationStopped();)i.type=f>1?u:h.bindType||p,a=(ue._data(l,"events")||{})[i.type]&&ue._data(l,"handle"),a&&a.apply(l,n),a=s&&l[s],a&&ue.acceptData(l)&&a.apply&&a.apply(l,n)===!1&&i.preventDefault();if(i.type=p,!(o||i.isDefaultPrevented()||h._default&&h._default.apply(r.ownerDocument,n)!==!1||"click"===p&&ue.nodeName(r,"a")||!ue.acceptData(r)||!s||!r[p]||ue.isWindow(r))){c=r[s],c&&(r[s]=null),ue.event.triggered=p;try{r[p]()}catch(g){}ue.event.triggered=t,c&&(r[s]=c)}return i.result}},dispatch:function(e){e=ue.event.fix(e);var i,n,r,o,a,s=[],l=re.call(arguments),u=(ue._data(this,"events")||{})[e.type]||[],h=ue.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!h.preDispatch||h.preDispatch.call(this,e)!==!1){for(s=ue.event.handlers.call(this,e,u),i=0;(o=s[i++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,a=0;(r=o.handlers[a++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(r.namespace))&&(e.handleObj=r,e.data=r.data,n=((ue.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,l),n!==t&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,e),e.result}},handlers:function(e,i){var n,r,o,a,s=[],l=i.delegateCount,u=e.target;if(l&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(o=[],a=0;l>a;a++)r=i[a],n=r.selector+" ",o[n]===t&&(o[n]=r.needsContext?ue(n,this).index(u)>=0:ue.find(n,this,null,[u]).length),o[n]&&o.push(r);o.length&&s.push({elem:u,handlers:o})}return l<i.length&&s.push({elem:this,handlers:i.slice(l)}),s},fix:function(e){if(e[ue.expando])return e;var t,i,n,r=e.type,o=e,a=this.fixHooks[r];for(a||(this.fixHooks[r]=a=Ve.test(r)?this.mouseHooks:Be.test(r)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,e=new ue.Event(o),t=n.length;t--;)i=n[t],e[i]=o[i];return e.target||(e.target=o.srcElement||Y),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,a.filter?a.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,i){var n,r,o,a=i.button,s=i.fromElement;return null==e.pageX&&null!=i.clientX&&(r=e.target.ownerDocument||Y,o=r.documentElement,n=r.body,e.pageX=i.clientX+(o&&o.scrollLeft||n&&n.scrollLeft||0)-(o&&o.clientLeft||n&&n.clientLeft||0),e.pageY=i.clientY+(o&&o.scrollTop||n&&n.scrollTop||0)-(o&&o.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?i.toElement:s),e.which||a===t||(e.which=1&a?1:2&a?3:4&a?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return ue.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0}},focus:{trigger:function(){if(this!==Y.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===Y.activeElement&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,n){var r=ue.extend(new ue.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?ue.event.trigger(r,null,t):ue.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},ue.removeEvent=Y.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){var n="on"+t;e.detachEvent&&(typeof e[n]===q&&(e[n]=null),e.detachEvent(n,i))},ue.Event=function(e,t){return this instanceof ue.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?u:h):this.type=e,t&&ue.extend(this,t),this.timeStamp=e&&e.timeStamp||ue.now(),void(this[ue.expando]=!0)):new ue.Event(e,t)},ue.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=u,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=u,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=u,this.stopPropagation()}},ue.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){ue.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==n&&!ue.contains(n,r))&&(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),ue.support.submitBubbles||(ue.event.special.submit={setup:function(){return ue.nodeName(this,"form")?!1:void ue.event.add(this,"click._submit keypress._submit",function(e){var i=e.target,n=ue.nodeName(i,"input")||ue.nodeName(i,"button")?i.form:t;n&&!ue._data(n,"submitBubbles")&&(ue.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),ue._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&ue.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return ue.nodeName(this,"form")?!1:void ue.event.remove(this,"._submit")}}),ue.support.changeBubbles||(ue.event.special.change={setup:function(){return ke.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ue.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),ue.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),ue.event.simulate("change",this,e,!0)})),!1):void ue.event.add(this,"beforeactivate._change",function(e){var t=e.target;ke.test(t.nodeName)&&!ue._data(t,"changeBubbles")&&(ue.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||ue.event.simulate("change",this.parentNode,e,!0)}),ue._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return ue.event.remove(this,"._change"),!ke.test(this.nodeName)}}),ue.support.focusinBubbles||ue.each({focus:"focusin",blur:"focusout"},function(e,t){var i=0,n=function(e){ue.event.simulate(t,e.target,ue.event.fix(e),!0)};ue.event.special[t]={setup:function(){0===i++&&Y.addEventListener(e,n,!0)},teardown:function(){0===--i&&Y.removeEventListener(e,n,!0)}}}),ue.fn.extend({on:function(e,i,n,r,o){var a,s;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=t);for(a in e)this.on(a,i,n,e[a],o);return this}if(null==n&&null==r?(r=i,n=i=t):null==r&&("string"==typeof i?(r=n,n=t):(r=n,n=i,i=t)),r===!1)r=h;else if(!r)return this;return 1===o&&(s=r,r=function(e){return ue().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=ue.guid++)),this.each(function(){ue.event.add(this,e,r,n,i)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,i,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ue(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(o in e)this.off(o,i,e[o]);return this}return(i===!1||"function"==typeof i)&&(n=i,i=t),n===!1&&(n=h),this.each(function(){ue.event.remove(this,e,n,i)})},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},trigger:function(e,t){return this.each(function(){ue.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?ue.event.trigger(e,t,i,!0):void 0}}),function(e,t){function i(e){return pe.test(e+"")}function n(){var e,t=[];return e=function(i,n){return t.push(i+=" ")>S.cacheLength&&delete e[t.shift()],e[i]=n}}function r(e){return e[V]=!0,e}function o(e){var t=D.createElement("div");try{return e(t)}catch(i){return!1}finally{t=null}}function a(e,t,i,n){var r,o,a,s,l,u,h,d,p,m;if((t?t.ownerDocument||t:U)!==D&&L(t),t=t||D,i=i||[],!e||"string"!=typeof e)return i;if(1!==(s=t.nodeType)&&9!==s)return[];if(!R&&!n){if(r=me.exec(e))if(a=r[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return i;if(o.id===a)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&k(t,o)&&o.id===a)return i.push(o),i}else{if(r[2])return Z.apply(i,Q.call(t.getElementsByTagName(e),0)),i;if((a=r[3])&&z.getByClassName&&t.getElementsByClassName)return Z.apply(i,Q.call(t.getElementsByClassName(a),0)),i}if(z.qsa&&!O.test(e)){if(h=!0,d=V,p=t,m=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(u=c(e),(h=t.getAttribute("id"))?d=h.replace(ye,"\\$&"):t.setAttribute("id",d),d="[id='"+d+"'] ",l=u.length;l--;)u[l]=d+f(u[l]);p=de.test(e)&&t.parentNode||t,m=u.join(",")}if(m)try{return Z.apply(i,Q.call(p.querySelectorAll(m),0)),i}catch(g){}finally{h||t.removeAttribute("id")}}}return b(e.replace(ae,"$1"),t,i,n)}function s(e,t){var i=t&&e,n=i&&(~t.sourceIndex||q)-(~e.sourceIndex||q);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function l(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function u(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function h(e){return r(function(t){return t=+t,r(function(i,n){for(var r,o=e([],i.length,t),a=o.length;a--;)i[r=o[a]]&&(i[r]=!(n[r]=i[r]))})})}function c(e,t){var i,n,r,o,s,l,u,h=W[e+" "];if(h)return t?0:h.slice(0);for(s=e,l=[],u=S.preFilter;s;){(!i||(n=se.exec(s)))&&(n&&(s=s.slice(n[0].length)||s),l.push(r=[])),i=!1,(n=le.exec(s))&&(i=n.shift(),r.push({value:i,type:n[0].replace(ae," ")}),s=s.slice(i.length));for(o in S.filter)!(n=fe[o].exec(s))||u[o]&&!(n=u[o](n))||(i=n.shift(),r.push({value:i,type:o,matches:n}),s=s.slice(i.length));if(!i)break}return t?s.length:s?a.error(e):W(e,l).slice(0)}function f(e){for(var t=0,i=e.length,n="";i>t;t++)n+=e[t].value;return n}function d(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=H++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,a){var s,l,u,h=$+" "+o;if(a){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,a))return!0}else for(;t=t[n];)if(1===t.nodeType||r)if(u=t[V]||(t[V]={}),(l=u[n])&&l[0]===h){if((s=l[1])===!0||s===M)return s===!0}else if(l=u[n]=[h],l[1]=e(t,i,a)||M,l[1]===!0)return!0}}function p(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function m(e,t,i,n,r){for(var o,a=[],s=0,l=e.length,u=null!=t;l>s;s++)(o=e[s])&&(!i||i(o,n,r))&&(a.push(o),u&&t.push(s));return a}function g(e,t,i,n,o,a){return n&&!n[V]&&(n=g(n)),o&&!o[V]&&(o=g(o,a)),r(function(r,a,s,l){var u,h,c,f=[],d=[],p=a.length,g=r||x(t||"*",s.nodeType?[s]:s,[]),v=!e||!r&&t?g:m(g,f,e,s,l),y=i?o||(r?e:p||n)?[]:a:v;if(i&&i(v,y,s,l),n)for(u=m(y,d),n(u,[],s,l),h=u.length;h--;)(c=u[h])&&(y[d[h]]=!(v[d[h]]=c));if(r){if(o||e){if(o){for(u=[],h=y.length;h--;)(c=y[h])&&u.push(v[h]=c);o(null,y=[],u,l)}for(h=y.length;h--;)(c=y[h])&&(u=o?J.call(r,c):f[h])>-1&&(r[u]=!(a[u]=c))}}else y=m(y===a?y.splice(p,y.length):y),o?o(null,a,y,l):Z.apply(a,y)})}function v(e){for(var t,i,n,r=e.length,o=S.relative[e[0].type],a=o||S.relative[" "],s=o?1:0,l=d(function(e){return e===t},a,!0),u=d(function(e){return J.call(t,e)>-1},a,!0),h=[function(e,i,n){return!o&&(n||i!==P)||((t=i).nodeType?l(e,i,n):u(e,i,n))}];r>s;s++)if(i=S.relative[e[s].type])h=[d(p(h),i)];else{if(i=S.filter[e[s].type].apply(null,e[s].matches),i[V]){for(n=++s;r>n&&!S.relative[e[n].type];n++);return g(s>1&&p(h),s>1&&f(e.slice(0,s-1)).replace(ae,"$1"),i,n>s&&v(e.slice(s,n)),r>n&&v(e=e.slice(n)),r>n&&f(e))}h.push(i)}return p(h)}function y(e,t){var i=0,n=t.length>0,o=e.length>0,s=function(r,s,l,u,h){var c,f,d,p=[],g=0,v="0",y=r&&[],x=null!=h,b=P,w=r||o&&S.find.TAG("*",h&&s.parentNode||s),_=$+=null==b?1:Math.random()||.1;for(x&&(P=s!==D&&s,M=i);null!=(c=w[v]);v++){if(o&&c){for(f=0;d=e[f++];)if(d(c,s,l)){
u.push(c);break}x&&($=_,M=++i)}n&&((c=!d&&c)&&g--,r&&y.push(c))}if(g+=v,n&&v!==g){for(f=0;d=t[f++];)d(y,p,s,l);if(r){if(g>0)for(;v--;)y[v]||p[v]||(p[v]=K.call(u));p=m(p)}Z.apply(u,p),x&&!r&&p.length>0&&g+t.length>1&&a.uniqueSort(u)}return x&&($=_,P=b),y};return n?r(s):s}function x(e,t,i){for(var n=0,r=t.length;r>n;n++)a(e,t[n],i);return i}function b(e,t,i,n){var r,o,a,s,l,u=c(e);if(!n&&1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&9===t.nodeType&&!R&&S.relative[o[1].type]){if(t=S.find.ID(a.matches[0].replace(be,we),t)[0],!t)return i;e=e.slice(o.shift().value.length)}for(r=fe.needsContext.test(e)?0:o.length;r--&&(a=o[r],!S.relative[s=a.type]);)if((l=S.find[s])&&(n=l(a.matches[0].replace(be,we),de.test(o[0].type)&&t.parentNode||t))){if(o.splice(r,1),e=n.length&&f(o),!e)return Z.apply(i,Q.call(n,0)),i;break}}return E(e,u)(n,t,R,i,de.test(e)),i}function w(){}var _,M,S,C,T,E,A,P,L,D,N,R,O,F,I,k,B,V="sizzle"+-new Date,U=e.document,z={},$=0,H=0,j=n(),W=n(),G=n(),X=typeof t,q=1<<31,Y=[],K=Y.pop,Z=Y.push,Q=Y.slice,J=Y.indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]===e)return t;return-1},ee="[\\x20\\t\\r\\n\\f]",te="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ie=te.replace("w","w#"),ne="([*^$|!~]?=)",re="\\["+ee+"*("+te+")"+ee+"*(?:"+ne+ee+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ie+")|)|)"+ee+"*\\]",oe=":("+te+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+re.replace(3,8)+")*)|.*)\\)|)",ae=new RegExp("^"+ee+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ee+"+$","g"),se=new RegExp("^"+ee+"*,"+ee+"*"),le=new RegExp("^"+ee+"*([\\x20\\t\\r\\n\\f>+~])"+ee+"*"),he=new RegExp(oe),ce=new RegExp("^"+ie+"$"),fe={ID:new RegExp("^#("+te+")"),CLASS:new RegExp("^\\.("+te+")"),NAME:new RegExp("^\\[name=['\"]?("+te+")['\"]?\\]"),TAG:new RegExp("^("+te.replace("w","w*")+")"),ATTR:new RegExp("^"+re),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ee+"*(even|odd|(([+-]|)(\\d*)n|)"+ee+"*(?:([+-]|)"+ee+"*(\\d+)|))"+ee+"*\\)|)","i"),needsContext:new RegExp("^"+ee+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ee+"*((?:-\\d)?\\d*)"+ee+"*\\)|)(?=[^-]|$)","i")},de=/[\x20\t\r\n\f]*[+~]/,pe=/^[^{]+\{\s*\[native code/,me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ge=/^(?:input|select|textarea|button)$/i,ve=/^h\d$/i,ye=/'|\\/g,xe=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,be=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,we=function(e,t){var i="0x"+t-65536;return i!==i?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)};try{Q.call(U.documentElement.childNodes,0)[0].nodeType}catch(_e){Q=function(e){for(var t,i=[];t=this[e++];)i.push(t);return i}}T=a.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},L=a.setDocument=function(e){var n=e?e.ownerDocument||e:U;return n!==D&&9===n.nodeType&&n.documentElement?(D=n,N=n.documentElement,R=T(n),z.tagNameNoComments=o(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),z.attributes=o(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),z.getByClassName=o(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),z.getByName=o(function(e){e.id=V+0,e.innerHTML="<a name='"+V+"'></a><div name='"+V+"'></div>",N.insertBefore(e,N.firstChild);var t=n.getElementsByName&&n.getElementsByName(V).length===2+n.getElementsByName(V+0).length;return z.getIdNotName=!n.getElementById(V),N.removeChild(e),t}),S.attrHandle=o(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==X&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},z.getIdNotName?(S.find.ID=function(e,t){if(typeof t.getElementById!==X&&!R){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},S.filter.ID=function(e){var t=e.replace(be,we);return function(e){return e.getAttribute("id")===t}}):(S.find.ID=function(e,i){if(typeof i.getElementById!==X&&!R){var n=i.getElementById(e);return n?n.id===e||typeof n.getAttributeNode!==X&&n.getAttributeNode("id").value===e?[n]:t:[]}},S.filter.ID=function(e){var t=e.replace(be,we);return function(e){var i=typeof e.getAttributeNode!==X&&e.getAttributeNode("id");return i&&i.value===t}}),S.find.TAG=z.tagNameNoComments?function(e,t){return typeof t.getElementsByTagName!==X?t.getElementsByTagName(e):void 0}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},S.find.NAME=z.getByName&&function(e,t){return typeof t.getElementsByName!==X?t.getElementsByName(name):void 0},S.find.CLASS=z.getByClassName&&function(e,t){return typeof t.getElementsByClassName===X||R?void 0:t.getElementsByClassName(e)},F=[],O=[":focus"],(z.qsa=i(n.querySelectorAll))&&(o(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||O.push("\\["+ee+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||O.push(":checked")}),o(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&O.push("[*^$]="+ee+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||O.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),O.push(",.*:")})),(z.matchesSelector=i(I=N.matchesSelector||N.mozMatchesSelector||N.webkitMatchesSelector||N.oMatchesSelector||N.msMatchesSelector))&&o(function(e){z.disconnectedMatch=I.call(e,"div"),I.call(e,"[s!='']:x"),F.push("!=",oe)}),O=new RegExp(O.join("|")),F=new RegExp(F.join("|")),k=i(N.contains)||N.compareDocumentPosition?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},B=N.compareDocumentPosition?function(e,t){var i;return e===t?(A=!0,0):(i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&i||e.parentNode&&11===e.parentNode.nodeType?e===n||k(U,e)?-1:t===n||k(U,t)?1:0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var i,r=0,o=e.parentNode,a=t.parentNode,l=[e],u=[t];if(e===t)return A=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return s(e,t);for(i=e;i=i.parentNode;)l.unshift(i);for(i=t;i=i.parentNode;)u.unshift(i);for(;l[r]===u[r];)r++;return r?s(l[r],u[r]):l[r]===U?-1:u[r]===U?1:0},A=!1,[0,0].sort(B),z.detectDuplicates=A,D):D},a.matches=function(e,t){return a(e,null,null,t)},a.matchesSelector=function(e,t){if((e.ownerDocument||e)!==D&&L(e),t=t.replace(xe,"='$1']"),!(!z.matchesSelector||R||F&&F.test(t)||O.test(t)))try{var i=I.call(e,t);if(i||z.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(n){}return a(t,D,null,[e]).length>0},a.contains=function(e,t){return(e.ownerDocument||e)!==D&&L(e),k(e,t)},a.attr=function(e,t){var i;return(e.ownerDocument||e)!==D&&L(e),R||(t=t.toLowerCase()),(i=S.attrHandle[t])?i(e):R||z.attributes?e.getAttribute(t):((i=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:i&&i.specified?i.value:null},a.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a.uniqueSort=function(e){var t,i=[],n=1,r=0;if(A=!z.detectDuplicates,e.sort(B),A){for(;t=e[n];n++)t===e[n-1]&&(r=i.push(n));for(;r--;)e.splice(i[r],1)}return e},C=a.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=C(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n];n++)i+=C(t);return i},S=a.selectors={cacheLength:50,createPseudo:r,match:fe,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,we),e[3]=(e[4]||e[5]||"").replace(be,we),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||a.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&a.error(e[0]),e},PSEUDO:function(e){var t,i=!e[5]&&e[2];return fe.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:i&&he.test(i)&&(t=c(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(be,we).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=j[e+" "];return t||(t=new RegExp("(^|"+ee+")"+e+"("+ee+"|$)"))&&j(e,function(e){return t.test(e.className||typeof e.getAttribute!==X&&e.getAttribute("class")||"")})},ATTR:function(e,t,i){return function(n){var r=a.attr(n,e);return null==r?"!="===t:t?(r+="","="===t?r===i:"!="===t?r!==i:"^="===t?i&&0===r.indexOf(i):"*="===t?i&&r.indexOf(i)>-1:"$="===t?i&&r.slice(-i.length)===i:"~="===t?(" "+r+" ").indexOf(i)>-1:"|="===t?r===i||r.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var u,h,c,f,d,p,m=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s;if(g){if(o){for(;m;){for(c=t;c=c[m];)if(s?c.nodeName.toLowerCase()===v:1===c.nodeType)return!1;p=m="only"===e&&!p&&"nextSibling"}return!0}if(p=[a?g.firstChild:g.lastChild],a&&y){for(h=g[V]||(g[V]={}),u=h[e]||[],d=u[0]===$&&u[1],f=u[0]===$&&u[2],c=d&&g.childNodes[d];c=++d&&c&&c[m]||(f=d=0)||p.pop();)if(1===c.nodeType&&++f&&c===t){h[e]=[$,d,f];break}}else if(y&&(u=(t[V]||(t[V]={}))[e])&&u[0]===$)f=u[1];else for(;(c=++d&&c&&c[m]||(f=d=0)||p.pop())&&((s?c.nodeName.toLowerCase()!==v:1!==c.nodeType)||!++f||(y&&((c[V]||(c[V]={}))[e]=[$,f]),c!==t)););return f-=r,f===n||f%n===0&&f/n>=0}}},PSEUDO:function(e,t){var i,n=S.pseudos[e]||S.setFilters[e.toLowerCase()]||a.error("unsupported pseudo: "+e);return n[V]?n(t):n.length>1?(i=[e,e,"",t],S.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,i){for(var r,o=n(e,t),a=o.length;a--;)r=J.call(e,o[a]),e[r]=!(i[r]=o[a])}):function(e){return n(e,0,i)}):n}},pseudos:{not:r(function(e){var t=[],i=[],n=E(e.replace(ae,"$1"));return n[V]?r(function(e,t,i,r){for(var o,a=n(e,null,r,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,r,o){return t[0]=e,n(t,null,o,i),!i.pop()}}),has:r(function(e){return function(t){return a(e,t).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||C(t)).indexOf(e)>-1}}),lang:r(function(e){return ce.test(e||"")||a.error("unsupported lang: "+e),e=e.replace(be,we).toLowerCase(),function(t){var i;do if(i=R?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===N},focus:function(e){return e===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!S.pseudos.empty(e)},header:function(e){return ve.test(e.nodeName)},input:function(e){return ge.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:h(function(){return[0]}),last:h(function(e,t){return[t-1]}),eq:h(function(e,t,i){return[0>i?i+t:i]}),even:h(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:h(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:h(function(e,t,i){for(var n=0>i?i+t:i;--n>=0;)e.push(n);return e}),gt:h(function(e,t,i){for(var n=0>i?i+t:i;++n<t;)e.push(n);return e})}};for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})S.pseudos[_]=l(_);for(_ in{submit:!0,reset:!0})S.pseudos[_]=u(_);E=a.compile=function(e,t){var i,n=[],r=[],o=G[e+" "];if(!o){for(t||(t=c(e)),i=t.length;i--;)o=v(t[i]),o[V]?n.push(o):r.push(o);o=G(e,y(r,n))}return o},S.pseudos.nth=S.pseudos.eq,S.filters=w.prototype=S.pseudos,S.setFilters=new w,L(),a.attr=ue.attr,ue.find=a,ue.expr=a.selectors,ue.expr[":"]=ue.expr.pseudos,ue.unique=a.uniqueSort,ue.text=a.getText,ue.isXMLDoc=a.isXML,ue.contains=a.contains}(e);var $e=/Until$/,He=/^(?:parents|prev(?:Until|All))/,je=/^.[^:#\[\.,]*$/,We=ue.expr.match.needsContext,Ge={children:!0,contents:!0,next:!0,prev:!0};ue.fn.extend({find:function(e){var t,i,n,r=this.length;if("string"!=typeof e)return n=this,this.pushStack(ue(e).filter(function(){for(t=0;r>t;t++)if(ue.contains(n[t],this))return!0}));for(i=[],t=0;r>t;t++)ue.find(e,this[t],i);return i=this.pushStack(r>1?ue.unique(i):i),i.selector=(this.selector?this.selector+" ":"")+e,i},has:function(e){var t,i=ue(e,this),n=i.length;return this.filter(function(){for(t=0;n>t;t++)if(ue.contains(this,i[t]))return!0})},not:function(e){return this.pushStack(f(this,e,!1))},filter:function(e){return this.pushStack(f(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?We.test(e)?ue(e,this.context).index(this[0])>=0:ue.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var i,n=0,r=this.length,o=[],a=We.test(e)||"string"!=typeof e?ue(e,t||this.context):0;r>n;n++)for(i=this[n];i&&i.ownerDocument&&i!==t&&11!==i.nodeType;){if(a?a.index(i)>-1:ue.find.matchesSelector(i,e)){o.push(i);break}i=i.parentNode}return this.pushStack(o.length>1?ue.unique(o):o)},index:function(e){return e?"string"==typeof e?ue.inArray(this[0],ue(e)):ue.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var i="string"==typeof e?ue(e,t):ue.makeArray(e&&e.nodeType?[e]:e),n=ue.merge(this.get(),i);return this.pushStack(ue.unique(n))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ue.fn.andSelf=ue.fn.addBack,ue.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ue.dir(e,"parentNode")},parentsUntil:function(e,t,i){return ue.dir(e,"parentNode",i)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")},nextAll:function(e){return ue.dir(e,"nextSibling")},prevAll:function(e){return ue.dir(e,"previousSibling")},nextUntil:function(e,t,i){return ue.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return ue.dir(e,"previousSibling",i)},siblings:function(e){return ue.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ue.sibling(e.firstChild)},contents:function(e){return ue.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ue.merge([],e.childNodes)}},function(e,t){ue.fn[e]=function(i,n){var r=ue.map(this,t,i);return $e.test(e)||(n=i),n&&"string"==typeof n&&(r=ue.filter(n,r)),r=this.length>1&&!Ge[e]?ue.unique(r):r,this.length>1&&He.test(e)&&(r=r.reverse()),this.pushStack(r)}}),ue.extend({filter:function(e,t,i){return i&&(e=":not("+e+")"),1===t.length?ue.find.matchesSelector(t[0],e)?[t[0]]:[]:ue.find.matches(e,t)},dir:function(e,i,n){for(var r=[],o=e[i];o&&9!==o.nodeType&&(n===t||1!==o.nodeType||!ue(o).is(n));)1===o.nodeType&&r.push(o),o=o[i];return r},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}});var Xe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",qe=/ jQuery\d+="(?:null|\d+)"/g,Ye=new RegExp("<(?:"+Xe+")[\\s/>]","i"),Ke=/^\s+/,Ze=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Qe=/<([\w:]+)/,Je=/<tbody/i,et=/<|&#?\w+;/,tt=/<(?:script|style|link)/i,it=/^(?:checkbox|radio)$/i,nt=/checked\s*(?:[^=]|=\s*.checked.)/i,rt=/^$|\/(?:java|ecma)script/i,ot=/^true\/(.*)/,at=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,st={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ue.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},lt=d(Y),ut=lt.appendChild(Y.createElement("div"));st.optgroup=st.option,st.tbody=st.tfoot=st.colgroup=st.caption=st.thead,st.th=st.td,ue.fn.extend({text:function(e){return ue.access(this,function(e){return e===t?ue.text(this):this.empty().append((this[0]&&this[0].ownerDocument||Y).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(ue.isFunction(e))return this.each(function(t){ue(this).wrapAll(e.call(this,t))});if(this[0]){var t=ue(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return ue.isFunction(e)?this.each(function(t){ue(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ue(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=ue.isFunction(e);return this.each(function(i){ue(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){ue.nodeName(this,"body")||ue(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,n=0;null!=(i=this[n]);n++)(!e||ue.filter(e,[i]).length>0)&&(t||1!==i.nodeType||ue.cleanData(b(i)),i.parentNode&&(t&&ue.contains(i.ownerDocument,i)&&v(b(i,"script")),i.parentNode.removeChild(i)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&ue.cleanData(b(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&ue.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return ue.clone(this,e,t)})},html:function(e){return ue.access(this,function(e){var i=this[0]||{},n=0,r=this.length;if(e===t)return 1===i.nodeType?i.innerHTML.replace(qe,""):t;if(!("string"!=typeof e||tt.test(e)||!ue.support.htmlSerialize&&Ye.test(e)||!ue.support.leadingWhitespace&&Ke.test(e)||st[(Qe.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ze,"<$1></$2>");try{for(;r>n;n++)i=this[n]||{},1===i.nodeType&&(ue.cleanData(b(i,!1)),i.innerHTML=e);i=0}catch(o){}}i&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=ue.isFunction(e);return t||"string"==typeof e||(e=ue(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,i=this.parentNode;i&&(ue(this).remove(),i.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,i,n){e=ie.apply([],e);var r,o,a,s,l,u,h=0,c=this.length,f=this,d=c-1,v=e[0],y=ue.isFunction(v);if(y||!(1>=c||"string"!=typeof v||ue.support.checkClone)&&nt.test(v))return this.each(function(r){var o=f.eq(r);y&&(e[0]=v.call(this,r,i?o.html():t)),o.domManip(e,i,n)});if(c&&(u=ue.buildFragment(e,this[0].ownerDocument,!1,this),r=u.firstChild,1===u.childNodes.length&&(u=r),r)){for(i=i&&ue.nodeName(r,"tr"),s=ue.map(b(u,"script"),m),a=s.length;c>h;h++)o=u,h!==d&&(o=ue.clone(o,!0,!0),a&&ue.merge(s,b(o,"script"))),n.call(i&&ue.nodeName(this[h],"table")?p(this[h],"tbody"):this[h],o,h);if(a)for(l=s[s.length-1].ownerDocument,ue.map(s,g),h=0;a>h;h++)o=s[h],rt.test(o.type||"")&&!ue._data(o,"globalEval")&&ue.contains(l,o)&&(o.src?ue.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):ue.globalEval((o.text||o.textContent||o.innerHTML||"").replace(at,"")));u=r=null}return this}}),ue.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ue.fn[e]=function(e){for(var i,n=0,r=[],o=ue(e),a=o.length-1;a>=n;n++)i=n===a?this:this.clone(!0),ue(o[n])[t](i),ne.apply(r,i.get());return this.pushStack(r)}}),ue.extend({clone:function(e,t,i){var n,r,o,a,s,l=ue.contains(e.ownerDocument,e);if(ue.support.html5Clone||ue.isXMLDoc(e)||!Ye.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(ut.innerHTML=e.outerHTML,ut.removeChild(o=ut.firstChild)),!(ue.support.noCloneEvent&&ue.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ue.isXMLDoc(e)))for(n=b(o),s=b(e),a=0;null!=(r=s[a]);++a)n[a]&&x(r,n[a]);if(t)if(i)for(s=s||b(e),n=n||b(o),a=0;null!=(r=s[a]);a++)y(r,n[a]);else y(e,o);return n=b(o,"script"),n.length>0&&v(n,!l&&b(e,"script")),n=s=r=null,o},buildFragment:function(e,t,i,n){for(var r,o,a,s,l,u,h,c=e.length,f=d(t),p=[],m=0;c>m;m++)if(o=e[m],o||0===o)if("object"===ue.type(o))ue.merge(p,o.nodeType?[o]:o);else if(et.test(o)){for(s=s||f.appendChild(t.createElement("div")),l=(Qe.exec(o)||["",""])[1].toLowerCase(),h=st[l]||st._default,s.innerHTML=h[1]+o.replace(Ze,"<$1></$2>")+h[2],r=h[0];r--;)s=s.lastChild;if(!ue.support.leadingWhitespace&&Ke.test(o)&&p.push(t.createTextNode(Ke.exec(o)[0])),!ue.support.tbody)for(o="table"!==l||Je.test(o)?"<table>"!==h[1]||Je.test(o)?0:s:s.firstChild,r=o&&o.childNodes.length;r--;)ue.nodeName(u=o.childNodes[r],"tbody")&&!u.childNodes.length&&o.removeChild(u);for(ue.merge(p,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=f.lastChild}else p.push(t.createTextNode(o));for(s&&f.removeChild(s),ue.support.appendChecked||ue.grep(b(p,"input"),w),m=0;o=p[m++];)if((!n||-1===ue.inArray(o,n))&&(a=ue.contains(o.ownerDocument,o),s=b(f.appendChild(o),"script"),a&&v(s),i))for(r=0;o=s[r++];)rt.test(o.type||"")&&i.push(o);return s=null,f},cleanData:function(e,t){for(var i,n,r,o,a=0,s=ue.expando,l=ue.cache,u=ue.support.deleteExpando,h=ue.event.special;null!=(i=e[a]);a++)if((t||ue.acceptData(i))&&(r=i[s],o=r&&l[r])){if(o.events)for(n in o.events)h[n]?ue.event.remove(i,n):ue.removeEvent(i,n,o.handle);l[r]&&(delete l[r],u?delete i[s]:typeof i.removeAttribute!==q?i.removeAttribute(s):i[s]=null,ee.push(r))}}});var ht,ct,ft,dt=/alpha\([^)]*\)/i,pt=/opacity\s*=\s*([^)]*)/,mt=/^(top|right|bottom|left)$/,gt=/^(none|table(?!-c[ea]).+)/,vt=/^margin/,yt=new RegExp("^("+he+")(.*)$","i"),xt=new RegExp("^("+he+")(?!px)[a-z%]+$","i"),bt=new RegExp("^([+-])=("+he+")","i"),wt={BODY:"block"},_t={position:"absolute",visibility:"hidden",display:"block"},Mt={letterSpacing:0,fontWeight:400},St=["Top","Right","Bottom","Left"],Ct=["Webkit","O","Moz","ms"];ue.fn.extend({css:function(e,i){return ue.access(this,function(e,i,n){var r,o,a={},s=0;if(ue.isArray(i)){for(o=ct(e),r=i.length;r>s;s++)a[i[s]]=ue.css(e,i[s],!1,o);return a}return n!==t?ue.style(e,i,n):ue.css(e,i)},e,i,arguments.length>1)},show:function(){return S(this,!0)},hide:function(){return S(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:M(this))?ue(this).show():ue(this).hide()})}}),ue.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=ft(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ue.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,i,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,l=ue.camelCase(i),u=e.style;if(i=ue.cssProps[l]||(ue.cssProps[l]=_(u,l)),s=ue.cssHooks[i]||ue.cssHooks[l],n===t)return s&&"get"in s&&(o=s.get(e,!1,r))!==t?o:u[i];if(a=typeof n,"string"===a&&(o=bt.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(ue.css(e,i)),a="number"),!(null==n||"number"===a&&isNaN(n)||("number"!==a||ue.cssNumber[l]||(n+="px"),ue.support.clearCloneStyle||""!==n||0!==i.indexOf("background")||(u[i]="inherit"),s&&"set"in s&&(n=s.set(e,n,r))===t)))try{u[i]=n}catch(h){}}},css:function(e,i,n,r){var o,a,s,l=ue.camelCase(i);return i=ue.cssProps[l]||(ue.cssProps[l]=_(e.style,l)),s=ue.cssHooks[i]||ue.cssHooks[l],s&&"get"in s&&(a=s.get(e,!0,n)),a===t&&(a=ft(e,i,r)),"normal"===a&&i in Mt&&(a=Mt[i]),""===n||n?(o=parseFloat(a),n===!0||ue.isNumeric(o)?o||0:a):a},swap:function(e,t,i,n){var r,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];r=i.apply(e,n||[]);for(o in t)e.style[o]=a[o];return r}}),e.getComputedStyle?(ct=function(t){return e.getComputedStyle(t,null)},ft=function(e,i,n){var r,o,a,s=n||ct(e),l=s?s.getPropertyValue(i)||s[i]:t,u=e.style;return s&&(""!==l||ue.contains(e.ownerDocument,e)||(l=ue.style(e,i)),xt.test(l)&&vt.test(i)&&(r=u.width,o=u.minWidth,a=u.maxWidth,u.minWidth=u.maxWidth=u.width=l,l=s.width,u.width=r,u.minWidth=o,u.maxWidth=a)),l}):Y.documentElement.currentStyle&&(ct=function(e){return e.currentStyle},ft=function(e,i,n){var r,o,a,s=n||ct(e),l=s?s[i]:t,u=e.style;return null==l&&u&&u[i]&&(l=u[i]),xt.test(l)&&!mt.test(i)&&(r=u.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),u.left="fontSize"===i?"1em":l,l=u.pixelLeft+"px",u.left=r,a&&(o.left=a)),""===l?"auto":l}),ue.each(["height","width"],function(e,t){ue.cssHooks[t]={get:function(e,i,n){return i?0===e.offsetWidth&&gt.test(ue.css(e,"display"))?ue.swap(e,_t,function(){return E(e,t,n)}):E(e,t,n):void 0},set:function(e,i,n){var r=n&&ct(e);return C(e,i,n?T(e,t,n,ue.support.boxSizing&&"border-box"===ue.css(e,"boxSizing",!1,r),r):0)}}}),ue.support.opacity||(ue.cssHooks.opacity={get:function(e,t){return pt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,n=e.currentStyle,r=ue.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=n&&n.filter||i.filter||"";i.zoom=1,(t>=1||""===t)&&""===ue.trim(o.replace(dt,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===t||n&&!n.filter)||(i.filter=dt.test(o)?o.replace(dt,r):o+" "+r)}}),ue(function(){ue.support.reliableMarginRight||(ue.cssHooks.marginRight={get:function(e,t){return t?ue.swap(e,{display:"inline-block"},ft,[e,"marginRight"]):void 0}}),!ue.support.pixelPosition&&ue.fn.position&&ue.each(["top","left"],function(e,t){ue.cssHooks[t]={get:function(e,i){return i?(i=ft(e,t),xt.test(i)?ue(e).position()[t]+"px":i):void 0}}})}),ue.expr&&ue.expr.filters&&(ue.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!ue.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||ue.css(e,"display"))},ue.expr.filters.visible=function(e){return!ue.expr.filters.hidden(e)}),ue.each({margin:"",padding:"",border:"Width"},function(e,t){ue.cssHooks[e+t]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[e+St[n]+t]=o[n]||o[n-2]||o[0];return r}},vt.test(e)||(ue.cssHooks[e+t].set=C)});var Tt=/%20/g,Et=/\[\]$/,At=/\r?\n/g,Pt=/^(?:submit|button|image|reset|file)$/i,Lt=/^(?:input|select|textarea|keygen)/i;ue.fn.extend({serialize:function(){return ue.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ue.prop(this,"elements");return e?ue.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ue(this).is(":disabled")&&Lt.test(this.nodeName)&&!Pt.test(e)&&(this.checked||!it.test(e))}).map(function(e,t){var i=ue(this).val();return null==i?null:ue.isArray(i)?ue.map(i,function(e){return{name:t.name,value:e.replace(At,"\r\n")}}):{name:t.name,value:i.replace(At,"\r\n")}}).get()}}),ue.param=function(e,i){var n,r=[],o=function(e,t){t=ue.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(i===t&&(i=ue.ajaxSettings&&ue.ajaxSettings.traditional),ue.isArray(e)||e.jquery&&!ue.isPlainObject(e))ue.each(e,function(){o(this.name,this.value)});else for(n in e)L(n,e[n],i,o);return r.join("&").replace(Tt,"+")},ue.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ue.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),ue.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var Dt,Nt,Rt=ue.now(),Ot=/\?/,Ft=/#.*$/,It=/([?&])_=[^&]*/,kt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Bt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Vt=/^(?:GET|HEAD)$/,Ut=/^\/\//,zt=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,$t=ue.fn.load,Ht={},jt={},Wt="*/".concat("*");try{Nt=K.href}catch(Gt){Nt=Y.createElement("a"),Nt.href="",Nt=Nt.href}Dt=zt.exec(Nt.toLowerCase())||[],ue.fn.load=function(e,i,n){if("string"!=typeof e&&$t)return $t.apply(this,arguments);var r,o,a,s=this,l=e.indexOf(" ");return l>=0&&(r=e.slice(l,e.length),e=e.slice(0,l)),ue.isFunction(i)?(n=i,i=t):i&&"object"==typeof i&&(a="POST"),s.length>0&&ue.ajax({url:e,type:a,dataType:"html",data:i}).done(function(e){o=arguments,s.html(r?ue("<div>").append(ue.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){s.each(n,o||[e.responseText,t,e])}),this},ue.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ue.fn[t]=function(e){return this.on(t,e)}}),ue.each(["get","post"],function(e,i){ue[i]=function(e,n,r,o){return ue.isFunction(n)&&(o=o||r,r=n,n=t),ue.ajax({url:e,type:i,dataType:o,data:n,success:r})}}),ue.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Nt,type:"GET",isLocal:Bt.test(Dt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Wt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":ue.parseJSON,"text xml":ue.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?R(R(e,ue.ajaxSettings),t):R(ue.ajaxSettings,e)},ajaxPrefilter:D(Ht),ajaxTransport:D(jt),ajax:function(e,i){function n(e,i,n,r){var o,c,y,x,w,M=i;2!==b&&(b=2,l&&clearTimeout(l),h=t,s=r||"",_.readyState=e>0?4:0,n&&(x=O(f,_,n)),e>=200&&300>e||304===e?(f.ifModified&&(w=_.getResponseHeader("Last-Modified"),w&&(ue.lastModified[a]=w),w=_.getResponseHeader("etag"),w&&(ue.etag[a]=w)),204===e?(o=!0,M="nocontent"):304===e?(o=!0,M="notmodified"):(o=F(f,x),M=o.state,c=o.data,y=o.error,o=!y)):(y=M,(e||!M)&&(M="error",0>e&&(e=0))),_.status=e,_.statusText=(i||M)+"",o?m.resolveWith(d,[c,M,_]):m.rejectWith(d,[_,M,y]),_.statusCode(v),v=t,u&&p.trigger(o?"ajaxSuccess":"ajaxError",[_,f,o?c:y]),g.fireWith(d,[_,M]),u&&(p.trigger("ajaxComplete",[_,f]),--ue.active||ue.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=t),i=i||{};var r,o,a,s,l,u,h,c,f=ue.ajaxSetup({},i),d=f.context||f,p=f.context&&(d.nodeType||d.jquery)?ue(d):ue.event,m=ue.Deferred(),g=ue.Callbacks("once memory"),v=f.statusCode||{},y={},x={},b=0,w="canceled",_={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!c)for(c={};t=kt.exec(s);)c[t[1].toLowerCase()]=t[2];t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){
return 2===b?s:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return b||(e=x[i]=x[i]||e,y[e]=t),this},overrideMimeType:function(e){return b||(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)v[t]=[v[t],e[t]];else _.always(e[_.status]);return this},abort:function(e){var t=e||w;return h&&h.abort(t),n(0,t),this}};if(m.promise(_).complete=g.add,_.success=_.done,_.error=_.fail,f.url=((e||f.url||Nt)+"").replace(Ft,"").replace(Ut,Dt[1]+"//"),f.type=i.method||i.type||f.method||f.type,f.dataTypes=ue.trim(f.dataType||"*").toLowerCase().match(ce)||[""],null==f.crossDomain&&(r=zt.exec(f.url.toLowerCase()),f.crossDomain=!(!r||r[1]===Dt[1]&&r[2]===Dt[2]&&(r[3]||("http:"===r[1]?80:443))==(Dt[3]||("http:"===Dt[1]?80:443)))),f.data&&f.processData&&"string"!=typeof f.data&&(f.data=ue.param(f.data,f.traditional)),N(Ht,f,i,_),2===b)return _;u=f.global,u&&0===ue.active++&&ue.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Vt.test(f.type),a=f.url,f.hasContent||(f.data&&(a=f.url+=(Ot.test(a)?"&":"?")+f.data,delete f.data),f.cache===!1&&(f.url=It.test(a)?a.replace(It,"$1_="+Rt++):a+(Ot.test(a)?"&":"?")+"_="+Rt++)),f.ifModified&&(ue.lastModified[a]&&_.setRequestHeader("If-Modified-Since",ue.lastModified[a]),ue.etag[a]&&_.setRequestHeader("If-None-Match",ue.etag[a])),(f.data&&f.hasContent&&f.contentType!==!1||i.contentType)&&_.setRequestHeader("Content-Type",f.contentType),_.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Wt+"; q=0.01":""):f.accepts["*"]);for(o in f.headers)_.setRequestHeader(o,f.headers[o]);if(f.beforeSend&&(f.beforeSend.call(d,_,f)===!1||2===b))return _.abort();w="abort";for(o in{success:1,error:1,complete:1})_[o](f[o]);if(h=N(jt,f,i,_)){_.readyState=1,u&&p.trigger("ajaxSend",[_,f]),f.async&&f.timeout>0&&(l=setTimeout(function(){_.abort("timeout")},f.timeout));try{b=1,h.send(y,n)}catch(M){if(!(2>b))throw M;n(-1,M)}}else n(-1,"No Transport");return _},getScript:function(e,i){return ue.get(e,t,i,"script")},getJSON:function(e,t,i){return ue.get(e,t,i,"json")}}),ue.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return ue.globalEval(e),e}}}),ue.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),ue.ajaxTransport("script",function(e){if(e.crossDomain){var i,n=Y.head||ue("head")[0]||Y.documentElement;return{send:function(t,r){i=Y.createElement("script"),i.async=!0,e.scriptCharset&&(i.charset=e.scriptCharset),i.src=e.url,i.onload=i.onreadystatechange=function(e,t){(t||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),i=null,t||r(200,"success"))},n.insertBefore(i,n.firstChild)},abort:function(){i&&i.onload(t,!0)}}}});var Xt=[],qt=/(=)\?(?=&|$)|\?\?/;ue.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xt.pop()||ue.expando+"_"+Rt++;return this[e]=!0,e}}),ue.ajaxPrefilter("json jsonp",function(i,n,r){var o,a,s,l=i.jsonp!==!1&&(qt.test(i.url)?"url":"string"==typeof i.data&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&qt.test(i.data)&&"data");return l||"jsonp"===i.dataTypes[0]?(o=i.jsonpCallback=ue.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,l?i[l]=i[l].replace(qt,"$1"+o):i.jsonp!==!1&&(i.url+=(Ot.test(i.url)?"&":"?")+i.jsonp+"="+o),i.converters["script json"]=function(){return s||ue.error(o+" was not called"),s[0]},i.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},r.always(function(){e[o]=a,i[o]&&(i.jsonpCallback=n.jsonpCallback,Xt.push(o)),s&&ue.isFunction(a)&&a(s[0]),s=a=t}),"script"):void 0});var Yt,Kt,Zt=0,Qt=e.ActiveXObject&&function(){var e;for(e in Yt)Yt[e](t,!0)};ue.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&I()||k()}:I,Kt=ue.ajaxSettings.xhr(),ue.support.cors=!!Kt&&"withCredentials"in Kt,Kt=ue.support.ajax=!!Kt,Kt&&ue.ajaxTransport(function(i){if(!i.crossDomain||ue.support.cors){var n;return{send:function(r,o){var a,s,l=i.xhr();if(i.username?l.open(i.type,i.url,i.async,i.username,i.password):l.open(i.type,i.url,i.async),i.xhrFields)for(s in i.xhrFields)l[s]=i.xhrFields[s];i.mimeType&&l.overrideMimeType&&l.overrideMimeType(i.mimeType),i.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(s in r)l.setRequestHeader(s,r[s])}catch(u){}l.send(i.hasContent&&i.data||null),n=function(e,r){var s,u,h,c;try{if(n&&(r||4===l.readyState))if(n=t,a&&(l.onreadystatechange=ue.noop,Qt&&delete Yt[a]),r)4!==l.readyState&&l.abort();else{c={},s=l.status,u=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(c.text=l.responseText);try{h=l.statusText}catch(f){h=""}s||!i.isLocal||i.crossDomain?1223===s&&(s=204):s=c.text?200:404}}catch(d){r||o(-1,d)}c&&o(s,h,c,u)},i.async?4===l.readyState?setTimeout(n):(a=++Zt,Qt&&(Yt||(Yt={},ue(e).unload(Qt)),Yt[a]=n),l.onreadystatechange=n):n()},abort:function(){n&&n(t,!0)}}}});var Jt,ei,ti=/^(?:toggle|show|hide)$/,ii=new RegExp("^(?:([+-])=|)("+he+")([a-z%]*)$","i"),ni=/queueHooks$/,ri=[$],oi={"*":[function(e,t){var i,n,r=this.createTween(e,t),o=ii.exec(t),a=r.cur(),s=+a||0,l=1,u=20;if(o){if(i=+o[2],n=o[3]||(ue.cssNumber[e]?"":"px"),"px"!==n&&s){s=ue.css(r.elem,e,!0)||i||1;do l=l||".5",s/=l,ue.style(r.elem,e,s+n);while(l!==(l=r.cur()/a)&&1!==l&&--u)}r.unit=n,r.start=s,r.end=o[1]?s+(o[1]+1)*i:i}return r}]};ue.Animation=ue.extend(U,{tweener:function(e,t){ue.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;r>n;n++)i=e[n],oi[i]=oi[i]||[],oi[i].unshift(t)},prefilter:function(e,t){t?ri.unshift(e):ri.push(e)}}),ue.Tween=H,H.prototype={constructor:H,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(ue.cssNumber[i]?"":"px")},cur:function(){var e=H.propHooks[this.prop];return e&&e.get?e.get(this):H.propHooks._default.get(this)},run:function(e){var t,i=H.propHooks[this.prop];return this.options.duration?this.pos=t=ue.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):H.propHooks._default.set(this),this}},H.prototype.init.prototype=H.prototype,H.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=ue.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){ue.fx.step[e.prop]?ue.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ue.cssProps[e.prop]]||ue.cssHooks[e.prop])?ue.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},H.propHooks.scrollTop=H.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ue.each(["toggle","show","hide"],function(e,t){var i=ue.fn[t];ue.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(j(t,!0),e,n,r)}}),ue.fn.extend({fadeTo:function(e,t,i,n){return this.filter(M).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=ue.isEmptyObject(e),o=ue.speed(t,i,n),a=function(){var t=U(this,ue.extend({},e),o);a.finish=function(){t.stop(!0)},(r||ue._data(this,"finish"))&&t.stop(!0)};return a.finish=a,r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,i,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=i,i=e,e=t),i&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=ue.timers,a=ue._data(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&ni.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));(t||!n)&&ue.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=ue._data(this),n=i[e+"queue"],r=i[e+"queueHooks"],o=ue.timers,a=n?n.length:0;for(i.finish=!0,ue.queue(this,e,[]),r&&r.cur&&r.cur.finish&&r.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),ue.each({slideDown:j("show"),slideUp:j("hide"),slideToggle:j("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ue.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),ue.speed=function(e,t,i){var n=e&&"object"==typeof e?ue.extend({},e):{complete:i||!i&&t||ue.isFunction(e)&&e,duration:e,easing:i&&t||t&&!ue.isFunction(t)&&t};return n.duration=ue.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in ue.fx.speeds?ue.fx.speeds[n.duration]:ue.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){ue.isFunction(n.old)&&n.old.call(this),n.queue&&ue.dequeue(this,n.queue)},n},ue.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ue.timers=[],ue.fx=H.prototype.init,ue.fx.tick=function(){var e,i=ue.timers,n=0;for(Jt=ue.now();n<i.length;n++)e=i[n],e()||i[n]!==e||i.splice(n--,1);i.length||ue.fx.stop(),Jt=t},ue.fx.timer=function(e){e()&&ue.timers.push(e)&&ue.fx.start()},ue.fx.interval=13,ue.fx.start=function(){ei||(ei=setInterval(ue.fx.tick,ue.fx.interval))},ue.fx.stop=function(){clearInterval(ei),ei=null},ue.fx.speeds={slow:600,fast:200,_default:400},ue.fx.step={},ue.expr&&ue.expr.filters&&(ue.expr.filters.animated=function(e){return ue.grep(ue.timers,function(t){return e===t.elem}).length}),ue.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){ue.offset.setOffset(this,e,t)});var i,n,r={top:0,left:0},o=this[0],a=o&&o.ownerDocument;if(a)return i=a.documentElement,ue.contains(i,o)?(typeof o.getBoundingClientRect!==q&&(r=o.getBoundingClientRect()),n=W(a),{top:r.top+(n.pageYOffset||i.scrollTop)-(i.clientTop||0),left:r.left+(n.pageXOffset||i.scrollLeft)-(i.clientLeft||0)}):r},ue.offset={setOffset:function(e,t,i){var n=ue.css(e,"position");"static"===n&&(e.style.position="relative");var r,o,a=ue(e),s=a.offset(),l=ue.css(e,"top"),u=ue.css(e,"left"),h=("absolute"===n||"fixed"===n)&&ue.inArray("auto",[l,u])>-1,c={},f={};h?(f=a.position(),r=f.top,o=f.left):(r=parseFloat(l)||0,o=parseFloat(u)||0),ue.isFunction(t)&&(t=t.call(e,i,s)),null!=t.top&&(c.top=t.top-s.top+r),null!=t.left&&(c.left=t.left-s.left+o),"using"in t?t.using.call(e,c):a.css(c)}},ue.fn.extend({position:function(){if(this[0]){var e,t,i={top:0,left:0},n=this[0];return"fixed"===ue.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ue.nodeName(e[0],"html")||(i=e.offset()),i.top+=ue.css(e[0],"borderTopWidth",!0),i.left+=ue.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-ue.css(n,"marginTop",!0),left:t.left-i.left-ue.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Y.documentElement;e&&!ue.nodeName(e,"html")&&"static"===ue.css(e,"position");)e=e.offsetParent;return e||Y.documentElement})}}),ue.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,i){var n=/Y/.test(i);ue.fn[e]=function(r){return ue.access(this,function(e,r,o){var a=W(e);return o===t?a?i in a?a[i]:a.document.documentElement[r]:e[r]:void(a?a.scrollTo(n?ue(a).scrollLeft():o,n?o:ue(a).scrollTop()):e[r]=o)},e,r,arguments.length,null)}}),ue.each({Height:"height",Width:"width"},function(e,i){ue.each({padding:"inner"+e,content:i,"":"outer"+e},function(n,r){ue.fn[r]=function(r,o){var a=arguments.length&&(n||"boolean"!=typeof r),s=n||(r===!0||o===!0?"margin":"border");return ue.access(this,function(i,n,r){var o;return ue.isWindow(i)?i.document.documentElement["client"+e]:9===i.nodeType?(o=i.documentElement,Math.max(i.body["scroll"+e],o["scroll"+e],i.body["offset"+e],o["offset"+e],o["client"+e])):r===t?ue.css(i,n,s):ue.style(i,n,r,s)},i,a?r:t,a,null)}})}),e.jQuery=e.$=ue,"function"==typeof a&&a.amd&&a.amd.jQuery&&a("jquery",[],function(){return ue})}(window),function(){function n(){var n={};return n.FRAMERATE=30,n.MAX_VIRTUAL_PIXELS=3e4,n.init=function(e){var t=0;n.UniqueId=function(){return t++,"canvg"+t},n.Definitions={},n.Styles={},n.Animations=[],n.Images=[],n.ctx=e,n.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},n.init(),n.ImagesLoaded=function(){for(var e=0;e<n.Images.length;e++)if(!n.Images[e].loaded)return!1;return!0},n.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},n.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},n.ajax=function(e){var t;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t?(t.open("GET",e,!1),t.send(null),t.responseText):null},n.parseXml=function(e){if(window.DOMParser){var t=new DOMParser;return t.parseFromString(e,"text/xml")}e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var i=new ActiveXObject("Microsoft.XMLDOM");return i.async="false",i.loadXML(e),i},n.Property=function(e,t){this.name=e,this.value=t},n.Property.prototype.getValue=function(){return this.value},n.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},n.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},n.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},n.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},n.Property.prototype.addOpacity=function(t){var i=this.value;if(null!=t&&""!=t&&"string"==typeof this.value){var r=new e(this.value);r.ok&&(i="rgba("+r.r+", "+r.g+", "+r.b+", "+t+")")}return new n.Property(this.name,i)},n.Property.prototype.getDefinition=function(){var e=this.value.match(/#([^\)'"]+)/);return e&&(e=e[1]),e||(e=this.value),n.Definitions[e]},n.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},n.Property.prototype.getFillStyleDefinition=function(e,t){var i=this.getDefinition();if(null!=i&&i.createGradient)return i.createGradient(n.ctx,e,t);if(null!=i&&i.createPattern){if(i.getHrefAttribute().hasValue()){var r=i.attribute("patternTransform");i=i.getHrefAttribute().getDefinition(),r.hasValue()&&(i.attribute("patternTransform",!0).value=r.value)}return i.createPattern(n.ctx,e)}return null},n.Property.prototype.getDPI=function(e){return 96},n.Property.prototype.getEM=function(e){var t=12,i=new n.Property("fontSize",n.Font.Parse(n.ctx.font).fontSize);return i.hasValue()&&(t=i.toPixels(e)),t},n.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},n.Property.prototype.toPixels=function(e,t){if(!this.hasValue())return 0;var i=this.value+"";if(i.match(/em$/))return this.numValue()*this.getEM(e);if(i.match(/ex$/))return this.numValue()*this.getEM(e)/2;if(i.match(/px$/))return this.numValue();if(i.match(/pt$/))return this.numValue()*this.getDPI(e)*(1/72);if(i.match(/pc$/))return 15*this.numValue();if(i.match(/cm$/))return this.numValue()*this.getDPI(e)/2.54;if(i.match(/mm$/))return this.numValue()*this.getDPI(e)/25.4;if(i.match(/in$/))return this.numValue()*this.getDPI(e);if(i.match(/%$/))return this.numValue()*n.ViewPort.ComputeSize(e);var r=this.numValue();return t&&1>r?r*n.ViewPort.ComputeSize(e):r},n.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():e.match(/ms$/)?this.numValue():this.numValue()},n.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},n.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(e,t,i,r,o,a){var s=null!=a?this.Parse(a):this.CreateFont("","","","","",n.ctx.font);return{fontFamily:o||s.fontFamily,fontSize:r||s.fontSize,fontStyle:e||s.fontStyle,fontWeight:i||s.fontWeight,fontVariant:t||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var e=this;this.Parse=function(t){for(var i={},r=n.trim(n.compressSpaces(t||"")).split(" "),o={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<r.length;s++)o.fontStyle||-1==e.Styles.indexOf(r[s])?o.fontVariant||-1==e.Variants.indexOf(r[s])?o.fontWeight||-1==e.Weights.indexOf(r[s])?o.fontSize?"inherit"!=r[s]&&(a+=r[s]):("inherit"!=r[s]&&(i.fontSize=r[s].split("/")[0]),o.fontStyle=o.fontVariant=o.fontWeight=o.fontSize=!0):("inherit"!=r[s]&&(i.fontWeight=r[s]),o.fontStyle=o.fontVariant=o.fontWeight=!0):("inherit"!=r[s]&&(i.fontVariant=r[s]),o.fontStyle=o.fontVariant=!0):("inherit"!=r[s]&&(i.fontStyle=r[s]),o.fontStyle=!0);return""!=a&&(i.fontFamily=a),i}},n.ToNumberArray=function(e){for(var t=n.trim(n.compressSpaces((e||"").replace(/,/g," "))).split(" "),i=0;i<t.length;i++)t[i]=parseFloat(t[i]);return t},n.Point=function(e,t){this.x=e,this.y=t},n.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},n.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],i=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=i},n.CreatePoint=function(e){var t=n.ToNumberArray(e);return new n.Point(t[0],t[1])},n.CreatePath=function(e){for(var t=n.ToNumberArray(e),i=[],r=0;r<t.length;r+=2)i.push(new n.Point(t[r],t[r+1]));return i},n.BoundingBox=function(e,t,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,i,n,r,o){var a=e+2/3*(i-e),s=t+2/3*(n-t),l=a+1/3*(r-e),u=s+1/3*(o-t);this.addBezierCurve(e,t,a,l,s,u,r,o)},this.addBezierCurve=function(e,t,n,r,o,a,s,l){var u=[e,t],h=[n,r],c=[o,a],f=[s,l];for(this.addPoint(u[0],u[1]),this.addPoint(f[0],f[1]),i=0;i<=1;i++){var d=function(e){return Math.pow(1-e,3)*u[i]+3*Math.pow(1-e,2)*e*h[i]+3*(1-e)*Math.pow(e,2)*c[i]+Math.pow(e,3)*f[i]},p=6*u[i]-12*h[i]+6*c[i],m=-3*u[i]+9*h[i]-9*c[i]+3*f[i],g=3*h[i]-3*u[i];if(0!=m){var v=Math.pow(p,2)-4*g*m;if(!(0>v)){var y=(-p+Math.sqrt(v))/(2*m);y>0&&1>y&&(0==i&&this.addX(d(y)),1==i&&this.addY(d(y)));var x=(-p-Math.sqrt(v))/(2*m);x>0&&1>x&&(0==i&&this.addX(d(x)),1==i&&this.addY(d(x)))}}else{if(0==p)continue;var b=-g/p;b>0&&1>b&&(0==i&&this.addX(d(b)),1==i&&this.addY(d(b)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(n,r)},n.Transform=function(e){var t=this;this.Type={},this.Type.translate=function(e){this.p=n.CreatePoint(e),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(e){var t=n.ToNumberArray(e);this.angle=new n.Property("angle",t[0]),this.cx=t[1]||0,this.cy=t[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(e){this.p=n.CreatePoint(e),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=n.ToNumberArray(e),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=t.Type.matrix,this.base(e),this.angle=new n.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;t>=0;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var i=n.trim(n.compressSpaces(e)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),r=0;r<i.length;r++){var o=n.trim(i[r].split("(")[0]),a=i[r].split("(")[1].replace(")",""),s=new this.Type[o](a);s.type=o,this.transforms.push(s)}},n.AspectRatio=function(e,t,i,r,o,a,s,l,u,h){t=n.compressSpaces(t),t=t.replace(/^defer\s/,"");var c=t.split(" ")[0]||"xMidYMid",f=t.split(" ")[1]||"meet",d=i/r,p=o/a,m=Math.min(d,p),g=Math.max(d,p);"meet"==f&&(r*=m,a*=m),"slice"==f&&(r*=g,a*=g),u=new n.Property("refX",u),h=new n.Property("refY",h),u.hasValue()&&h.hasValue()?e.translate(-m*u.toPixels("x"),-m*h.toPixels("y")):(c.match(/^xMid/)&&("meet"==f&&m==p||"slice"==f&&g==p)&&e.translate(i/2-r/2,0),c.match(/YMid$/)&&("meet"==f&&m==d||"slice"==f&&g==d)&&e.translate(0,o/2-a/2),c.match(/^xMax/)&&("meet"==f&&m==p||"slice"==f&&g==p)&&e.translate(i-r,0),c.match(/YMax$/)&&("meet"==f&&m==d||"slice"==f&&g==d)&&e.translate(0,o-a)),"none"==c?e.scale(d,p):"meet"==f?e.scale(m,m):"slice"==f&&e.scale(g,g),e.translate(null==s?0:-s,null==l?0:-l)},n.Element={},n.EmptyProperty=new n.Property("EMPTY",""),n.Element.ElementBase=function(e){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(e,t){var i=this.attributes[e];return null!=i?i:(1==t&&(i=new n.Property(e,""),this.attributes[e]=i),i||n.EmptyProperty)},this.getHrefAttribute=function(){for(var e in this.attributes)if(e.match(/:href$/))return this.attributes[e];return n.EmptyProperty},this.style=function(e,t){var i=this.styles[e];if(null!=i)return i;var r=this.attribute(e);if(null!=r&&r.hasValue())return this.styles[e]=r,r;var o=this.parent;if(null!=o){var a=o.style(e);if(null!=a&&a.hasValue())return a}return 1==t&&(i=new n.Property(e,""),this.styles[e]=i),i||n.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(e.save(),this.attribute("mask").hasValue()){var t=this.attribute("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var i=this.style("filter").getDefinition();null!=i&&i.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(e){},this.clearContext=function(e){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(e,t){var i=e;t&&(i=n.CreateElement(e)),i.parent=this,this.children.push(i)},null!=e&&1==e.nodeType){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&this.addChild(i,!0),this.captureTextNodes&&3==i.nodeType){var r=i.nodeValue||i.text||"";""!=n.trim(n.compressSpaces(r))&&this.addChild(new n.Element.tspan(i),!1)}}for(var t=0;t<e.attributes.length;t++){var o=e.attributes[t];this.attributes[o.nodeName]=new n.Property(o.nodeName,o.nodeValue)}var a=n.Styles[e.nodeName];if(null!=a)for(var s in a)this.styles[s]=a[s];if(this.attribute("class").hasValue())for(var l=n.compressSpaces(this.attribute("class").value).split(" "),u=0;u<l.length;u++){if(a=n.Styles["."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s];if(a=n.Styles[e.nodeName+"."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("id").hasValue()){var a=n.Styles["#"+this.attribute("id").value];if(null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("style").hasValue())for(var a=this.attribute("style").value.split(";"),t=0;t<a.length;t++)if(""!=n.trim(a[t])){var h=a[t].split(":"),s=n.trim(h[0]),c=n.trim(h[1]);this.styles[s]=new n.Property(s,c)}this.attribute("id").hasValue()&&null==n.Definitions[this.attribute("id").value]&&(n.Definitions[this.attribute("id").value]=this)}},n.Element.RenderedElementBase=function(e){this.base=n.Element.ElementBase,this.base(e),this.setContext=function(e){if(this.style("fill").isUrlDefinition()){var t=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=t&&(e.fillStyle=t)}else if(this.style("fill").hasValue()){var i=this.style("fill");"currentColor"==i.value&&(i.value=this.style("color").value),e.fillStyle="none"==i.value?"rgba(0,0,0,0)":i.value}if(this.style("fill-opacity").hasValue()){var i=new n.Property("fill",e.fillStyle);i=i.addOpacity(this.style("fill-opacity").value),e.fillStyle=i.value}if(this.style("stroke").isUrlDefinition()){var t=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=t&&(e.strokeStyle=t)}else if(this.style("stroke").hasValue()){var r=this.style("stroke");"currentColor"==r.value&&(r.value=this.style("color").value),e.strokeStyle="none"==r.value?"rgba(0,0,0,0)":r.value}if(this.style("stroke-opacity").hasValue()){var r=new n.Property("stroke",e.strokeStyle);r=r.addOpacity(this.style("stroke-opacity").value),e.strokeStyle=r.value}if(this.style("stroke-width").hasValue()){var o=this.style("stroke-width").toPixels();e.lineWidth=0==o?.001:o}if(this.style("stroke-linecap").hasValue()&&(e.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(e.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(e.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var a=n.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof e.setLineDash?e.setLineDash(a):"undefined"!=typeof e.webkitLineDash?e.webkitLineDash=a:"undefined"!=typeof e.mozDash&&(e.mozDash=a);var s=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof e.lineDashOffset?e.lineDashOffset=s:"undefined"!=typeof e.webkitLineDashOffset?e.webkitLineDashOffset=s:"undefined"!=typeof e.mozDashOffset&&(e.mozDashOffset=s)}if("undefined"!=typeof e.font&&(e.font=n.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var l=new n.Transform(this.attribute("transform").value);l.apply(e)}if(this.style("clip-path").hasValue()){var u=this.style("clip-path").getDefinition();null!=u&&u.apply(e)}this.style("opacity").hasValue()&&(e.globalAlpha=this.style("opacity").numValue())}},n.Element.RenderedElementBase.prototype=new n.Element.ElementBase,n.Element.PathElementBase=function(e){this.base=n.Element.RenderedElementBase,this.base(e),this.path=function(e){return null!=e&&e.beginPath(),new n.BoundingBox},this.renderChildren=function(e){this.path(e),n.Mouse.checkPath(this,e),""!=e.fillStyle&&(this.attribute("fill-rule").hasValue()?e.fill(this.attribute("fill-rule").value):e.fill()),""!=e.strokeStyle&&e.stroke();var t=this.getMarkers();if(null!=t){if(this.style("marker-start").isUrlDefinition()){var i=this.style("marker-start").getDefinition();i.render(e,t[0][0],t[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var i=this.style("marker-mid").getDefinition(),r=1;r<t.length-1;r++)i.render(e,t[r][0],t[r][1]);if(this.style("marker-end").isUrlDefinition()){var i=this.style("marker-end").getDefinition();i.render(e,t[t.length-1][0],t[t.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},n.Element.PathElementBase.prototype=new n.Element.RenderedElementBase,n.Element.svg=function(e){this.base=n.Element.RenderedElementBase,this.base(e),this.baseClearContext=this.clearContext,this.clearContext=function(e){this.baseClearContext(e),n.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4,this.baseSetContext(e),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),e.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var t=n.ViewPort.width(),i=n.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){t=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");var r=0,o=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(r=-this.attribute("refX").toPixels("x"),o=-this.attribute("refY").toPixels("y")),e.beginPath(),e.moveTo(r,o),e.lineTo(t,o),e.lineTo(t,i),e.lineTo(r,i),e.closePath(),e.clip()}if(n.ViewPort.SetCurrent(t,i),this.attribute("viewBox").hasValue()){var a=n.ToNumberArray(this.attribute("viewBox").value),s=a[0],l=a[1];t=a[2],i=a[3],n.AspectRatio(e,this.attribute("preserveAspectRatio").value,n.ViewPort.width(),t,n.ViewPort.height(),i,s,l,this.attribute("refX").value,this.attribute("refY").value),n.ViewPort.RemoveCurrent(),n.ViewPort.SetCurrent(a[2],a[3])}}},n.Element.svg.prototype=new n.Element.RenderedElementBase,n.Element.rect=function(e){this.base=n.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y"),a=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=s),a=Math.min(a,r/2),s=Math.min(s,o/2),null!=e&&(e.beginPath(),e.moveTo(t+a,i),e.lineTo(t+r-a,i),e.quadraticCurveTo(t+r,i,t+r,i+s),e.lineTo(t+r,i+o-s),e.quadraticCurveTo(t+r,i+o,t+r-a,i+o),e.lineTo(t+a,i+o),e.quadraticCurveTo(t,i+o,t,i+o-s),e.lineTo(t,i+s),e.quadraticCurveTo(t,i,t+a,i),e.closePath()),new n.BoundingBox(t,i,t+r,i+o)}},n.Element.rect.prototype=new n.Element.PathElementBase,n.Element.circle=function(e){this.base=n.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("cx").toPixels("x"),i=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=e&&(e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!0),e.closePath()),
new n.BoundingBox(t-r,i-r,t+r,i+r)}},n.Element.circle.prototype=new n.Element.PathElementBase,n.Element.ellipse=function(e){this.base=n.Element.PathElementBase,this.base(e),this.path=function(e){var t=4*((Math.sqrt(2)-1)/3),i=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y"),o=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y");return null!=e&&(e.beginPath(),e.moveTo(o,a-r),e.bezierCurveTo(o+t*i,a-r,o+i,a-t*r,o+i,a),e.bezierCurveTo(o+i,a+t*r,o+t*i,a+r,o,a+r),e.bezierCurveTo(o-t*i,a+r,o-i,a+t*r,o-i,a),e.bezierCurveTo(o-i,a-t*r,o-t*i,a-r,o,a-r),e.closePath()),new n.BoundingBox(o-i,a-r,o+i,a+r)}},n.Element.ellipse.prototype=new n.Element.PathElementBase,n.Element.line=function(e){this.base=n.Element.PathElementBase,this.base(e),this.getPoints=function(){return[new n.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new n.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(e){var t=this.getPoints();return null!=e&&(e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y)),new n.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},n.Element.line.prototype=new n.Element.PathElementBase,n.Element.polyline=function(e){this.base=n.Element.PathElementBase,this.base(e),this.points=n.CreatePath(this.attribute("points").value),this.path=function(e){var t=new n.BoundingBox(this.points[0].x,this.points[0].y);null!=e&&(e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)t.addPoint(this.points[i].x,this.points[i].y),null!=e&&e.lineTo(this.points[i].x,this.points[i].y);return t},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},n.Element.polyline.prototype=new n.Element.PathElementBase,n.Element.polygon=function(e){this.base=n.Element.polyline,this.base(e),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},n.Element.polygon.prototype=new n.Element.polyline,n.Element.path=function(e){this.base=n.Element.PathElementBase,this.base(e);var t=this.attribute("d").value;t=t.replace(/,/gm," "),t=t.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),t=t.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),t=t.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),t=t.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),t=t.replace(/([0-9])([+\-])/gm,"$1 $2"),t=t.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),t=t.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),t=n.compressSpaces(t),t=n.trim(t),this.PathParser=new function(e){this.tokens=e.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new n.Point(0,0),this.control=new n.Point(0,0),this.current=new n.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var e=new n.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(e)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e,e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e,e},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var e=new n.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return e},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,i){null!=i&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(i)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(t),this.path=function(e){var t=this.PathParser;t.reset();var i=new n.BoundingBox;for(null!=e&&e.beginPath();!t.isEnd();)switch(t.nextCommand(),t.command){case"M":case"m":var r=t.getAsCurrentPoint();for(t.addMarker(r),i.addPoint(r.x,r.y),null!=e&&e.moveTo(r.x,r.y),t.start=t.current;!t.isCommandOrEnd();){var r=t.getAsCurrentPoint();t.addMarker(r,t.start),i.addPoint(r.x,r.y),null!=e&&e.lineTo(r.x,r.y)}break;case"L":case"l":for(;!t.isCommandOrEnd();){var o=t.current,r=t.getAsCurrentPoint();t.addMarker(r,o),i.addPoint(r.x,r.y),null!=e&&e.lineTo(r.x,r.y)}break;case"H":case"h":for(;!t.isCommandOrEnd();){var a=new n.Point((t.isRelativeCommand()?t.current.x:0)+t.getScalar(),t.current.y);t.addMarker(a,t.current),t.current=a,i.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y)}break;case"V":case"v":for(;!t.isCommandOrEnd();){var a=new n.Point(t.current.x,(t.isRelativeCommand()?t.current.y:0)+t.getScalar());t.addMarker(a,t.current),t.current=a,i.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y)}break;case"C":case"c":for(;!t.isCommandOrEnd();){var s=t.current,l=t.getPoint(),u=t.getAsControlPoint(),h=t.getAsCurrentPoint();t.addMarker(h,u,l),i.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,h.x,h.y),null!=e&&e.bezierCurveTo(l.x,l.y,u.x,u.y,h.x,h.y)}break;case"S":case"s":for(;!t.isCommandOrEnd();){var s=t.current,l=t.getReflectedControlPoint(),u=t.getAsControlPoint(),h=t.getAsCurrentPoint();t.addMarker(h,u,l),i.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,h.x,h.y),null!=e&&e.bezierCurveTo(l.x,l.y,u.x,u.y,h.x,h.y)}break;case"Q":case"q":for(;!t.isCommandOrEnd();){var s=t.current,u=t.getAsControlPoint(),h=t.getAsCurrentPoint();t.addMarker(h,u,u),i.addQuadraticCurve(s.x,s.y,u.x,u.y,h.x,h.y),null!=e&&e.quadraticCurveTo(u.x,u.y,h.x,h.y)}break;case"T":case"t":for(;!t.isCommandOrEnd();){var s=t.current,u=t.getReflectedControlPoint();t.control=u;var h=t.getAsCurrentPoint();t.addMarker(h,u,u),i.addQuadraticCurve(s.x,s.y,u.x,u.y,h.x,h.y),null!=e&&e.quadraticCurveTo(u.x,u.y,h.x,h.y)}break;case"A":case"a":for(;!t.isCommandOrEnd();){var s=t.current,c=t.getScalar(),f=t.getScalar(),d=t.getScalar()*(Math.PI/180),p=t.getScalar(),m=t.getScalar(),h=t.getAsCurrentPoint(),g=new n.Point(Math.cos(d)*(s.x-h.x)/2+Math.sin(d)*(s.y-h.y)/2,-Math.sin(d)*(s.x-h.x)/2+Math.cos(d)*(s.y-h.y)/2),v=Math.pow(g.x,2)/Math.pow(c,2)+Math.pow(g.y,2)/Math.pow(f,2);v>1&&(c*=Math.sqrt(v),f*=Math.sqrt(v));var y=(p==m?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(f,2)-Math.pow(c,2)*Math.pow(g.y,2)-Math.pow(f,2)*Math.pow(g.x,2))/(Math.pow(c,2)*Math.pow(g.y,2)+Math.pow(f,2)*Math.pow(g.x,2)));isNaN(y)&&(y=0);var x=new n.Point(y*c*g.y/f,y*-f*g.x/c),b=new n.Point((s.x+h.x)/2+Math.cos(d)*x.x-Math.sin(d)*x.y,(s.y+h.y)/2+Math.sin(d)*x.x+Math.cos(d)*x.y),w=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},_=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(w(e)*w(t))},M=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(_(e,t))},S=M([1,0],[(g.x-x.x)/c,(g.y-x.y)/f]),C=[(g.x-x.x)/c,(g.y-x.y)/f],T=[(-g.x-x.x)/c,(-g.y-x.y)/f],E=M(C,T);_(C,T)<=-1&&(E=Math.PI),_(C,T)>=1&&(E=0);var A=1-m?1:-1,P=S+A*(E/2),L=new n.Point(b.x+c*Math.cos(P),b.y+f*Math.sin(P));if(t.addMarkerAngle(L,P-A*Math.PI/2),t.addMarkerAngle(h,P-A*Math.PI),i.addPoint(h.x,h.y),null!=e){var _=c>f?c:f,D=c>f?1:c/f,N=c>f?f/c:1;e.translate(b.x,b.y),e.rotate(d),e.scale(D,N),e.arc(0,0,_,S,S+E,1-m),e.scale(1/D,1/N),e.rotate(-d),e.translate(-b.x,-b.y)}}break;case"Z":case"z":null!=e&&e.closePath(),t.current=t.start}return i},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),i=[],n=0;n<e.length;n++)i.push([e[n],t[n]]);return i}},n.Element.path.prototype=new n.Element.PathElementBase,n.Element.pattern=function(e){this.base=n.Element.ElementBase,this.base(e),this.createPattern=function(e,t){var i=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),o=new n.Element.svg;o.attributes.viewBox=new n.Property("viewBox",this.attribute("viewBox").value),o.attributes.width=new n.Property("width",i+"px"),o.attributes.height=new n.Property("height",r+"px"),o.attributes.transform=new n.Property("transform",this.attribute("patternTransform").value),o.children=this.children;var a=document.createElement("canvas");a.width=i,a.height=r;var s=a.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&s.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var l=-1;1>=l;l++)for(var u=-1;1>=u;u++)s.save(),s.translate(l*a.width,u*a.height),o.render(s),s.restore();var h=e.createPattern(a,"repeat");return h}},n.Element.pattern.prototype=new n.Element.ElementBase,n.Element.marker=function(e){this.base=n.Element.ElementBase,this.base(e),this.baseRender=this.render,this.render=function(e,t,i){e.translate(t.x,t.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(i),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(e.lineWidth,e.lineWidth),e.save();var r=new n.Element.svg;r.attributes.viewBox=new n.Property("viewBox",this.attribute("viewBox").value),r.attributes.refX=new n.Property("refX",this.attribute("refX").value),r.attributes.refY=new n.Property("refY",this.attribute("refY").value),r.attributes.width=new n.Property("width",this.attribute("markerWidth").value),r.attributes.height=new n.Property("height",this.attribute("markerHeight").value),r.attributes.fill=new n.Property("fill",this.attribute("fill").valueOrDefault("black")),r.attributes.stroke=new n.Property("stroke",this.attribute("stroke").valueOrDefault("none")),r.children=this.children,r.render(e),e.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(1/e.lineWidth,1/e.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(-i),e.translate(-t.x,-t.y)}},n.Element.marker.prototype=new n.Element.ElementBase,n.Element.defs=function(e){this.base=n.Element.ElementBase,this.base(e),this.render=function(e){}},n.Element.defs.prototype=new n.Element.ElementBase,n.Element.GradientBase=function(e){this.base=n.Element.ElementBase,this.base(e),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var t=0;t<this.children.length;t++){var i=this.children[t];"stop"==i.type&&this.stops.push(i)}this.getGradient=function(){},this.createGradient=function(e,t,i){var r=this;this.getHrefAttribute().hasValue()&&(r=this.getHrefAttribute().getDefinition());var o=function(e){if(i.hasValue()){var t=new n.Property("color",e);return t.addOpacity(i.value).value}return e},a=this.getGradient(e,t);if(null==a)return o(r.stops[r.stops.length-1].color);for(var s=0;s<r.stops.length;s++)a.addColorStop(r.stops[s].offset,o(r.stops[s].color));if(this.attribute("gradientTransform").hasValue()){var l=n.ViewPort.viewPorts[0],u=new n.Element.rect;u.attributes.x=new n.Property("x",-n.MAX_VIRTUAL_PIXELS/3),u.attributes.y=new n.Property("y",-n.MAX_VIRTUAL_PIXELS/3),u.attributes.width=new n.Property("width",n.MAX_VIRTUAL_PIXELS),u.attributes.height=new n.Property("height",n.MAX_VIRTUAL_PIXELS);var h=new n.Element.g;h.attributes.transform=new n.Property("transform",this.attribute("gradientTransform").value),h.children=[u];var c=new n.Element.svg;c.attributes.x=new n.Property("x",0),c.attributes.y=new n.Property("y",0),c.attributes.width=new n.Property("width",l.width),c.attributes.height=new n.Property("height",l.height),c.children=[h];var f=document.createElement("canvas");f.width=l.width,f.height=l.height;var d=f.getContext("2d");return d.fillStyle=a,c.render(d),d.createPattern(f,"no-repeat")}return a}},n.Element.GradientBase.prototype=new n.Element.ElementBase,n.Element.linearGradient=function(e){this.base=n.Element.GradientBase,this.base(e),this.getGradient=function(e,t){var i=t.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var n="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),r="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),a="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return n==o&&r==a?null:e.createLinearGradient(n,r,o,a)}},n.Element.linearGradient.prototype=new n.Element.GradientBase,n.Element.radialGradient=function(e){this.base=n.Element.GradientBase,this.base(e),this.getGradient=function(e,t){var i=t.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var n="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),r="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=n,a=r;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(a="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits?(i.width()+i.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(o,a,0,n,r,s)}},n.Element.radialGradient.prototype=new n.Element.GradientBase,n.Element.stop=function(e){this.base=n.Element.ElementBase,this.base(e),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var t=this.style("stop-color");this.style("stop-opacity").hasValue()&&(t=t.addOpacity(this.style("stop-opacity").value)),this.color=t.value},n.Element.stop.prototype=new n.Element.ElementBase,n.Element.AnimateBase=function(e){this.base=n.Element.ElementBase,this.base(e),n.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var i=this.calcValue();if(this.attribute("type").hasValue()){var n=this.attribute("type").value;i=n+"("+i+")"}this.getProperty().value=i,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var e={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=e.progress*(this.values.value.length-1),i=Math.floor(t),r=Math.ceil(t);e.from=new n.Property("from",parseFloat(this.values.value[i])),e.to=new n.Property("to",parseFloat(this.values.value[r])),e.progress=(t-i)/(r-i)}else e.from=this.from,e.to=this.to;return e}},n.Element.AnimateBase.prototype=new n.Element.ElementBase,n.Element.animate=function(e){this.base=n.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress(),t=e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress;return t+this.initialUnits}},n.Element.animate.prototype=new n.Element.AnimateBase,n.Element.animateColor=function(t){this.base=n.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress(),i=new e(t.from.value),n=new e(t.to.value);if(i.ok&&n.ok){var r=i.r+(n.r-i.r)*t.progress,o=i.g+(n.g-i.g)*t.progress,a=i.b+(n.b-i.b)*t.progress;return"rgb("+parseInt(r,10)+","+parseInt(o,10)+","+parseInt(a,10)+")"}return this.attribute("from").value}},n.Element.animateColor.prototype=new n.Element.AnimateBase,n.Element.animateTransform=function(e){this.base=n.Element.AnimateBase,this.base(e),this.calcValue=function(){for(var e=this.progress(),t=n.ToNumberArray(e.from.value),i=n.ToNumberArray(e.to.value),r="",o=0;o<t.length;o++)r+=t[o]+(i[o]-t[o])*e.progress+" ";return r}},n.Element.animateTransform.prototype=new n.Element.animate,n.Element.font=function(e){this.base=n.Element.ElementBase,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var t=0;t<this.children.length;t++){var i=this.children[t];"font-face"==i.type?(this.fontFace=i,i.style("font-family").hasValue()&&(n.Definitions[i.style("font-family").value]=this)):"missing-glyph"==i.type?this.missingGlyph=i:"glyph"==i.type&&(""!=i.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[i.unicode]&&(this.glyphs[i.unicode]=[]),this.glyphs[i.unicode][i.arabicForm]=i):this.glyphs[i.unicode]=i)}},n.Element.font.prototype=new n.Element.ElementBase,n.Element.fontface=function(e){this.base=n.Element.ElementBase,this.base(e),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},n.Element.fontface.prototype=new n.Element.ElementBase,n.Element.missingglyph=function(e){this.base=n.Element.path,this.base(e),this.horizAdvX=0},n.Element.missingglyph.prototype=new n.Element.path,n.Element.glyph=function(e){this.base=n.Element.path,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},n.Element.glyph.prototype=new n.Element.path,n.Element.text=function(e){this.captureTextNodes=!0,this.base=n.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.style("dominant-baseline").hasValue()&&(e.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(e.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new n.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(e,this,0);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,t)},this.getAnchorDelta=function(e,t,i){var n=this.style("text-anchor").valueOrDefault("start");if("start"!=n){for(var r=0,o=i;o<t.children.length;o++){var a=t.children[o];if(o>i&&a.attribute("x").hasValue())break;r+=a.measureTextRecursive(e)}return-1*("end"==n?r:r/2)}return 0},this.renderChild=function(e,t,i){var n=t.children[i];n.attribute("x").hasValue()?n.x=n.attribute("x").toPixels("x")+this.getAnchorDelta(e,t,i):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),n.attribute("dx").hasValue()&&(this.x+=n.attribute("dx").toPixels("x")),n.x=this.x),this.x=n.x+n.measureText(e),n.attribute("y").hasValue()?n.y=n.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),n.attribute("dy").hasValue()&&(this.y+=n.attribute("dy").toPixels("y")),n.y=this.y),this.y=n.y,n.render(e);for(var i=0;i<n.children.length;i++)this.renderChild(e,n,i)}},n.Element.text.prototype=new n.Element.RenderedElementBase,n.Element.TextElementBase=function(e){this.base=n.Element.RenderedElementBase,this.base(e),this.getGlyph=function(e,t,i){var n=t[i],r=null;if(e.isArabic){var o="isolated";(0==i||" "==t[i-1])&&i<t.length-2&&" "!=t[i+1]&&(o="terminal"),i>0&&" "!=t[i-1]&&i<t.length-2&&" "!=t[i+1]&&(o="medial"),i>0&&" "!=t[i-1]&&(i==t.length-1||" "==t[i+1])&&(o="initial"),"undefined"!=typeof e.glyphs[n]&&(r=e.glyphs[n][o],null==r&&"glyph"==e.glyphs[n].type&&(r=e.glyphs[n]))}else r=e.glyphs[n];return null==r&&(r=e.missingGlyph),r},this.renderChildren=function(e){var t=this.parent.style("font-family").getDefinition();if(null==t)""!=e.fillStyle&&e.fillText(n.compressSpaces(this.getText()),this.x,this.y),""!=e.strokeStyle&&e.strokeText(n.compressSpaces(this.getText()),this.x,this.y);else{var i=this.parent.style("font-size").numValueOrDefault(n.Font.Parse(n.ctx.font).fontSize),r=this.parent.style("font-style").valueOrDefault(n.Font.Parse(n.ctx.font).fontStyle),o=this.getText();t.isRTL&&(o=o.split("").reverse().join(""));for(var a=n.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(t,o,s),u=i/t.fontFace.unitsPerEm;e.translate(this.x,this.y),e.scale(u,-u);var h=e.lineWidth;e.lineWidth=e.lineWidth*t.fontFace.unitsPerEm/i,"italic"==r&&e.transform(1,0,.4,1,0,0),l.render(e),"italic"==r&&e.transform(1,0,-.4,1,0,0),e.lineWidth=h,e.scale(1/u,-1/u),e.translate(-this.x,-this.y),this.x+=i*(l.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(this.x+=a[s])}}},this.getText=function(){},this.measureTextRecursive=function(e){for(var t=this.measureText(e),i=0;i<this.children.length;i++)t+=this.children[i].measureTextRecursive(e);return t},this.measureText=function(e){var t=this.parent.style("font-family").getDefinition();if(null!=t){var i=this.parent.style("font-size").numValueOrDefault(n.Font.Parse(n.ctx.font).fontSize),r=0,o=this.getText();t.isRTL&&(o=o.split("").reverse().join(""));for(var a=n.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(t,o,s);r+=(l.horizAdvX||t.horizAdvX)*i/t.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(r+=a[s])}return r}var u=n.compressSpaces(this.getText());if(!e.measureText)return 10*u.length;e.save(),this.setContext(e);var h=e.measureText(u).width;return e.restore(),h}},n.Element.TextElementBase.prototype=new n.Element.RenderedElementBase,n.Element.tspan=function(e){this.captureTextNodes=!0,this.base=n.Element.TextElementBase,this.base(e),this.text=e.nodeValue||e.text||"",this.getText=function(){return this.text}},n.Element.tspan.prototype=new n.Element.TextElementBase,n.Element.tref=function(e){this.base=n.Element.TextElementBase,this.base(e),this.getText=function(){var e=this.getHrefAttribute().getDefinition();return null!=e?e.children[0].getText():void 0}},n.Element.tref.prototype=new n.Element.TextElementBase,n.Element.a=function(e){this.base=n.Element.TextElementBase,this.base(e),this.hasText=!0;for(var t=0;t<e.childNodes.length;t++)3!=e.childNodes[t].nodeType&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(e){if(this.hasText){this.baseRenderChildren(e);var t=new n.Property("fontSize",n.Font.Parse(n.ctx.font).fontSize);n.Mouse.checkBoundingBox(this,new n.BoundingBox(this.x,this.y-t.toPixels("y"),this.x+this.measureText(e),this.y))}else{var i=new n.Element.g;i.children=this.children,i.parent=this,i.render(e)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){n.ctx.canvas.style.cursor="pointer"}},n.Element.a.prototype=new n.Element.TextElementBase,n.Element.image=function(e){this.base=n.Element.RenderedElementBase,this.base(e);var t=this.getHrefAttribute().value,i=t.match(/\.svg$/);if(n.Images.push(this),this.loaded=!1,i)this.img=n.ajax(t),this.loaded=!0;else{this.img=document.createElement("img");var r=this;this.img.onload=function(){r.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+t+'" not found'),r.loaded=!0)},this.img.src=t}this.renderChildren=function(e){var t=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=o&&0!=a&&(e.save(),i?e.drawSvg(this.img,t,r,o,a):(e.translate(t,r),n.AspectRatio(e,this.attribute("preserveAspectRatio").value,o,this.img.width,a,this.img.height,0,0),e.drawImage(this.img,0,0)),e.restore())},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),t=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");return new n.BoundingBox(e,t,e+i,t+r)}},n.Element.image.prototype=new n.Element.RenderedElementBase,n.Element.g=function(e){this.base=n.Element.RenderedElementBase,this.base(e),this.getBoundingBox=function(){for(var e=new n.BoundingBox,t=0;t<this.children.length;t++)e.addBoundingBox(this.children[t].getBoundingBox());return e}},n.Element.g.prototype=new n.Element.RenderedElementBase,n.Element.symbol=function(e){this.base=n.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){if(this.baseSetContext(e),this.attribute("viewBox").hasValue()){var t=n.ToNumberArray(this.attribute("viewBox").value),i=t[0],r=t[1];width=t[2],height=t[3],n.AspectRatio(e,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,i,r),n.ViewPort.SetCurrent(t[2],t[3])}}},n.Element.symbol.prototype=new n.Element.RenderedElementBase,n.Element.style=function(e){this.base=n.Element.ElementBase,this.base(e);for(var t="",i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].nodeValue;t=t.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),t=n.compressSpaces(t);for(var r=t.split("}"),i=0;i<r.length;i++)if(""!=n.trim(r[i]))for(var o=r[i].split("{"),a=o[0].split(","),s=o[1].split(";"),l=0;l<a.length;l++){var u=n.trim(a[l]);if(""!=u){for(var h={},c=0;c<s.length;c++){var f=s[c].indexOf(":"),d=s[c].substr(0,f),p=s[c].substr(f+1,s[c].length-f);null!=d&&null!=p&&(h[n.trim(d)]=new n.Property(n.trim(d),n.trim(p)))}if(n.Styles[u]=h,"@font-face"==u)for(var m=h["font-family"].value.replace(/"/g,""),g=h.src.value.split(","),v=0;v<g.length;v++)if(g[v].indexOf('format("svg")')>0)for(var y=g[v].indexOf("url"),x=g[v].indexOf(")",y),b=g[v].substr(y+5,x-y-6),w=n.parseXml(n.ajax(b)),_=w.getElementsByTagName("font"),M=0;M<_.length;M++){var S=n.CreateElement(_[M]);n.Definitions[m]=S}}}},n.Element.style.prototype=new n.Element.ElementBase,n.Element.use=function(e){this.base=n.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var e=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(e.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(e.attribute("height",!0).value=this.attribute("height").value),e},this.path=function(e){var t=this.getDefinition();null!=t&&t.path(e)},this.getBoundingBox=function(){var e=this.getDefinition();return null!=e?e.getBoundingBox():void 0},this.renderChildren=function(e){var t=this.getDefinition();if(null!=t){var i=t.parent;t.parent=null,t.render(e),t.parent=i}}},n.Element.use.prototype=new n.Element.RenderedElementBase,n.Element.mask=function(e){this.base=n.Element.ElementBase,this.base(e),this.apply=function(e,t){var i=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");if(0==o&&0==a){for(var s=new n.BoundingBox,l=0;l<this.children.length;l++)s.addBoundingBox(this.children[l].getBoundingBox());var i=Math.floor(s.x1),r=Math.floor(s.y1),o=Math.floor(s.width()),a=Math.floor(s.height())}var u=t.attribute("mask").value;t.attribute("mask").value="";var h=document.createElement("canvas");h.width=i+o,h.height=r+a;var c=h.getContext("2d");this.renderChildren(c);var f=document.createElement("canvas");f.width=i+o,f.height=r+a;var d=f.getContext("2d");t.render(d),d.globalCompositeOperation="destination-in",d.fillStyle=c.createPattern(h,"no-repeat"),d.fillRect(0,0,i+o,r+a),e.fillStyle=d.createPattern(f,"no-repeat"),e.fillRect(0,0,i+o,r+a),t.attribute("mask").value=u},this.render=function(e){}},n.Element.mask.prototype=new n.Element.ElementBase,n.Element.clipPath=function(e){this.base=n.Element.ElementBase,this.base(e),this.apply=function(e){for(var t=0;t<this.children.length;t++){var i=this.children[t];if("undefined"!=typeof i.path){var r=null;i.attribute("transform").hasValue()&&(r=new n.Transform(i.attribute("transform").value),r.apply(e)),i.path(e),e.clip(),r&&r.unapply(e)}}},this.render=function(e){}},n.Element.clipPath.prototype=new n.Element.ElementBase,n.Element.filter=function(e){this.base=n.Element.ElementBase,this.base(e),this.apply=function(e,t){var i=t.getBoundingBox(),n=Math.floor(i.x1),r=Math.floor(i.y1),o=Math.floor(i.width()),a=Math.floor(i.height()),s=t.style("filter").value;t.style("filter").value="";for(var l=0,u=0,h=0;h<this.children.length;h++){var c=this.children[h].extraFilterDistance||0;l=Math.max(l,c),u=Math.max(u,c)}var f=document.createElement("canvas");f.width=o+2*l,f.height=a+2*u;var d=f.getContext("2d");d.translate(-n+l,-r+u),t.render(d);for(var h=0;h<this.children.length;h++)this.children[h].apply(d,0,0,o+2*l,a+2*u);e.drawImage(f,0,0,o+2*l,a+2*u,n-l,r-u,o+2*l,a+2*u),t.style("filter",!0).value=s},this.render=function(e){}},n.Element.filter.prototype=new n.Element.ElementBase,n.Element.feMorphology=function(e){this.base=n.Element.ElementBase,this.base(e),this.apply=function(e,t,i,n,r){}},n.Element.feMorphology.prototype=new n.Element.ElementBase,n.Element.feColorMatrix=function(e){function t(e,t,i,n,r,o){return e[i*n*4+4*t+o]}function i(e,t,i,n,r,o,a){e[i*n*4+4*t+o]=a}this.base=n.Element.ElementBase,this.base(e),this.apply=function(e,n,r,o,a){for(var s=e.getImageData(0,0,o,a),r=0;a>r;r++)for(var n=0;o>n;n++){var l=t(s.data,n,r,o,a,0),u=t(s.data,n,r,o,a,1),h=t(s.data,n,r,o,a,2),c=(l+u+h)/3;i(s.data,n,r,o,a,0,c),i(s.data,n,r,o,a,1,c),i(s.data,n,r,o,a,2,c)}e.clearRect(0,0,o,a),e.putImageData(s,0,0)}},n.Element.feColorMatrix.prototype=new n.Element.ElementBase,n.Element.feGaussianBlur=function(e){this.base=n.Element.ElementBase,this.base(e),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(e,i,r,o,a){return"undefined"==typeof t?void("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work")):(e.canvas.id=n.UniqueId(),
e.canvas.style.display="none",document.body.appendChild(e.canvas),t(e.canvas.id,i,r,o,a,this.blurRadius),void document.body.removeChild(e.canvas))}},n.Element.feGaussianBlur.prototype=new n.Element.ElementBase,n.Element.title=function(e){},n.Element.title.prototype=new n.Element.ElementBase,n.Element.desc=function(e){},n.Element.desc.prototype=new n.Element.ElementBase,n.Element.MISSING=function(e){"undefined"!=typeof console&&console.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},n.Element.MISSING.prototype=new n.Element.ElementBase,n.CreateElement=function(e){var t=e.nodeName.replace(/^[^:]+:/,"");t=t.replace(/\-/g,"");var i=null;return i="undefined"!=typeof n.Element[t]?new n.Element[t](e):new n.Element.MISSING(e),i.type=e.nodeName,i},n.load=function(e,t){n.loadXml(e,n.ajax(t))},n.loadXml=function(e,t){n.loadXmlDoc(e,n.parseXml(t))},n.loadXmlDoc=function(e,t){n.init(e);var i=function(t){for(var i=e.canvas;i;)t.x-=i.offsetLeft,t.y-=i.offsetTop,i=i.offsetParent;return window.scrollX&&(t.x+=window.scrollX),window.scrollY&&(t.y+=window.scrollY),t};1!=n.opts.ignoreMouse&&(e.canvas.onclick=function(e){var t=i(new n.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));n.Mouse.onclick(t.x,t.y)},e.canvas.onmousemove=function(e){var t=i(new n.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));n.Mouse.onmousemove(t.x,t.y)});var r=n.CreateElement(t.documentElement);r.root=!0;var o=!0,a=function(){n.ViewPort.Clear(),e.canvas.parentNode&&n.ViewPort.SetCurrent(e.canvas.parentNode.clientWidth,e.canvas.parentNode.clientHeight),1!=n.opts.ignoreDimensions&&(r.style("width").hasValue()&&(e.canvas.width=r.style("width").toPixels("x"),e.canvas.style.width=e.canvas.width+"px"),r.style("height").hasValue()&&(e.canvas.height=r.style("height").toPixels("y"),e.canvas.style.height=e.canvas.height+"px"));var i=e.canvas.clientWidth||e.canvas.width,a=e.canvas.clientHeight||e.canvas.height;if(1==n.opts.ignoreDimensions&&r.style("width").hasValue()&&r.style("height").hasValue()&&(i=r.style("width").toPixels("x"),a=r.style("height").toPixels("y")),n.ViewPort.SetCurrent(i,a),null!=n.opts.offsetX&&(r.attribute("x",!0).value=n.opts.offsetX),null!=n.opts.offsetY&&(r.attribute("y",!0).value=n.opts.offsetY),null!=n.opts.scaleWidth&&null!=n.opts.scaleHeight){var s=1,l=1,u=n.ToNumberArray(r.attribute("viewBox").value);r.attribute("width").hasValue()?s=r.attribute("width").toPixels("x")/n.opts.scaleWidth:isNaN(u[2])||(s=u[2]/n.opts.scaleWidth),r.attribute("height").hasValue()?l=r.attribute("height").toPixels("y")/n.opts.scaleHeight:isNaN(u[3])||(l=u[3]/n.opts.scaleHeight),r.attribute("width",!0).value=n.opts.scaleWidth,r.attribute("height",!0).value=n.opts.scaleHeight,r.attribute("viewBox",!0).value="0 0 "+i*s+" "+a*l,r.attribute("preserveAspectRatio",!0).value="none"}1!=n.opts.ignoreClear&&e.clearRect(0,0,i,a),r.render(e),o&&(o=!1,"function"==typeof n.opts.renderCallback&&n.opts.renderCallback(t))},s=!0;n.ImagesLoaded()&&(s=!1,a()),n.intervalID=setInterval(function(){var e=!1;if(s&&n.ImagesLoaded()&&(s=!1,e=!0),1!=n.opts.ignoreMouse&&(e|=n.Mouse.hasEvents()),1!=n.opts.ignoreAnimation)for(var t=0;t<n.Animations.length;t++)e|=n.Animations[t].update(1e3/n.FRAMERATE);"function"==typeof n.opts.forceRedraw&&1==n.opts.forceRedraw()&&(e=!0),e&&(a(),n.Mouse.runEvents())},1e3/n.FRAMERATE)},n.stop=function(){n.intervalID&&clearInterval(n.intervalID)},n.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var i=0;i<this.events.length;i++){var n=this.events[i];t.isPointInPath&&t.isPointInPath(n.x,n.y)&&(this.eventElements[i]=e)}},this.checkBoundingBox=function(e,t){for(var i=0;i<this.events.length;i++){var n=this.events[i];t.isPointInBox(n.x,n.y)&&(this.eventElements[i]=e)}},this.runEvents=function(){n.ctx.canvas.style.cursor="";for(var e=0;e<this.events.length;e++)for(var t=this.events[e],i=this.eventElements[e];i;)t.run(i),i=i.parent;this.events=[],this.eventElements=[]}},n}this.canvg=function(e,t,i){if(null!=e||null!=t||null!=i){i=i||{},"string"==typeof e&&(e=document.getElementById(e)),null!=e.svg&&e.svg.stop();var r=n();(1!=e.childNodes.length||"OBJECT"!=e.childNodes[0].nodeName)&&(e.svg=r),r.opts=i;var o=e.getContext("2d");"undefined"!=typeof t.documentElement?r.loadXmlDoc(o,t):"<"==t.substr(0,1)?r.loadXml(o,t):r.load(o,t)}else for(var a=document.getElementsByTagName("svg"),s=0;s<a.length;s++){var l=a[s],u=document.createElement("canvas");u.width=l.clientWidth,u.height=l.clientHeight,l.parentNode.insertBefore(u,l),l.parentNode.removeChild(l);var h=document.createElement("div");h.appendChild(l),canvg(u,h.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,i,n,r){canvg(this.canvas,e,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:i,scaleWidth:n,scaleHeight:r})}),a("canvg",function(){}),a("rgbcolor",function(){});var l=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],u=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];a("stackblur",function(){}),function(e,t){function i(i,n){function r(e){return me.preferFlash&&le&&!me.ignoreFlash&&me.flash[e]!==t&&me.flash[e]}function o(e){return function(t){var i,n=this._s;return n&&n._a?i=e.call(this,t):(n&&n.id?me._wD(n.id+": Ignoring "+t.type):me._wD(be+"Ignoring "+t.type),i=null),i}}this.setupOptions={url:i||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,html5Test:/^(probably|maybe)$/i,preferFlash:!0,noSWFCache:!1,idPrefix:"sound"},this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100},this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},opus:{type:["audio/ogg; codecs=opus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}},this.movieID="sm2-container",this.id=n||"sm2movie",this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.versionNumber="V2.97a.20130512",this.version=null,this.movieURL=null,this.altURL=null,this.swfLoaded=!1,this.enabled=!1,this.oMC=null,this.sounds={},this.soundIDs=[],this.muted=!1,this.didFlashBlock=!1,this.filePattern=null,this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i},this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null},this.html5={usingFlash:null},this.flash={},this.html5Only=!1,this.ignoreFlash=!1;var a,s,l,u,h,c,f,d,p,m,g,v,y,x,b,w,_,M,S,C,T,E,A,P,L,D,N,R,O,F,I,k,B,V,U,z,$,H,j,W,G,X,q,Y,K,Z,Q,J,ee,te,ie,ne,re,oe,ae,se,le,ue,he,ce,fe,de,pe,me=this,ge=null,ve=null,ye="soundManager",xe=ye+": ",be="HTML5::",we=navigator.userAgent,_e=e.location.href.toString(),Me=document,Se=[],Ce=!0,Te=!1,Ee=!1,Ae=!1,Pe=!1,Le=!1,De=0,Ne=["log","info","warn","error"],Re=8,Oe=null,Fe=null,Ie=!1,ke=!1,Be=0,Ve=null,Ue=[],ze=null,$e=Array.prototype.slice,He=!1,je=0,We=we.match(/(ipad|iphone|ipod)/i),Ge=we.match(/android/i),Xe=we.match(/msie/i),qe=we.match(/webkit/i),Ye=we.match(/safari/i)&&!we.match(/chrome/i),Ke=we.match(/opera/i),Ze=we.match(/firefox/i),Qe=we.match(/(mobile|pre\/|xoom)/i)||We||Ge,Je=!_e.match(/usehtml5audio/i)&&!_e.match(/sm2\-ignorebadua/i)&&Ye&&!we.match(/silk/i)&&we.match(/OS X 10_6_([3-7])/i),et=e.console!==t&&console.log!==t,tt=Me.hasFocus!==t?Me.hasFocus():null,it=Ye&&(Me.hasFocus===t||!Me.hasFocus()),nt=!it,rt=/(mp3|mp4|mpa|m4a|m4b)/i,ot=1e3,at="about:blank",st=Me.location?Me.location.protocol.match(/http/i):null,lt=st?"":"http://",ut=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,ht=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","m4b","mp4v","3gp","3g2"],ct=new RegExp("\\.("+ht.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,this.useAltURL=!st,$={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"},this.hasHTML5=function(){try{return Audio!==t&&(Ke&&opera!==t&&opera.version()<10?new Audio(null):new Audio).canPlayType!==t}catch(e){return!1}}(),this.setup=function(e){var i=!me.url;return e!==t&&Ae&&ze&&me.ok()&&(e.flashVersion!==t||e.url!==t||e.html5Test!==t)&&G(V("setupLate")),g(e),e&&(i&&L&&e.url!==t&&me.beginDelayedInit(),L||e.url===t||"complete"!==Me.readyState||setTimeout(A,1)),me},this.ok=function(){return ze?Ae&&!Pe:me.useHTML5Audio&&me.hasHTML5},this.supported=this.ok,this.getMovie=function(t){return s(t)||Me[t]||e[t]},this.createSound=function(e,i){function n(){return s=j(s),me.sounds[s.id]=new a(s),me.soundIDs.push(s.id),me.sounds[s.id]}var r,o,s,l=null;if(r=ye+".createSound(): ",o=r+V(Ae?"notOK":"notReady"),!Ae||!me.ok())return G(o),!1;if(i!==t&&(e={id:e,url:i}),s=m(e),s.url=Z(s.url),void 0===s.id&&(s.id=me.setupOptions.idPrefix+je++),s.id.toString().charAt(0).match(/^[0-9]$/)&&me._wD(r+V("badID",s.id),2),me._wD(r+s.id+(s.url?" ("+s.url+")":""),1),X(s.id,!0))return me._wD(r+s.id+" exists",1),me.sounds[s.id];if(ee(s))l=n(),me._wD(s.id+": Using HTML5"),l._setup_html5(s);else{if(me.html5Only)return me._wD(s.id+": No HTML5 support for this sound, and no Flash. Exiting."),n();if(me.html5.usingFlash&&s.url&&s.url.match(/data\:/i))return me._wD(s.id+": data: URIs not supported via Flash. Exiting."),n();c>8&&(null===s.isMovieStar&&(s.isMovieStar=!!(s.serverURL||(s.type?s.type.match(ut):!1)||s.url&&s.url.match(ct))),s.isMovieStar&&(me._wD(r+"using MovieStar handling"),s.loops>1&&d("noNSLoop"))),s=W(s,r),l=n(),8===c?ve._createSound(s.id,s.loops||1,s.usePolicyFile):(ve._createSound(s.id,s.url,s.usePeakData,s.useWaveformData,s.useEQData,s.isMovieStar,s.isMovieStar?s.bufferTime:!1,s.loops||1,s.serverURL,s.duration||null,s.autoPlay,!0,s.autoLoad,s.usePolicyFile),s.serverURL||(l.connected=!0,s.onconnect&&s.onconnect.apply(l))),s.serverURL||!s.autoLoad&&!s.autoPlay||l.load(s)}return!s.serverURL&&s.autoPlay&&l.play(),l},this.destroySound=function(e,t){if(!X(e))return!1;var i,n=me.sounds[e];for(n._iO={},n.stop(),n.unload(),i=0;i<me.soundIDs.length;i++)if(me.soundIDs[i]===e){me.soundIDs.splice(i,1);break}return t||n.destruct(!0),n=null,delete me.sounds[e],!0},this.load=function(e,t){return X(e)?me.sounds[e].load(t):!1},this.unload=function(e){return X(e)?me.sounds[e].unload():!1},this.onPosition=function(e,t,i,n){return X(e)?me.sounds[e].onposition(t,i,n):!1},this.onposition=this.onPosition,this.clearOnPosition=function(e,t,i){return X(e)?me.sounds[e].clearOnPosition(t,i):!1},this.play=function(e,t){var i=null,n=t&&!(t instanceof Object);if(!Ae||!me.ok())return G(ye+".play(): "+V(Ae?"notOK":"notReady")),!1;if(X(e,n))n&&(t={url:t});else{if(!n)return!1;n&&(t={url:t}),t&&t.url&&(me._wD(ye+'.play(): Attempting to create "'+e+'"',1),t.id=e,i=me.createSound(t).play())}return null===i&&(i=me.sounds[e].play(t)),i},this.start=this.play,this.setPosition=function(e,t){return X(e)?me.sounds[e].setPosition(t):!1},this.stop=function(e){return X(e)?(me._wD(ye+".stop("+e+")",1),me.sounds[e].stop()):!1},this.stopAll=function(){var e;me._wD(ye+".stopAll()",1);for(e in me.sounds)me.sounds.hasOwnProperty(e)&&me.sounds[e].stop()},this.pause=function(e){return X(e)?me.sounds[e].pause():!1},this.pauseAll=function(){var e;for(e=me.soundIDs.length-1;e>=0;e--)me.sounds[me.soundIDs[e]].pause()},this.resume=function(e){return X(e)?me.sounds[e].resume():!1},this.resumeAll=function(){var e;for(e=me.soundIDs.length-1;e>=0;e--)me.sounds[me.soundIDs[e]].resume()},this.togglePause=function(e){return X(e)?me.sounds[e].togglePause():!1},this.setPan=function(e,t){return X(e)?me.sounds[e].setPan(t):!1},this.setVolume=function(e,t){return X(e)?me.sounds[e].setVolume(t):!1},this.mute=function(e){var t=0;if(e instanceof String&&(e=null),e)return X(e)?(me._wD(ye+'.mute(): Muting "'+e+'"'),me.sounds[e].mute()):!1;for(me._wD(ye+".mute(): Muting all sounds"),t=me.soundIDs.length-1;t>=0;t--)me.sounds[me.soundIDs[t]].mute();return me.muted=!0,!0},this.muteAll=function(){me.mute()},this.unmute=function(e){var t;if(e instanceof String&&(e=null),e)return X(e)?(me._wD(ye+'.unmute(): Unmuting "'+e+'"'),me.sounds[e].unmute()):!1;for(me._wD(ye+".unmute(): Unmuting all sounds"),t=me.soundIDs.length-1;t>=0;t--)me.sounds[me.soundIDs[t]].unmute();return me.muted=!1,!0},this.unmuteAll=function(){me.unmute()},this.toggleMute=function(e){return X(e)?me.sounds[e].toggleMute():!1},this.getMemoryUse=function(){var e=0;return ve&&8!==c&&(e=parseInt(ve._getMemoryUse(),10)),e},this.disable=function(i){var n;if(i===t&&(i=!1),Pe)return!1;for(Pe=!0,d("shutdown",1),n=me.soundIDs.length-1;n>=0;n--)I(me.sounds[me.soundIDs[n]]);return p(i),ae.remove(e,"load",b),!0},this.canPlayMIME=function(e){var t;return me.hasHTML5&&(t=te({type:e})),!t&&ze&&(t=e&&me.ok()?!!((c>8?e.match(ut):null)||e.match(me.mimePattern)):null),t},this.canPlayURL=function(e){var t;return me.hasHTML5&&(t=te({url:e})),!t&&ze&&(t=e&&me.ok()?!!e.match(me.filePattern):null),t},this.canPlayLink=function(e){return e.type!==t&&e.type&&me.canPlayMIME(e.type)?!0:me.canPlayURL(e.href)},this.getSoundById=function(e,t){if(!e)return null;var i=me.sounds[e];return i||t||me._wD(ye+'.getSoundById(): Sound "'+e+'" not found.',2),i},this.onready=function(t,i){var n="onready",r=!1;if("function"!=typeof t)throw V("needFunction",n);return Ae&&me._wD(V("queue",n)),i||(i=e),y(n,t,i),x(),r=!0,r},this.ontimeout=function(t,i){var n="ontimeout",r=!1;if("function"!=typeof t)throw V("needFunction",n);return Ae&&me._wD(V("queue",n)),i||(i=e),y(n,t,i),x({type:n}),r=!0,r},this._writeDebug=function(e,i){var n,r,o="soundmanager-debug";return me.debugMode?et&&me.useConsole&&(i&&"object"==typeof i?console.log(e,i):Ne[i]!==t?console[Ne[i]](e):console.log(e),me.consoleOnly)?!0:(n=s(o))?(r=Me.createElement("div"),++De%2===0&&(r.className="sm2-alt"),i=i===t?0:parseInt(i,10),r.appendChild(Me.createTextNode(e)),i&&(i>=2&&(r.style.fontWeight="bold"),3===i&&(r.style.color="#ff3333")),n.insertBefore(r,n.firstChild),n=null,!0):!1:!1},-1!==_e.indexOf("sm2-debug=alert")&&(this._writeDebug=function(t){e.alert(t)}),this._wD=this._writeDebug,this._debug=function(){var e,t;for(d("currentObj",1),e=0,t=me.soundIDs.length;t>e;e++)me.sounds[me.soundIDs[e]]._debug()},this.reboot=function(t,i){me.soundIDs.length&&me._wD("Destroying "+me.soundIDs.length+" SMSound object"+(1!==me.soundIDs.length?"s":"")+"...");var n,r,o;for(n=me.soundIDs.length-1;n>=0;n--)me.sounds[me.soundIDs[n]].destruct();if(ve)try{Xe&&(Fe=ve.innerHTML),Oe=ve.parentNode.removeChild(ve)}catch(a){d("badRemove",2)}if(Fe=Oe=ze=ve=null,me.enabled=L=Ae=Ie=ke=Te=Ee=Pe=He=me.swfLoaded=!1,me.soundIDs=[],me.sounds={},je=0,t)Se=[];else for(n in Se)if(Se.hasOwnProperty(n))for(r=0,o=Se[n].length;o>r;r++)Se[n][r].fired=!1;return i||me._wD(ye+": Rebooting..."),me.html5={usingFlash:null},me.flash={},me.html5Only=!1,me.ignoreFlash=!1,e.setTimeout(function(){E(),i||me.beginDelayedInit()},20),me},this.reset=function(){return d("reset"),me.reboot(!0,!0)},this.getMoviePercent=function(){return ve&&"PercentLoaded"in ve?ve.PercentLoaded():null},this.beginDelayedInit=function(){Le=!0,A(),setTimeout(function(){return ke?!1:(N(),T(),ke=!0,!0)},20),w()},this.destruct=function(){me._wD(ye+".destruct()"),me.disable(!0)},a=function(e){var i,n,r,o,a,s,l,u,h,p,g=this,v=!1,y=[],x=0,b=null;h={duration:null,time:null},this.id=e.id,this.sID=this.id,this.url=e.url,this.options=m(e),this.instanceOptions=this.options,this._iO=this.instanceOptions,this.pan=this.options.pan,this.volume=this.options.volume,this.isHTML5=!1,this._a=null,p=this.url?!1:!0,this.id3={},this._debug=function(){me._wD(g.id+": Merged options:",g.options)},this.load=function(e){var i,n=null;if(e!==t?g._iO=m(e,g.options):(e=g.options,g._iO=e,b&&b!==g.url&&(d("manURL"),g._iO.url=g.url,g.url=null)),g._iO.url||(g._iO.url=g.url),g._iO.url=Z(g._iO.url),g.instanceOptions=g._iO,i=g._iO,me._wD(g.id+": load ("+i.url+")"),!i.url&&!g.url)return me._wD(g.id+": load(): url is unassigned. Exiting.",2),g;if(g.isHTML5||8!==c||g.url||i.autoPlay||me._wD(g.id+": Flash 8 load() limitation: Wait for onload() before calling play().",1),i.url===g.url&&0!==g.readyState&&2!==g.readyState)return d("onURL",1),3===g.readyState&&i.onload&&pe(g,function(){i.onload.apply(g,[!!g.duration])}),g;if(g.loaded=!1,g.readyState=1,g.playState=0,g.id3={},ee(i))n=g._setup_html5(i),n._called_load?me._wD(g.id+": Ignoring request to load again"):(g._html5_canplay=!1,g.url!==i.url&&(me._wD(d("manURL")+": "+i.url),g._a.src=i.url,g.setPosition(0)),g._a.autobuffer="auto",g._a.preload="auto",g._a._called_load=!0,i.autoPlay&&g.play());else{if(me.html5Only)return me._wD(g.id+": No flash support. Exiting."),g;if(g._iO.url&&g._iO.url.match(/data\:/i))return me._wD(g.id+": data: URIs not supported via Flash. Exiting."),g;try{g.isHTML5=!1,g._iO=W(j(i)),i=g._iO,8===c?ve._load(g.id,i.url,i.stream,i.autoPlay,i.usePolicyFile):ve._load(g.id,i.url,!!i.stream,!!i.autoPlay,i.loops||1,!!i.autoLoad,i.usePolicyFile)}catch(r){d("smError",2),f("onload",!1),R({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}return g.url=i.url,g},this.unload=function(){return 0!==g.readyState&&(me._wD(g.id+": unload()"),g.isHTML5?(o(),g._a&&(g._a.pause(),b=ne(g._a))):8===c?ve._unload(g.id,at):ve._unload(g.id),i()),g},this.destruct=function(e){me._wD(g.id+": Destruct"),g.isHTML5?(o(),g._a&&(g._a.pause(),ne(g._a),He||r(),g._a._s=null,g._a=null)):(g._iO.onfailure=null,ve._destroySound(g.id)),e||me.destroySound(g.id,!0)},this.play=function(e,i){var n,r,o,l,h,f,d,y=!0,x=null;if(n=g.id+": play(): ",i=i===t?!0:i,e||(e={}),g.url&&(g._iO.url=g.url),g._iO=m(g._iO,g.options),g._iO=m(e,g._iO),g._iO.url=Z(g._iO.url),g.instanceOptions=g._iO,!g.isHTML5&&g._iO.serverURL&&!g.connected)return g.getAutoPlay()||(me._wD(n+" Netstream not connected yet - setting autoPlay"),g.setAutoPlay(!0)),g;if(ee(g._iO)&&(g._setup_html5(g._iO),a()),1!==g.playState||g.paused||(r=g._iO.multiShot,r?me._wD(n+"Already playing (multi-shot)",1):(me._wD(n+"Already playing (one-shot)",1),g.isHTML5&&g.setPosition(g._iO.position),x=g)),null!==x)return x;if(e.url&&e.url!==g.url&&(g.readyState||g.isHTML5||8!==c||!p?g.load(g._iO):p=!1),g.loaded?me._wD(n.substr(0,n.lastIndexOf(":"))):0===g.readyState?(me._wD(n+"Attempting to load"),g.isHTML5||me.html5Only?g.isHTML5?g.load(g._iO):(me._wD(n+"Unsupported type. Exiting."),x=g):(g._iO.autoPlay=!0,g.load(g._iO)),g.instanceOptions=g._iO):2===g.readyState?(me._wD(n+"Could not load - exiting",2),x=g):me._wD(n+"Loading - attempting to play..."),null!==x)return x;if(!g.isHTML5&&9===c&&g.position>0&&g.position===g.duration&&(me._wD(n+"Sound at end, resetting to position:0"),e.position=0),g.paused&&g.position>=0&&(!g._iO.serverURL||g.position>0))me._wD(n+"Resuming from paused state",1),g.resume();else{if(g._iO=m(e,g._iO),null!==g._iO.from&&null!==g._iO.to&&0===g.instanceCount&&0===g.playState&&!g._iO.serverURL){if(l=function(){g._iO=m(e,g._iO),g.play(g._iO)},g.isHTML5&&!g._html5_canplay?(me._wD(n+"Beginning load for from/to case"),g.load({oncanplay:l}),x=!1):g.isHTML5||g.loaded||g.readyState&&2===g.readyState||(me._wD(n+"Preloading for from/to case"),g.load({onload:l}),x=!1),null!==x)return x;g._iO=u()}(!g.instanceCount||g._iO.multiShotEvents||g.isHTML5&&g._iO.multiShot&&!He||!g.isHTML5&&c>8&&!g.getAutoPlay())&&g.instanceCount++,g._iO.onposition&&0===g.playState&&s(g),g.playState=1,g.paused=!1,g.position=g._iO.position===t||isNaN(g._iO.position)?0:g._iO.position,g.isHTML5||(g._iO=W(j(g._iO))),g._iO.onplay&&i&&(g._iO.onplay.apply(g),v=!0),g.setVolume(g._iO.volume,!0),g.setPan(g._iO.pan,!0),g.isHTML5?g.instanceCount<2?(a(),o=g._setup_html5(),g.setPosition(g._iO.position),o.play()):(me._wD(g.id+": Cloning Audio() for instance #"+g.instanceCount+"..."),h=new Audio(g._iO.url),f=function(){ae.remove(h,"onended",f),g._onfinish(g),ne(h),h=null},d=function(){ae.remove(h,"canplay",d);try{h.currentTime=g._iO.position/ot}catch(e){G(g.id+": multiShot play() failed to apply position of "+g._iO.position/ot)}h.play()},ae.add(h,"ended",f),g._iO.position?ae.add(h,"canplay",d):h.play()):(y=ve._start(g.id,g._iO.loops||1,9===c?g.position:g.position/ot,g._iO.multiShot||!1),9!==c||y||(me._wD(n+"No sound hardware, or 32-sound ceiling hit",2),g._iO.onplayerror&&g._iO.onplayerror.apply(g)))}return g},this.start=this.play,this.stop=function(e){var t,i=g._iO;return 1===g.playState&&(me._wD(g.id+": stop()"),g._onbufferchange(0),g._resetOnPosition(0),g.paused=!1,g.isHTML5||(g.playState=0),l(),i.to&&g.clearOnPosition(i.to),g.isHTML5?g._a&&(t=g.position,g.setPosition(0),g.position=t,g._a.pause(),g.playState=0,g._onTimer(),o()):(ve._stop(g.id,e),i.serverURL&&g.unload()),g.instanceCount=0,g._iO={},i.onstop&&i.onstop.apply(g)),g},this.setAutoPlay=function(e){me._wD(g.id+": Autoplay turned "+(e?"on":"off")),g._iO.autoPlay=e,g.isHTML5||(ve._setAutoPlay(g.id,e),e&&(g.instanceCount||1!==g.readyState||(g.instanceCount++,me._wD(g.id+": Incremented instance count to "+g.instanceCount))))},this.getAutoPlay=function(){return g._iO.autoPlay},this.setPosition=function(e){e===t&&(e=0);var i,n,r=g.isHTML5?Math.max(e,0):Math.min(g.duration||g._iO.duration,Math.max(e,0));if(g.position=r,n=g.position/ot,g._resetOnPosition(g.position),g._iO.position=r,g.isHTML5){if(g._a){if(g._html5_canplay){if(g._a.currentTime!==n){me._wD(g.id+": setPosition("+n+")");try{g._a.currentTime=n,(0===g.playState||g.paused)&&g._a.pause()}catch(o){me._wD(g.id+": setPosition("+n+") failed: "+o.message,2)}}}else if(n)return me._wD(g.id+": setPosition("+n+"): Cannot seek yet, sound not ready",2),g;g.paused&&g._onTimer(!0)}}else i=9===c?g.position:n,g.readyState&&2!==g.readyState&&ve._setPosition(g.id,i,g.paused||!g.playState,g._iO.multiShot);return g},this.pause=function(e){return g.paused||0===g.playState&&1!==g.readyState?g:(me._wD(g.id+": pause()"),g.paused=!0,g.isHTML5?(g._setup_html5().pause(),o()):(e||e===t)&&ve._pause(g.id,g._iO.multiShot),g._iO.onpause&&g._iO.onpause.apply(g),g)},this.resume=function(){var e=g._iO;return g.paused?(me._wD(g.id+": resume()"),g.paused=!1,g.playState=1,g.isHTML5?(g._setup_html5().play(),a()):(e.isMovieStar&&!e.serverURL&&g.setPosition(g.position),ve._pause(g.id,e.multiShot)),!v&&e.onplay?(e.onplay.apply(g),v=!0):e.onresume&&e.onresume.apply(g),g):g},this.togglePause=function(){return me._wD(g.id+": togglePause()"),0===g.playState?(g.play({position:9!==c||g.isHTML5?g.position/ot:g.position}),g):(g.paused?g.resume():g.pause(),g)},this.setPan=function(e,i){return e===t&&(e=0),i===t&&(i=!1),g.isHTML5||ve._setPan(g.id,e),g._iO.pan=e,i||(g.pan=e,g.options.pan=e),g},this.setVolume=function(e,i){return e===t&&(e=100),i===t&&(i=!1),g.isHTML5?g._a&&(g._a.volume=Math.max(0,Math.min(1,e/100))):ve._setVolume(g.id,me.muted&&!g.muted||g.muted?0:e),g._iO.volume=e,i||(g.volume=e,g.options.volume=e),g},this.mute=function(){return g.muted=!0,g.isHTML5?g._a&&(g._a.muted=!0):ve._setVolume(g.id,0),g},this.unmute=function(){g.muted=!1;var e=g._iO.volume!==t;return g.isHTML5?g._a&&(g._a.muted=!1):ve._setVolume(g.id,e?g._iO.volume:g.options.volume),g},this.toggleMute=function(){return g.muted?g.unmute():g.mute()},this.onPosition=function(e,i,n){return y.push({position:parseInt(e,10),method:i,scope:n!==t?n:g,fired:!1}),g},this.onposition=this.onPosition,this.clearOnPosition=function(e,t){var i;if(e=parseInt(e,10),isNaN(e))return!1;for(i=0;i<y.length;i++)e===y[i].position&&(t&&t!==y[i].method||(y[i].fired&&x--,y.splice(i,1)))},this._processOnPosition=function(){var e,t,i=y.length;if(!i||!g.playState||x>=i)return!1;for(e=i-1;e>=0;e--)t=y[e],!t.fired&&g.position>=t.position&&(t.fired=!0,x++,t.method.apply(t.scope,[t.position]));return!0},this._resetOnPosition=function(e){var t,i,n=y.length;if(!n)return!1;for(t=n-1;t>=0;t--)i=y[t],i.fired&&e<=i.position&&(i.fired=!1,x--);return!0},u=function(){var e,t,i=g._iO,n=i.from,r=i.to;return t=function(){me._wD(g.id+': "To" time of '+r+" reached."),g.clearOnPosition(r,t),g.stop()},e=function(){me._wD(g.id+': Playing "from" '+n),null===r||isNaN(r)||g.onPosition(r,t)},null===n||isNaN(n)||(i.position=n,i.multiShot=!1,e()),i},s=function(){var e,t=g._iO.onposition;if(t)for(e in t)t.hasOwnProperty(e)&&g.onPosition(parseInt(e,10),t[e])},l=function(){var e,t=g._iO.onposition;if(t)for(e in t)t.hasOwnProperty(e)&&g.clearOnPosition(parseInt(e,10))},a=function(){g.isHTML5&&q(g)},o=function(){g.isHTML5&&Y(g)},i=function(e){e||(y=[],x=0),v=!1,g._hasTimer=null,g._a=null,g._html5_canplay=!1,g.bytesLoaded=null,g.bytesTotal=null,g.duration=g._iO&&g._iO.duration?g._iO.duration:null,g.durationEstimate=null,g.buffered=[],g.eqData=[],g.eqData.left=[],g.eqData.right=[],g.failures=0,g.isBuffering=!1,g.instanceOptions={},g.instanceCount=0,g.loaded=!1,g.metadata={},g.readyState=0,g.muted=!1,g.paused=!1,g.peakData={left:0,right:0},g.waveformData={left:[],right:[]},g.playState=0,g.position=null,g.id3={}},i(),this._onTimer=function(e){var t,i,n=!1,r={};return g._hasTimer||e?(g._a&&(e||(g.playState>0||1===g.readyState)&&!g.paused)&&(t=g._get_html5_duration(),t!==h.duration&&(h.duration=t,g.duration=t,n=!0),g.durationEstimate=g.duration,i=g._a.currentTime*ot||0,i!==h.time&&(h.time=i,n=!0),(n||e)&&g._whileplaying(i,r,r,r,r)),n):void 0},this._get_html5_duration=function(){var e=g._iO,t=g._a&&g._a.duration?g._a.duration*ot:e&&e.duration?e.duration:null,i=t&&!isNaN(t)&&t!==1/0?t:null;return i},this._apply_loop=function(e,t){!e.loop&&t>1&&me._wD("Note: Native HTML5 looping is infinite.",1),e.loop=t>1?"loop":""},this._setup_html5=function(e){var t,r=m(g._iO,e),o=He?ge:g._a,a=decodeURI(r.url);if(He?a===decodeURI(se)&&(t=!0):a===decodeURI(b)&&(t=!0),o){if(o._s)if(He)o._s&&o._s.playState&&!t&&o._s.stop();else if(!He&&a===decodeURI(b))return g._apply_loop(o,r.loops),o;t||(i(!1),o.src=r.url,g.url=r.url,b=r.url,se=r.url,o._called_load=!1)}else r.autoLoad||r.autoPlay?g._a=new Audio(r.url):g._a=Ke&&opera.version()<10?new Audio(null):new Audio,o=g._a,o._called_load=!1,He&&(ge=o);return g.isHTML5=!0,g._a=o,o._s=g,n(),g._apply_loop(o,r.loops),r.autoLoad||r.autoPlay?g.load():(o.autobuffer=!1,o.preload="auto"),o},n=function(){function e(e,t,i){return g._a?g._a.addEventListener(e,t,i||!1):null}if(g._a._added_events)return!1;var t;g._a._added_events=!0;for(t in ce)ce.hasOwnProperty(t)&&e(t,ce[t]);return!0},r=function(){function e(e,t,i){return g._a?g._a.removeEventListener(e,t,i||!1):null}var t;me._wD(g.id+": Removing event listeners"),g._a._added_events=!1;for(t in ce)ce.hasOwnProperty(t)&&e(t,ce[t])},this._onload=function(e){var t,i=!!e||!g.isHTML5&&8===c&&g.duration;return t=g.id+": ",me._wD(t+(i?"onload()":"Failed to load / invalid sound?"+(g.duration?" -":" Zero-length duration reported.")+" ("+g.url+")"),i?1:2),i||g.isHTML5||(me.sandbox.noRemote===!0&&me._wD(t+V("noNet"),1),me.sandbox.noLocal===!0&&me._wD(t+V("noLocal"),1)),g.loaded=i,g.readyState=i?3:2,g._onbufferchange(0),g._iO.onload&&pe(g,function(){g._iO.onload.apply(g,[i])}),!0},this._onbufferchange=function(e){return 0===g.playState?!1:e&&g.isBuffering||!e&&!g.isBuffering?!1:(g.isBuffering=1===e,g._iO.onbufferchange&&(me._wD(g.id+": Buffer state change: "+e),g._iO.onbufferchange.apply(g)),!0)},this._onsuspend=function(){return g._iO.onsuspend&&(me._wD(g.id+": Playback suspended"),g._iO.onsuspend.apply(g)),!0},this._onfailure=function(e,t,i){g.failures++,me._wD(g.id+": Failures = "+g.failures),g._iO.onfailure&&1===g.failures?g._iO.onfailure(g,e,t,i):me._wD(g.id+": Ignoring failure")},this._onfinish=function(){var e=g._iO.onfinish;g._onbufferchange(0),g._resetOnPosition(0),g.instanceCount&&(g.instanceCount--,g.instanceCount||(l(),g.playState=0,g.paused=!1,g.instanceCount=0,g.instanceOptions={},g._iO={},o(),g.isHTML5&&(g.position=0)),(!g.instanceCount||g._iO.multiShotEvents)&&e&&(me._wD(g.id+": onfinish()"),pe(g,function(){e.apply(g)})))},this._whileloading=function(e,t,i,n){var r=g._iO;g.bytesLoaded=e,g.bytesTotal=t,g.duration=Math.floor(i),g.bufferLength=n,g.isHTML5||r.isMovieStar?g.durationEstimate=g.duration:r.duration?g.durationEstimate=g.duration>r.duration?g.duration:r.duration:g.durationEstimate=parseInt(g.bytesTotal/g.bytesLoaded*g.duration,10),g.isHTML5||(g.buffered=[{start:0,end:g.duration}]),(3!==g.readyState||g.isHTML5)&&r.whileloading&&r.whileloading.apply(g)},this._whileplaying=function(e,i,n,r,o){var a,s=g._iO;return isNaN(e)||null===e?!1:(g.position=Math.max(0,e),g._processOnPosition(),!g.isHTML5&&c>8&&(s.usePeakData&&i!==t&&i&&(g.peakData={left:i.leftPeak,right:i.rightPeak}),s.useWaveformData&&n!==t&&n&&(g.waveformData={left:n.split(","),right:r.split(",")}),s.useEQData&&o!==t&&o&&o.leftEQ&&(a=o.leftEQ.split(","),g.eqData=a,g.eqData.left=a,o.rightEQ!==t&&o.rightEQ&&(g.eqData.right=o.rightEQ.split(",")))),1===g.playState&&(g.isHTML5||8!==c||g.position||!g.isBuffering||g._onbufferchange(0),s.whileplaying&&s.whileplaying.apply(g)),!0)},this._oncaptiondata=function(e){
me._wD(g.id+": Caption data received."),g.captiondata=e,g._iO.oncaptiondata&&g._iO.oncaptiondata.apply(g,[e])},this._onmetadata=function(e,t){me._wD(g.id+": Metadata received.");var i,n,r={};for(i=0,n=e.length;n>i;i++)r[e[i]]=t[i];g.metadata=r,g._iO.onmetadata&&g._iO.onmetadata.apply(g)},this._onid3=function(e,t){me._wD(g.id+": ID3 data received.");var i,n,r=[];for(i=0,n=e.length;n>i;i++)r[e[i]]=t[i];g.id3=m(g.id3,r),g._iO.onid3&&g._iO.onid3.apply(g)},this._onconnect=function(e){e=1===e,me._wD(g.id+": "+(e?"Connected.":"Failed to connect? - "+g.url),e?1:2),g.connected=e,e&&(g.failures=0,X(g.id)&&(g.getAutoPlay()?g.play(t,g.getAutoPlay()):g._iO.autoLoad&&g.load()),g._iO.onconnect&&g._iO.onconnect.apply(g,[e]))},this._ondataerror=function(e){g.playState>0&&(me._wD(g.id+": Data error: "+e),g._iO.ondataerror&&g._iO.ondataerror.apply(g))},this._debug()},D=function(){return Me.body||Me._docElement||Me.getElementsByTagName("div")[0]},s=function(e){return Me.getElementById(e)},m=function(e,i){var n,r,o=e||{};n=i===t?me.defaultOptions:i;for(r in n)n.hasOwnProperty(r)&&o[r]===t&&("object"!=typeof n[r]||null===n[r]?o[r]=n[r]:o[r]=m(o[r],n[r]));return o},pe=function(t,i){t.isHTML5||8!==c?i():e.setTimeout(i,0)},v={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1},g=function(e,i){var n,r=!0,o=i!==t,a=me.setupOptions,s=v;if(e===t){r=[];for(n in a)a.hasOwnProperty(n)&&r.push(n);for(n in s)s.hasOwnProperty(n)&&("object"==typeof me[n]?r.push(n+": {...}"):me[n]instanceof Function?r.push(n+": function() {...}"):r.push(n));return me._wD(V("setup",r.join(", "))),!1}for(n in e)if(e.hasOwnProperty(n))if("object"!=typeof e[n]||null===e[n]||e[n]instanceof Array||e[n]instanceof RegExp)o&&s[i]!==t?me[i][n]=e[n]:a[n]!==t?(me.setupOptions[n]=e[n],me[n]=e[n]):s[n]===t?(G(V(me[n]===t?"setupUndef":"setupError",n),2),r=!1):me[n]instanceof Function?me[n].apply(me,e[n]instanceof Array?e[n]:[e[n]]):me[n]=e[n];else{if(s[n]!==t)return g(e[n],n);G(V(me[n]===t?"setupUndef":"setupError",n),2),r=!1}return r},ae=function(){function t(e){var t=$e.call(e),i=t.length;return o?(t[1]="on"+t[1],i>3&&t.pop()):3===i&&t.push(!1),t}function i(e,t){var i=e.shift(),n=[a[t]];o?i[n](e[0],e[1]):i[n].apply(i,e)}function n(){i(t(arguments),"add")}function r(){i(t(arguments),"remove")}var o=e.attachEvent,a={add:o?"attachEvent":"addEventListener",remove:o?"detachEvent":"removeEventListener"};return{add:n,remove:r}}(),ce={abort:o(function(){me._wD(this._s.id+": abort")}),canplay:o(function(){var e,i=this._s;if(i._html5_canplay)return!0;if(i._html5_canplay=!0,me._wD(i.id+": canplay"),i._onbufferchange(0),e=i._iO.position===t||isNaN(i._iO.position)?null:i._iO.position/ot,i.position&&this.currentTime!==e){me._wD(i.id+": canplay: Setting position to "+e);try{this.currentTime=e}catch(n){me._wD(i.id+": canplay: Setting position of "+e+" failed: "+n.message,2)}}i._iO._oncanplay&&i._iO._oncanplay()}),canplaythrough:o(function(){var e=this._s;e.loaded||(e._onbufferchange(0),e._whileloading(e.bytesLoaded,e.bytesTotal,e._get_html5_duration()),e._onload(!0))}),ended:o(function(){var e=this._s;me._wD(e.id+": ended"),e._onfinish()}),error:o(function(){me._wD(this._s.id+": HTML5 error, code "+this.error.code),this._s._onload(!1)}),loadeddata:o(function(){var e=this._s;me._wD(e.id+": loadeddata"),e._loaded||Ye||(e.duration=e._get_html5_duration())}),loadedmetadata:o(function(){me._wD(this._s.id+": loadedmetadata")}),loadstart:o(function(){me._wD(this._s.id+": loadstart"),this._s._onbufferchange(1)}),play:o(function(){this._s._onbufferchange(0)}),playing:o(function(){me._wD(this._s.id+": playing"),this._s._onbufferchange(0)}),progress:o(function(e){var t,i,n,r=this._s,o=0,a="progress"===e.type,s=e.target.buffered,l=e.loaded||0,u=e.total||1;if(r.buffered=[],s&&s.length){for(t=0,i=s.length;i>t;t++)r.buffered.push({start:s.start(t)*ot,end:s.end(t)*ot});if(o=(s.end(0)-s.start(0))*ot,l=Math.min(1,o/(e.target.duration*ot)),a&&s.length>1){for(n=[],i=s.length,t=0;i>t;t++)n.push(e.target.buffered.start(t)*ot+"-"+e.target.buffered.end(t)*ot);me._wD(this._s.id+": progress, timeRanges: "+n.join(", "))}a&&!isNaN(l)&&me._wD(this._s.id+": progress, "+Math.floor(100*l)+"% loaded")}isNaN(l)||(r._onbufferchange(0),r._whileloading(l,u,r._get_html5_duration()),l&&u&&l===u&&ce.canplaythrough.call(this,e))}),ratechange:o(function(){me._wD(this._s.id+": ratechange")}),suspend:o(function(e){var t=this._s;me._wD(this._s.id+": suspend"),ce.progress.call(this,e),t._onsuspend()}),stalled:o(function(){me._wD(this._s.id+": stalled")}),timeupdate:o(function(){this._s._onTimer()}),waiting:o(function(){var e=this._s;me._wD(this._s.id+": waiting"),e._onbufferchange(1)})},ee=function(e){var t;return t=e&&(e.type||e.url||e.serverURL)?e.serverURL||e.type&&r(e.type)?!1:e.type?te({type:e.type}):te({url:e.url})||me.html5Only||e.url.match(/data\:/i):!1},ne=function(e){var t;return e&&(t=Ye&&!We?null:Ze?at:null,e.src=t,void 0!==e._called_unload&&(e._called_load=!1)),He&&(se=null),t},te=function(e){if(!me.useHTML5Audio||!me.hasHTML5)return!1;var i,n,o,a,s=e.url||null,l=e.type||null,u=me.audioFormats;if(l&&me.html5[l]!==t)return me.html5[l]&&!r(l);if(!ie){ie=[];for(a in u)u.hasOwnProperty(a)&&(ie.push(a),u[a].related&&(ie=ie.concat(u[a].related)));ie=new RegExp("\\.("+ie.join("|")+")(\\?.*)?$","i")}return o=s?s.toLowerCase().match(ie):null,o&&o.length?o=o[1]:l?(n=l.indexOf(";"),o=(-1!==n?l.substr(0,n):l).substr(6)):i=!1,o&&me.html5[o]!==t?i=me.html5[o]&&!r(o):(l="audio/"+o,i=me.html5.canPlayType({type:l}),me.html5[o]=i,i=i&&me.html5[l]&&!r(l)),i},oe=function(){function e(e){var t,i,n,r=!1,o=!1;if(!a||"function"!=typeof a.canPlayType)return r;if(e instanceof Array){for(i=0,n=e.length;n>i;i++)(me.html5[e[i]]||a.canPlayType(e[i]).match(me.html5Test))&&(o=!0,me.html5[e[i]]=!0,me.flash[e[i]]=!!e[i].match(rt));r=o}else t=a&&"function"==typeof a.canPlayType?a.canPlayType(e):!1,r=!(!t||!t.match(me.html5Test));return r}if(!me.useHTML5Audio||!me.hasHTML5)return me.html5.usingFlash=!0,ze=!0,!1;var i,n,r,o,a=Audio!==t?Ke&&opera.version()<10?new Audio(null):new Audio:null,s={};r=me.audioFormats;for(i in r)if(r.hasOwnProperty(i)&&(n="audio/"+i,s[i]=e(r[i].type),s[n]=s[i],i.match(rt)?(me.flash[i]=!0,me.flash[n]=!0):(me.flash[i]=!1,me.flash[n]=!1),r[i]&&r[i].related))for(o=r[i].related.length-1;o>=0;o--)s["audio/"+r[i].related[o]]=s[i],me.html5[r[i].related[o]]=s[i],me.flash[r[i].related[o]]=s[i];return s.canPlayType=a?e:null,me.html5=m(me.html5,s),me.html5.usingFlash=J(),ze=me.html5.usingFlash,!0},C={notReady:"Unavailable - wait until onready() has fired.",notOK:"Audio support is not available.",domError:ye+"exception caught while appending SWF to DOM.",spcWmode:"Removing wmode, preventing known SWF loading issue(s)",swf404:xe+"Verify that %s is a valid path.",tryDebug:"Try "+ye+".debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:xe+"Non-HTTP page ("+Me.location.protocol+" URL?) Review Flash player security settings for this special case:\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:xe+"Special case: Waiting for SWF to load with window focus...",waitForever:xe+"Waiting indefinitely for Flash (will recover if unblocked)...",waitSWF:xe+"Waiting for 100% SWF load...",needFunction:xe+"Function object expected for %s",badID:'Sound ID "%s" should be a string, starting with a non-numeric character',currentObj:xe+"_debug(): Current sound objects",waitOnload:xe+"Waiting for window.onload()",docLoaded:xe+"Document already loaded",onload:xe+"initComplete(): calling soundManager.onload()",onloadOK:ye+".onload() complete",didInit:xe+"init(): Already called?",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:xe+"Failed to remove Flash node.",shutdown:ye+".disable(): Shutting down",queue:xe+"Queueing %s handler",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+$.swfTimedout+" CSS...",fbLoaded:"Flash loaded",fbHandler:xe+"flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:ye+".load(): current URL already assigned.",badFV:ye+'.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",needFlash:xe+"Fatal error: Flash is needed to play some required formats, but is not available.",gotFocus:xe+"Got window focus.",policy:"Enabling usePolicyFile for data access",setup:ye+".setup(): allowed parameters: %s",setupError:ye+'.setup(): "%s" cannot be assigned with this method.',setupUndef:ye+'.setup(): Could not find option "%s"',setupLate:ye+".setup(): url, flashVersion and html5Test property changes will not take effect until reboot().",noURL:xe+"Flash URL required. Call soundManager.setup({url:...}) to get started.",sm2Loaded:"SoundManager 2: Ready.",reset:ye+".reset(): Removing event callbacks",mobileUA:"Mobile UA detected, preferring HTML5 by default.",globalHTML5:"Using singleton HTML5 Audio() pattern for this device."},V=function(){var e,t,i=$e.call(arguments),n=i.shift(),r=C&&C[n]?C[n]:"";if(r&&i&&i.length)for(e=0,t=i.length;t>e;e++)r=r.replace("%s",i[e]);return r},j=function(e){return 8===c&&e.loops>1&&e.stream&&(d("as2loop"),e.stream=!1),e},W=function(e,t){return e&&!e.usePolicyFile&&(e.onid3||e.usePeakData||e.useWaveformData||e.useEQData)&&(me._wD((t||"")+V("policy")),e.usePolicyFile=!0),e},G=function(e){et&&console.warn!==t?console.warn(e):me._wD(e)},l=function(){return!1},I=function(e){var t;for(t in e)e.hasOwnProperty(t)&&"function"==typeof e[t]&&(e[t]=l);t=null},k=function(e){e===t&&(e=!1),(Pe||e)&&me.disable(e)},B=function(e){var t,i=null;if(e)if(e.match(/\.swf(\?.*)?$/i)){if(i=e.substr(e.toLowerCase().lastIndexOf(".swf?")+4))return e}else e.lastIndexOf("/")!==e.length-1&&(e+="/");return t=(e&&-1!==e.lastIndexOf("/")?e.substr(0,e.lastIndexOf("/")+1):"./")+me.movieURL,me.noSWFCache&&(t+="?ts="+(new Date).getTime()),t},M=function(){c=parseInt(me.flashVersion,10),8!==c&&9!==c&&(me._wD(V("badFV",c,Re)),me.flashVersion=c=Re);var e=me.debugMode||me.debugFlash?"_debug.swf":".swf";me.useHTML5Audio&&!me.html5Only&&me.audioFormats.mp4.required&&9>c&&(me._wD(V("needfl9")),me.flashVersion=c=9),me.version=me.versionNumber+(me.html5Only?" (HTML5-only mode)":9===c?" (AS3/Flash 9)":" (AS2/Flash 8)"),c>8?(me.defaultOptions=m(me.defaultOptions,me.flash9Options),me.features.buffering=!0,me.defaultOptions=m(me.defaultOptions,me.movieStarOptions),me.filePatterns.flash9=new RegExp("\\.(mp3|"+ht.join("|")+")(\\?.*)?$","i"),me.features.movieStar=!0):me.features.movieStar=!1,me.filePattern=me.filePatterns[8!==c?"flash9":"flash8"],me.movieURL=(8===c?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",e),me.features.peakData=me.features.waveformData=me.features.eqData=c>8},O=function(e,t){return ve?void ve._setPolling(e,t):!1},F=function(){if(me.debugURLParam.test(_e)&&(me.debugMode=!0),s(me.debugID))return!1;var e,t,i,n,r;if(!(!me.debugMode||s(me.debugID)||et&&me.useConsole&&me.consoleOnly)){e=Me.createElement("div"),e.id=me.debugID+"-toggle",n={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001},e.appendChild(Me.createTextNode("-")),e.onclick=H,e.title="Toggle SM2 debug console",we.match(/msie 6/i)&&(e.style.position="absolute",e.style.cursor="hand");for(r in n)n.hasOwnProperty(r)&&(e.style[r]=n[r]);if(t=Me.createElement("div"),t.id=me.debugID,t.style.display=me.debugMode?"block":"none",me.debugMode&&!s(e.id)){try{i=D(),i.appendChild(e)}catch(o){throw new Error(V("domError")+" \n"+o.toString())}i.appendChild(t)}}i=null},X=this.getSoundById,d=function(e,t){return e?me._wD(V(e),t):""},H=function(){var e=s(me.debugID),t=s(me.debugID+"-toggle");return e?(Ce?(t.innerHTML="+",e.style.display="none"):(t.innerHTML="-",e.style.display="block"),void(Ce=!Ce)):!1},f=function(i,n,r){if(e.sm2Debugger!==t)try{sm2Debugger.handleEvent(i,n,r)}catch(o){return!1}return!0},z=function(){var e=[];return me.debugMode&&e.push($.sm2Debug),me.debugFlash&&e.push($.flashDebug),me.useHighPerformance&&e.push($.highPerf),e.join(" ")},U=function(){var e=V("fbHandler"),t=me.getMoviePercent(),i=$,n={type:"FLASHBLOCK"};return me.html5Only?!1:void(me.ok()?(me.didFlashBlock&&me._wD(e+": Unblocked"),me.oMC&&(me.oMC.className=[z(),i.swfDefault,i.swfLoaded+(me.didFlashBlock?" "+i.swfUnblocked:"")].join(" "))):(ze&&(me.oMC.className=z()+" "+i.swfDefault+" "+(null===t?i.swfTimedout:i.swfError),me._wD(e+": "+V("fbTimeout")+(t?" ("+V("fbLoaded")+")":""))),me.didFlashBlock=!0,x({type:"ontimeout",ignoreInit:!0,error:n}),R(n)))},y=function(e,i,n){Se[e]===t&&(Se[e]=[]),Se[e].push({method:i,scope:n||null,fired:!1})},x=function(e){if(e||(e={type:me.ok()?"onready":"ontimeout"}),!Ae&&e&&!e.ignoreInit)return!1;if("ontimeout"===e.type&&(me.ok()||Pe&&!e.ignoreInit))return!1;var t,i,n={success:e&&e.ignoreInit?me.ok():!Pe},r=e&&e.type?Se[e.type]||[]:[],o=[],a=[n],s=ze&&!me.ok();for(e.error&&(a[0].error=e.error),t=0,i=r.length;i>t;t++)r[t].fired!==!0&&o.push(r[t]);if(o.length)for(t=0,i=o.length;i>t;t++)o[t].scope?o[t].method.apply(o[t].scope,a):o[t].method.apply(this,a),s||(o[t].fired=!0);return!0},b=function(){e.setTimeout(function(){me.useFlashBlock&&U(),x(),"function"==typeof me.onload&&(d("onload",1),me.onload.apply(e),d("onloadOK",1)),me.waitForWindowLoad&&ae.add(e,"load",b)},1)},ue=function(){if(le!==t)return le;var i,n,r,o=!1,a=navigator,s=a.plugins,l=e.ActiveXObject;if(s&&s.length)n="application/x-shockwave-flash",r=a.mimeTypes,r&&r[n]&&r[n].enabledPlugin&&r[n].enabledPlugin.description&&(o=!0);else if(l!==t&&!we.match(/MSAppHost/i)){try{i=new l("ShockwaveFlash.ShockwaveFlash")}catch(u){i=null}o=!!i,i=null}return le=o,o},J=function(){var e,t,i=me.audioFormats,n=We&&!!we.match(/os (1|2|3_0|3_1)/i);if(n?(me.hasHTML5=!1,me.html5Only=!0,me.oMC&&(me.oMC.style.display="none")):me.useHTML5Audio&&(me.html5&&me.html5.canPlayType||(me._wD("SoundManager: No HTML5 Audio() support detected."),me.hasHTML5=!1),Je&&me._wD(xe+"Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(le?"will use flash fallback for MP3/MP4, if available":" would use flash fallback for MP3/MP4, but none detected."),1)),me.useHTML5Audio&&me.hasHTML5){Q=!0;for(t in i)i.hasOwnProperty(t)&&i[t].required&&(me.html5.canPlayType(i[t].type)?me.preferFlash&&(me.flash[t]||me.flash[i[t].type])&&(e=!0):(Q=!1,e=!0))}return me.ignoreFlash&&(e=!1,Q=!0),me.html5Only=me.hasHTML5&&me.useHTML5Audio&&!e,!me.html5Only},Z=function(e){var t,i,n,r=0;if(e instanceof Array){for(t=0,i=e.length;i>t;t++)if(e[t]instanceof Object){if(me.canPlayMIME(e[t].type)){r=t;break}}else if(me.canPlayURL(e[t])){r=t;break}e[r].url&&(e[r]=e[r].url),n=e[r]}else n=e;return n},q=function(e){e._hasTimer||(e._hasTimer=!0,!Qe&&me.html5PollingInterval&&(null===Ve&&0===Be&&(Ve=setInterval(K,me.html5PollingInterval)),Be++))},Y=function(e){e._hasTimer&&(e._hasTimer=!1,!Qe&&me.html5PollingInterval&&Be--)},K=function(){var e;if(null!==Ve&&!Be)return clearInterval(Ve),Ve=null,!1;for(e=me.soundIDs.length-1;e>=0;e--)me.sounds[me.soundIDs[e]].isHTML5&&me.sounds[me.soundIDs[e]]._hasTimer&&me.sounds[me.soundIDs[e]]._onTimer()},R=function(i){i=i!==t?i:{},"function"==typeof me.onerror&&me.onerror.apply(e,[{type:i.type!==t?i.type:null}]),i.fatal!==t&&i.fatal&&me.disable()},he=function(){if(!Je||!ue())return!1;var e,t,i=me.audioFormats;for(t in i)if(i.hasOwnProperty(t)&&("mp3"===t||"mp4"===t)&&(me._wD(ye+": Using flash fallback for "+t+" format"),me.html5[t]=!1,i[t]&&i[t].related))for(e=i[t].related.length-1;e>=0;e--)me.html5[i[t].related[e]]=!1},this._setSandboxType=function(e){var i=me.sandbox;i.type=e,i.description=i.types[i.types[e]!==t?e:"unknown"],"localWithFile"===i.type?(i.noRemote=!0,i.noLocal=!1,d("secNote",2)):"localWithNetwork"===i.type?(i.noRemote=!1,i.noLocal=!0):"localTrusted"===i.type&&(i.noRemote=!1,i.noLocal=!1)},this._externalInterfaceOK=function(e){if(me.swfLoaded)return!1;var t;return f("swf",!0),f("flashtojs",!0),me.swfLoaded=!0,it=!1,Je&&he(),e&&e.replace(/\+dev/i,"")===me.versionNumber.replace(/\+dev/i,"")?void setTimeout(h,Xe?100:1):(t=ye+': Fatal: JavaScript file build "'+me.versionNumber+'" does not match Flash SWF build "'+e+'" at '+me.url+". Ensure both are up-to-date.",setTimeout(function(){throw new Error(t)},0),!1)},N=function(e,i){function n(){var e,t=[],i=[],n=" + ";e="SoundManager "+me.version+(!me.html5Only&&me.useHTML5Audio?me.hasHTML5?" + HTML5 audio":", no HTML5 audio support":""),me.html5Only?me.html5PollingInterval&&t.push("html5PollingInterval ("+me.html5PollingInterval+"ms)"):(me.preferFlash&&t.push("preferFlash"),me.useHighPerformance&&t.push("useHighPerformance"),me.flashPollingInterval&&t.push("flashPollingInterval ("+me.flashPollingInterval+"ms)"),me.html5PollingInterval&&t.push("html5PollingInterval ("+me.html5PollingInterval+"ms)"),me.wmode&&t.push("wmode ("+me.wmode+")"),me.debugFlash&&t.push("debugFlash"),me.useFlashBlock&&t.push("flashBlock")),t.length&&(i=i.concat([t.join(n)])),me._wD(e+(i.length?n+i.join(", "):""),1),fe()}function r(e,t){return'<param name="'+e+'" value="'+t+'" />'}if(Te&&Ee)return!1;if(me.html5Only)return M(),n(),me.oMC=s(me.movieID),h(),Te=!0,Ee=!0,!1;var o,a,l,u,c,f,d,p,m=i||me.url,g=me.altURL||m,v="JS/Flash audio component (SoundManager 2)",y=D(),x=z(),b=null,w=Me.getElementsByTagName("html")[0];if(b=w&&w.dir&&w.dir.match(/rtl/i),e=e===t?me.id:e,M(),me.url=B(st?m:g),i=me.url,me.wmode=!me.wmode&&me.useHighPerformance?"transparent":me.wmode,null!==me.wmode&&(we.match(/msie 8/i)||!Xe&&!me.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(Ue.push(C.spcWmode),me.wmode=null),o={name:e,id:e,src:i,quality:"high",allowScriptAccess:me.allowScriptAccess,bgcolor:me.bgColor,pluginspage:lt+"www.macromedia.com/go/getflashplayer",title:v,type:"application/x-shockwave-flash",wmode:me.wmode,hasPriority:"true"},me.debugFlash&&(o.FlashVars="debug=1"),me.wmode||delete o.wmode,Xe)a=Me.createElement("div"),u=['<object id="'+e+'" data="'+i+'" type="'+o.type+'" title="'+o.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+lt+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',r("movie",i),r("AllowScriptAccess",me.allowScriptAccess),r("quality",o.quality),me.wmode?r("wmode",me.wmode):"",r("bgcolor",me.bgColor),r("hasPriority","true"),me.debugFlash?r("FlashVars",o.FlashVars):"","</object>"].join("");else{a=Me.createElement("embed");for(l in o)o.hasOwnProperty(l)&&a.setAttribute(l,o[l])}if(F(),x=z(),y=D())if(me.oMC=s(me.movieID)||Me.createElement("div"),me.oMC.id)p=me.oMC.className,me.oMC.className=(p?p+" ":$.swfDefault)+(x?" "+x:""),me.oMC.appendChild(a),Xe&&(c=me.oMC.appendChild(Me.createElement("div")),c.className=$.swfBox,c.innerHTML=u),Ee=!0;else{if(me.oMC.id=me.movieID,me.oMC.className=$.swfDefault+" "+x,f=null,c=null,me.useFlashBlock||(me.useHighPerformance?f={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(f={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},b&&(f.left=Math.abs(parseInt(f.left,10))+"px"))),qe&&(me.oMC.style.zIndex=1e4),!me.debugFlash)for(d in f)f.hasOwnProperty(d)&&(me.oMC.style[d]=f[d]);try{Xe||me.oMC.appendChild(a),y.appendChild(me.oMC),Xe&&(c=me.oMC.appendChild(Me.createElement("div")),c.className=$.swfBox,c.innerHTML=u),Ee=!0}catch(_){throw new Error(V("domError")+" \n"+_.toString())}}return Te=!0,n(),!0},T=function(){return me.html5Only?(N(),!1):ve?!1:me.url?(ve=me.getMovie(me.id),ve||(Oe?(Xe?me.oMC.innerHTML=Fe:me.oMC.appendChild(Oe),Oe=null,Te=!0):N(me.id,me.url),ve=me.getMovie(me.id)),"function"==typeof me.oninitmovie&&setTimeout(me.oninitmovie,1),de(),!0):(d("noURL"),!1)},w=function(){setTimeout(_,1e3)},_=function(){var t,i=!1;return me.url?Ie?!1:(Ie=!0,ae.remove(e,"load",w),it&&!tt?(d("waitFocus"),!1):(Ae||(t=me.getMoviePercent(),t>0&&100>t&&(i=!0)),void setTimeout(function(){return t=me.getMoviePercent(),i?(Ie=!1,me._wD(V("waitSWF")),e.setTimeout(w,1),!1):(Ae||(me._wD(ye+": No Flash response within expected time. Likely causes: "+(0===t?"SWF load failed, ":"")+"Flash blocked or JS-Flash security error."+(me.debugFlash?" "+V("checkSWF"):""),2),!st&&t&&(d("localFail",2),me.debugFlash||d("tryDebug",2)),0===t&&me._wD(V("swf404",me.url),1),f("flashtojs",!1," (Check flash security or flash blockers)")),void(!Ae&&nt&&(null===t?me.useFlashBlock||0===me.flashLoadTimeout?(me.useFlashBlock&&U(),d("waitForever")):!me.useFlashBlock&&Q?e.setTimeout(function(){G(xe+"useFlashBlock is false, 100% HTML5 mode is possible. Rebooting with preferFlash: false..."),me.setup({preferFlash:!1}).reboot(),me.didFlashBlock=!0,me.beginDelayedInit()},1):(d("waitForever"),x({type:"ontimeout",ignoreInit:!0})):0===me.flashLoadTimeout?d("waitForever"):k(!0))))},me.flashLoadTimeout))):!1},S=function(){function t(){ae.remove(e,"focus",S)}return tt||!it?(t(),!0):(nt=!0,tt=!0,d("gotFocus"),Ie=!1,w(),t(),!0)},de=function(){Ue.length&&(me._wD("SoundManager 2: "+Ue.join(" "),1),Ue=[])},fe=function(){de();var e,t=[];if(me.useHTML5Audio&&me.hasHTML5){for(e in me.audioFormats)me.audioFormats.hasOwnProperty(e)&&t.push(e+" = "+me.html5[e]+(!me.html5[e]&&ze&&me.flash[e]?" (using flash)":me.preferFlash&&me.flash[e]&&ze?" (preferring flash)":me.html5[e]?"":" ("+(me.audioFormats[e].required?"required, ":"")+"and no flash support)"));me._wD("SoundManager 2 HTML5 support: "+t.join(", "),1)}},p=function(t){if(Ae)return!1;if(me.html5Only)return d("sm2Loaded"),Ae=!0,b(),f("onload",!0),!0;var i,n=me.useFlashBlock&&me.flashLoadTimeout&&!me.getMoviePercent(),r=!0;return n||(Ae=!0,Pe&&(i={type:!le&&ze?"NO_FLASH":"INIT_TIMEOUT"})),me._wD("SoundManager 2 "+(Pe?"failed to load":"loaded")+" ("+(Pe?"Flash security/load error":"OK")+")",Pe?2:1),Pe||t?(me.useFlashBlock&&me.oMC&&(me.oMC.className=z()+" "+(null===me.getMoviePercent()?$.swfTimedout:$.swfError)),x({type:"ontimeout",error:i,ignoreInit:!0}),f("onload",!1),R(i),r=!1):f("onload",!0),Pe||(me.waitForWindowLoad&&!Le?(d("waitOnload"),ae.add(e,"load",b)):(me.waitForWindowLoad&&Le&&d("docLoaded"),b())),r},u=function(){var e,i=me.setupOptions;for(e in i)i.hasOwnProperty(e)&&(me[e]===t?me[e]=i[e]:me[e]!==i[e]&&(me.setupOptions[e]=me[e]))},h=function(){function t(){ae.remove(e,"load",me.beginDelayedInit)}if(Ae)return d("didInit"),!1;if(me.html5Only)return Ae||(t(),me.enabled=!0,p()),!0;T();try{ve._externalInterfaceTest(!1),O(!0,me.flashPollingInterval||(me.useHighPerformance?10:50)),me.debugMode||ve._disableDebug(),me.enabled=!0,f("jstoflash",!0),me.html5Only||ae.add(e,"unload",l)}catch(i){return me._wD("js/flash exception: "+i.toString()),f("jstoflash",!1),R({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),k(!0),p(),!1}return p(),t(),!0},A=function(){return L?!1:(L=!0,u(),F(),function(){var e="sm2-usehtml5audio=",t="sm2-preferflash=",i=null,n=null,r=_e.toLowerCase();-1!==r.indexOf(e)&&(i="1"===r.charAt(r.indexOf(e)+e.length),et&&console.log((i?"Enabling ":"Disabling ")+"useHTML5Audio via URL parameter"),me.setup({useHTML5Audio:i})),-1!==r.indexOf(t)&&(n="1"===r.charAt(r.indexOf(t)+t.length),et&&console.log((n?"Enabling ":"Disabling ")+"preferFlash via URL parameter"),me.setup({preferFlash:n}))}(),!le&&me.hasHTML5&&(me._wD("SoundManager: No Flash detected"+(me.useHTML5Audio?". Trying HTML5-only mode.":", enabling HTML5."),1),me.setup({useHTML5Audio:!0,preferFlash:!1})),oe(),!le&&ze&&(Ue.push(C.needFlash),me.setup({flashLoadTimeout:1})),Me.removeEventListener&&Me.removeEventListener("DOMContentLoaded",A,!1),T(),!0)},re=function(){return"complete"===Me.readyState&&(A(),Me.detachEvent("onreadystatechange",re)),!0},P=function(){Le=!0,ae.remove(e,"load",P)},E=function(){Qe&&((!me.setupOptions.useHTML5Audio||me.setupOptions.preferFlash)&&Ue.push(C.mobileUA),me.setupOptions.useHTML5Audio=!0,me.setupOptions.preferFlash=!1,(We||Ge&&!we.match(/android\s2\.3/i))&&(Ue.push(C.globalHTML5),We&&(me.ignoreFlash=!0),He=!0))},E(),ue(),ae.add(e,"focus",S),ae.add(e,"load",w),ae.add(e,"load",P),Me.addEventListener?Me.addEventListener("DOMContentLoaded",A,!1):Me.attachEvent?Me.attachEvent("onreadystatechange",re):(f("onload",!1),R({type:"NO_DOM2_EVENTS",fatal:!0}))}var n=null;void 0!==e.SM2_DEFER&&SM2_DEFER||(n=new i),e.SoundManager=i,e.soundManager=n}(window),a("sound",function(){}),function(e,t,i){"use strict";function n(){var t=e.angular;return e.angular=ni,t}function r(e){return e&&"number"==typeof e.length?"function"!=typeof e.hasOwnProperty&&"function"!=typeof e.constructor?!0:e instanceof ae||Kt&&e instanceof Kt||"[object Object]"!==ii.call(e)||"function"==typeof e.callee:!1}function o(e,t,i){var n;if(e)if(S(e))for(n in e)"prototype"!=n&&"length"!=n&&"name"!=n&&e.hasOwnProperty(n)&&t.call(i,e[n],n);else if(e.forEach&&e.forEach!==o)e.forEach(t,i);else if(r(e))for(n=0;n<e.length;n++)t.call(i,e[n],n);else for(n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n);return e}function a(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t.sort()}function s(e,t,i){for(var n=a(e),r=0;r<n.length;r++)t.call(i,e[n[r]],n[r]);return n}function l(e){return function(t,i){e(i,t)}}function u(){for(var e,t=oi.length;t;){if(t--,e=oi[t].charCodeAt(0),57==e)return oi[t]="A",oi.join("");if(90!=e)return oi[t]=String.fromCharCode(e+1),oi.join("");oi[t]="0"}return oi.unshift("0"),oi.join("")}function h(e,t){t?e.$$hashKey=t:delete e.$$hashKey}function c(e){var t=e.$$hashKey;return o(arguments,function(t){t!==e&&o(t,function(t,i){e[i]=t})}),h(e,t),e}function f(e){return parseInt(e,10)}function d(e,t){return c(new(c(function(){},{prototype:e})),t)}function p(){}function m(e){return e}function g(e){return function(){return e}}function v(e){return"undefined"==typeof e}function y(e){return"undefined"!=typeof e}function x(e){return null!=e&&"object"==typeof e}function b(e){return"string"==typeof e}function w(e){return"number"==typeof e}function _(e){return"[object Date]"==ii.apply(e)}function M(e){return"[object Array]"==ii.apply(e)}function S(e){return"function"==typeof e}function C(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function T(e){return e&&e.$evalAsync&&e.$watch}function E(e){return"[object File]"===ii.apply(e)}function A(e){return b(e)?e.replace(/^\s*/,"").replace(/\s*$/,""):e}function P(e){return e&&(e.nodeName||e.bind&&e.find)}function L(e,t,i){var n=[];return o(e,function(e,r,o){n.push(t.call(i,e,r,o))}),n}function D(e,t){return-1!=N(e,t)}function N(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;i++)if(t===e[i])return i;return-1}function R(e,t){var i=N(e,t);return i>=0&&e.splice(i,1),t}function O(e,t){if(C(e)||T(e))throw Error("Can't copy Window or Scope");if(t){if(e===t)throw Error("Can't copy equivalent objects or arrays");if(M(e)){t.length=0;for(var i=0;i<e.length;i++)t.push(O(e[i]))}else{var n=t.$$hashKey;o(t,function(e,i){delete t[i]});for(var r in e)t[r]=O(e[r]);h(t,n)}}else t=e,e&&(M(e)?t=O(e,[]):_(e)?t=new Date(e.getTime()):x(e)&&(t=O(e,{})));return t}function F(e,t){t=t||{};for(var i in e)e.hasOwnProperty(i)&&"$$"!==i.substr(0,2)&&(t[i]=e[i]);return t}function I(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!==e&&t!==t)return!0;var n,r,o,a=typeof e,s=typeof t;if(a==s&&"object"==a){if(!M(e)){if(_(e))return _(t)&&e.getTime()==t.getTime();if(T(e)||T(t)||C(e)||C(t))return!1;o={};for(r in e)if("$"!==r.charAt(0)&&!S(e[r])){if(!I(e[r],t[r]))return!1;o[r]=!0}for(r in t)if(!o[r]&&"$"!==r.charAt(0)&&t[r]!==i&&!S(t[r]))return!1;return!0}if((n=e.length)==t.length){for(r=0;n>r;r++)if(!I(e[r],t[r]))return!1;return!0}}return!1}function k(e,t,i){return e.concat(ei.call(t,i))}function B(e,t){return ei.call(e,t||0)}function V(e,t){var i=arguments.length>2?B(arguments,2):[];return!S(t)||t instanceof RegExp?t:i.length?function(){return arguments.length?t.apply(e,i.concat(ei.call(arguments,0))):t.apply(e,i)}:function(){return arguments.length?t.apply(e,arguments):t.call(e)}}function U(e,n){var r=n;return/^\$+/.test(e)?r=i:C(n)?r="$WINDOW":n&&t===n?r="$DOCUMENT":T(n)&&(r="$SCOPE"),r}function z(e,t){return JSON.stringify(e,U,t?"  ":null)}function $(e){return b(e)?JSON.parse(e):e}function H(e){if(e&&0!==e.length){var t=Wt(""+e);e=!("f"==t||"0"==t||"false"==t||"no"==t||"n"==t||"[]"==t)}else e=!1;return e}function j(e){e=Yt(e).clone();try{e.html("")}catch(t){}var i=3,n=Yt("<div>").append(e).html();try{return e[0].nodeType===i?Wt(n):n.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(e,t){return"<"+Wt(t)})}catch(t){return Wt(n)}}function W(e){var t,i,n={};return o((e||"").split("&"),function(e){e&&(t=e.split("="),i=decodeURIComponent(t[0]),n[i]=y(t[1])?decodeURIComponent(t[1]):!0)}),n}function G(e){var t=[];return o(e,function(e,i){t.push(q(i,!0)+(e===!0?"":"="+q(e,!0)))}),t.length?t.join("&"):""}function X(e){return q(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function q(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function Y(e,i){function n(e){e&&s.push(e)}var r,a,s=[e],l=["ng:app","ng-app","x-ng-app","data-ng-app"],u=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;o(l,function(i){l[i]=!0,n(t.getElementById(i)),i=i.replace(":","\\:"),e.querySelectorAll&&(o(e.querySelectorAll("."+i),n),o(e.querySelectorAll("."+i+"\\:"),n),o(e.querySelectorAll("["+i+"]"),n))}),o(s,function(e){if(!r){var t=" "+e.className+" ",i=u.exec(t);i?(r=e,a=(i[2]||"").replace(/\s+/g,",")):o(e.attributes,function(t){!r&&l[t.name]&&(r=e,a=t.value)})}}),r&&i(r,a?[a]:[])}function K(t,i){var n=function(){t=Yt(t),i=i||[],i.unshift(["$provide",function(e){e.value("$rootElement",t)}]),i.unshift("ng");var e=Se(i);return e.invoke(["$rootScope","$rootElement","$compile","$injector","$animator",function(e,t,i,n,r){e.$apply(function(){t.data("$injector",n),i(t)(e)}),r.enabled(!0)}]),e},r=/^NG_DEFER_BOOTSTRAP!/;return e&&!r.test(e.name)?n():(e.name=e.name.replace(r,""),void(ri.resumeBootstrap=function(e){o(e,function(e){i.push(e)}),n()}))}function Z(e,t){return t=t||"_",e.replace(ai,function(e,i){return(i?t:"")+e.toLowerCase()})}function Q(){Kt=e.jQuery,Kt?(Yt=Kt,c(Kt.fn,{scope:mi.scope,controller:mi.controller,injector:mi.injector,inheritedData:mi.inheritedData}),oe("remove",!0),oe("empty"),oe("html")):Yt=ae,ri.element=Yt}function J(e,t,i){if(!e)throw new Error("Argument '"+(t||"?")+"' is "+(i||"required"));return e}function ee(e,t,i){return i&&M(e)&&(e=e[e.length-1]),J(S(e),t,"not a function, got "+(e&&"object"==typeof e?e.constructor.name||"Object":typeof e)),e}function te(e){function t(e,t,i){return e[t]||(e[t]=i())}return t(t(e,"angular",Object),"module",function(){var e={};return function(i,n,r){return n&&e.hasOwnProperty(i)&&(e[i]=null),t(e,i,function(){function e(e,i,n){return function(){return t[n||"push"]([e,i,arguments]),s}}if(!n)throw Error("No module: "+i);var t=[],o=[],a=e("$injector","invoke"),s={_invokeQueue:t,_runBlocks:o,requires:n,name:i,provider:e("$provide","provider"),factory:e("$provide","factory"),service:e("$provide","service"),value:e("$provide","value"),constant:e("$provide","constant","unshift"),animation:e("$animationProvider","register"),filter:e("$filterProvider","register"),controller:e("$controllerProvider","register"),directive:e("$compileProvider","directive"),config:a,run:function(e){return o.push(e),this}};return r&&a(r),s})}})}function ie(t){c(t,{bootstrap:K,copy:O,extend:c,
equals:I,element:Yt,forEach:o,injector:Se,noop:p,bind:V,toJson:z,fromJson:$,identity:m,isUndefined:v,isDefined:y,isString:b,isFunction:S,isObject:x,isNumber:w,isElement:P,isArray:M,version:si,isDate:_,lowercase:Wt,uppercase:Gt,callbacks:{counter:0},noConflict:n}),Zt=te(e);try{Zt("ngLocale")}catch(i){Zt("ngLocale",[]).provider("$locale",xt)}Zt("ng",["ngLocale"],["$provide",function(e){e.provider("$compile",De).directive({a:Vi,input:Yi,textarea:Yi,form:Hi,script:Rn,select:Fn,style:kn,option:In,ngBind:ln,ngBindHtmlUnsafe:hn,ngBindTemplate:un,ngClass:cn,ngClassEven:dn,ngClassOdd:fn,ngCsp:gn,ngCloak:pn,ngController:mn,ngForm:ji,ngHide:Tn,ngIf:xn,ngInclude:bn,ngInit:wn,ngNonBindable:_n,ngPluralize:Mn,ngRepeat:Sn,ngShow:Cn,ngSubmit:yn,ngStyle:En,ngSwitch:An,ngSwitchWhen:Pn,ngSwitchDefault:Ln,ngOptions:On,ngView:Nn,ngTransclude:Dn,ngModel:tn,ngList:on,ngChange:nn,required:rn,ngRequired:rn,ngValue:sn}).directive(Ui).directive(vn),e.provider({$anchorScroll:Ce,$animation:Te,$animator:_i,$browser:Ae,$cacheFactory:Pe,$controller:Re,$document:Oe,$exceptionHandler:Fe,$filter:wt,$interpolate:Ie,$http:gt,$httpBackend:vt,$location:Ye,$log:Ke,$parse:nt,$route:at,$routeParams:st,$rootScope:lt,$q:rt,$sniffer:ut,$templateCache:Le,$timeout:bt,$window:ht})}])}function ne(){return++hi}function re(e){return e.replace(di,function(e,t,i,n){return n?i.toUpperCase():i}).replace(pi,"Moz$1")}function oe(e,t){function i(){for(var e,i,r,o,a,s,l,u=[this],h=t;u.length;)for(e=u.shift(),i=0,r=e.length;r>i;i++)for(o=Yt(e[i]),h?o.triggerHandler("$destroy"):h=!h,a=0,s=(l=o.children()).length;s>a;a++)u.push(Kt(l[a]));return n.apply(this,arguments)}var n=Kt.fn[e];n=n.$original||n,i.$original=n,Kt.fn[e]=i}function ae(e){if(e instanceof ae)return e;if(!(this instanceof ae)){if(b(e)&&"<"!=e.charAt(0))throw Error("selectors not implemented");return new ae(e)}if(b(e)){var i=t.createElement("div");i.innerHTML="<div>&#160;</div>"+e,i.removeChild(i.firstChild),ge(this,i.childNodes),this.remove()}else ge(this,e)}function se(e){return e.cloneNode(!0)}function le(e){he(e);for(var t=0,i=e.childNodes||[];t<i.length;t++)le(i[t])}function ue(e,t,i){var n=ce(e,"events"),r=ce(e,"handle");r&&(v(t)?o(n,function(t,i){fi(e,i,t),delete n[i]}):v(i)?(fi(e,t,n[t]),delete n[t]):R(n[t],i))}function he(e){var t=e[ui],n=li[t];n&&(n.handle&&(n.events.$destroy&&n.handle({},"$destroy"),ue(e)),delete li[t],e[ui]=i)}function ce(e,t,i){var n=e[ui],r=li[n||-1];return y(i)?(r||(e[ui]=n=ne(),r=li[n]={}),void(r[t]=i)):r&&r[t]}function fe(e,t,i){var n=ce(e,"data"),r=y(i),o=!r&&y(t),a=o&&!x(t);if(n||a||ce(e,"data",n={}),r)n[t]=i;else{if(!o)return n;if(a)return n&&n[t];c(n,t)}}function de(e,t){return(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1}function pe(e,t){t&&o(t.split(" "),function(t){e.className=A((" "+e.className+" ").replace(/[\n\t]/g," ").replace(" "+A(t)+" "," "))})}function me(e,t){t&&o(t.split(" "),function(t){de(e,t)||(e.className=A(e.className+" "+A(t)))})}function ge(e,t){if(t){t=t.nodeName||!y(t.length)||C(t)?[t]:t;for(var i=0;i<t.length;i++)e.push(t[i])}}function ve(e,t){return ye(e,"$"+(t||"ngController")+"Controller")}function ye(e,t,i){for(e=Yt(e),9==e[0].nodeType&&(e=e.find("html"));e.length;){if(i=e.data(t))return i;e=e.parent()}}function xe(e,t){var i=gi[t.toLowerCase()];return i&&vi[e.nodeName]&&i}function be(e,i){var n=function(n,r){if(n.preventDefault||(n.preventDefault=function(){n.returnValue=!1}),n.stopPropagation||(n.stopPropagation=function(){n.cancelBubble=!0}),n.target||(n.target=n.srcElement||t),v(n.defaultPrevented)){var a=n.preventDefault;n.preventDefault=function(){n.defaultPrevented=!0,a.call(n)},n.defaultPrevented=!1}n.isDefaultPrevented=function(){return n.defaultPrevented||0==n.returnValue},o(i[r||n.type],function(t){t.call(e,n)}),8>=Jt?(n.preventDefault=null,n.stopPropagation=null,n.isDefaultPrevented=null):(delete n.preventDefault,delete n.stopPropagation,delete n.isDefaultPrevented)};return n.elem=e,n}function we(e){var t,n=typeof e;return"object"==n&&null!==e?"function"==typeof(t=e.$$hashKey)?t=e.$$hashKey():t===i&&(t=e.$$hashKey=u()):t=e,n+":"+t}function _e(e){o(e,this.put,this)}function Me(e){var t,i,n,r;return"function"==typeof e?(t=e.$inject)||(t=[],i=e.toString().replace(wi,""),n=i.match(yi),o(n[1].split(xi),function(e){e.replace(bi,function(e,i,n){t.push(n)})}),e.$inject=t):M(e)?(r=e.length-1,ee(e[r],"fn"),t=e.slice(0,r)):ee(e,"fn",!0),t}function Se(e){function t(e){return function(t,i){return x(t)?void o(t,l(e)):e(t,i)}}function i(e,t){if((S(t)||M(t))&&(t=w.instantiate(t)),!t.$get)throw Error("Provider "+e+" must define $get factory method.");return y[e+d]=t}function n(e,t){return i(e,{$get:t})}function r(e,t){return n(e,["$injector",function(e){return e.instantiate(t)}])}function a(e,t){return n(e,g(t))}function s(e,t){y[e]=t,_[e]=t}function u(e,t){var i=w.get(e+d),n=i.$get;i.$get=function(){var e=C.invoke(n,i);return C.invoke(t,null,{$delegate:e})}}function h(e){var t=[];return o(e,function(e){if(!v.get(e))if(v.put(e,!0),b(e)){var i=Zt(e);t=t.concat(h(i.requires)).concat(i._runBlocks);try{for(var n=i._invokeQueue,r=0,o=n.length;o>r;r++){var a=n[r],s=w.get(a[0]);s[a[1]].apply(s,a[2])}}catch(l){throw l.message&&(l.message+=" from "+e),l}}else if(S(e))try{t.push(w.invoke(e))}catch(l){throw l.message&&(l.message+=" from "+e),l}else if(M(e))try{t.push(w.invoke(e))}catch(l){throw l.message&&(l.message+=" from "+String(e[e.length-1])),l}else ee(e,"module")}),t}function c(e,t){function i(i){if("string"!=typeof i)throw Error("Service name expected");if(e.hasOwnProperty(i)){if(e[i]===f)throw Error("Circular dependency: "+m.join(" <- "));return e[i]}try{return m.unshift(i),e[i]=f,e[i]=t(i)}finally{m.shift()}}function n(e,t,n){var r,o,a,s=[],l=Me(e);for(o=0,r=l.length;r>o;o++)a=l[o],s.push(n&&n.hasOwnProperty(a)?n[a]:i(a));switch(e.$inject||(e=e[r]),t?-1:s.length){case 0:return e();case 1:return e(s[0]);case 2:return e(s[0],s[1]);case 3:return e(s[0],s[1],s[2]);case 4:return e(s[0],s[1],s[2],s[3]);case 5:return e(s[0],s[1],s[2],s[3],s[4]);case 6:return e(s[0],s[1],s[2],s[3],s[4],s[5]);case 7:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6]);case 8:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);case 9:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8]);case 10:return e(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9]);default:return e.apply(t,s)}}function r(e,t){var i,r,o=function(){};return o.prototype=(M(e)?e[e.length-1]:e).prototype,i=new o,r=n(e,i,t),x(r)?r:i}return{invoke:n,instantiate:r,get:i,annotate:Me,has:function(t){return y.hasOwnProperty(t+d)||e.hasOwnProperty(t)}}}var f={},d="Provider",m=[],v=new _e,y={$provide:{provider:t(i),factory:t(n),service:t(r),value:t(a),constant:t(s),decorator:u}},w=y.$injector=c(y,function(){throw Error("Unknown provider: "+m.join(" <- "))}),_={},C=_.$injector=c(_,function(e){var t=w.get(e+d);return C.invoke(t.$get,t)});return o(h(e),function(e){C.invoke(e||p)}),C}function Ce(){var e=!0;this.disableAutoScrolling=function(){e=!1},this.$get=["$window","$location","$rootScope",function(t,i,n){function r(e){var t=null;return o(e,function(e){t||"a"!==Wt(e.nodeName)||(t=e)}),t}function a(){var e,n=i.hash();n?(e=s.getElementById(n))?e.scrollIntoView():(e=r(s.getElementsByName(n)))?e.scrollIntoView():"top"===n&&t.scrollTo(0,0):t.scrollTo(0,0)}var s=t.document;return e&&n.$watch(function(){return i.hash()},function(){n.$evalAsync(a)}),a}]}function Te(e){var t="Animation";this.register=function(i,n){e.factory(re(i)+t,n)},this.$get=["$injector",function(e){return function(i){if(i){var n=re(i)+t;if(e.has(n))return e.get(n)}}}]}function Ee(e,t,n,r){function a(e){try{e.apply(null,B(arguments,1))}finally{if(y--,0===y)for(;x.length;)try{x.pop()()}catch(t){n.error(t)}}}function s(e,t){!function i(){o(_,function(e){e()}),w=t(i,e)}()}function l(){M!=u.url()&&(M=u.url(),o(C,function(e){e(u.url())}))}var u=this,h=t[0],c=e.location,f=e.history,d=e.setTimeout,m=e.clearTimeout,g={};u.isMock=!1;var y=0,x=[];u.$$completeOutstandingRequest=a,u.$$incOutstandingRequestCount=function(){y++},u.notifyWhenNoOutstandingRequests=function(e){o(_,function(e){e()}),0===y?e():x.push(e)};var w,_=[];u.addPollFn=function(e){return v(w)&&s(100,d),_.push(e),e};var M=c.href,S=t.find("base");u.url=function(e,t){if(e){if(M==e)return;return M=e,r.history?t?f.replaceState(null,"",e):(f.pushState(null,"",e),S.attr("href",S.attr("href"))):t?c.replace(e):c.href=e,u}return c.href.replace(/%27/g,"'")};var C=[],T=!1;u.onUrlChange=function(t){return T||(r.history&&Yt(e).bind("popstate",l),r.hashchange?Yt(e).bind("hashchange",l):u.addPollFn(l),T=!0),C.push(t),t},u.baseHref=function(){var e=S.attr("href");return e?e.replace(/^https?\:\/\/[^\/]*/,""):""};var E={},A="",P=u.baseHref();u.cookies=function(e,t){var r,o,a,s,l;if(!e){if(h.cookie!==A)for(A=h.cookie,o=A.split("; "),E={},s=0;s<o.length;s++)if(a=o[s],l=a.indexOf("="),l>0){var e=unescape(a.substring(0,l));E[e]===i&&(E[e]=unescape(a.substring(l+1)))}return E}t===i?h.cookie=escape(e)+"=;path="+P+";expires=Thu, 01 Jan 1970 00:00:00 GMT":b(t)&&(r=(h.cookie=escape(e)+"="+escape(t)+";path="+P).length+1,r>4096&&n.warn("Cookie '"+e+"' possibly not set or overflowed because it was too large ("+r+" > 4096 bytes)!"))},u.defer=function(e,t){var i;return y++,i=d(function(){delete g[i],a(e)},t||0),g[i]=!0,i},u.defer.cancel=function(e){return g[e]?(delete g[e],m(e),a(p),!0):!1}}function Ae(){this.$get=["$window","$log","$sniffer","$document",function(e,t,i,n){return new Ee(e,n,t,i)}]}function Pe(){this.$get=function(){function e(e,i){function n(e){e!=h&&(f?f==e&&(f=e.n):f=e,r(e.n,e.p),r(e,h),h=e,h.n=null)}function r(e,t){e!=t&&(e&&(e.p=t),t&&(t.n=e))}if(e in t)throw Error("cacheId "+e+" taken");var o=0,a=c({},i,{id:e}),s={},l=i&&i.capacity||Number.MAX_VALUE,u={},h=null,f=null;return t[e]={put:function(e,t){var i=u[e]||(u[e]={key:e});return n(i),v(t)?void 0:(e in s||o++,s[e]=t,o>l&&this.remove(f.key),t)},get:function(e){var t=u[e];if(t)return n(t),s[e]},remove:function(e){var t=u[e];t&&(t==h&&(h=t.p),t==f&&(f=t.n),r(t.n,t.p),delete u[e],delete s[e],o--)},removeAll:function(){s={},o=0,u={},h=f=null},destroy:function(){s=null,a=null,u=null,delete t[e]},info:function(){return c({},a,{size:o})}}}var t={};return e.info=function(){var e={};return o(t,function(t,i){e[i]=t.info()}),e},e.get=function(e){return t[e]},e}}function Le(){this.$get=["$cacheFactory",function(e){return e("templates")}]}function De(e){var n={},r="Directive",a=/^\s*directive\:\s*([\d\w\-_]+)\s+(.*)$/,s=/(([\d\w\-_]+)(?:\:([^;]+))?;?)/,u="Template must have exactly one root element. was: ",h=/^\s*(https?|ftp|mailto|file):/;this.directive=function f(t,i){return b(t)?(J(i,"directive"),n.hasOwnProperty(t)||(n[t]=[],e.factory(t+r,["$injector","$exceptionHandler",function(e,i){var r=[];return o(n[t],function(n){try{var o=e.invoke(n);S(o)?o={compile:g(o)}:!o.compile&&o.link&&(o.compile=g(o.link)),o.priority=o.priority||0,o.name=o.name||t,o.require=o.require||o.controller&&o.name,o.restrict=o.restrict||"A",r.push(o)}catch(a){i(a)}}),r}])),n[t].push(i)):o(t,l(f)),this},this.urlSanitizationWhitelist=function(e){return y(e)?(h=e,this):h},this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document",function(e,l,f,d,p,v,y,w,_){function C(e,t,i){e instanceof Yt||(e=Yt(e)),o(e,function(t,i){3==t.nodeType&&t.nodeValue.match(/\S+/)&&(e[i]=Yt(t).wrap("<span></span>").parent()[0])});var n=E(e,t,e,i);return function(t,i){J(t,"scope");for(var r=i?mi.clone.call(e):e,o=0,a=r.length;a>o;o++){var s=r[o];(1==s.nodeType||9==s.nodeType)&&r.eq(o).data("$scope",t)}return T(r,"ng-scope"),i&&i(r,t),n&&n(t,r,r),r}}function T(e,t){try{e.addClass(t)}catch(i){}}function E(e,t,n,r){function o(e,n,r,o){var a,s,l,u,h,f,d,p,m=[];for(f=0,d=n.length;d>f;f++)m.push(n[f]);for(f=0,p=0,d=c.length;d>f;p++)l=m[p],a=c[f++],s=c[f++],a?(a.scope?(u=e.$new(x(a.scope)),Yt(l).data("$scope",u)):u=e,h=a.transclude,h||!o&&t?a(s,u,l,r,function(t){return function(i){var n=e.$new();return n.$$transcluded=!0,t(n,i).bind("$destroy",V(n,n.$destroy))}}(h||t)):a(s,u,l,i,o)):s&&s(e,l.childNodes,i,o)}for(var a,s,l,u,h,c=[],f=0;f<e.length;f++)u=new z,l=P(e[f],[],u,r),a=l.length?L(l,e[f],u,t,n):null,s=a&&a.terminal||!e[f].childNodes||!e[f].childNodes.length?null:E(e[f].childNodes,a?a.transclude:t),c.push(a),c.push(s),h=h||a||s;return h?o:null}function P(e,t,i,n){var r,o,l=e.nodeType,u=i.$attr;switch(l){case 1:D(t,Ne(Qt(e).toLowerCase()),"E",n);for(var h,c,f,d,p,m=e.attributes,g=0,v=m&&m.length;v>g;g++)h=m[g],h.specified&&(c=h.name,d=Ne(c),X.test(d)&&(c=d.substr(6).toLowerCase()),f=Ne(c.toLowerCase()),u[f]=c,i[f]=p=A(Jt&&"href"==c?decodeURIComponent(e.getAttribute(c,2)):h.value),xe(e,f)&&(i[f]=!0),B(e,t,p,f),D(t,f,"A",n));if(o=e.className,b(o)&&""!==o)for(;r=s.exec(o);)f=Ne(r[2]),D(t,f,"C",n)&&(i[f]=A(r[3])),o=o.substr(r.index+r[0].length);break;case 3:k(t,e.nodeValue);break;case 8:try{r=a.exec(e.nodeValue),r&&(f=Ne(r[1]),D(t,f,"M",n)&&(i[f]=A(r[2])))}catch(y){}}return t.sort(O),t}function L(e,n,r,a,s){function h(e,t){e&&(e.require=p.require,O.push(e)),t&&(t.require=p.require,k.push(t))}function c(e,t){var i,n="data",r=!1;if(b(e)){for(;"^"==(i=e.charAt(0))||"?"==i;)e=e.substr(1),"^"==i&&(n="inheritedData"),r=r||"?"==i;if(i=t[n]("$"+e+"Controller"),!i&&!r)throw Error("No controller: "+e);return i}return M(e)&&(i=[],o(e,function(e){i.push(c(e,t))})),i}function d(e,t,a,s,u){var h,d,p,m,g,x;if(h=n===a?r:F(r,new z(Yt(a),r.$attr)),d=h.$$element,V){var b=/^\s*([@=&])(\??)\s*(\w*)\s*$/,w=t.$parent||t;o(V.scope,function(e,i){var n,r,o,a=e.match(b)||[],s=a[3]||i,u="?"==a[2],c=a[1];switch(t.$$isolateBindings[i]=c+s,c){case"@":h.$observe(s,function(e){t[i]=e}),h.$$observers[s].$$scope=w,h[s]&&(t[i]=l(h[s])(w));break;case"=":if(u&&!h[s])return;r=v(h[s]),o=r.assign||function(){throw n=t[i]=r(w),Error(Mi+h[s]+" (directive: "+V.name+")")},n=t[i]=r(w),t.$watch(function(){var e=r(w);return e!==t[i]&&(e!==n?n=t[i]=e:o(w,e=n=t[i])),e});break;case"&":r=v(h[s]),t[i]=function(e){return r(w,e)};break;default:throw Error("Invalid isolate scope definition for directive "+V.name+": "+e)}})}for(_&&o(_,function(e){var i={$scope:t,$element:d,$attrs:h,$transclude:u};x=e.controller,"@"==x&&(x=h[e.name]),d.data("$"+e.name+"Controller",y(x,i))}),p=0,m=O.length;m>p;p++)try{g=O[p],g(t,d,h,g.require&&c(g.require,d))}catch(M){f(M,j(d))}for(e&&e(t,a.childNodes,i,u),p=0,m=k.length;m>p;p++)try{g=k[p],g(t,d,h,g.require&&c(g.require,d))}catch(M){f(M,j(d))}}for(var p,m,g,w,_,E,L,D=-Number.MAX_VALUE,O=[],k=[],B=null,V=null,$=null,H=r.$$element=Yt(n),W=a,X=0,q=e.length;q>X&&(p=e[X],g=i,!(D>p.priority));X++){if((L=p.scope)&&(I("isolated scope",V,p,H),x(L)&&(T(H,"ng-isolate-scope"),V=p),T(H,"ng-scope"),B=B||p),m=p.name,(L=p.controller)&&(_=_||{},I("'"+m+"' controller",_[m],p,H),_[m]=p),(L=p.transclude)&&(I("transclusion",w,p,H),w=p,D=p.priority,"element"==L?(g=Yt(n),H=r.$$element=Yt(t.createComment(" "+m+": "+r[m]+" ")),n=H[0],U(s,Yt(g[0]),n),W=C(g,a,D)):(g=Yt(se(n)).contents(),H.html(""),W=C(g,a))),p.template)if(I("template",$,p,H),$=p,L=S(p.template)?p.template(H,r):p.template,L=G(L),p.replace){if(g=Yt("<div>"+A(L)+"</div>").contents(),n=g[0],1!=g.length||1!==n.nodeType)throw new Error(u+L);U(s,H,n);var Y={$attr:{}};e=e.concat(P(n,e.splice(X+1,e.length-(X+1)),Y)),N(r,Y),q=e.length}else H.html(L);if(p.templateUrl)I("template",$,p,H),$=p,d=R(e.splice(X,e.length-X),d,H,r,s,p.replace,W),q=e.length;else if(p.compile)try{E=p.compile(H,r,W),S(E)?h(null,E):E&&h(E.pre,E.post)}catch(K){f(K,j(H))}p.terminal&&(d.terminal=!0,D=Math.max(D,p.priority))}return d.scope=B&&B.scope,d.transclude=w&&W,d}function D(t,o,a,s){var l=!1;if(n.hasOwnProperty(o))for(var u,h=e.get(o+r),c=0,d=h.length;d>c;c++)try{u=h[c],(s===i||s>u.priority)&&-1!=u.restrict.indexOf(a)&&(t.push(u),l=!0)}catch(p){f(p)}return l}function N(e,t){var i=t.$attr,n=e.$attr,r=e.$$element;o(e,function(n,r){"$"!=r.charAt(0)&&(t[r]&&(n+=("style"===r?";":" ")+t[r]),e.$set(r,n,!0,i[r]))}),o(t,function(t,o){"class"==o?(T(r,t),e["class"]=(e["class"]?e["class"]+" ":"")+t):"style"==o?r.attr("style",r.attr("style")+";"+t):"$"==o.charAt(0)||e.hasOwnProperty(o)||(e[o]=t,n[o]=i[o])})}function R(e,t,i,n,r,o,a){var s,l,h=[],f=i[0],m=e.shift(),g=c({},m,{controller:null,templateUrl:null,transclude:null,scope:null}),v=S(m.templateUrl)?m.templateUrl(i,n):m.templateUrl;return i.html(""),d.get(v,{cache:p}).success(function(c){var d,p,m;if(c=G(c),o){if(m=Yt("<div>"+A(c)+"</div>").contents(),d=m[0],1!=m.length||1!==d.nodeType)throw new Error(u+c);p={$attr:{}},U(r,i,d),P(d,e,p),N(n,p)}else d=f,i.html(c);for(e.unshift(g),s=L(e,d,n,a),l=E(i[0].childNodes,a);h.length;){var v=h.shift(),y=h.shift(),x=h.shift(),b=h.shift(),w=d;y!==f&&(w=se(d),U(x,Yt(y),w)),s(function(){t(l,v,w,r,b)},v,w,r,b)}h=null}).error(function(e,t,i,n){throw Error("Failed to load template: "+n.url)}),function(e,i,n,r,o){h?(h.push(i),h.push(n),h.push(r),h.push(o)):s(function(){t(l,i,n,r,o)},i,n,r,o)}}function O(e,t){return t.priority-e.priority}function I(e,t,i,n){if(t)throw Error("Multiple directives ["+t.name+", "+i.name+"] asking for "+e+" on: "+j(n))}function k(e,t){var i=l(t,!0);i&&e.push({priority:0,compile:g(function(e,t){var n=t.parent(),r=n.data("$binding")||[];r.push(i),T(n.data("$binding",r),"ng-binding"),e.$watch(i,function(e){t[0].nodeValue=e})})})}function B(e,t,i,n){var r=l(i,!0);r&&t.push({priority:100,compile:g(function(e,t,i){var o=i.$$observers||(i.$$observers={});r=l(i[n],!0),r&&(i[n]=r(e),(o[n]||(o[n]=[])).$$inter=!0,(i.$$observers&&i.$$observers[n].$$scope||e).$watch(r,function(e){i.$set(n,e)}))})})}function U(e,t,i){var n,r,o=t[0],a=o.parentNode;if(e)for(n=0,r=e.length;r>n;n++)if(e[n]==o){e[n]=i;break}a&&a.replaceChild(i,o),i[Yt.expando]=o[Yt.expando],t[0]=i}var z=function(e,t){this.$$element=e,this.$attr=t||{}};z.prototype={$normalize:Ne,$set:function(e,t,n,r){var a,s=xe(this.$$element[0],e),l=this.$$observers;s&&(this.$$element.prop(e,t),r=s),this[e]=t,r?this.$attr[e]=r:(r=this.$attr[e],r||(this.$attr[e]=r=Z(e,"-"))),"A"===Qt(this.$$element[0])&&"href"===e&&($.setAttribute("href",t),a=$.href,a.match(h)||(this[e]=t="unsafe:"+a)),n!==!1&&(null===t||t===i?this.$$element.removeAttr(r):this.$$element.attr(r,t)),l&&o(l[e],function(e){try{e(t)}catch(i){f(i)}})},$observe:function(e,t){var i=this,n=i.$$observers||(i.$$observers={}),r=n[e]||(n[e]=[]);return r.push(t),w.$evalAsync(function(){r.$$inter||t(i[e])}),t}};var $=_[0].createElement("a"),H=l.startSymbol(),W=l.endSymbol(),G="{{"==H||"}}"==W?m:function(e){return e.replace(/\{\{/g,H).replace(/}}/g,W)},X=/^ngAttr[A-Z]/;return C}]}function Ne(e){return re(e.replace(Si,""))}function Re(){var e={},t=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(t,i){x(t)?c(e,t):e[t]=i},this.$get=["$injector","$window",function(i,n){return function(r,o){var a,s,l,u;if(b(r)&&(s=r.match(t),l=s[1],u=s[3],r=e.hasOwnProperty(l)?e[l]:et(o.$scope,l,!0)||et(n,l,!0),ee(r,l,!0)),a=i.instantiate(r,o),u){if("object"!=typeof o.$scope)throw new Error('Can not export controller as "'+u+'". No scope object provided!');o.$scope[u]=a}return a}}]}function Oe(){this.$get=["$window",function(e){return Yt(e.document)}]}function Fe(){this.$get=["$log",function(e){return function(t,i){e.error.apply(e,arguments)}}]}function Ie(){var e="{{",t="}}";this.startSymbol=function(t){return t?(e=t,this):e},this.endSymbol=function(e){return e?(t=e,this):t},this.$get=["$parse","$exceptionHandler",function(n,r){function o(o,l){for(var u,h,c,f,d=0,p=[],m=o.length,g=!1,v=[];m>d;)-1!=(u=o.indexOf(e,d))&&-1!=(h=o.indexOf(t,u+a))?(d!=u&&p.push(o.substring(d,u)),p.push(c=n(f=o.substring(u+a,h))),c.exp=f,d=h+s,g=!0):(d!=m&&p.push(o.substring(d)),d=m);return(m=p.length)||(p.push(""),m=1),!l||g?(v.length=m,c=function(e){try{for(var t,n=0,a=m;a>n;n++)"function"==typeof(t=p[n])&&(t=t(e),null==t||t==i?t="":"string"!=typeof t&&(t=z(t))),v[n]=t;return v.join("")}catch(s){var l=new Error("Error while interpolating: "+o+"\n"+s.toString());r(l)}},c.exp=o,c.parts=p,c):void 0}var a=e.length,s=t.length;return o.startSymbol=function(){return e},o.endSymbol=function(){return t},o}]}function ke(e){for(var t=e.split("/"),i=t.length;i--;)t[i]=X(t[i]);return t.join("/")}function Be(e,t){var i=Ci.exec(e);t.$$protocol=i[1],t.$$host=i[3],t.$$port=f(i[5])||Ei[i[1]]||null}function Ve(e,t){var i=Ti.exec(e);t.$$path=decodeURIComponent(i[1]),t.$$search=W(i[3]),t.$$hash=decodeURIComponent(i[5]||""),t.$$path&&"/"!=t.$$path.charAt(0)&&(t.$$path="/"+t.$$path)}function Ue(e,t,i){return 0==t.indexOf(e)?t.substr(e.length):i}function ze(e){var t=e.indexOf("#");return-1==t?e:e.substr(0,t)}function $e(e){return e.substr(0,ze(e).lastIndexOf("/")+1)}function He(e){return e.substring(0,e.indexOf("/",e.indexOf("//")+2))}function je(e,t){t=t||"";var n=$e(e);this.$$parse=function(e){var t={};Be(e,t);var i=Ue(n,e);if(!b(i))throw Error('Invalid url "'+e+'", missing path prefix "'+n+'".');Ve(i,t),c(this,t),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var e=G(this.$$search),t=this.$$hash?"#"+X(this.$$hash):"";this.$$url=ke(this.$$path)+(e?"?"+e:"")+t,this.$$absUrl=n+this.$$url.substr(1)},this.$$rewrite=function(r){var o,a;return(o=Ue(e,r))!==i?(a=o,(o=Ue(t,o))!==i?n+(Ue("/",o)||o):e+a):(o=Ue(n,r))!==i?n+o:n==r+"/"?n:void 0}}function We(e,t){var i=$e(e);this.$$parse=function(n){Be(n,this);var r=Ue(e,n)||Ue(i,n);if(!b(r))throw new Error('Invalid url "'+n+'", does not start with "'+e+'".');var o="#"==r.charAt(0)?Ue(t,r):r;if(!b(o))throw new Error('Invalid url "'+n+'", missing hash prefix "'+t+'".');Ve(o,this),this.$$compose()},this.$$compose=function(){var i=G(this.$$search),n=this.$$hash?"#"+X(this.$$hash):"";this.$$url=ke(this.$$path)+(i?"?"+i:"")+n,this.$$absUrl=e+(this.$$url?t+this.$$url:"")},this.$$rewrite=function(t){return ze(e)==ze(t)?t:void 0}}function Ge(e,t){We.apply(this,arguments);var i=$e(e);this.$$rewrite=function(n){var r;return e==ze(n)?n:(r=Ue(i,n))?e+t+r:i===n+"/"?i:void 0}}function Xe(e){return function(){return this[e]}}function qe(e,t){return function(i){return v(i)?this[e]:(this[e]=t(i),this.$$compose(),this)}}function Ye(){var t="",i=!1;this.hashPrefix=function(e){return y(e)?(t=e,this):t},this.html5Mode=function(e){return y(e)?(i=e,this):i},this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(n,r,o,a){function s(e){n.$broadcast("$locationChangeSuccess",l.absUrl(),e)}var l,u,h,c=r.baseHref(),f=r.url();i?(h=c?He(f)+c:f,u=o.history?je:Ge):(h=ze(f),u=We),l=new u(h,"#"+t),l.$$parse(l.$$rewrite(f)),a.bind("click",function(t){if(!t.ctrlKey&&!t.metaKey&&2!=t.which){for(var i=Yt(t.target);"a"!==Wt(i[0].nodeName);)if(i[0]===a[0]||!(i=i.parent())[0])return;var o=i.prop("href"),s=l.$$rewrite(o);o&&!i.attr("target")&&s&&!t.isDefaultPrevented()&&(t.preventDefault(),s!=r.url()&&(l.$$parse(s),n.$apply(),e.angular["ff-684208-preventDefault"]=!0))}}),l.absUrl()!=f&&r.url(l.absUrl(),!0),r.onUrlChange(function(e){if(l.absUrl()!=e){if(n.$broadcast("$locationChangeStart",e,l.absUrl()).defaultPrevented)return void r.url(l.absUrl());n.$evalAsync(function(){var t=l.absUrl();l.$$parse(e),s(t)}),n.$$phase||n.$digest()}});var d=0;return n.$watch(function(){var e=r.url(),t=l.$$replace;return d&&e==l.absUrl()||(d++,n.$evalAsync(function(){n.$broadcast("$locationChangeStart",l.absUrl(),e).defaultPrevented?l.$$parse(e):(r.url(l.absUrl(),t),s(e))})),l.$$replace=!1,d}),l}]}function Ke(){var e=!0,t=this;this.debugEnabled=function(t){return y(t)?(e=t,this):e},this.$get=["$window",function(i){function n(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function r(e){var t=i.console||{},r=t[e]||t.log||p;return r.apply?function(){var e=[];return o(arguments,function(t){e.push(n(t))}),r.apply(t,e)}:function(e,t){r(e,t)}}return{log:r("log"),warn:r("warn"),info:r("info"),error:r("error"),debug:function(){var i=r("debug");return function(){e&&i.apply(t,arguments)}}()}}]}function Ze(e,t){function i(e){return-1!=e.indexOf(m)}function n(e){return-1!=e.indexOf(b)}function r(t){var i=t||1;return v+i<e.length?e.charAt(v+i):!1}function o(e){return e>="0"&&"9">=e}function a(e){return" "==e||"\r"==e||"	"==e||"\n"==e||""==e||"Â "==e}function s(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e||"_"==e||"$"==e}function l(e){return"-"==e||"+"==e||o(e)}function u(t,i,n){throw n=n||v,Error("Lexer Error: "+t+" at column"+(y(i)?"s "+i+"-"+v+" ["+e.substring(i,n)+"]":" "+n)+" in expression ["+e+"].")}function h(){for(var t="",i=v;v<e.length;){var n=Wt(e.charAt(v));if("."==n||o(n))t+=n;else{var a=r();if("e"==n&&l(a))t+=n;else if(l(n)&&a&&o(a)&&"e"==t.charAt(t.length-1))t+=n;else{if(!l(n)||a&&o(a)||"e"!=t.charAt(t.length-1))break;u("Invalid exponent")}}v++}t=1*t,g.push({index:i,text:t,json:!0,fn:function(){return t}})}function f(){for(var i,n,r,l,u="",h=v;v<e.length&&(l=e.charAt(v),"."==l||s(l)||o(l));)"."==l&&(i=v),u+=l,v++;if(i)for(n=v;n<e.length;){if(l=e.charAt(n),"("==l){r=u.substr(i-h+1),u=u.substr(0,i-h),v=n;break}if(!a(l))break;n++}var f={index:h,text:u};if(Ai.hasOwnProperty(u))f.fn=f.json=Ai[u];else{var d=it(u,t);f.fn=c(function(e,t){return d(e,t)},{assign:function(e,t){return Je(e,u,t)}})}g.push(f),r&&(g.push({index:i,text:".",json:!1}),g.push({index:i+1,text:r,json:!1}))}function d(t){var i=v;v++;for(var n="",r=t,o=!1;v<e.length;){var a=e.charAt(v);if(r+=a,o){if("u"==a){var s=e.substring(v+1,v+5);s.match(/[\da-f]{4}/i)||u("Invalid unicode escape [\\u"+s+"]"),v+=4,n+=String.fromCharCode(parseInt(s,16))}else{var l=Pi[a];n+=l?l:a}o=!1}else if("\\"==a)o=!0;else{if(a==t)return v++,void g.push({index:i,text:r,string:n,json:!0,fn:function(){return n}});n+=a}v++}u("Unterminated quote",i)}for(var p,m,g=[],v=0,x=[],b=":";v<e.length;){if(m=e.charAt(v),i("\"'"))d(m);else if(o(m)||i(".")&&o(r()))h();else if(s(m))f(),n("{,")&&"{"==x[0]&&(p=g[g.length-1])&&(p.json=-1==p.text.indexOf("."));else if(i("(){}[].,;:?"))g.push({index:v,text:m,json:n(":[,")&&i("{[")||i("}]:,")}),i("{[")&&x.unshift(m),i("}]")&&x.shift(),v++;else{if(a(m)){v++;continue}var w=m+r(),_=w+r(2),M=Ai[m],S=Ai[w],C=Ai[_];C?(g.push({index:v,text:_,fn:C}),v+=3):S?(g.push({index:v,text:w,fn:S}),v+=2):M?(g.push({index:v,text:m,fn:M,json:n("[,:")&&i("+-")}),v+=1):u("Unexpected next character ",v,v+1)}b=m}return g}function Qe(e,t,n,r){function o(t,i){throw Error("Syntax Error: Token '"+i.text+"' "+t+" at column "+(i.index+1)+" of the expression ["+e+"] starting at ["+e.substring(i.index)+"].")}function a(){if(0===k.length)throw Error("Unexpected end of expression: "+e);return k[0]}function s(e,t,i,n){if(k.length>0){var r=k[0],o=r.text;if(o==e||o==t||o==i||o==n||!e&&!t&&!i&&!n)return r}return!1}function l(e,i,n,r){var a=s(e,i,n,r);return a?(t&&!a.json&&o("is not valid json",a),k.shift(),a):!1}function u(e){l(e)||o("is unexpected, expecting ["+e+"]",s())}function h(e,t){return c(function(i,n){return e(i,n,t)},{constant:t.constant})}function f(e,t,i){return c(function(n,r){return e(n,r)?t(n,r):i(n,r)},{constant:e.constant&&t.constant&&i.constant})}function d(e,t,i){return c(function(n,r){return t(n,r,e,i)},{constant:e.constant&&i.constant})}function m(){for(var e=[];;)if(k.length>0&&!s("}",")",";","]")&&e.push($()),!l(";"))return 1==e.length?e[0]:function(t,i){for(var n,r=0;r<e.length;r++){var o=e[r];o&&(n=o(t,i))}return n}}function v(){for(var e,t=x();;){if(!(e=l("|")))return t;t=d(t,e.fn,y())}}function y(){for(var e=l(),t=n(e.text),i=[];;){if(!(e=l(":"))){var r=function(e,n,r){for(var o=[r],a=0;a<i.length;a++)o.push(i[a](e,n));return t.apply(e,o)};return function(){return r}}i.push(x())}}function x(){return B()}function b(){var t,i,n=w();return(i=l("="))?(n.assign||o("implies assignment but ["+e.substring(0,i.index)+"] can not be assigned to",i),t=w(),function(e,i){return n.assign(e,t(e,i),i)}):n}function w(){var e,t,i=_();return(t=l("?"))?(e=w(),(t=l(":"))?f(i,e,w()):void o("expected :",t)):i}function _(){for(var e,t=M();;){if(!(e=l("||")))return t;t=d(t,e.fn,M())}}function M(){var e,t=S();return(e=l("&&"))&&(t=d(t,e.fn,M())),t}function S(){var e,t=C();return(e=l("==","!=","===","!=="))&&(t=d(t,e.fn,S())),t}function C(){var e,t=T();return(e=l("<",">","<=",">="))&&(t=d(t,e.fn,C())),t}function T(){for(var e,t=E();e=l("+","-");)t=d(t,e.fn,E());return t}function E(){for(var e,t=A();e=l("*","/","%");)t=d(t,e.fn,A());return t}function A(){var e;return l("+")?P():(e=l("-"))?d(I,e.fn,A()):(e=l("!"))?h(e.fn,A()):P()}function P(){var e;if(l("("))e=$(),u(")");else if(l("["))e=R();else if(l("{"))e=O();else{var t=l();e=t.fn,e||o("not a primary expression",t),t.json&&(e.constant=e.literal=!0)}for(var i,n;i=l("(","[",".");)"("===i.text?(e=V(e,n),n=null):"["===i.text?(n=e,e=z(e)):"."===i.text?(n=e,e=U(e)):o("IMPOSSIBLE");return e}function L(e){var t=l().text,i=it(t,r);return c(function(t,n,r){return i(r||e(t,n),n)},{assign:function(i,n,r){return Je(e(i,r),t,n)}})}function D(e){var t=x();return u("]"),c(function(n,r){var o,a,s=e(n,r),l=t(n,r);return s?(o=s[l],o&&o.then&&(a=o,"$$v"in o||(a.$$v=i,a.then(function(e){a.$$v=e})),o=o.$$v),o):i},{assign:function(i,n,r){return e(i,r)[t(i,r)]=n}})}function N(e,t){var i=[];if(")"!=a().text)do i.push(x());while(l(","));return u(")"),function(n,r){for(var o=[],a=t?t(n,r):n,s=0;s<i.length;s++)o.push(i[s](n,r));var l=e(n,r,a)||p;return l.apply?l.apply(a,o):l(o[0],o[1],o[2],o[3],o[4])}}function R(){var e=[],t=!0;if("]"!=a().text)do{var i=x();e.push(i),i.constant||(t=!1)}while(l(","));return u("]"),c(function(t,i){for(var n=[],r=0;r<e.length;r++)n.push(e[r](t,i));return n},{literal:!0,constant:t})}function O(){var e=[],t=!0;if("}"!=a().text)do{var i=l(),n=i.string||i.text;u(":");var r=x();e.push({key:n,value:r}),r.constant||(t=!1)}while(l(","));return u("}"),c(function(t,i){for(var n={},r=0;r<e.length;r++){var o=e[r];n[o.key]=o.value(t,i)}return n},{literal:!0,constant:t})}var F,I=g(0),k=Ze(e,r),B=b,V=N,U=L,z=D,$=v;return t?(B=_,V=U=z=$=function(){o("is not valid json",{text:e,index:0})},F=P()):F=m(),0!==k.length&&o("is an unexpected token",k[0]),F.literal=!!F.literal,F.constant=!!F.constant,F}function Je(e,t,i){for(var n=t.split("."),r=0;n.length>1;r++){var o=n.shift(),a=e[o];a||(a={},e[o]=a),e=a}return e[n.shift()]=i,i}function et(e,t,i){if(!t)return e;for(var n,r=t.split("."),o=e,a=r.length,s=0;a>s;s++)n=r[s],e&&(e=(o=e)[n]);return!i&&S(e)?V(o,e):e}function tt(e,t,n,r,o){return function(a,s){var l,u=s&&s.hasOwnProperty(e)?s:a;return null===u||u===i?u:(u=u[e],u&&u.then&&("$$v"in u||(l=u,l.$$v=i,l.then(function(e){l.$$v=e})),u=u.$$v),t&&null!==u&&u!==i?(u=u[t],u&&u.then&&("$$v"in u||(l=u,l.$$v=i,l.then(function(e){l.$$v=e})),u=u.$$v),n&&null!==u&&u!==i?(u=u[n],u&&u.then&&("$$v"in u||(l=u,l.$$v=i,l.then(function(e){l.$$v=e})),u=u.$$v),r&&null!==u&&u!==i?(u=u[r],u&&u.then&&("$$v"in u||(l=u,l.$$v=i,l.then(function(e){l.$$v=e})),u=u.$$v),o&&null!==u&&u!==i?(u=u[o],u&&u.then&&("$$v"in u||(l=u,l.$$v=i,l.then(function(e){l.$$v=e})),u=u.$$v),u):u):u):u):u)}}function it(e,t){if(Li.hasOwnProperty(e))return Li[e];var n,r=e.split("."),a=r.length;if(t)n=6>a?tt(r[0],r[1],r[2],r[3],r[4]):function(e,t){var n,o=0;do n=tt(r[o++],r[o++],r[o++],r[o++],r[o++])(e,t),t=i,e=n;while(a>o);return n};else{var s="var l, fn, p;\n";o(r,function(e,t){s+="if(s === null || s === undefined) return s;\nl=s;\ns="+(t?"s":'((k&&k.hasOwnProperty("'+e+'"))?k:s)')+'["'+e+'"];\nif (s && s.then) {\n if (!("$$v" in s)) {\n p=s;\n p.$$v = undefined;\n p.then(function(v) {p.$$v=v;});\n}\n s=s.$$v\n}\n'}),s+="return s;",n=Function("s","k",s),n.toString=function(){return s}}return Li[e]=n}function nt(){var e={};this.$get=["$filter","$sniffer",function(t,i){return function(n){switch(typeof n){case"string":return e.hasOwnProperty(n)?e[n]:e[n]=Qe(n,!1,t,i.csp);case"function":return n;default:return p}}}]}function rt(){this.$get=["$rootScope","$exceptionHandler",function(e,t){return ot(function(t){e.$evalAsync(t)},t)}]}function ot(e,t){function n(e){return e}function r(e){return u(e)}function a(e){var t=s(),i=0,n=M(e)?[]:{};return o(e,function(e,r){i++,l(e).then(function(e){
n.hasOwnProperty(r)||(n[r]=e,--i||t.resolve(n))},function(e){n.hasOwnProperty(r)||t.reject(e)})}),0===i&&t.resolve(n),t.promise}var s=function(){var o,a,h=[];return a={resolve:function(t){if(h){var n=h;h=i,o=l(t),n.length&&e(function(){for(var e,t=0,i=n.length;i>t;t++)e=n[t],o.then(e[0],e[1])})}},reject:function(e){a.resolve(u(e))},promise:{then:function(e,i){var a=s(),l=function(i){try{a.resolve((e||n)(i))}catch(r){t(r),a.reject(r)}},u=function(e){try{a.resolve((i||r)(e))}catch(n){t(n),a.reject(n)}};return h?h.push([l,u]):o.then(l,u),a.promise},always:function(e){function t(e,t){var i=s();return t?i.resolve(e):i.reject(e),i.promise}function i(i,r){var o=null;try{o=(e||n)()}catch(a){return t(a,!1)}return o&&o.then?o.then(function(){return t(i,r)},function(e){return t(e,!1)}):t(i,r)}return this.then(function(e){return i(e,!0)},function(e){return i(e,!1)})}}}},l=function(t){return t&&t.then?t:{then:function(i){var n=s();return e(function(){n.resolve(i(t))}),n.promise}}},u=function(t){return{then:function(i,n){var o=s();return e(function(){o.resolve((n||r)(t))}),o.promise}}},h=function(i,o,a){var h,c=s(),f=function(e){try{return(o||n)(e)}catch(i){return t(i),u(i)}},d=function(e){try{return(a||r)(e)}catch(i){return t(i),u(i)}};return e(function(){l(i).then(function(e){h||(h=!0,c.resolve(l(e).then(f,d)))},function(e){h||(h=!0,c.resolve(d(e)))})}),c.promise};return{defer:s,reject:u,when:h,all:a}}function at(){var e={};this.when=function(t,i){if(e[t]=c({reloadOnSearch:!0,caseInsensitiveMatch:!1},i),t){var n="/"==t[t.length-1]?t.substr(0,t.length-1):t+"/";e[n]={redirectTo:t}}return this},this.otherwise=function(e){return this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache",function(t,i,n,r,a,s,l){function u(e,t,i){t="^"+t.replace(/[-\/\\^$:*+?.()|[\]{}]/g,"\\$&")+"$";for(var n,r="",a=[],s={},l=/\\([:*])(\w+)/g,u=0;null!==(n=l.exec(t));){switch(r+=t.slice(u,n.index),n[1]){case":":r+="([^\\/]*)";break;case"*":r+="(.*)"}a.push(n[2]),u=l.lastIndex}r+=t.substr(u);var h=e.match(new RegExp(r,i.caseInsensitiveMatch?"i":""));return h&&o(a,function(e,t){s[e]=h[t+1]}),h?s:null}function h(){var e=f(),u=g.current;e&&u&&e.$$route===u.$$route&&I(e.pathParams,u.pathParams)&&!e.reloadOnSearch&&!m?(u.params=e.params,O(u.params,n),t.$broadcast("$routeUpdate",u)):(e||u)&&(m=!1,t.$broadcast("$routeChangeStart",e,u),g.current=e,e&&e.redirectTo&&(b(e.redirectTo)?i.path(p(e.redirectTo,e.params)).search(e.params).replace():i.url(e.redirectTo(e.pathParams,i.path(),i.search())).replace()),r.when(e).then(function(){if(e){var t,i=c({},e.resolve);return o(i,function(e,t){i[t]=b(e)?a.get(e):a.invoke(e)}),y(t=e.template)?S(t)&&(t=t(e.params)):y(t=e.templateUrl)&&(S(t)&&(t=t(e.params)),y(t)&&(e.loadedTemplateUrl=t,t=s.get(t,{cache:l}).then(function(e){return e.data}))),y(t)&&(i.$template=t),r.all(i)}}).then(function(i){e==g.current&&(e&&(e.locals=i,O(e.params,n)),t.$broadcast("$routeChangeSuccess",e,u))},function(i){e==g.current&&t.$broadcast("$routeChangeError",e,u,i)}))}function f(){var t,n;return o(e,function(e,r){!n&&(t=u(i.path(),r,e))&&(n=d(e,{params:c({},i.search(),t),pathParams:t}),n.$$route=e)}),n||e[null]&&d(e[null],{params:{},pathParams:{}})}function p(e,t){var i=[];return o((e||"").split(":"),function(e,n){if(0==n)i.push(e);else{var r=e.match(/(\w+)(.*)/),o=r[1];i.push(t[o]),i.push(r[2]||""),delete t[o]}}),i.join("")}var m=!1,g={routes:e,reload:function(){m=!0,t.$evalAsync(h)}};return t.$on("$locationChangeSuccess",h),g}]}function st(){this.$get=g({})}function lt(){var e=10;this.digestTtl=function(t){return arguments.length&&(e=t),e},this.$get=["$injector","$exceptionHandler","$parse",function(t,i,n){function o(){this.$id=u(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this["this"]=this.$root=this,this.$$destroyed=!1,this.$$asyncQueue=[],this.$$listeners={},this.$$isolateBindings={}}function a(e){if(c.$$phase)throw Error(c.$$phase+" already in progress");c.$$phase=e}function s(){c.$$phase=null}function l(e,t){var i=n(e);return ee(i,t),i}function h(){}o.prototype={$new:function(e){var t,i;if(S(e))throw Error("API-CHANGE: Use $controller to instantiate controllers.");return e?(i=new o,i.$root=this.$root):(t=function(){},t.prototype=this,i=new t,i.$id=u()),i["this"]=i,i.$$listeners={},i.$parent=this,i.$$watchers=i.$$nextSibling=i.$$childHead=i.$$childTail=null,i.$$prevSibling=this.$$childTail,this.$$childHead?(this.$$childTail.$$nextSibling=i,this.$$childTail=i):this.$$childHead=this.$$childTail=i,i},$watch:function(e,t,i){var n=this,r=l(e,"watch"),o=n.$$watchers,a={fn:t,last:h,get:r,exp:e,eq:!!i};if(!S(t)){var s=l(t||p,"listener");a.fn=function(e,t,i){s(i)}}if("string"==typeof e&&r.constant){var u=a.fn;a.fn=function(e,t,i){u.call(this,e,t,i),R(o,a)}}return o||(o=n.$$watchers=[]),o.unshift(a),function(){R(o,a)}},$watchCollection:function(e,t){function i(){s=h(l);var e,t;if(x(s))if(r(s)){a!==c&&(a=c,d=a.length=0,u++),e=s.length,d!==e&&(u++,a.length=d=e);for(var i=0;e>i;i++)a[i]!==s[i]&&(u++,a[i]=s[i])}else{a!==f&&(a=f={},d=0,u++),e=0;for(t in s)s.hasOwnProperty(t)&&(e++,a.hasOwnProperty(t)?a[t]!==s[t]&&(u++,a[t]=s[t]):(d++,a[t]=s[t],u++));if(d>e){u++;for(t in a)a.hasOwnProperty(t)&&!s.hasOwnProperty(t)&&(d--,delete a[t])}}else a!==s&&(a=s,u++);return u}function o(){t(s,a,l)}var a,s,l=this,u=0,h=n(e),c=[],f={},d=0;return this.$watch(i,o)},$digest:function(){var t,n,r,o,l,u,c,f,d,p,m=this.$$asyncQueue,g=e,v=this,y=[];a("$digest");do{for(u=!1,f=v;m.length;)try{f.$eval(m.shift())}catch(x){i(x)}do{if(o=f.$$watchers)for(l=o.length;l--;)try{t=o[l],(n=t.get(f))===(r=t.last)||(t.eq?I(n,r):"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))||(u=!0,t.last=t.eq?O(n):n,t.fn(n,r===h?n:r,f),5>g&&(d=4-g,y[d]||(y[d]=[]),p=S(t.exp)?"fn: "+(t.exp.name||t.exp.toString()):t.exp,p+="; newVal: "+z(n)+"; oldVal: "+z(r),y[d].push(p)))}catch(x){i(x)}if(!(c=f.$$childHead||f!==v&&f.$$nextSibling))for(;f!==v&&!(c=f.$$nextSibling);)f=f.$parent}while(f=c);if(u&&!g--)throw s(),Error(e+" $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: "+z(y))}while(u||m.length);s()},$destroy:function(){if(c!=this&&!this.$$destroyed){var e=this.$parent;this.$broadcast("$destroy"),this.$$destroyed=!0,e.$$childHead==this&&(e.$$childHead=this.$$nextSibling),e.$$childTail==this&&(e.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null}},$eval:function(e,t){return n(e)(this,t)},$evalAsync:function(e){this.$$asyncQueue.push(e)},$apply:function(e){try{return a("$apply"),this.$eval(e)}catch(t){i(t)}finally{s();try{c.$digest()}catch(t){throw i(t),t}}},$on:function(e,t){var i=this.$$listeners[e];return i||(this.$$listeners[e]=i=[]),i.push(t),function(){i[N(i,t)]=null}},$emit:function(e,t){var n,r,o,a=[],s=this,l=!1,u={name:e,targetScope:s,stopPropagation:function(){l=!0},preventDefault:function(){u.defaultPrevented=!0},defaultPrevented:!1},h=k([u],arguments,1);do{for(n=s.$$listeners[e]||a,u.currentScope=s,r=0,o=n.length;o>r;r++)if(n[r])try{if(n[r].apply(null,h),l)return u}catch(c){i(c)}else n.splice(r,1),r--,o--;s=s.$parent}while(s);return u},$broadcast:function(e,t){var n,r,o,a=this,s=a,l=a,u={name:e,targetScope:a,preventDefault:function(){u.defaultPrevented=!0},defaultPrevented:!1},h=k([u],arguments,1);do{for(s=l,u.currentScope=s,n=s.$$listeners[e]||[],r=0,o=n.length;o>r;r++)if(n[r])try{n[r].apply(null,h)}catch(c){i(c)}else n.splice(r,1),r--,o--;if(!(l=s.$$childHead||s!==a&&s.$$nextSibling))for(;s!==a&&!(l=s.$$nextSibling);)s=s.$parent}while(s=l);return u}};var c=new o;return c}]}function ut(){this.$get=["$window","$document",function(e,t){var i,n,r={},o=f((/android (\d+)/.exec(Wt((e.navigator||{}).userAgent))||[])[1]),a=t[0]||{},s=/^(Moz|webkit|O|ms)(?=[A-Z])/,l=a.body&&a.body.style,u=!1,h=!1;if(l){for(var c in l)if(n=s.exec(c)){i=n[0],i=i.substr(0,1).toUpperCase()+i.substr(1);break}u=!!("transition"in l||i+"Transition"in l),h=!!("animation"in l||i+"Animation"in l)}return{history:!(!e.history||!e.history.pushState||4>o),hashchange:"onhashchange"in e&&(!a.documentMode||a.documentMode>7),hasEvent:function(e){if("input"==e&&9==Jt)return!1;if(v(r[e])){var t=a.createElement("div");r[e]="on"+e in t}return r[e]},csp:a.securityPolicy?a.securityPolicy.isActive:!1,vendorPrefix:i,transitions:u,animations:h}}]}function ht(){this.$get=g(e)}function ct(e){var t,i,n,r={};return e?(o(e.split("\n"),function(e){n=e.indexOf(":"),t=Wt(A(e.substr(0,n))),i=A(e.substr(n+1)),t&&(r[t]?r[t]+=", "+i:r[t]=i)}),r):r}function ft(e,t){var n=Di.exec(e);if(null==n)return!0;var r={protocol:n[2],host:n[4],port:f(n[6])||Ei[n[2]]||null,relativeProtocol:n[2]===i||""===n[2]};n=Ci.exec(t);var o={protocol:n[1],host:n[3],port:f(n[5])||Ei[n[1]]||null};return(r.protocol==o.protocol||r.relativeProtocol)&&r.host==o.host&&(r.port==o.port||r.relativeProtocol&&o.port==Ei[o.protocol])}function dt(e){var t=x(e)?e:i;return function(i){return t||(t=ct(e)),i?t[Wt(i)]||null:t}}function pt(e,t,i){return S(i)?i(e,t):(o(i,function(i){e=i(e,t)}),e)}function mt(e){return e>=200&&300>e}function gt(){var e=/^\s*(\[|\{[^\{])/,t=/[\}\]]\s*$/,n=/^\)\]\}',?\n/,r={"Content-Type":"application/json;charset=utf-8"},a=this.defaults={transformResponse:[function(i){return b(i)&&(i=i.replace(n,""),e.test(i)&&t.test(i)&&(i=$(i,!0))),i}],transformRequest:[function(e){return x(e)&&!E(e)?z(e):e}],headers:{common:{Accept:"application/json, text/plain, */*"},post:r,put:r,patch:r},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},l=this.interceptors=[],u=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(e,t,n,r,h,f){function d(e){function n(e){var t=c({},e,{data:pt(e.data,e.headers,r.transformResponse)});return mt(e.status)?t:h.reject(t)}var r={transformRequest:a.transformRequest,transformResponse:a.transformResponse},s={};c(r,e),r.headers=s,r.method=Gt(r.method),c(s,a.headers.common,a.headers[Wt(r.method)],e.headers);var l=ft(r.url,t.url())?t.cookies()[r.xsrfCookieName||a.xsrfCookieName]:i;l&&(s[r.xsrfHeaderName||a.xsrfHeaderName]=l);var u=function(e){var t=pt(e.data,dt(s),e.transformRequest);return v(e.data)&&delete s["Content-Type"],v(e.withCredentials)&&!v(a.withCredentials)&&(e.withCredentials=a.withCredentials),g(e,t,s).then(n,n)},f=[u,i],d=h.when(r);for(o(_,function(e){(e.request||e.requestError)&&f.unshift(e.request,e.requestError),(e.response||e.responseError)&&f.push(e.response,e.responseError)});f.length;){var p=f.shift(),m=f.shift();d=d.then(p,m)}return d.success=function(e){return d.then(function(t){e(t.data,t.status,t.headers,r)}),d},d.error=function(e){return d.then(null,function(t){e(t.data,t.status,t.headers,r)}),d},d}function p(e){o(arguments,function(e){d[e]=function(t,i){return d(c(i||{},{method:e,url:t}))}})}function m(e){o(arguments,function(e){d[e]=function(t,i,n){return d(c(n||{},{method:e,url:t,data:i}))}})}function g(t,i,n){function o(e,t,i){u&&(mt(e)?u.put(m,[e,t,ct(i)]):u.remove(m)),s(t,e,i),r.$$phase||r.$apply()}function s(e,i,n){i=Math.max(i,0),(mt(i)?f.resolve:f.reject)({data:e,status:i,headers:dt(n),config:t})}function l(){var e=N(d.pendingRequests,t);-1!==e&&d.pendingRequests.splice(e,1)}var u,c,f=h.defer(),p=f.promise,m=y(t.url,t.params);if(d.pendingRequests.push(t),p.then(l,l),(t.cache||a.cache)&&t.cache!==!1&&"GET"==t.method&&(u=x(t.cache)?t.cache:x(a.cache)?a.cache:w),u)if(c=u.get(m)){if(c.then)return c.then(l,l),c;M(c)?s(c[1],c[0],O(c[2])):s(c,200,{})}else u.put(m,p);return c||e(t.method,m,i,o,n,t.timeout,t.withCredentials,t.responseType),p}function y(e,t){if(!t)return e;var n=[];return s(t,function(e,t){null!=e&&e!=i&&(M(e)||(e=[e]),o(e,function(e){x(e)&&(e=z(e)),n.push(q(t)+"="+q(e))}))}),e+(-1==e.indexOf("?")?"?":"&")+n.join("&")}var w=n("$http"),_=[];return o(l,function(e){_.unshift(b(e)?f.get(e):f.invoke(e))}),o(u,function(e,t){var i=b(e)?f.get(e):f.invoke(e);_.splice(t,0,{response:function(e){return i(h.when(e))},responseError:function(e){return i(h.reject(e))}})}),d.pendingRequests=[],p("get","delete","head","jsonp"),m("post","put"),d.defaults=a,d}]}function vt(){this.$get=["$browser","$window","$document",function(e,t,i){return yt(e,Ni,e.defer,t.angular.callbacks,i[0],t.location.protocol.replace(":",""))}]}function yt(e,t,i,n,r,a){function s(e,t){var i=r.createElement("script"),n=function(){r.body.removeChild(i),t&&t()};return i.type="text/javascript",i.src=e,Jt?i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&n()}:i.onload=i.onerror=n,r.body.appendChild(i),n}return function(r,l,u,h,c,f,d,m){function g(){y=-1,b&&b(),w&&w.abort()}function v(t,n,r,o){var s=(l.match(Ci)||["",a])[1];_&&i.cancel(_),b=w=null,n="file"==s?r?200:404:n,n=1223==n?204:n,t(n,r,o),e.$$completeOutstandingRequest(p)}var y;if(e.$$incOutstandingRequestCount(),l=l||e.url(),"jsonp"==Wt(r)){var x="_"+(n.counter++).toString(36);n[x]=function(e){n[x].data=e};var b=s(l.replace("JSON_CALLBACK","angular.callbacks."+x),function(){n[x].data?v(h,200,n[x].data):v(h,y||-2),delete n[x]})}else{var w=new t;w.open(r,l,!0),o(c,function(e,t){e&&w.setRequestHeader(t,e)}),w.onreadystatechange=function(){if(4==w.readyState){var e=w.getAllResponseHeaders(),t=["Cache-Control","Content-Language","Content-Type","Expires","Last-Modified","Pragma"];e||(e="",o(t,function(t){var i=w.getResponseHeader(t);i&&(e+=t+": "+i+"\n")})),v(h,y||w.status,w.responseType?w.response:w.responseText,e)}},d&&(w.withCredentials=!0),m&&(w.responseType=m),w.send(u||"")}if(f>0)var _=i(g,f);else f&&f.then&&f.then(g)}}function xt(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"Â¤",posSuf:"",negPre:"(Â¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),SHORTMONTH:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),DAY:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),SHORTDAY:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(e){return 1===e?"one":"other"}}}}function bt(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function(e,t,i,n){function r(r,a,s){var l,u,h=i.defer(),c=h.promise,f=y(s)&&!s;return l=t.defer(function(){try{h.resolve(r())}catch(t){h.reject(t),n(t)}f||e.$apply()},a),u=function(){delete o[c.$$timeoutId]},c.$$timeoutId=l,o[l]=h,c.then(u,u),c}var o={};return r.cancel=function(e){return e&&e.$$timeoutId in o?(o[e.$$timeoutId].reject("canceled"),t.defer.cancel(e.$$timeoutId)):!1},r}]}function wt(e){function t(t,n){return e.factory(t+i,n)}var i="Filter";this.register=t,this.$get=["$injector",function(e){return function(t){return e.get(t+i)}}],t("currency",Mt),t("date",Dt),t("filter",_t),t("json",Nt),t("limitTo",Rt),t("lowercase",ki),t("number",St),t("orderBy",Ot),t("uppercase",Bi)}function _t(){return function(e,t,i){if(!M(e))return e;var n=[];switch(n.check=function(e){for(var t=0;t<n.length;t++)if(!n[t](e))return!1;return!0},typeof i){case"function":break;case"boolean":if(1==i){i=function(e,t){return ri.equals(e,t)};break}default:i=function(e,t){return t=(""+t).toLowerCase(),(""+e).toLowerCase().indexOf(t)>-1}}var r=function(e,t){if("string"==typeof t&&"!"===t.charAt(0))return!r(e,t.substr(1));switch(typeof e){case"boolean":case"number":case"string":return i(e,t);case"object":switch(typeof t){case"object":return i(e,t);default:for(var n in e)if("$"!==n.charAt(0)&&r(e[n],t))return!0}return!1;case"array":for(var o=0;o<e.length;o++)if(r(e[o],t))return!0;return!1;default:return!1}};switch(typeof t){case"boolean":case"number":case"string":t={$:t};case"object":for(var o in t)"$"==o?!function(){if(t[o]){var e=o;n.push(function(i){return r(i,t[e])})}}():!function(){if(t[o]){var e=o;n.push(function(i){return r(et(i,e),t[e])})}}();break;case"function":n.push(t);break;default:return e}for(var a=[],s=0;s<e.length;s++){var l=e[s];n.check(l)&&a.push(l)}return a}}function Mt(e){var t=e.NUMBER_FORMATS;return function(e,i){return v(i)&&(i=t.CURRENCY_SYM),Ct(e,t.PATTERNS[1],t.GROUP_SEP,t.DECIMAL_SEP,2).replace(/\u00A4/g,i)}}function St(e){var t=e.NUMBER_FORMATS;return function(e,i){return Ct(e,t.PATTERNS[0],t.GROUP_SEP,t.DECIMAL_SEP,i)}}function Ct(e,t,i,n,r){if(isNaN(e)||!isFinite(e))return"";var o=0>e;e=Math.abs(e);var a=e+"",s="",l=[],u=!1;if(-1!==a.indexOf("e")){var h=a.match(/([\d\.]+)e(-?)(\d+)/);h&&"-"==h[2]&&h[3]>r+1?a="0":(s=a,u=!0)}if(!u){var c=(a.split(Ri)[1]||"").length;v(r)&&(r=Math.min(Math.max(t.minFrac,c),t.maxFrac));var f=Math.pow(10,r);e=Math.round(e*f)/f;var d=(""+e).split(Ri),p=d[0];d=d[1]||"";var m=0,g=t.lgSize,y=t.gSize;if(p.length>=g+y){m=p.length-g;for(var x=0;m>x;x++)(m-x)%y===0&&0!==x&&(s+=i),s+=p.charAt(x)}for(x=m;x<p.length;x++)(p.length-x)%g===0&&0!==x&&(s+=i),s+=p.charAt(x);for(;d.length<r;)d+="0";r&&"0"!==r&&(s+=n+d.substr(0,r))}return l.push(o?t.negPre:t.posPre),l.push(s),l.push(o?t.negSuf:t.posSuf),l.join("")}function Tt(e,t,i){var n="";for(0>e&&(n="-",e=-e),e=""+e;e.length<t;)e="0"+e;return i&&(e=e.substr(e.length-t)),n+e}function Et(e,t,i,n){return i=i||0,function(r){var o=r["get"+e]();return(i>0||o>-i)&&(o+=i),0===o&&-12==i&&(o=12),Tt(o,t,n)}}function At(e,t){return function(i,n){var r=i["get"+e](),o=Gt(t?"SHORT"+e:e);return n[o][r]}}function Pt(e){var t=-1*e.getTimezoneOffset(),i=t>=0?"+":"";return i+=Tt(Math[t>0?"floor":"ceil"](t/60),2)+Tt(Math.abs(t%60),2)}function Lt(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function Dt(e){function t(e){var t;if(t=e.match(i)){var n=new Date(0),r=0,o=0,a=t[8]?n.setUTCFullYear:n.setFullYear,s=t[8]?n.setUTCHours:n.setHours;t[9]&&(r=f(t[9]+t[10]),o=f(t[9]+t[11])),a.call(n,f(t[1]),f(t[2])-1,f(t[3]));var l=f(t[4]||0)-r,u=f(t[5]||0)-o,h=f(t[6]||0),c=Math.round(1e3*parseFloat("0."+(t[7]||0)));return s.call(n,l,u,h,c),n}return e}var i=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(i,n){var r,a,s="",l=[];if(n=n||"mediumDate",n=e.DATETIME_FORMATS[n]||n,b(i)&&(i=Ii.test(i)?f(i):t(i)),w(i)&&(i=new Date(i)),!_(i))return i;for(;n;)a=Fi.exec(n),a?(l=k(l,a,1),n=l.pop()):(l.push(n),n=null);return o(l,function(t){r=Oi[t],s+=r?r(i,e.DATETIME_FORMATS):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),s}}function Nt(){return function(e){return z(e,!0)}}function Rt(){return function(e,t){if(!M(e)&&!b(e))return e;if(t=f(t),b(e))return t?t>=0?e.slice(0,t):e.slice(t,e.length):"";var i,n,r=[];for(t>e.length?t=e.length:t<-e.length&&(t=-e.length),t>0?(i=0,n=t):(i=e.length+t,n=e.length);n>i;i++)r.push(e[i]);return r}}function Ot(e){return function(t,i,n){function r(e,t){for(var n=0;n<i.length;n++){var r=i[n](e,t);if(0!==r)return r}return 0}function o(e,t){return H(t)?function(t,i){return e(i,t)}:e}function a(e,t){var i=typeof e,n=typeof t;return i==n?("string"==i&&(e=e.toLowerCase()),"string"==i&&(t=t.toLowerCase()),e===t?0:t>e?-1:1):n>i?-1:1}if(!M(t))return t;if(!i)return t;i=M(i)?i:[i],i=L(i,function(t){var i=!1,n=t||m;return b(t)&&(("+"==t.charAt(0)||"-"==t.charAt(0))&&(i="-"==t.charAt(0),t=t.substring(1)),n=e(t)),o(function(e,t){return a(n(e),n(t))},i)});for(var s=[],l=0;l<t.length;l++)s.push(t[l]);return s.sort(o(r,n))}}function Ft(e){return S(e)&&(e={link:e}),e.restrict=e.restrict||"AC",g(e)}function It(e,t){function i(t,i){i=i?"-"+Z(i,"-"):"",e.removeClass((t?Zi:Ki)+i).addClass((t?Ki:Zi)+i)}var n=this,r=e.parent().controller("form")||zi,a=0,s=n.$error={},l=[];n.$name=t.name,n.$dirty=!1,n.$pristine=!0,n.$valid=!0,n.$invalid=!1,r.$addControl(n),e.addClass(Qi),i(!0),n.$addControl=function(e){l.push(e),e.$name&&!n.hasOwnProperty(e.$name)&&(n[e.$name]=e)},n.$removeControl=function(e){e.$name&&n[e.$name]===e&&delete n[e.$name],o(s,function(t,i){n.$setValidity(i,!0,e)}),R(l,e)},n.$setValidity=function(e,t,o){var l=s[e];if(t)l&&(R(l,o),l.length||(a--,a||(i(t),n.$valid=!0,n.$invalid=!1),s[e]=!1,i(!0,e),r.$setValidity(e,!0,n)));else{if(a||i(t),l){if(D(l,o))return}else s[e]=l=[],a++,i(!1,e),r.$setValidity(e,!1,n);l.push(o),n.$valid=!1,n.$invalid=!0}},n.$setDirty=function(){e.removeClass(Qi).addClass(Ji),n.$dirty=!0,n.$pristine=!1,r.$setDirty()},n.$setPristine=function(){e.removeClass(Ji).addClass(Qi),n.$dirty=!1,n.$pristine=!0,o(l,function(e){e.$setPristine()})}}function kt(e){return v(e)||""===e||null===e||e!==e}function Bt(e,t,n,r,o,a){var s=function(){var i=t.val();H(n.ngTrim||"T")&&(i=A(i)),r.$viewValue!==i&&e.$apply(function(){r.$setViewValue(i)})};if(o.hasEvent("input"))t.bind("input",s);else{var l,u=function(){l||(l=a.defer(function(){s(),l=null}))};t.bind("keydown",function(e){var t=e.keyCode;91===t||t>15&&19>t||t>=37&&40>=t||u()}),t.bind("change",s),o.hasEvent("paste")&&t.bind("paste cut",u)}r.$render=function(){t.val(kt(r.$viewValue)?"":r.$viewValue)};var h,c,d=n.ngPattern,p=function(e,t){return kt(t)||e.test(t)?(r.$setValidity("pattern",!0),t):(r.$setValidity("pattern",!1),i)};if(d&&(c=d.match(/^\/(.*)\/([gim]*)$/),c?(d=new RegExp(c[1],c[2]),h=function(e){return p(d,e)}):h=function(t){var i=e.$eval(d);if(!i||!i.test)throw new Error("Expected "+d+" to be a RegExp but was "+i);return p(i,t)},r.$formatters.push(h),r.$parsers.push(h)),n.ngMinlength){var m=f(n.ngMinlength),g=function(e){return!kt(e)&&e.length<m?(r.$setValidity("minlength",!1),i):(r.$setValidity("minlength",!0),e)};r.$parsers.push(g),r.$formatters.push(g)}if(n.ngMaxlength){var v=f(n.ngMaxlength),y=function(e){return!kt(e)&&e.length>v?(r.$setValidity("maxlength",!1),i):(r.$setValidity("maxlength",!0),e)};r.$parsers.push(y),r.$formatters.push(y)}}function Vt(e,t,n,r,o,a){if(Bt(e,t,n,r,o,a),r.$parsers.push(function(e){var t=kt(e);return t||Xi.test(e)?(r.$setValidity("number",!0),""===e?null:t?e:parseFloat(e)):(r.$setValidity("number",!1),i)}),r.$formatters.push(function(e){return kt(e)?"":""+e}),n.min){var s=parseFloat(n.min),l=function(e){return!kt(e)&&s>e?(r.$setValidity("min",!1),i):(r.$setValidity("min",!0),e)};r.$parsers.push(l),r.$formatters.push(l)}if(n.max){var u=parseFloat(n.max),h=function(e){return!kt(e)&&e>u?(r.$setValidity("max",!1),i):(r.$setValidity("max",!0),e)};r.$parsers.push(h),r.$formatters.push(h)}r.$formatters.push(function(e){return kt(e)||w(e)?(r.$setValidity("number",!0),e):(r.$setValidity("number",!1),i)})}function Ut(e,t,n,r,o,a){Bt(e,t,n,r,o,a);var s=function(e){return kt(e)||Wi.test(e)?(r.$setValidity("url",!0),e):(r.$setValidity("url",!1),i)};r.$formatters.push(s),r.$parsers.push(s)}function zt(e,t,n,r,o,a){Bt(e,t,n,r,o,a);var s=function(e){return kt(e)||Gi.test(e)?(r.$setValidity("email",!0),e):(r.$setValidity("email",!1),i)};r.$formatters.push(s),r.$parsers.push(s)}function $t(e,t,i,n){v(i.name)&&t.attr("name",u()),t.bind("click",function(){t[0].checked&&e.$apply(function(){n.$setViewValue(i.value)})}),n.$render=function(){var e=i.value;t[0].checked=e==n.$viewValue},i.$observe("value",n.$render)}function Ht(e,t,i,n){var r=i.ngTrueValue,o=i.ngFalseValue;b(r)||(r=!0),b(o)||(o=!1),t.bind("click",function(){e.$apply(function(){n.$setViewValue(t[0].checked)})}),n.$render=function(){t[0].checked=n.$viewValue},n.$formatters.push(function(e){return e===r}),n.$parsers.push(function(e){return e?r:o})}function jt(e,t){return e="ngClass"+e,Ft(function(n,r,o){function a(e){(t===!0||n.$index%2===t)&&(u&&!I(e,u)&&s(u),l(e)),u=O(e)}function s(e){x(e)&&!M(e)&&(e=L(e,function(e,t){return e?t:void 0})),r.removeClass(M(e)?e.join(" "):e)}function l(e){x(e)&&!M(e)&&(e=L(e,function(e,t){return e?t:void 0})),e&&r.addClass(M(e)?e.join(" "):e)}var u=i;n.$watch(o[e],a,!0),o.$observe("class",function(t){var i=n.$eval(o[e]);a(i,i)}),"ngClass"!==e&&n.$watch("$index",function(i,r){var a=1&i;a!==r&1&&(a===t?l(n.$eval(o[e])):s(n.$eval(o[e])))})})}var Wt=function(e){return b(e)?e.toLowerCase():e},Gt=function(e){return b(e)?e.toUpperCase():e},Xt=function(e){return b(e)?e.replace(/[A-Z]/g,function(e){return String.fromCharCode(32|e.charCodeAt(0))}):e},qt=function(e){return b(e)?e.replace(/[a-z]/g,function(e){return String.fromCharCode(-33&e.charCodeAt(0))}):e};"i"!=="I".toLowerCase()&&(Wt=Xt,Gt=qt);var Yt,Kt,Zt,Qt,Jt=f((/msie (\d+)/.exec(Wt(navigator.userAgent))||[])[1]),ei=[].slice,ti=[].push,ii=Object.prototype.toString,ni=e.angular,ri=e.angular||(e.angular={}),oi=["0","0","0"];p.$inject=[],m.$inject=[],Qt=9>Jt?function(e){return e=e.nodeName?e:e[0],e.scopeName&&"HTML"!=e.scopeName?Gt(e.scopeName+":"+e.nodeName):e.nodeName}:function(e){return e.nodeName?e.nodeName:e[0].nodeName};var ai=/[A-Z]/g,si={full:"1.1.5",major:1,minor:1,dot:5,codeName:"triangle-squarification"},li=ae.cache={},ui=ae.expando="ng-"+(new Date).getTime(),hi=1,ci=e.document.addEventListener?function(e,t,i){e.addEventListener(t,i,!1)}:function(e,t,i){e.attachEvent("on"+t,i)},fi=e.document.removeEventListener?function(e,t,i){e.removeEventListener(t,i,!1)}:function(e,t,i){e.detachEvent("on"+t,i)},di=/([\:\-\_]+(.))/g,pi=/^moz([A-Z])/,mi=ae.prototype={ready:function(i){function n(){r||(r=!0,i())}var r=!1;"complete"===t.readyState?setTimeout(n):(this.bind("DOMContentLoaded",n),ae(e).bind("load",n))},toString:function(){var e=[];return o(this,function(t){e.push(""+t)}),"["+e.join(", ")+"]"},eq:function(e){return Yt(e>=0?this[e]:this[this.length+e])},length:0,push:ti,sort:[].sort,splice:[].splice},gi={};o("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(e){gi[Wt(e)]=e});var vi={};o("input,select,option,textarea,button,form,details".split(","),function(e){vi[Gt(e)]=!0}),o({data:fe,inheritedData:ye,scope:function(e){return ye(e,"$scope")},controller:ve,injector:function(e){return ye(e,"$injector")},removeAttr:function(e,t){e.removeAttribute(t)},hasClass:de,css:function(e,t,n){if(t=re(t),!y(n)){var r;return 8>=Jt&&(r=e.currentStyle&&e.currentStyle[t],""===r&&(r="auto")),r=r||e.style[t],8>=Jt&&(r=""===r?i:r),r}e.style[t]=n},attr:function(e,t,n){var r=Wt(t);if(gi[r]){if(!y(n))return e[t]||(e.attributes.getNamedItem(t)||p).specified?r:i;n?(e[t]=!0,e.setAttribute(t,r)):(e[t]=!1,e.removeAttribute(r))}else if(y(n))e.setAttribute(t,n);else if(e.getAttribute){var o=e.getAttribute(t,2);return null===o?i:o}},prop:function(e,t,i){return y(i)?void(e[t]=i):e[t]},text:c(9>Jt?function(e,t){if(1==e.nodeType){if(v(t))return e.innerText;e.innerText=t}else{if(v(t))return e.nodeValue;e.nodeValue=t}}:function(e,t){return v(t)?e.textContent:void(e.textContent=t)},{$dv:""}),val:function(e,t){return v(t)?e.value:void(e.value=t)},html:function(e,t){if(v(t))return e.innerHTML;for(var i=0,n=e.childNodes;i<n.length;i++)le(n[i]);e.innerHTML=t}},function(e,t){ae.prototype[t]=function(t,n){var r,o;if((2==e.length&&e!==de&&e!==ve?t:n)!==i){for(r=0;r<this.length;r++)e(this[r],t,n);return this}if(x(t)){for(r=0;r<this.length;r++)if(e===fe)e(this[r],t);else for(o in t)e(this[r],o,t[o]);return this}return this.length?e(this[0],t,n):e.$dv}}),o({removeData:he,dealoc:le,bind:function Bn(e,i,n){var r=ce(e,"events"),a=ce(e,"handle");r||ce(e,"events",r={}),a||ce(e,"handle",a=be(e,r)),o(i.split(" "),function(i){var o=r[i];if(!o){if("mouseenter"==i||"mouseleave"==i){var s=t.body.contains||t.body.compareDocumentPosition?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};r[i]=[];var l={mouseleave:"mouseout",mouseenter:"mouseover"};Bn(e,l[i],function(e){var t=this,n=e.relatedTarget;(!n||n!==t&&!s(t,n))&&a(e,i)})}else ci(e,i,a),r[i]=[];o=r[i]}o.push(n)})},unbind:ue,replaceWith:function(e,t){var i,n=e.parentNode;le(e),o(new ae(t),function(t){i?n.insertBefore(t,i.nextSibling):n.replaceChild(t,e),i=t})},children:function(e){var t=[];return o(e.childNodes,function(e){1===e.nodeType&&t.push(e)}),t},contents:function(e){return e.childNodes||[]},append:function(e,t){o(new ae(t),function(t){(1===e.nodeType||11===e.nodeType)&&e.appendChild(t)})},prepend:function(e,t){if(1===e.nodeType){var i=e.firstChild;o(new ae(t),function(t){i?e.insertBefore(t,i):(e.appendChild(t),i=t)})}},wrap:function(e,t){t=Yt(t)[0];var i=e.parentNode;i&&i.replaceChild(t,e),t.appendChild(e)},remove:function(e){le(e);var t=e.parentNode;t&&t.removeChild(e)},after:function(e,t){var i=e,n=e.parentNode;o(new ae(t),function(e){n.insertBefore(e,i.nextSibling),i=e})},addClass:me,removeClass:pe,toggleClass:function(e,t,i){v(i)&&(i=!de(e,t)),(i?me:pe)(e,t)},parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},next:function(e){if(e.nextElementSibling)return e.nextElementSibling;for(var t=e.nextSibling;null!=t&&1!==t.nodeType;)t=t.nextSibling;return t},find:function(e,t){return e.getElementsByTagName(t)},clone:se,triggerHandler:function(e,t){var i=(ce(e,"events")||{})[t];o(i,function(t){t.call(e,{preventDefault:p})})}},function(e,t){ae.prototype[t]=function(t,n){for(var r,o=0;o<this.length;o++)r==i?(r=e(this[o],t,n),r!==i&&(r=Yt(r))):ge(r,e(this[o],t,n));return r==i?this:r}}),_e.prototype={put:function(e,t){this[we(e)]=t},get:function(e){return this[we(e)]},remove:function(e){var t=this[e=we(e)];return delete this[e],t}};var yi=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,xi=/,/,bi=/^\s*(_?)(\S+?)\1\s*$/,wi=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;Te.$inject=["$provide"];var _i=function(){var e="$ngAnimateController",t={running:!0};this.$get=["$animation","$window","$sniffer","$rootElement","$rootScope",function(i,n,r,a,s){a.data(e,t);var l=function(t,a){function s(s,l,u){return function(h,c,f){function d(e){var t=0,i=b(e)?e.split(/\s*,\s*/):[];return o(i,function(e){t=Math.max(parseFloat(e)||0,t)}),t}function m(){if(h.addClass(T),M)M(h,g,A);else if(S(n.getComputedStyle)){var e="animation",t="transition",i=r.vendorPrefix+"Animation",a=r.vendorPrefix+"Transition",s="Duration",l="Delay",u="IterationCount",c=0,f=1;o(h,function(r){if(r.nodeType==f){var o=t,h=a,p=1,m=n.getComputedStyle(r)||{};(parseFloat(m[e+s])>0||parseFloat(m[i+s])>0)&&(o=e,h=i,p=Math.max(parseInt(m[o+u])||0,parseInt(m[h+u])||0,p));var g=Math.max(d(m[o+l]),d(m[h+l])),v=Math.max(d(m[o+s]),d(m[h+s]));c=Math.max(g+p*v,c)}}),n.setTimeout(g,1e3*c)}else g()}function g(){g.run||(g.run=!0,u(h,c,f),h.removeClass(y),h.removeClass(T),h.removeData(e))}var v=t.$eval(a.ngAnimate),y=v?x(v)?v[s]:v+"-"+s:"",w=i(y),_=w&&w.setup,M=w&&w.start,C=w&&w.cancel;if(y){var T=y+"-active";if(c||(c=f?f.parent():h.parent()),!r.transitions&&!_&&!M||(c.inheritedData(e)||p).running)return l(h,c,f),void u(h,c,f);var E=h.data(e)||{};if(E.running&&((C||p)(h),E.done()),h.data(e,{running:!0,done:g}),h.addClass(y),l(h,c,f),0==h.length)return g();var A=(_||p)(h);n.setTimeout(m,1)}else l(h,c,f),u(h,c,f)}}function l(e){e.css("display","")}function u(e){e.css("display","none")}function h(e,t,i){i?i.after(e):t.append(e)}function c(e){e.remove()}function f(e,t,i){h(e,t,i)}var d={};return d.enter=s("enter",h,p),d.leave=s("leave",p,c),d.move=s("move",f,p),d.show=s("show",l,p),d.hide=s("hide",p,u),d.animate=function(e,t){s(e,p,p)(t)},d};return l.enabled=function(e){return arguments.length&&(t.running=!e),!t.running},l}]},Mi="Non-assignable model expression: ";De.$inject=["$provide"];var Si=/^(x[\:\-_]|data[\:\-_])/i,Ci=/^([^:]+):\/\/(\w+:{0,1}\w*@)?(\{?[\w\.-]*\}?)(:([0-9]+))?(\/[^\?#]*)?(\?([^#]*))?(#(.*))?$/,Ti=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,Ei={http:80,https:443,ftp:21};Ge.prototype=We.prototype=je.prototype={$$replace:!1,absUrl:Xe("$$absUrl"),url:function(e,t){if(v(e))return this.$$url;var i=Ti.exec(e);return i[1]&&this.path(decodeURIComponent(i[1])),(i[2]||i[1])&&this.search(i[3]||""),
this.hash(i[5]||"",t),this},protocol:Xe("$$protocol"),host:Xe("$$host"),port:Xe("$$port"),path:qe("$$path",function(e){return"/"==e.charAt(0)?e:"/"+e}),search:function(e,t){return v(e)?this.$$search:(y(t)?null===t?delete this.$$search[e]:this.$$search[e]=t:this.$$search=b(e)?W(e):e,this.$$compose(),this)},hash:qe("$$hash",m),replace:function(){return this.$$replace=!0,this}};var Ai={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:p,"+":function(e,t,n,r){return n=n(e,t),r=r(e,t),y(n)?y(r)?n+r:n:y(r)?r:i},"-":function(e,t,i,n){return i=i(e,t),n=n(e,t),(y(i)?i:0)-(y(n)?n:0)},"*":function(e,t,i,n){return i(e,t)*n(e,t)},"/":function(e,t,i,n){return i(e,t)/n(e,t)},"%":function(e,t,i,n){return i(e,t)%n(e,t)},"^":function(e,t,i,n){return i(e,t)^n(e,t)},"=":p,"===":function(e,t,i,n){return i(e,t)===n(e,t)},"!==":function(e,t,i,n){return i(e,t)!==n(e,t)},"==":function(e,t,i,n){return i(e,t)==n(e,t)},"!=":function(e,t,i,n){return i(e,t)!=n(e,t)},"<":function(e,t,i,n){return i(e,t)<n(e,t)},">":function(e,t,i,n){return i(e,t)>n(e,t)},"<=":function(e,t,i,n){return i(e,t)<=n(e,t)},">=":function(e,t,i,n){return i(e,t)>=n(e,t)},"&&":function(e,t,i,n){return i(e,t)&&n(e,t)},"||":function(e,t,i,n){return i(e,t)||n(e,t)},"&":function(e,t,i,n){return i(e,t)&n(e,t)},"|":function(e,t,i,n){return n(e,t)(e,t,i(e,t))},"!":function(e,t,i){return!i(e,t)}},Pi={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'},Li={},Di=/^(([^:]+):)?\/\/(\w+:{0,1}\w*@)?([\w\.-]*)?(:([0-9]+))?(.*)$/,Ni=e.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(i){}throw new Error("This browser does not support XMLHttpRequest.")};wt.$inject=["$provide"],Mt.$inject=["$locale"],St.$inject=["$locale"];var Ri=".",Oi={yyyy:Et("FullYear",4),yy:Et("FullYear",2,0,!0),y:Et("FullYear",1),MMMM:At("Month"),MMM:At("Month",!0),MM:Et("Month",2,1),M:Et("Month",1,1),dd:Et("Date",2),d:Et("Date",1),HH:Et("Hours",2),H:Et("Hours",1),hh:Et("Hours",2,-12),h:Et("Hours",1,-12),mm:Et("Minutes",2),m:Et("Minutes",1),ss:Et("Seconds",2),s:Et("Seconds",1),sss:Et("Milliseconds",3),EEEE:At("Day"),EEE:At("Day",!0),a:Lt,Z:Pt},Fi=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,Ii=/^\d+$/;Dt.$inject=["$locale"];var ki=g(Wt),Bi=g(Gt);Ot.$inject=["$parse"];var Vi=g({restrict:"E",compile:function(e,i){return 8>=Jt&&(i.href||i.name||i.$set("href",""),e.append(t.createComment("IE fix"))),function(e,t){t.bind("click",function(e){t.attr("href")||e.preventDefault()})}}}),Ui={};o(gi,function(e,t){var i=Ne("ng-"+t);Ui[i]=function(){return{priority:100,compile:function(){return function(e,n,r){e.$watch(r[i],function(e){r.$set(t,!!e)})}}}}}),o(["src","srcset","href"],function(e){var t=Ne("ng-"+e);Ui[t]=function(){return{priority:99,link:function(i,n,r){r.$observe(t,function(t){t&&(r.$set(e,t),Jt&&n.prop(e,r[e]))})}}}});var zi={$addControl:p,$removeControl:p,$setValidity:p,$setDirty:p,$setPristine:p};It.$inject=["$element","$attrs","$scope"];var $i=function(e){return["$timeout",function(t){var n={name:"form",restrict:"E",controller:It,compile:function(){return{pre:function(e,n,r,o){if(!r.action){var a=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1};ci(n[0],"submit",a),n.bind("$destroy",function(){t(function(){fi(n[0],"submit",a)},0,!1)})}var s=n.parent().controller("form"),l=r.name||r.ngForm;l&&(e[l]=o),s&&n.bind("$destroy",function(){s.$removeControl(o),l&&(e[l]=i),c(o,zi)})}}}};return e?c(O(n),{restrict:"EAC"}):n}]},Hi=$i(),ji=$i(!0),Wi=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,Gi=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,Xi=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,qi={text:Bt,number:Vt,url:Ut,email:zt,radio:$t,checkbox:Ht,hidden:p,button:p,submit:p,reset:p},Yi=["$browser","$sniffer",function(e,t){return{restrict:"E",require:"?ngModel",link:function(i,n,r,o){o&&(qi[Wt(r.type)]||qi.text)(i,n,r,o,t,e)}}}],Ki="ng-valid",Zi="ng-invalid",Qi="ng-pristine",Ji="ng-dirty",en=["$scope","$exceptionHandler","$attrs","$element","$parse",function(e,t,i,n,r){function a(e,t){t=t?"-"+Z(t,"-"):"",n.removeClass((e?Zi:Ki)+t).addClass((e?Ki:Zi)+t)}this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$name=i.name;var s=r(i.ngModel),l=s.assign;if(!l)throw Error(Mi+i.ngModel+" ("+j(n)+")");this.$render=p;var u=n.inheritedData("$formController")||zi,h=0,c=this.$error={};n.addClass(Qi),a(!0),this.$setValidity=function(e,t){c[e]!==!t&&(t?(c[e]&&h--,h||(a(!0),this.$valid=!0,this.$invalid=!1)):(a(!1),this.$invalid=!0,this.$valid=!1,h++),c[e]=!t,a(t,e),u.$setValidity(e,t,this))},this.$setPristine=function(){this.$dirty=!1,this.$pristine=!0,n.removeClass(Ji).addClass(Qi)},this.$setViewValue=function(i){this.$viewValue=i,this.$pristine&&(this.$dirty=!0,this.$pristine=!1,n.removeClass(Qi).addClass(Ji),u.$setDirty()),o(this.$parsers,function(e){i=e(i)}),this.$modelValue!==i&&(this.$modelValue=i,l(e,i),o(this.$viewChangeListeners,function(e){try{e()}catch(i){t(i)}}))};var f=this;e.$watch(function(){var t=s(e);if(f.$modelValue!==t){var i=f.$formatters,n=i.length;for(f.$modelValue=t;n--;)t=i[n](t);f.$viewValue!==t&&(f.$viewValue=t,f.$render())}})}],tn=function(){return{require:["ngModel","^?form"],controller:en,link:function(e,t,i,n){var r=n[0],o=n[1]||zi;o.$addControl(r),t.bind("$destroy",function(){o.$removeControl(r)})}}},nn=g({require:"ngModel",link:function(e,t,i,n){n.$viewChangeListeners.push(function(){e.$eval(i.ngChange)})}}),rn=function(){return{require:"?ngModel",link:function(e,t,i,n){if(n){i.required=!0;var r=function(e){return i.required&&(kt(e)||e===!1)?void n.$setValidity("required",!1):(n.$setValidity("required",!0),e)};n.$formatters.push(r),n.$parsers.unshift(r),i.$observe("required",function(){r(n.$viewValue)})}}}},on=function(){return{require:"ngModel",link:function(e,t,n,r){var a=/\/(.*)\//.exec(n.ngList),s=a&&new RegExp(a[1])||n.ngList||",",l=function(e){var t=[];return e&&o(e.split(s),function(e){e&&t.push(A(e))}),t};r.$parsers.push(l),r.$formatters.push(function(e){return M(e)?e.join(", "):i})}}},an=/^(true|false|\d+)$/,sn=function(){return{priority:100,compile:function(e,t){return an.test(t.ngValue)?function(e,t,i){i.$set("value",e.$eval(i.ngValue))}:function(e,t,i){e.$watch(i.ngValue,function(e){i.$set("value",e,!1)})}}}},ln=Ft(function(e,t,n){t.addClass("ng-binding").data("$binding",n.ngBind),e.$watch(n.ngBind,function(e){t.text(e==i?"":e)})}),un=["$interpolate",function(e){return function(t,i,n){var r=e(i.attr(n.$attr.ngBindTemplate));i.addClass("ng-binding").data("$binding",r),n.$observe("ngBindTemplate",function(e){i.text(e)})}}],hn=[function(){return function(e,t,i){t.addClass("ng-binding").data("$binding",i.ngBindHtmlUnsafe),e.$watch(i.ngBindHtmlUnsafe,function(e){t.html(e||"")})}}],cn=jt("",!0),fn=jt("Odd",0),dn=jt("Even",1),pn=Ft({compile:function(e,t){t.$set("ngCloak",i),e.removeClass("ng-cloak")}}),mn=[function(){return{scope:!0,controller:"@"}}],gn=["$sniffer",function(e){return{priority:1e3,compile:function(){e.csp=!0}}}],vn={};o("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress".split(" "),function(e){var t=Ne("ng-"+e);vn[t]=["$parse",function(i){return function(n,r,o){var a=i(o[t]);r.bind(Wt(e),function(e){n.$apply(function(){a(n,{$event:e})})})}}]});var yn=Ft(function(e,t,i){t.bind("submit",function(){e.$apply(i.ngSubmit)})}),xn=["$animator",function(e){return{transclude:"element",priority:1e3,terminal:!0,restrict:"A",compile:function(t,n,r){return function(t,n,o){var a,s,l=e(t,o);t.$watch(o.ngIf,function(e){a&&(l.leave(a),a=i),s&&(s.$destroy(),s=i),H(e)&&(s=t.$new(),r(s,function(e){a=e,l.enter(e,n.parent(),n)}))})}}}}],bn=["$http","$templateCache","$anchorScroll","$compile","$animator",function(e,t,i,n,r){return{restrict:"ECA",terminal:!0,compile:function(o,a){var s=a.ngInclude||a.src,l=a.onload||"",u=a.autoscroll;return function(o,a,h){var c,f=r(o,h),d=0,p=function(){c&&(c.$destroy(),c=null),f.leave(a.contents(),a)};o.$watch(s,function(r){var s=++d;r?(e.get(r,{cache:t}).success(function(e){if(s===d){c&&c.$destroy(),c=o.$new(),f.leave(a.contents(),a);var t=Yt("<div/>").html(e).contents();f.enter(t,a),n(t)(c),!y(u)||u&&!o.$eval(u)||i(),c.$emit("$includeContentLoaded"),o.$eval(l)}}).error(function(){s===d&&p()}),o.$emit("$includeContentRequested")):p()})}}}}],wn=Ft({compile:function(){return{pre:function(e,t,i){e.$eval(i.ngInit)}}}}),_n=Ft({terminal:!0,priority:1e3}),Mn=["$locale","$interpolate",function(e,t){var i=/{}/g;return{restrict:"EA",link:function(n,r,a){var s=a.count,l=r.attr(a.$attr.when),u=a.offset||0,h=n.$eval(l),c={},f=t.startSymbol(),d=t.endSymbol();o(h,function(e,n){c[n]=t(e.replace(i,f+s+"-"+u+d))}),n.$watch(function(){var t=parseFloat(n.$eval(s));return isNaN(t)?"":(t in h||(t=e.pluralCat(t-u)),c[t](n,r,!0))},function(e){r.text(e)})}}}],Sn=["$parse","$animator",function(e,t){var i="$$NG_REMOVED";return{transclude:"element",priority:1e3,terminal:!0,compile:function(n,a,s){return function(n,a,l){var u,h,c,f,d,p,m,g=t(n,l),v=l.ngRepeat,y=v.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),x={$id:we};if(!y)throw Error("Expected ngRepeat in form of '_item_ in _collection_[ track by _id_]' but got '"+v+"'.");if(f=y[1],d=y[2],u=y[4],u?(h=e(u),c=function(e,t,i){return m&&(x[m]=e),x[p]=t,x.$index=i,h(n,x)}):c=function(e,t){return we(t)},y=f.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),!y)throw Error("'item' in 'item in collection' should be identifier or (key, value) but got '"+f+"'.");p=y[3]||y[1],m=y[2];var b={};n.$watchCollection(d,function(e){var t,l,u,h,f,d,y,x,w,_,M=a,S={},C=[];if(r(e))w=e;else{w=[];for(d in e)e.hasOwnProperty(d)&&"$"!=d.charAt(0)&&w.push(d);w.sort()}for(h=w.length,l=C.length=w.length,t=0;l>t;t++)if(d=e===w?t:w[t],y=e[d],x=c(d,y,t),b.hasOwnProperty(x))_=b[x],delete b[x],S[x]=_,C[t]=_;else{if(S.hasOwnProperty(x))throw o(C,function(e){e&&e.element&&(b[e.id]=e)}),new Error("Duplicates in a repeater are not allowed. Repeater: "+v+" key: "+x);C[t]={id:x},S[x]=!1}for(d in b)b.hasOwnProperty(d)&&(_=b[d],g.leave(_.element),_.element[0][i]=!0,_.scope.$destroy());for(t=0,l=w.length;l>t;t++){if(d=e===w?t:w[t],y=e[d],_=C[t],_.element){f=_.scope,u=M[0];do u=u.nextSibling;while(u&&u[i]);_.element[0]==u?M=_.element:(g.move(_.element,null,M),M=_.element)}else f=n.$new();f[p]=y,m&&(f[m]=d),f.$index=t,f.$first=0===t,f.$last=t===h-1,f.$middle=!(f.$first||f.$last),_.element||s(f,function(e){g.enter(e,null,M),M=e,_.scope=f,_.element=e,S[_.id]=_})}b=S})}}}}],Cn=["$animator",function(e){return function(t,i,n){var r=e(t,n);t.$watch(n.ngShow,function(e){r[H(e)?"show":"hide"](i)})}}],Tn=["$animator",function(e){return function(t,i,n){var r=e(t,n);t.$watch(n.ngHide,function(e){r[H(e)?"hide":"show"](i)})}}],En=Ft(function(e,t,i){e.$watch(i.ngStyle,function(e,i){i&&e!==i&&o(i,function(e,i){t.css(i,"")}),e&&t.css(e)},!0)}),An=["$animator",function(e){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(t,i,n,r){var a,s,l=e(t,n),u=n.ngSwitch||n.on,h=[];t.$watch(u,function(e){for(var i=0,u=h.length;u>i;i++)h[i].$destroy(),l.leave(s[i]);s=[],h=[],(a=r.cases["!"+e]||r.cases["?"])&&(t.$eval(n.change),o(a,function(e){var i=t.$new();h.push(i),e.transclude(i,function(t){var i=e.element;s.push(t),l.enter(t,i.parent(),i)})}))})}}}],Pn=Ft({transclude:"element",priority:500,require:"^ngSwitch",compile:function(e,t,i){return function(e,n,r,o){o.cases["!"+t.ngSwitchWhen]=o.cases["!"+t.ngSwitchWhen]||[],o.cases["!"+t.ngSwitchWhen].push({transclude:i,element:n})}}}),Ln=Ft({transclude:"element",priority:500,require:"^ngSwitch",compile:function(e,t,i){return function(e,t,n,r){r.cases["?"]=r.cases["?"]||[],r.cases["?"].push({transclude:i,element:t})}}}),Dn=Ft({controller:["$transclude","$element",function(e,t){e(function(e){t.append(e)})}]}),Nn=["$http","$templateCache","$route","$anchorScroll","$compile","$controller","$animator",function(e,t,i,n,r,o,a){return{restrict:"ECA",terminal:!0,link:function(e,t,s){function l(){c&&(c.$destroy(),c=null)}function u(){d.leave(t.contents(),t),l()}function h(){var a=i.current&&i.current.locals,s=a&&a.$template;if(s){u();var l=Yt("<div></div>").html(s).contents();d.enter(l,t);var h,p=r(l),m=i.current;c=m.scope=e.$new(),m.controller&&(a.$scope=c,h=o(m.controller,a),m.controllerAs&&(c[m.controllerAs]=h),t.children().data("$ngControllerController",h)),p(c),c.$emit("$viewContentLoaded"),c.$eval(f),n()}else u()}var c,f=s.onload||"",d=a(e,s);e.$on("$routeChangeSuccess",h),h()}}}],Rn=["$templateCache",function(e){return{restrict:"E",terminal:!0,compile:function(t,i){if("text/ng-template"==i.type){var n=i.id,r=t[0].text;e.put(n,r)}}}}],On=g({terminal:!0}),Fn=["$compile","$parse",function(e,n){var r=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w\d]*)|(?:\(\s*([\$\w][\$\w\d]*)\s*,\s*([\$\w][\$\w\d]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/,s={$setViewValue:p};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(e,t,i){var n,r,o=this,a={},l=s;o.databound=i.ngModel,o.init=function(e,t,i){l=e,n=t,r=i},o.addOption=function(t){a[t]=!0,l.$viewValue==t&&(e.val(t),r.parent()&&r.remove())},o.removeOption=function(e){this.hasOption(e)&&(delete a[e],l.$viewValue==e&&this.renderUnknownOption(e))},o.renderUnknownOption=function(t){var i="? "+we(t)+" ?";r.val(i),e.prepend(r),e.val(i),r.prop("selected",!0)},o.hasOption=function(e){return a.hasOwnProperty(e)},t.$on("$destroy",function(){o.renderUnknownOption=p})}],link:function(s,l,u,h){function c(e,t,i,n){i.$render=function(){var e=i.$viewValue;n.hasOption(e)?(C.parent()&&C.remove(),t.val(e),""===e&&p.prop("selected",!0)):v(e)&&p?t.val(""):n.renderUnknownOption(e)},t.bind("change",function(){e.$apply(function(){C.parent()&&C.remove(),i.$setViewValue(t.val())})})}function f(e,t,i){var n;i.$render=function(){var e=new _e(i.$viewValue);o(t.find("option"),function(t){t.selected=y(e.get(t.value))})},e.$watch(function(){I(n,i.$viewValue)||(n=O(i.$viewValue),i.$render())}),t.bind("change",function(){e.$apply(function(){var e=[];o(t.find("option"),function(t){t.selected&&e.push(t.value)}),i.$setViewValue(e)})})}function d(t,o,s){function l(){var e,n,r,l,u,g,b,C,T,E,A,P,L,D,N={"":[]},R=[""],O=s.$modelValue,F=m(t)||[],I=f?a(F):F,k={},B=!1;if(x)if(v&&M(O)){B=new _e([]);for(var V=0;V<O.length;V++)k[c]=O[V],B.put(v(t,k),O[V])}else B=new _e(O);for(E=0;C=I.length,C>E;E++){if(k[c]=F[f?k[f]=I[E]:E],e=d(t,k)||"",(n=N[e])||(n=N[e]=[],R.push(e)),x)A=B.remove(v?v(t,k):p(t,k))!=i;else{if(v){var U={};U[c]=O,A=v(t,U)===v(t,k)}else A=O===p(t,k);B=B||A}D=h(t,k),D=D===i?"":D,n.push({id:v?v(t,k):f?I[E]:E,label:D,selected:A})}for(x||(w||null===O?N[""].unshift({id:"",label:"",selected:!B}):B||N[""].unshift({id:"?",label:"",selected:!0})),T=0,b=R.length;b>T;T++){for(e=R[T],n=N[e],y.length<=T?(l={element:S.clone().attr("label",e),label:n.label},u=[l],y.push(u),o.append(l.element)):(u=y[T],l=u[0],l.label!=e&&l.element.attr("label",l.label=e)),P=null,E=0,C=n.length;C>E;E++)r=n[E],(g=u[E+1])?(P=g.element,g.label!==r.label&&P.text(g.label=r.label),g.id!==r.id&&P.val(g.id=r.id),P[0].selected!==r.selected&&P.prop("selected",g.selected=r.selected)):(""===r.id&&w?L=w:(L=_.clone()).val(r.id).attr("selected",r.selected).text(r.label),u.push(g={element:L,label:r.label,id:r.id,selected:r.selected}),P?P.after(L):l.element.append(L),P=L);for(E++;u.length>E;)u.pop().element.remove()}for(;y.length>T;)y.pop()[0].element.remove()}var u;if(!(u=b.match(r)))throw Error("Expected ngOptions in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_ (track by _expr_)?' but got '"+b+"'.");var h=n(u[2]||u[1]),c=u[4]||u[6],f=u[5],d=n(u[3]||""),p=n(u[2]?u[1]:c),m=n(u[7]),g=u[8],v=g?n(u[8]):null,y=[[{element:o,label:""}]];w&&(e(w)(t),w.removeClass("ng-scope"),w.remove()),o.html(""),o.bind("change",function(){t.$apply(function(){var e,n,r,a,l,u,h,d,g=m(t)||[],b={};if(x){for(r=[],u=0,d=y.length;d>u;u++)for(e=y[u],l=1,h=e.length;h>l;l++)if((a=e[l].element)[0].selected){if(n=a.val(),f&&(b[f]=n),v)for(var w=0;w<g.length&&(b[c]=g[w],v(t,b)!=n);w++);else b[c]=g[n];r.push(p(t,b))}}else if(n=o.val(),"?"==n)r=i;else if(""==n)r=null;else if(v){for(var w=0;w<g.length;w++)if(b[c]=g[w],v(t,b)==n){r=p(t,b);break}}else b[c]=g[n],f&&(b[f]=n),r=p(t,b);s.$setViewValue(r)})}),s.$render=l,t.$watch(l)}if(h[1]){for(var p,m=h[0],g=h[1],x=u.multiple,b=u.ngOptions,w=!1,_=Yt(t.createElement("option")),S=Yt(t.createElement("optgroup")),C=_.clone(),T=0,E=l.children(),A=E.length;A>T;T++)if(""==E[T].value){p=w=E.eq(T);break}if(m.init(g,w,C),x&&(u.required||u.ngRequired)){var P=function(e){return g.$setValidity("required",!u.required||e&&e.length),e};g.$parsers.push(P),g.$formatters.unshift(P),u.$observe("required",function(){P(g.$viewValue)})}b?d(s,l,g):x?f(s,l,g):c(s,l,g,m)}}}}],In=["$interpolate",function(e){var t={addOption:p,removeOption:p};return{restrict:"E",priority:100,compile:function(i,n){if(v(n.value)){var r=e(i.text(),!0);r||n.$set("value",i.text())}return function(e,i,n){var o="$selectController",a=i.parent(),s=a.data(o)||a.parent().data(o);s&&s.databound?i.prop("selected",!1):s=t,r?e.$watch(r,function(e,t){n.$set("value",e),e!==t&&s.removeOption(t),s.addOption(e)}):s.addOption(n.value),i.bind("$destroy",function(){s.removeOption(n.value)})}}}}],kn=g({restrict:"E",terminal:!0});Q(),ie(ri),Yt(t).ready(function(){Y(t,K)})}(window,document),angular.element(document).find("head").append('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak{display:none;}ng\\:form{display:block;}</style>'),a("angular",["jquery","canvg","rgbcolor","stackblur","sound"],function(e){return function(){var t;return t||e.angular}}(this));var h={};!function(){function e(e){return"undefined"==typeof e?!1:!0}function t(e,t){for(var i,n=e.split(t=t||","),r=n.length-1;r>=0;r--)'"'==n[r].replace(/"\s+$/,'"').charAt(n[r].length-1)?(i=n[r].replace(/^\s+"/,'"')).length>1&&'"'==i.charAt(0)?n[r]=n[r].replace(/^\s*"|"\s*$/g,"").replace(/""/g,'"'):r?n.splice(r-1,2,[n[r-1],n[r]].join(t)):n=n.shift().split(t).concat(n):n[r].replace(/""/g,'"');return n}h.csv2json=function(i,n){n=n||{};var r=e(n.delim)?n.delim:",",o=i.split("\n"),a=t(o[0],r),s=o.slice(1,o.length),l={};l.headers=a,l.rows=[];for(var u in s)if(s.hasOwnProperty(u)){var h=s[u],c=t(h,r);if(0==h.length)break;var f={};for(var d in c)if(c.hasOwnProperty(d)){var p=c[d];isNaN(1*p)||(p=1*p),f[a[d]]=p}l.rows.push(f)}return l},h.json2csv=function(t,i){i=i||{};var n=e(i.delim)?i.delim:",",r=e(i.textdelim)?i.textdelim:"";if("string"==typeof t)return null;var o="";for(var a in t.headers)if(t.headers.hasOwnProperty(a)){var s=t.headers[a];o+=r+s+r+n}o=o.slice(0,o.length-1),o+="\n";for(var l in t.rows)if(t.rows.hasOwnProperty(l)){var u=t.rows[l];for(var a in t.headers)if(t.headers.hasOwnProperty(a)){var s=t.headers[a],h=u[s];o+="string"==typeof h?r+u[s]+r+n:u[s]+n}o=o.slice(0,o.length-1),o+="\n"}return o=o.slice(0,o.length-1)}}(),a("csv2json",function(){}),function(e,t,i){"use strict";t.module("ngResource",["ng"]).factory("$resource",["$http","$parse",function(e,n){function r(e){return o(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function o(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function a(e,t){this.template=e,this.defaults=t||{},this.urlParams={}}function s(n,r,o){function m(e,t){var i={};return t=c({},r,t),h(t,function(t,n){d(t)&&(t=t()),i[n]=t&&t.charAt&&"@"==t.charAt(0)?p(e,t.substr(1)):t}),i}function g(e){f(e||{},this)}var v=new a(n);return o=c({},l,o),h(o,function(n,r){n.method=t.uppercase(n.method);var o="POST"==n.method||"PUT"==n.method||"PATCH"==n.method;g[r]=function(t,i,r,a){function s(){w.$resolved=!0}var l,p,y={},x=u,b=null;switch(arguments.length){case 4:b=a,x=r;case 3:case 2:if(!d(i)){y=t,l=i,x=r;break}if(d(t)){x=t,b=i;break}x=i,b=r;case 1:d(t)?x=t:o?l=t:y=t;break;case 0:break;default:throw"Expected between 0-4 arguments [params, data, success, error], got "+arguments.length+" arguments."}var p,w=this instanceof g?this:n.isArray?[]:new g(l),_={};return h(n,function(e,t){"params"!=t&&"isArray"!=t&&(_[t]=f(e))}),_.data=l,v.setUrlParams(_,c({},m(l,n.params||{}),y),n.url),p=e(_),w.$resolved=!1,p.then(s,s),w.$then=p.then(function(e){var t=e.data,i=w.$then,r=w.$resolved;return t&&(n.isArray?(w.length=0,h(t,function(e){w.push(new g(e))})):(f(t,w),w.$then=i,w.$resolved=r)),(x||u)(w,e.headers),e.resource=w,e},b).then,w},g.prototype["$"+r]=function(e,t,n){var a,s=m(this),l=u;switch(arguments.length){case 3:s=e,l=t,a=n;break;case 2:case 1:d(e)?(l=e,a=t):(s=e,l=t||u);case 0:break;default:throw"Expected between 1-3 arguments [params, success, error], got "+arguments.length+" arguments."}var h=o?this:i;g[r].call(this,s,h,l,a)}}),g.bind=function(e){return s(n,c({},r,e),o)},g}var l={get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}},u=t.noop,h=t.forEach,c=t.extend,f=t.copy,d=t.isFunction,p=function(e,t){return n(t)(e)};return a.prototype={setUrlParams:function(e,i,n){var o,a,s=this,l=n||s.template,u=s.urlParams={};h(l.split(/\W/),function(e){e&&new RegExp("(^|[^\\\\]):"+e+"(\\W|$)").test(l)&&(u[e]=!0)}),l=l.replace(/\\:/g,":"),i=i||{},h(s.urlParams,function(e,n){o=i.hasOwnProperty(n)?i[n]:s.defaults[n],t.isDefined(o)&&null!==o?(a=r(o),l=l.replace(new RegExp(":"+n+"(\\W|$)","g"),a+"$1")):l=l.replace(new RegExp("(/?):"+n+"(\\W|$)","g"),function(e,t,i){return"/"==i.charAt(0)?i:t+i})}),l=l.replace(/\/+$/,""),l=l.replace(/\/\.(?=\w+($|\?))/,"."),e.url=l.replace(/\/\\\./,"/."),h(i,function(t,i){s.urlParams[i]||(e.params=e.params||{},e.params[i]=t)})}},s}])}(window,window.angular),a("angular_resource",["angular"],function(e){return function(){var t;return t||e.angular_resource}}(this)),a("appmodule",["angular","angular_resource"],function(){var e;return e=angular.module("app",["ngResource"]),e.config(["$routeProvider","$locationProvider",function(e,t){return t.html5Mode(!1)}])});var c={REVISION:"62"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},c.extend=function(e,t){if(Object.keys)for(var i=Object.keys(t),n=0,r=i.length;r>n;n++){var o=i[n];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else{var a={}.hasOwnProperty;for(var o in t)a.call(t,o)&&(e[o]=t[o])}return e},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!self.requestAnimationFrame;++i)self.requestAnimationFrame=self[t[i]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[i]+"CancelAnimationFrame"]||self[t[i]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var i=Date.now(),n=Math.max(0,16-(i-e)),r=self.setTimeout(function(){t(i+n)},n);return e=i+n,r}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),c.CullFaceNone=0,c.CullFaceBack=1,c.CullFaceFront=2,c.CullFaceFrontBack=3,c.FrontFaceDirectionCW=0,c.FrontFaceDirectionCCW=1,c.BasicShadowMap=0,c.PCFShadowMap=1,c.PCFSoftShadowMap=2,c.FrontSide=0,c.BackSide=1,c.DoubleSide=2,c.NoShading=0,c.FlatShading=1,c.SmoothShading=2,c.NoColors=0,c.FaceColors=1,c.VertexColors=2,c.NoBlending=0,c.NormalBlending=1,c.AdditiveBlending=2,c.SubtractiveBlending=3,c.MultiplyBlending=4,c.CustomBlending=5,c.AddEquation=100,c.SubtractEquation=101,c.ReverseSubtractEquation=102,c.ZeroFactor=200,c.OneFactor=201,c.SrcColorFactor=202,c.OneMinusSrcColorFactor=203,c.SrcAlphaFactor=204,c.OneMinusSrcAlphaFactor=205,c.DstAlphaFactor=206,c.OneMinusDstAlphaFactor=207,c.DstColorFactor=208,c.OneMinusDstColorFactor=209,c.SrcAlphaSaturateFactor=210,c.MultiplyOperation=0,c.MixOperation=1,c.AddOperation=2,c.UVMapping=function(){},c.CubeReflectionMapping=function(){},c.CubeRefractionMapping=function(){},c.SphericalReflectionMapping=function(){},c.SphericalRefractionMapping=function(){},c.RepeatWrapping=1e3,c.ClampToEdgeWrapping=1001,c.MirroredRepeatWrapping=1002,c.NearestFilter=1003,c.NearestMipMapNearestFilter=1004,c.NearestMipMapLinearFilter=1005,c.LinearFilter=1006,c.LinearMipMapNearestFilter=1007,c.LinearMipMapLinearFilter=1008,c.UnsignedByteType=1009,c.ByteType=1010,c.ShortType=1011,c.UnsignedShortType=1012,c.IntType=1013,c.UnsignedIntType=1014,c.FloatType=1015,c.UnsignedShort4444Type=1016,c.UnsignedShort5551Type=1017,c.UnsignedShort565Type=1018,c.AlphaFormat=1019,c.RGBFormat=1020,c.RGBAFormat=1021,c.LuminanceFormat=1022,c.LuminanceAlphaFormat=1023,c.RGB_S3TC_DXT1_Format=2001,c.RGBA_S3TC_DXT1_Format=2002,c.RGBA_S3TC_DXT3_Format=2003,c.RGBA_S3TC_DXT5_Format=2004,c.Color=function(e){return void 0!==e&&this.set(e),this},c.Color.prototype={constructor:c.Color,r:1,g:1,b:1,set:function(e){return e instanceof c.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var n=function(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+6*(t-e)*(2/3-i):e},r=.5>=i?i*(1+t):i+t-i*t,o=2*i-r;this.r=n(o,r,e+1/3),this.g=n(o,r,e),this.b=n(o,r,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(c.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t,i,n=this.r,r=this.g,o=this.b,a=Math.max(n,r,o),s=Math.min(n,r,o),l=(s+a)/2;if(s===a)t=0,i=0;else{var u=a-s;switch(i=.5>=l?u/(a+s):u/(2-a-s),a){case n:t=(r-o)/u+(o>r?6:0);break;case r:t=(o-n)/u+2;break;case o:t=(n-r)/u+4}t/=6}return e.h=t,e.s=i,e.l=l,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new c.Color).setRGB(this.r,this.g,this.b)}},c.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},c.Quaternion=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1},c.Quaternion.prototype={constructor:c.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(e){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){
if(e instanceof c.Euler==!1)throw new Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var i=Math.cos(e._x/2),n=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"YXZ"===e.order?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"ZXY"===e.order?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"ZYX"===e.order?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"YZX"===e.order?(this._x=o*n*r+i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r-o*a*s):"XZY"===e.order&&(this._x=o*n*r-i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r+o*a*s),t!==!1&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._updateEuler(),this},setFromRotationMatrix:function(e){var t,i=e.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],l=i[9],u=i[2],h=i[6],c=i[10],f=n+s+c;return f>0?(t=.5/Math.sqrt(f+1),this._w=.25/t,this._x=(h-l)*t,this._y=(o-u)*t,this._z=(a-r)*t):n>s&&n>c?(t=2*Math.sqrt(1+n-s-c),this._w=(h-l)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+u)/t):s>c?(t=2*Math.sqrt(1+s-n-c),this._w=(o-u)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(l+h)/t):(t=2*Math.sqrt(1+c-n-s),this._w=(a-r)/t,this._x=(o+u)/t,this._y=(l+h)/t,this._z=.25*t),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=i*u+o*a+n*l-r*s,this._y=n*u+o*s+r*a-i*l,this._z=r*u+o*l+i*s-n*a,this._w=o*u-i*a-n*s-r*l,this._updateEuler(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this._x,n=this._y,r=this._z,o=this._w,a=o*e._w+i*e._x+n*e._y+r*e._z;if(0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var u=Math.sin((1-t)*s)/l,h=Math.sin(t*s)/l;return this._w=o*u+this._w*h,this._x=i*u+this._x*h,this._y=n*u+this._y*h,this._z=r*u+this._z*h,this._updateEuler(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new c.Quaternion(this._x,this._y,this._z,this._w)}},c.Quaternion.slerp=function(e,t,i,n){return i.copy(e).slerp(t,n)},c.Vector2=function(e,t){this.x=e||0,this.y=t||0},c.Vector2.prototype={constructor:c.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new c.Vector2(this.x,this.y)}},c.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},c.Vector3.prototype={constructor:c.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*i,u=s*i+a*t-r*n,h=s*n+r*i-o*t,c=-r*t-o*i-a*n;return this.x=l*s+c*-r+u*-a-h*-o,this.y=u*s+c*-o+h*-r-l*-a,this.z=h*s+c*-a+l*-o-u*-r,this},transformDirection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(c.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=n,this},getColumnFromMatrix:function(e,t){var i=4*e,n=t.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new c.Vector3(this.x,this.y,this.z)}},c.extend(c.Vector3.prototype,{applyEuler:function(){var e=new c.Quaternion;return function(t){return t instanceof c.Euler==!1&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e=new c.Quaternion;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i)),this}}(),projectOnVector:function(){var e=new c.Vector3;return function(t){e.copy(t).normalize();var i=this.dot(e);return this.copy(e).multiplyScalar(i)}}(),projectOnPlane:function(){var e=new c.Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new c.Vector3;return function(t){return e.copy(this).projectOnVector(t).multiplyScalar(2),this.subVectors(e,this)}}()}),c.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},c.Vector4.prototype={constructor:c.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,r,o=.01,a=.1,s=e.elements,l=s[0],u=s[4],h=s[8],c=s[1],f=s[5],d=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(u-c)<o&&Math.abs(h-p)<o&&Math.abs(d-m)<o){if(Math.abs(u+c)<a&&Math.abs(h+p)<a&&Math.abs(d+m)<a&&Math.abs(l+f+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(f+1)/2,x=(g+1)/2,b=(u+c)/4,w=(h+p)/4,_=(d+m)/4;return v>y&&v>x?o>v?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(v),n=b/i,r=w/i):y>x?o>y?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(y),i=b/n,r=_/n):o>x?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(x),i=w/r,n=_/r),this.set(i,n,r,t),this}var M=Math.sqrt((m-d)*(m-d)+(h-p)*(h-p)+(c-u)*(c-u));return Math.abs(M)<.001&&(M=1),this.x=(m-d)/M,this.y=(h-p)/M,this.z=(c-u)/M,this.w=Math.acos((l+f+g-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new c.Vector4(this.x,this.y,this.z,this.w)}},c.Euler=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||c.Euler.DefaultOrder},c.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],c.Euler.DefaultOrder="XYZ",c.Euler.prototype={constructor:c.Euler,_x:0,_y:0,_z:0,_order:c.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.elements,r=n[0],o=n[4],a=n[8],s=n[1],l=n[5],u=n[9],h=n[2],c=n[6],f=n[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(a)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(c,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-h,r),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(c)),Math.abs(c)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,r))):"ZYX"===t?(this._y=Math.asin(-i(h)),Math.abs(h)<.99999?(this._x=Math.atan2(c,f),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(i(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===t?(this._z=Math.asin(-i(o)),Math.abs(o)<.99999?(this._x=Math.atan2(c,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,i){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,o=e.y*e.y,a=e.z*e.z,s=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-r-o+a),this._y=Math.asin(n(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+r-o-a)):"YXZ"===t?(this._x=Math.asin(n(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-r-o+a),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-r+o-a)):"ZXY"===t?(this._x=Math.asin(n(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-r-o+a),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-r+o-a)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-r-o+a),this._y=Math.asin(n(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+r-o-a)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-r+o-a),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+r-o-a),this._z=Math.asin(n(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-r+o-a),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+r-o-a),this._z=Math.asin(n(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,i!==!1&&this._updateQuaternion(),this},reorder:function(){var e=new c.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new c.Euler(this._x,this._y,this._z,this._order)}},c.Line3=function(e,t){this.start=void 0!==e?e:new c.Vector3,this.end=void 0!==t?t:new c.Vector3},c.Line3.prototype={constructor:c.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new c.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new c.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new c.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new c.Vector3,t=new c.Vector3;return function(i,n){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),o=t.dot(e),a=o/r;return n&&(a=c.Math.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,i){var n=this.closestPointToPointParameter(e,t),r=i||new c.Vector3;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new c.Line3).copy(this)}},c.Box2=function(e,t){this.min=void 0!==e?e:new c.Vector2(1/0,1/0),this.max=void 0!==t?t:new c.Vector2(-(1/0),-(1/0))},c.Box2.prototype={constructor:c.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new c.Vector2;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new c.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new c.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e){return new c.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var i=t||new c.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new c.Vector2;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new c.Box2).copy(this)}},c.Box3=function(e,t){this.min=void 0!==e?e:new c.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new c.Vector3(-(1/0),-(1/0),-(1/0))},c.Box3.prototype={constructor:c.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)this.addPoint(e[i])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new c.Vector3;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new c.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var n=t.geometry.vertices,r=0,o=n.length;o>r;r++)e.copy(n[r]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new c.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new c.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e){return new c.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var i=t||new c.Vector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new c.Vector3;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),getBoundingSphere:function(){var e=new c.Vector3;return function(t){var i=t||new c.Sphere;return i.center=this.center(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new c.Box3).copy(this)}},c.Matrix3=function(e,t,i,n,r,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,n||0,void 0!==r?r:1,o||0,a||0,s||0,void 0!==l?l:1)},c.Matrix3.prototype={constructor:c.Matrix3,set:function(e,t,i,n,r,o,a,s,l){var u=this.elements;return u[0]=e,u[3]=t,u[6]=i,u[1]=n,u[4]=r,u[7]=o,u[2]=a,u[5]=s,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new c.Vector3;return function(t){for(var i=0,n=t.length;n>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyMatrix3(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-i*r*u+i*a*s+n*r*l-n*o*s},getInverse:function(e,t){var i=e.elements,n=this.elements;n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4];var r=i[0]*n[0]+i[1]*n[3]+i[2]*n[6];if(0===r){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new c.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},c.Matrix4=function(e,t,i,n,r,o,a,s,l,u,h,c,f,d,p,m){this.elements=new Float32Array(16);var g=this.elements;g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=i||0,g[12]=n||0,g[1]=r||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=u||0,g[10]=void 0!==h?h:1,g[14]=c||0,g[3]=f||0,g[7]=d||0,g[11]=p||0,g[15]=void 0!==m?m:1},c.Matrix4.prototype={constructor:c.Matrix4,set:function(e,t,i,n,r,o,a,s,l,u,h,c,f,d,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=h,g[14]=c,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(){var e=new c.Vector3;return function(t){var i=this.elements,n=t.elements,r=1/e.set(n[0],n[1],n[2]).length(),o=1/e.set(n[4],n[5],n[6]).length(),a=1/e.set(n[8],n[9],n[10]).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*a,i[9]=n[9]*a,i[10]=n[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof c.Euler==!1&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(n),l=Math.sin(n),u=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){var f=o*u,d=o*h,p=a*u,m=a*h;
t[0]=s*u,t[4]=-s*h,t[8]=l,t[1]=d+p*l,t[5]=f-m*l,t[9]=-a*s,t[2]=m-f*l,t[6]=p+d*l,t[10]=o*s}else if("YXZ"===e.order){var g=s*u,v=s*h,y=l*u,x=l*h;t[0]=g+x*a,t[4]=y*a-v,t[8]=o*l,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=v*a-y,t[6]=x+g*a,t[10]=o*s}else if("ZXY"===e.order){var g=s*u,v=s*h,y=l*u,x=l*h;t[0]=g-x*a,t[4]=-o*h,t[8]=y+v*a,t[1]=v+y*a,t[5]=o*u,t[9]=x-g*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){var f=o*u,d=o*h,p=a*u,m=a*h;t[0]=s*u,t[4]=p*l-d,t[8]=f*l+m,t[1]=s*h,t[5]=m*l+f,t[9]=d*l-p,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var b=o*s,w=o*l,_=a*s,M=a*l;t[0]=s*u,t[4]=M-b*h,t[8]=_*h+w,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=w*h+_,t[10]=b-M*h}else if("XZY"===e.order){var b=o*s,w=o*l,_=a*s,M=a*l;t[0]=s*u,t[4]=-h,t[8]=l*u,t[1]=b*h+M,t[5]=o*u,t[9]=w*h-_,t[2]=_*h-w,t[6]=a*u,t[10]=M*h+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,a=i+i,s=n+n,l=r+r,u=i*a,h=i*s,c=i*l,f=n*s,d=n*l,p=r*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(f+p),t[4]=h-v,t[8]=c+g,t[1]=h+v,t[5]=1-(u+p),t[9]=d-m,t[2]=c-g,t[6]=d+m,t[10]=1-(u+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new c.Vector3,t=new c.Vector3,i=new c.Vector3;return function(n,r,o){var a=this.elements;return i.subVectors(n,r).normalize(),0===i.length()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.length()&&(i.x+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),a[0]=e.x,a[4]=t.x,a[8]=i.x,a[1]=e.y,a[5]=t.y,a[9]=i.y,a[2]=e.z,a[6]=t.z,a[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],u=i[1],h=i[5],c=i[9],f=i[13],d=i[2],p=i[6],m=i[10],g=i[14],v=i[3],y=i[7],x=i[11],b=i[15],w=n[0],_=n[4],M=n[8],S=n[12],C=n[1],T=n[5],E=n[9],A=n[13],P=n[2],L=n[6],D=n[10],N=n[14],R=n[3],O=n[7],F=n[11],I=n[15];return r[0]=o*w+a*C+s*P+l*R,r[4]=o*_+a*T+s*L+l*O,r[8]=o*M+a*E+s*D+l*F,r[12]=o*S+a*A+s*N+l*I,r[1]=u*w+h*C+c*P+f*R,r[5]=u*_+h*T+c*L+f*O,r[9]=u*M+h*E+c*D+f*F,r[13]=u*S+h*A+c*N+f*I,r[2]=d*w+p*C+m*P+g*R,r[6]=d*_+p*T+m*L+g*O,r[10]=d*M+p*E+m*D+g*F,r[14]=d*S+p*A+m*N+g*I,r[3]=v*w+y*C+x*P+b*R,r[7]=v*_+y*T+x*L+b*O,r[11]=v*M+y*E+x*D+b*F,r[15]=v*S+y*A+x*N+b*I,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new c.Vector3;return function(t){for(var i=0,n=t.length;n>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyProjection(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],h=e[6],c=e[10],f=e[14],d=e[3],p=e[7],m=e[11],g=e[15];return d*(+r*s*h-n*l*h-r*a*c+i*l*c+n*a*f-i*s*f)+p*(+t*s*f-t*l*c+r*o*c-n*o*f+n*l*u-r*s*u)+m*(+t*l*h-t*a*f-r*o*h+i*o*f+r*a*u-i*l*u)+g*(-n*a*u-t*s*h+t*a*c+n*o*h-i*o*c+i*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=new c.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[4],a=n[8],s=n[12],l=n[1],u=n[5],h=n[9],c=n[13],f=n[2],d=n[6],p=n[10],m=n[14],g=n[3],v=n[7],y=n[11],x=n[15];i[0]=h*m*v-c*p*v+c*d*y-u*m*y-h*d*x+u*p*x,i[4]=s*p*v-a*m*v-s*d*y+o*m*y+a*d*x-o*p*x,i[8]=a*c*v-s*h*v+s*u*y-o*c*y-a*u*x+o*h*x,i[12]=s*h*d-a*c*d-s*u*p+o*c*p+a*u*m-o*h*m,i[1]=c*p*g-h*m*g-c*f*y+l*m*y+h*f*x-l*p*x,i[5]=a*m*g-s*p*g+s*f*y-r*m*y-a*f*x+r*p*x,i[9]=s*h*g-a*c*g-s*l*y+r*c*y+a*l*x-r*h*x,i[13]=a*c*f-s*h*f+s*l*p-r*c*p-a*l*m+r*h*m,i[2]=u*m*g-c*d*g+c*f*v-l*m*v-u*f*x+l*d*x,i[6]=s*d*g-o*m*g-s*f*v+r*m*v+o*f*x-r*d*x,i[10]=o*c*g-s*u*g+s*l*v-r*c*v-o*l*x+r*u*x,i[14]=s*u*f-o*c*f-s*l*d+r*c*d+o*l*m-r*u*m,i[3]=h*d*g-u*p*g-h*f*v+l*p*v+u*f*y-l*d*y,i[7]=o*p*g-a*d*g+a*f*v-r*p*v-o*f*y+r*d*y,i[11]=a*u*g-o*h*g-a*l*v+r*h*v+o*l*y-r*u*y,i[15]=o*h*f-a*u*f+a*l*d-r*h*d-o*l*p+r*u*p;var b=r*i[0]+l*i[4]+f*i[8]+g*i[12];if(0==b){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,n)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,s=e.z,l=r*o,u=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,u*a+i,u*s-n*o,0,l*s-n*a,u*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new c.Vector3,t=new c.Matrix4;return function(i,n,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var u=1/a,h=1/s,c=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=c,t.elements[9]*=c,t.elements[10]*=c,n.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makeFrustum:function(e,t,i,n,r,o){var a=this.elements,s=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i),c=-(o+r)/(o-r),f=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,i,n){var r=i*Math.tan(c.Math.degToRad(.5*e)),o=-r,a=o*t,s=r*t;return this.makeFrustum(a,s,o,r,i,n)},makeOrthographic:function(e,t,i,n,r,o){var a=this.elements,s=t-e,l=i-n,u=o-r,h=(t+e)/s,c=(i+n)/l,f=(o+r)/u;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2/u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new c.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},c.Ray=function(e,t){this.origin=void 0!==e?e:new c.Vector3,this.direction=void 0!==t?t:new c.Vector3},c.Ray.prototype={constructor:c.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var i=t||new c.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new c.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new c.Vector3;i.subVectors(e,this.origin);var n=i.dot(this.direction);return 0>n?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new c.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return 0>i?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,i,n){var r,o,a,s,l=e.clone().add(t).multiplyScalar(.5),u=t.clone().sub(e).normalize(),h=.5*e.distanceTo(t),c=this.origin.clone().sub(l),f=-this.direction.dot(u),d=c.dot(this.direction),p=-c.dot(u),m=c.lengthSq(),g=Math.abs(1-f*f);if(g>=0)if(r=f*p-d,o=f*d-p,s=h*g,r>=0)if(o>=-s)if(s>=o){var v=1/g;r*=v,o*=v,a=r*(r+f*o+2*d)+o*(f*r+o+2*p)+m}else o=h,r=Math.max(0,-(f*o+d)),a=-r*r+o*(o+2*p)+m;else o=-h,r=Math.max(0,-(f*o+d)),a=-r*r+o*(o+2*p)+m;else-s>=o?(r=Math.max(0,-(-f*h+d)),o=r>0?-h:Math.min(Math.max(-h,-p),h),a=-r*r+o*(o+2*p)+m):s>=o?(r=0,o=Math.min(Math.max(-h,-p),h),a=o*(o+2*p)+m):(r=Math.max(0,-(f*h+d)),o=r>0?h:Math.min(Math.max(-h,-p),h),a=-r*r+o*(o+2*p)+m);else o=f>0?-h:h,r=Math.max(0,-(f*o+d)),a=-r*r+o*(o+2*p)+m;return i&&i.copy(this.direction.clone().multiplyScalar(r).add(this.origin)),n&&n.copy(u.clone().multiplyScalar(o).add(l)),a},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var i=e.normal.dot(this.direction);return 0>i*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},isIntersectionBox:function(){var e=new c.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var i,n,r,o,a,s,l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(i=(e.min.x-c.x)*l,n=(e.max.x-c.x)*l):(i=(e.max.x-c.x)*l,n=(e.min.x-c.x)*l),u>=0?(r=(e.min.y-c.y)*u,o=(e.max.y-c.y)*u):(r=(e.max.y-c.y)*u,o=(e.min.y-c.y)*u),i>o||r>n?null:((r>i||i!==i)&&(i=r),(n>o||n!==n)&&(n=o),h>=0?(a=(e.min.z-c.z)*h,s=(e.max.z-c.z)*h):(a=(e.max.z-c.z)*h,s=(e.min.z-c.z)*h),i>s||a>n?null:((a>i||i!==i)&&(i=a),(n>s||n!==n)&&(n=s),0>n?null:this.at(i>=0?i:n,t)))},intersectTriangle:function(){var e=new c.Vector3,t=new c.Vector3,i=new c.Vector3,n=new c.Vector3;return function(r,o,a,s,l){t.subVectors(o,r),i.subVectors(a,r),n.crossVectors(t,i);var u,h=this.direction.dot(n);if(h>0){if(s)return null;u=1}else{if(!(0>h))return null;u=-1,h=-h}e.subVectors(this.origin,r);var c=u*this.direction.dot(i.crossVectors(e,i));if(0>c)return null;var f=u*this.direction.dot(t.cross(e));if(0>f)return null;if(c+f>h)return null;var d=-u*e.dot(n);return 0>d?null:this.at(d/h,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new c.Ray).copy(this)}},c.Sphere=function(e,t){this.center=void 0!==e?e:new c.Vector3,this.radius=void 0!==t?t:0},c.Sphere.prototype={constructor:c.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new c.Box3;return function(t,i){var n=this.center;void 0!==i?n.copy(i):e.setFromPoints(t).center(n);for(var r=0,o=0,a=t.length;a>o;o++)r=Math.max(r,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),n=t||new c.Vector3;return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new c.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new c.Sphere).copy(this)}},c.Frustum=function(e,t,i,n,r,o){this.planes=[void 0!==e?e:new c.Plane,void 0!==t?t:new c.Plane,void 0!==i?i:new c.Plane,void 0!==n?n:new c.Plane,void 0!==r?r:new c.Plane,void 0!==o?o:new c.Plane]},c.Frustum.prototype={constructor:c.Frustum,set:function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=i[5],u=i[6],h=i[7],c=i[8],f=i[9],d=i[10],p=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(a-n,h-s,p-c,y-m).normalize(),t[1].setComponents(a+n,h+s,p+c,y+m).normalize(),t[2].setComponents(a+r,h+l,p+f,y+g).normalize(),t[3].setComponents(a-r,h-l,p-f,y-g).normalize(),t[4].setComponents(a-o,h-u,p-d,y-v).normalize(),t[5].setComponents(a+o,h+u,p+d,y+v).normalize(),this},intersectsObject:function(){var e=new c.Sphere;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;6>r;r++){var o=t[r].distanceToPoint(i);if(n>o)return!1}return!0},intersectsBox:function(){var e=new c.Vector3,t=new c.Vector3;return function(i){for(var n=this.planes,r=0;6>r;r++){var o=n[r];e.x=o.normal.x>0?i.min.x:i.max.x,t.x=o.normal.x>0?i.max.x:i.min.x,e.y=o.normal.y>0?i.min.y:i.max.y,t.y=o.normal.y>0?i.max.y:i.min.y,e.z=o.normal.z>0?i.min.z:i.max.z,t.z=o.normal.z>0?i.max.z:i.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(0>a&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new c.Frustum).copy(this)}},c.Plane=function(e,t){this.normal=void 0!==e?e:new c.Vector3(1,0,0),this.constant=void 0!==t?t:0},c.Plane.prototype={constructor:c.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new c.Vector3,t=new c.Vector3;return function(i,n,r){var o=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e),n=t||new c.Vector3;return n.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return 0>t&&i>0||0>i&&t>0},intersectLine:function(){var e=new c.Vector3;return function(t,i){var n=i||new c.Vector3,r=t.delta(e),o=this.normal.dot(r);if(0==o)return 0==this.distanceToPoint(t.start)?n.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/o;return 0>a||a>1?void 0:n.copy(r).multiplyScalar(a).add(t.start)}}(),coplanarPoint:function(e){var t=e||new c.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new c.Vector3,t=new c.Vector3;return function(i,n){n=n||(new c.Matrix3).getNormalMatrix(i);var r=e.copy(this.normal).applyMatrix3(n),o=this.coplanarPoint(t);return o.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(r,o),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new c.Plane).copy(this)}},c.Math={PI2:2*Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;36>r;r++)8==r||13==r||18==r||23==r?i[r]="-":14==r?i[r]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,i[r]=t[19==r?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},smoothstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},c.Spline=function(e){function t(e,t,i,n,r,o,a){var s=.5*(i-e),l=.5*(n-t);return(2*(t-i)+s+l)*a+(-3*(t-i)-2*s-l)*o+s*r+t}this.points=e;var i,n,r,o,a,s,l,u,h,f=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,n=Math.floor(i),r=i-n,f[0]=0===n?n:n-1,f[1]=n,f[2]=n>this.points.length-2?this.points.length-1:n+1,f[3]=n>this.points.length-3?this.points.length-1:n+2,s=this.points[f[0]],l=this.points[f[1]],u=this.points[f[2]],h=this.points[f[3]],o=r*r,a=r*o,d.x=t(s.x,l.x,u.x,h.x,r,o,a),d.y=t(s.y,l.y,u.y,h.y,r,o,a),d.z=t(s.z,l.z,u.z,h.z,r,o,a),d},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;i>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,i,n,r,o=0,a=0,s=0,l=new c.Vector3,u=new c.Vector3,h=[],f=0;for(h[0]=0,e||(e=100),n=this.points.length*e,l.copy(this.points[0]),t=1;n>t;t++)i=t/n,r=this.getPoint(i),u.copy(r),f+=u.distanceTo(l),l.copy(r),o=(this.points.length-1)*i,a=Math.floor(o),a!=s&&(h[a]=f,s=a);return h[h.length]=f,{chunks:h,total:f}},this.reparametrizeByArcLength=function(e){var t,i,n,r,o,a,s,l,u=[],h=new c.Vector3,f=this.getLength();for(u.push(h.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=f.chunks[t]-f.chunks[t-1],s=Math.ceil(e*a/f.total),r=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;s-1>i;i++)n=r+i*(1/s)*(o-r),l=this.getPoint(n),u.push(h.copy(l).clone());u.push(h.copy(this.points[t]).clone())}this.points=u}},c.Triangle=function(e,t,i){this.a=void 0!==e?e:new c.Vector3,this.b=void 0!==t?t:new c.Vector3,this.c=void 0!==i?i:new c.Vector3},c.Triangle.normal=function(){var e=new c.Vector3;return function(t,i,n,r){var o=r||new c.Vector3;o.subVectors(n,i),e.subVectors(t,i),o.cross(e);var a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}}(),c.Triangle.barycoordFromPoint=function(){var e=new c.Vector3,t=new c.Vector3,i=new c.Vector3;return function(n,r,o,a,s){e.subVectors(a,r),t.subVectors(o,r),i.subVectors(n,r);var l=e.dot(e),u=e.dot(t),h=e.dot(i),f=t.dot(t),d=t.dot(i),p=l*f-u*u,m=s||new c.Vector3;if(0==p)return m.set(-2,-1,-1);var g=1/p,v=(f*h-u*d)*g,y=(l*d-u*h)*g;return m.set(1-v-y,y,v)}}(),c.Triangle.containsPoint=function(){var e=new c.Vector3;return function(t,i,n,r){var o=c.Triangle.barycoordFromPoint(t,i,n,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),c.Triangle.prototype={constructor:c.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new c.Vector3,t=new c.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new c.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return c.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new c.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return c.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return c.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new c.Triangle).copy(this)}},c.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},c.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new c.Vector2(e,t)},c.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},c.Clock.prototype={constructor:c.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},c.EventDispatcher=function(){},c.EventDispatcher.prototype={constructor:c.EventDispatcher,apply:function(e){e.addEventListener=c.EventDispatcher.prototype.addEventListener,e.hasEventListener=c.EventDispatcher.prototype.hasEventListener,e.removeEventListener=c.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=c.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}},dispatchEvent:function(){var e=[];return function(t){if(void 0!==this._listeners){var i=this._listeners,n=i[t.type];if(void 0!==n){t.target=this;for(var r=n.length,o=0;r>o;o++)e[o]=n[o];for(var o=0;r>o;o++)e[o].call(this,t)}}}}()},function(e){e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),this.near=n||0,this.far=r||1/0};var t=new e.Sphere,i=new e.Ray,n=(new e.Plane,new e.Vector3,new e.Vector3),r=new e.Matrix4,o=function(e,t){return e.distance-t.distance},a=new e.Vector3,s=new e.Vector3,l=new e.Vector3,u=function(o,h,c){if(o instanceof e.Sprite){n.getPositionFromMatrix(o.matrixWorld);var f=h.ray.distanceToPoint(n);if(f>o.scale.x)return c;c.push({distance:f,point:o.position,face:null,object:o})}else if(o instanceof e.LOD){n.getPositionFromMatrix(o.matrixWorld);var f=h.ray.origin.distanceTo(n);u(o.getObjectForDistance(f),h,c)}else if(o instanceof e.Mesh){var d=o.geometry;if(null===d.boundingSphere&&d.computeBoundingSphere(),t.copy(d.boundingSphere),t.applyMatrix4(o.matrixWorld),h.ray.isIntersectionSphere(t)===!1)return c;if(r.getInverse(o.matrixWorld),i.copy(h.ray).applyMatrix4(r),null!==d.boundingBox&&i.isIntersectionBox(d.boundingBox)===!1)return c;if(d instanceof e.BufferGeometry){var p=o.material;if(void 0===p)return c;if(d.dynamic===!1)return c;var m,g,v,y=h.precision;if(void 0!==d.attributes.index)for(var x=d.offsets,b=d.attributes.index.array,w=d.attributes.position.array,_=d.offsets.length,M=d.attributes.index.array.length/3,S=0;_>S;++S)for(var C=x[S].start,T=x[S].count,E=x[S].index,A=C,P=C+T;P>A;A+=3){if(m=E+b[A],g=E+b[A+1],v=E+b[A+2],a.set(w[3*m],w[3*m+1],w[3*m+2]),s.set(w[3*g],w[3*g+1],w[3*g+2]),l.set(w[3*v],w[3*v+1],w[3*v+2]),p.side===e.BackSide)var L=i.intersectTriangle(l,s,a,!0);else var L=i.intersectTriangle(a,s,l,p.side!==e.DoubleSide);if(null!==L){L.applyMatrix4(o.matrixWorld);var f=h.ray.origin.distanceTo(L);y>f||f<h.near||f>h.far||c.push({distance:f,point:L,face:null,faceIndex:null,object:o})}}else for(var x=d.offsets,w=d.attributes.position.array,_=d.offsets.length,M=d.attributes.position.array.length,A=0;M>A;A+=3){if(m=A,g=A+1,v=A+2,a.set(w[3*m],w[3*m+1],w[3*m+2]),s.set(w[3*g],w[3*g+1],w[3*g+2]),l.set(w[3*v],w[3*v+1],w[3*v+2]),p.side===e.BackSide)var L=i.intersectTriangle(l,s,a,!0);else var L=i.intersectTriangle(a,s,l,p.side!==e.DoubleSide);if(null!==L){L.applyMatrix4(o.matrixWorld);var f=h.ray.origin.distanceTo(L);y>f||f<h.near||f>h.far||c.push({distance:f,point:L,face:null,faceIndex:null,object:o})}}}else if(d instanceof e.Geometry)for(var m,g,v,D=o.material instanceof e.MeshFaceMaterial,N=D===!0?o.material.materials:null,y=h.precision,R=d.vertices,O=0,M=d.faces.length;M>O;O++){var F=d.faces[O],p=D===!0?N[F.materialIndex]:o.material;if(void 0!==p){if(m=R[F.a],g=R[F.b],v=R[F.c],p.side===e.BackSide)var L=i.intersectTriangle(v,g,m,!0);else var L=i.intersectTriangle(m,g,v,p.side!==e.DoubleSide);if(null!==L){L.applyMatrix4(o.matrixWorld);var f=h.ray.origin.distanceTo(L);y>f||f<h.near||f>h.far||c.push({distance:f,point:L,face:F,faceIndex:O,object:o})}}}}else if(o instanceof e.Line){var y=h.linePrecision,I=y*y,d=o.geometry;if(null===d.boundingSphere&&d.computeBoundingSphere(),t.copy(d.boundingSphere),t.applyMatrix4(o.matrixWorld),h.ray.isIntersectionSphere(t)===!1)return c;if(r.getInverse(o.matrixWorld),i.copy(h.ray).applyMatrix4(r),d instanceof e.Geometry)for(var R=d.vertices,k=R.length,B=new e.Vector3,V=new e.Vector3,U=o.type===e.LineStrip?1:2,A=0;k-1>A;A+=U){var z=i.distanceSqToSegment(R[A],R[A+1],V,B);if(!(z>I)){var f=i.origin.distanceTo(V);f<h.near||f>h.far||c.push({distance:f,point:B.clone().applyMatrix4(o.matrixWorld),face:null,faceIndex:null,object:o})}}}},h=function(e,t,i){for(var n=e.getDescendants(),r=0,o=n.length;o>r;r++)u(n[r],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return t===!0&&h(e,this,i),u(e,this,i),i.sort(o),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],n=0,r=e.length;r>n;n++)u(e[n],this,i),t===!0&&h(e[n],this,i);return i.sort(o),i}}(c),c.Object3D=function(){this.id=c.Object3DIdCount++,this.uuid=c.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new c.Vector3(0,1,0),this.position=new c.Vector3,this.rotation=new c.Euler,this.quaternion=new c.Quaternion,this.scale=new c.Vector3(1,1,1),this.rotation._quaternion=this.quaternion,this.quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new c.Matrix4,this.matrixWorld=new c.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},c.Object3D.prototype={constructor:c.Object3D,get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(){var e=new c.Matrix4;return function(t){this.matrix.multiplyMatrices(t,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),e.extractRotation(this.matrix),this.quaternion.setFromRotationMatrix(e)}}(),setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new c.Quaternion;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new c.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new c.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new c.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new c.Vector3;return function(t,i){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e);
},translateX:function(){var e=new c.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new c.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new c.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new c.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new c.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this)return void console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");if(e instanceof c.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof c.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof c.Scene&&i.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;i>t;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.id===e)return r;if(t===!0&&(r=r.getObjectById(e,t),void 0!==r))return r}return void 0},getObjectByName:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.name===e)return r;if(t===!0&&(r=r.getObjectByName(e,t),void 0!==r))return r}return void 0},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;i>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){if(void 0===e&&(e=new c.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var i=0;i<this.children.length;i++){var n=this.children[i];e.add(n.clone())}return e}},c.EventDispatcher.prototype.apply(c.Object3D.prototype),c.Object3DIdCount=0,c.Projector=function(){function e(){if(l===b){var e=new c.RenderableObject;return x.push(e),b++,l++,e}return x[l++]}function t(){if(h===_){var e=new c.RenderableVertex;return w.push(e),_++,h++,e}return w[h++]}function i(){if(d===S){var e=new c.RenderableFace3;return M.push(e),S++,d++,e}return M[d++]}function n(){if(m===T){var e=new c.RenderableLine;return C.push(e),T++,m++,e}return C[m++]}function r(){if(v===A){var e=new c.RenderableSprite;return E.push(e),A++,v++,e}return E[v++]}function o(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function a(e,t){var i=0,n=1,r=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return r>=0&&o>=0&&a>=0&&s>=0?!0:0>r&&0>o||0>a&&0>s?!1:(0>r?i=Math.max(i,r/(r-o)):0>o&&(n=Math.min(n,r/(r-o))),0>a?i=Math.max(i,a/(a-s)):0>s&&(n=Math.min(n,a/(a-s))),i>n?!1:(e.lerp(t,i),t.lerp(e,1-n),!0))}var s,l,u,h,f,d,p,m,g,v,y,x=[],b=0,w=[],_=0,M=[],S=0,C=[],T=0,E=[],A=0,P={objects:[],sprites:[],lights:[],elements:[]},L=new c.Vector3,D=new c.Vector4,N=new c.Box3(new c.Vector3(-1,-1,-1),new c.Vector3(1,1,1)),R=new c.Box3,O=new Array(3),F=(new Array(4),new c.Matrix4),I=new c.Matrix4,k=new c.Matrix4,B=new c.Matrix3,V=new c.Matrix3,U=new c.Vector3,z=new c.Frustum,$=new c.Vector4,H=new c.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),I.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(I)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),I.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(I)},this.pickingRay=function(e,t){e.z=-1;var i=new c.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new c.Raycaster(e,i)};var j=function(t){return s=e(),s.id=t.id,s.object=t,null!==t.renderDepth?s.z=t.renderDepth:(L.getPositionFromMatrix(t.matrixWorld),L.applyProjection(I),s.z=L.z),s},W=function(e){if(e.visible!==!1){e instanceof c.Light?P.lights.push(e):e instanceof c.Mesh||e instanceof c.Line?(e.frustumCulled===!1||z.intersectsObject(e)===!0)&&P.objects.push(j(e)):e instanceof c.Sprite&&P.sprites.push(j(e));for(var t=0,i=e.children.length;i>t;t++)W(e.children[t])}},G=function(e,t){l=0,P.objects.length=0,P.sprites.length=0,P.lights.length=0,W(e),t===!0&&P.objects.sort(o)};this.projectScene=function(e,s,l,x){var b,_,M,S,C,T,E,A,L,j,W,X,q,Y,K,Z,Q,J,ee,te,ie,ne,re,oe,ae,se=!1;for(d=0,m=0,v=0,P.elements.length=0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===s.parent&&s.updateMatrixWorld(),F.copy(s.matrixWorldInverse.getInverse(s.matrixWorld)),I.multiplyMatrices(s.projectionMatrix,F),V.getNormalMatrix(F),z.setFromMatrix(I),G(e,l),b=0,_=P.objects.length;_>b;b++)if(q=P.objects[b].object,y=q.matrixWorld,h=0,q instanceof c.Mesh){for(Y=q.geometry,K=Y.vertices,Z=Y.faces,ee=Y.faceVertexUvs,B.getNormalMatrix(y),oe=q.material instanceof c.MeshFaceMaterial,ae=oe===!0?q.material:null,M=0,S=K.length;S>M;M++){u=t(),u.positionWorld.copy(K[M]).applyMatrix4(y),u.positionScreen.copy(u.positionWorld).applyMatrix4(I);var le=1/u.positionScreen.w;u.positionScreen.x*=le,u.positionScreen.y*=le,u.positionScreen.z*=le,u.visible=!(u.positionScreen.x<-1||u.positionScreen.x>1||u.positionScreen.y<-1||u.positionScreen.y>1||u.positionScreen.z<-1||u.positionScreen.z>1)}for(C=0,T=Z.length;T>C;C++){Q=Z[C];var ue=oe===!0?ae.materials[Q.materialIndex]:q.material;if(void 0!==ue){var he=ue.side;if(ie=w[Q.a],ne=w[Q.b],re=w[Q.c],O[0]=ie.positionScreen,O[1]=ne.positionScreen,O[2]=re.positionScreen,(ie.visible===!0||ne.visible===!0||re.visible===!0||N.isIntersectionBox(R.setFromPoints(O)))&&(se=(re.positionScreen.x-ie.positionScreen.x)*(ne.positionScreen.y-ie.positionScreen.y)-(re.positionScreen.y-ie.positionScreen.y)*(ne.positionScreen.x-ie.positionScreen.x)<0,he===c.DoubleSide||se===(he===c.FrontSide))){for(f=i(),f.id=q.id,f.v1.copy(ie),f.v2.copy(ne),f.v3.copy(re),f.normalModel.copy(Q.normal),se!==!1||he!==c.BackSide&&he!==c.DoubleSide||f.normalModel.negate(),f.normalModel.applyMatrix3(B).normalize(),f.normalModelView.copy(f.normalModel).applyMatrix3(V),f.centroidModel.copy(Q.centroid).applyMatrix4(y),J=Q.vertexNormals,E=0,A=Math.min(J.length,3);A>E;E++){var ce=f.vertexNormalsModel[E];ce.copy(J[E]),se!==!1||he!==c.BackSide&&he!==c.DoubleSide||ce.negate(),ce.applyMatrix3(B).normalize();var fe=f.vertexNormalsModelView[E];fe.copy(ce).applyMatrix3(V)}for(f.vertexNormalsLength=J.length,L=0,j=Math.min(ee.length,3);j>L;L++)if(te=ee[L][C],void 0!==te)for(W=0,X=te.length;X>W;W++)f.uvs[L][W]=te[W];f.color=Q.color,f.material=ue,U.copy(f.centroidModel).applyProjection(I),f.z=U.z,P.elements.push(f)}}}}else if(q instanceof c.Line){k.multiplyMatrices(I,y),K=q.geometry.vertices,ie=t(),ie.positionScreen.copy(K[0]).applyMatrix4(k);var de=q.type===c.LinePieces?2:1;for(M=1,S=K.length;S>M;M++)ie=t(),ie.positionScreen.copy(K[M]).applyMatrix4(k),(M+1)%de>0||(ne=w[h-2],$.copy(ie.positionScreen),H.copy(ne.positionScreen),a($,H)===!0&&($.multiplyScalar(1/$.w),H.multiplyScalar(1/H.w),p=n(),p.id=q.id,p.v1.positionScreen.copy($),p.v2.positionScreen.copy(H),p.z=Math.max($.z,H.z),p.material=q.material,q.material.vertexColors===c.VertexColors&&(p.vertexColors[0].copy(q.geometry.colors[M]),p.vertexColors[1].copy(q.geometry.colors[M-1])),P.elements.push(p)))}for(b=0,_=P.sprites.length;_>b;b++)if(q=P.sprites[b].object,y=q.matrixWorld,q instanceof c.Sprite){D.set(y.elements[12],y.elements[13],y.elements[14],1),D.applyMatrix4(I);var le=1/D.w;D.z*=le,D.z>-1&&D.z<1&&(g=r(),g.id=q.id,g.x=D.x*le,g.y=D.y*le,g.z=D.z,g.object=q,g.rotation=q.rotation,g.scale.x=q.scale.x*Math.abs(g.x-(D.x+s.projectionMatrix.elements[0])/(D.w+s.projectionMatrix.elements[12])),g.scale.y=q.scale.y*Math.abs(g.y-(D.y+s.projectionMatrix.elements[5])/(D.w+s.projectionMatrix.elements[13])),g.material=q.material,P.elements.push(g))}return x===!0&&P.elements.sort(o),P}},c.Face3=function(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n instanceof c.Vector3?n:new c.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=r instanceof c.Color?r:new c.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new c.Vector3},c.Face3.prototype={constructor:c.Face3,clone:function(){var e=new c.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},c.Face4=function(e,t,i,n,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new c.Face3(e,t,i,r,o,a)},c.Geometry=function(){this.id=c.GeometryIdCount++,this.uuid=c.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},c.Geometry.prototype={constructor:c.Geometry,applyMatrix:function(e){for(var t=(new c.Matrix3).getNormalMatrix(e),i=0,n=this.vertices.length;n>i;i++){var r=this.vertices[i];r.applyMatrix4(e)}for(var i=0,n=this.faces.length;n>i;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var a=0,s=o.vertexNormals.length;s>a;a++)o.vertexNormals[a].applyMatrix3(t).normalize();o.centroid.applyMatrix4(e)}this.boundingBox instanceof c.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof c.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i.centroid.set(0,0,0),i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)},computeFaceNormals:function(){for(var e=new c.Vector3,t=new c.Vector3,i=0,n=this.faces.length;n>i;i++){var r=this.faces[i],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,i,n,r,o,a;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),a=this.__tmpVertices,t=0,i=this.vertices.length;i>t;t++)a[t]=new c.Vector3;for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.vertexNormals=[new c.Vector3,new c.Vector3,new c.Vector3]}else for(a=this.__tmpVertices,t=0,i=this.vertices.length;i>t;t++)a[t].set(0,0,0);if(e){var s,l,u,h=new c.Vector3,f=new c.Vector3;new c.Vector3,new c.Vector3,new c.Vector3;for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],u=this.vertices[o.c],h.subVectors(u,l),f.subVectors(s,l),h.cross(f),a[o.a].add(h),a[o.b].add(h),a[o.c].add(h)}else for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;i>t;t++)a[t].normalize();for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.vertexNormals[0].copy(a[o.a]),o.vertexNormals[1].copy(a[o.b]),o.vertexNormals[2].copy(a[o.c])},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;n>i;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;t>e;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new c.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,s,l=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],a=new c.Vector3,s={a:new c.Vector3,b:new c.Vector3,c:new c.Vector3},l.push(a),u.push(s)}var h=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var a,s;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],a=h.faceNormals[i],s=h.vertexNormals[i],a.copy(r.normal),s.a.copy(r.vertexNormals[0]),s.b.copy(r.vertexNormals[1]),s.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){function e(e,t,i,n,r,o,a){u=e.vertices[t],h=e.vertices[i],f=e.vertices[n],d=l[r],p=l[o],m=l[a],g=h.x-u.x,v=f.x-u.x,y=h.y-u.y,x=f.y-u.y,b=h.z-u.z,w=f.z-u.z,_=p.x-d.x,M=m.x-d.x,S=p.y-d.y,C=m.y-d.y,T=1/(_*C-M*S),N.set((C*g-S*v)*T,(C*y-S*x)*T,(C*b-S*w)*T),R.set((_*v-M*g)*T,(_*x-M*y)*T,(_*w-M*b)*T),L[t].add(N),L[i].add(N),L[n].add(N),D[t].add(R),D[i].add(R),D[n].add(R)}var t,i,n,r,o,a,s,l,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,C,T,E,A,P,L=[],D=[],N=new c.Vector3,R=new c.Vector3,O=new c.Vector3,F=new c.Vector3,I=new c.Vector3;for(n=0,r=this.vertices.length;r>n;n++)L[n]=new c.Vector3,D[n]=new c.Vector3;for(t=0,i=this.faces.length;i>t;t++)s=this.faces[t],l=this.faceVertexUvs[0][t],e(this,s.a,s.b,s.c,0,1,2);var k=["a","b","c","d"];for(t=0,i=this.faces.length;i>t;t++)for(s=this.faces[t],o=0;o<Math.min(s.vertexNormals.length,3);o++)I.copy(s.vertexNormals[o]),a=s[k[o]],E=L[a],O.copy(E),O.sub(I.multiplyScalar(I.dot(E))).normalize(),F.crossVectors(s.vertexNormals[o],E),A=F.dot(D[a]),P=0>A?-1:1,s.vertexTangents[o]=new c.Vector4(O.x,O.y,O.z,P);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;n>i;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new c.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new c.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e,t,i,n,r,o,a,s,l={},u=[],h=[],c=4,f=Math.pow(10,c);for(this.__tmpVertices=void 0,i=0,n=this.vertices.length;n>i;i++)e=this.vertices[i],t=Math.round(e.x*f)+"_"+Math.round(e.y*f)+"_"+Math.round(e.z*f),void 0===l[t]?(l[t]=i,u.push(this.vertices[i]),h[i]=u.length-1):h[i]=h[l[t]];var d=[];for(i=0,n=this.faces.length;n>i;i++){r=this.faces[i],r.a=h[r.a],r.b=h[r.b],r.c=h[r.c],o=[r.a,r.b,r.c];for(var p=-1,m=0;3>m;m++)if(o[m]==o[(m+1)%3]){p=m,d.push(i);break}}for(i=d.length-1;i>=0;i--){var g=d[i];for(this.faces.splice(g,1),a=0,s=this.faceVertexUvs.length;s>a;a++)this.faceVertexUvs[a].splice(g,1)}var v=this.vertices.length-u.length;return this.vertices=u,v},clone:function(){for(var e=new c.Geometry,t=this.vertices,i=0,n=t.length;n>i;i++)e.vertices.push(t[i].clone());for(var r=this.faces,i=0,n=r.length;n>i;i++)e.faces.push(r[i].clone());for(var o=this.faceVertexUvs[0],i=0,n=o.length;n>i;i++){for(var a=o[i],s=[],l=0,u=a.length;u>l;l++)s.push(new c.Vector2(a[l].x,a[l].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.Geometry.prototype),c.GeometryIdCount=0,c.BufferGeometry=function(){this.id=c.GeometryIdCount++,this.uuid=c.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},c.BufferGeometry.prototype={constructor:c.BufferGeometry,addAttribute:function(e,t,i,n){this.attributes[e]={itemSize:n,array:new t(i*n)}},applyMatrix:function(e){var t,i;if(this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==i){var n=(new c.Matrix3).getNormalMatrix(e);n.multiplyVector3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new c.Box3);var e=this.attributes.position.array;if(e){var t,i,n,r=this.boundingBox;e.length>=3&&(r.min.x=r.max.x=e[0],r.min.y=r.max.y=e[1],r.min.z=r.max.z=e[2]);for(var o=3,a=e.length;a>o;o+=3)t=e[o],i=e[o+1],n=e[o+2],t<r.min.x?r.min.x=t:t>r.max.x&&(r.max.x=t),i<r.min.y?r.min.y=i:i>r.max.y&&(r.max.y=i),n<r.min.z?r.min.z=n:n>r.max.z&&(r.max.z=n)}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new c.Box3,t=new c.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new c.Sphere);var i=this.attributes.position.array;if(i){for(var n=this.boundingSphere.center,r=0,o=i.length;o>r;r+=3)t.set(i[r],i[r+1],i[r+2]),e.addPoint(t);e.center(n);for(var a=0,r=0,o=i.length;o>r;r+=3)t.set(i[r],i[r+1],i[r+2]),a=Math.max(a,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,t,i,n,r=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(r)};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var o,a,s,l,u,h,f=this.attributes.position.array,d=this.attributes.normal.array,p=new c.Vector3,m=new c.Vector3,g=new c.Vector3,v=new c.Vector3,y=new c.Vector3;if(this.attributes.index){var x=this.attributes.index.array,b=this.offsets;for(i=0,n=b.length;n>i;++i){var w=b[i].start,_=b[i].count,M=b[i].index;for(e=w,t=w+_;t>e;e+=3)o=M+x[e],a=M+x[e+1],s=M+x[e+2],l=f[3*o],u=f[3*o+1],h=f[3*o+2],p.set(l,u,h),l=f[3*a],u=f[3*a+1],h=f[3*a+2],m.set(l,u,h),l=f[3*s],u=f[3*s+1],h=f[3*s+2],g.set(l,u,h),v.subVectors(g,m),y.subVectors(p,m),v.cross(y),d[3*o]+=v.x,d[3*o+1]+=v.y,d[3*o+2]+=v.z,d[3*a]+=v.x,d[3*a+1]+=v.y,d[3*a+2]+=v.z,d[3*s]+=v.x,d[3*s+1]+=v.y,d[3*s+2]+=v.z}}else for(e=0,t=f.length;t>e;e+=9)l=f[e],u=f[e+1],h=f[e+2],p.set(l,u,h),l=f[e+3],u=f[e+4],h=f[e+5],m.set(l,u,h),l=f[e+6],u=f[e+7],h=f[e+8],g.set(l,u,h),v.subVectors(g,m),y.subVectors(p,m),v.cross(y),d[e]=v.x,d[e+1]=v.y,d[e+2]=v.z,d[e+3]=v.x,d[e+4]=v.y,d[e+5]=v.z,d[e+6]=v.x,d[e+7]=v.y,d[e+8]=v.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,n,r=this.attributes.normal.array,o=0,a=r.length;a>o;o+=3)e=r[o],t=r[o+1],i=r[o+2],n=1/Math.sqrt(e*e+t*t+i*i),r[o]*=n,r[o+1]*=n,r[o+2]*=n},computeTangents:function(){function e(e,t,i){d=n[3*e],p=n[3*e+1],m=n[3*e+2],g=n[3*t],v=n[3*t+1],y=n[3*t+2],x=n[3*i],b=n[3*i+1],w=n[3*i+2],_=o[2*e],M=o[2*e+1],S=o[2*t],C=o[2*t+1],T=o[2*i],E=o[2*i+1],A=g-d,P=x-d,L=v-p,D=b-p,N=y-m,R=w-m,O=S-_,F=T-_,I=C-M,k=E-M,B=1/(O*k-F*I),G.set((k*A-I*P)*B,(k*L-I*D)*B,(k*N-I*R)*B),X.set((O*P-F*A)*B,(O*D-F*L)*B,(O*R-F*N)*B),u[e].add(G),u[t].add(G),u[i].add(G),h[e].add(X),h[t].add(X),h[i].add(X)}function t(e){ne.x=r[3*e],ne.y=r[3*e+1],ne.z=r[3*e+2],re.copy(ne),J=u[e],te.copy(J),te.sub(ne.multiplyScalar(ne.dot(J))).normalize(),ie.crossVectors(re,J),ee=ie.dot(h[e]),Q=0>ee?-1:1,l[4*e]=te.x,l[4*e+1]=te.y,l[4*e+2]=te.z,l[4*e+3]=Q}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var i=this.attributes.index.array,n=this.attributes.position.array,r=this.attributes.normal.array,o=this.attributes.uv.array,a=n.length/3;if(void 0===this.attributes.tangent){var s=4*a;this.attributes.tangent={itemSize:4,array:new Float32Array(s)}}for(var l=this.attributes.tangent.array,u=[],h=[],f=0;a>f;f++)u[f]=new c.Vector3,h[f]=new c.Vector3;var d,p,m,g,v,y,x,b,w,_,M,S,C,T,E,A,P,L,D,N,R,O,F,I,k,B,V,U,z,$,H,j,W,G=new c.Vector3,X=new c.Vector3,q=this.offsets;for(z=0,$=q.length;$>z;++z){var Y=q[z].start,K=q[z].count,Z=q[z].index;for(V=Y,U=Y+K;U>V;V+=3)H=Z+i[V],j=Z+i[V+1],W=Z+i[V+2],e(H,j,W)}var Q,J,ee,te=new c.Vector3,ie=new c.Vector3,ne=new c.Vector3,re=new c.Vector3;for(z=0,$=q.length;$>z;++z){var Y=q[z].start,K=q[z].count,Z=q[z].index;for(V=Y,U=Y+K;U>V;V+=3)H=Z+i[V],j=Z+i[V+1],W=Z+i[V+2],t(H),t(j),t(W)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},clone:function(){var e=new c.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var i in this.attributes){for(var n=this.attributes[i],r=n.array,o={itemSize:n.itemSize,numItems:n.numItems,array:null},a=0,s=t.length;s>a;a++){var l=t[a];if(r instanceof l){o.array=new l(r);break}}e.attributes[i]=o}for(var a=0,s=this.offsets.length;s>a;a++){var u=this.offsets[a];e.offsets.push({start:u.start,index:u.index,count:u.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.BufferGeometry.prototype),c.Camera=function(){c.Object3D.call(this),this.matrixWorldInverse=new c.Matrix4,this.projectionMatrix=new c.Matrix4,this.projectionMatrixInverse=new c.Matrix4},c.Camera.prototype=Object.create(c.Object3D.prototype),c.Camera.prototype.lookAt=function(){var e=new c.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),c.Camera.prototype.clone=function(e){return void 0===e&&(e=new c.Camera),c.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e.projectionMatrixInverse.copy(this.projectionMatrixInverse),e},c.OrthographicCamera=function(e,t,i,n,r,o){c.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},c.OrthographicCamera.prototype=Object.create(c.Camera.prototype),c.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},c.OrthographicCamera.prototype.clone=function(){var e=new c.OrthographicCamera;return c.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},c.PerspectiveCamera=function(e,t,i,n){c.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},c.PerspectiveCamera.prototype=Object.create(c.Camera.prototype),c.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*c.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},c.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,n,r,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},c.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(c.Math.degToRad(.5*this.fov))*this.near,i=-t,n=e*i,r=e*t,o=Math.abs(r-n),a=Math.abs(t-i);this.projectionMatrix.makeFrustum(n+this.x*o/this.fullWidth,n+(this.x+this.width)*o/this.fullWidth,t-(this.y+this.height)*a/this.fullHeight,t-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},c.PerspectiveCamera.prototype.clone=function(){var e=new c.PerspectiveCamera;return c.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},c.Light=function(e){c.Object3D.call(this),this.color=new c.Color(e)},c.Light.prototype=Object.create(c.Object3D.prototype),c.Light.prototype.clone=function(e){return void 0===e&&(e=new c.Light),c.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},c.AmbientLight=function(e){c.Light.call(this,e)},c.AmbientLight.prototype=Object.create(c.Light.prototype),c.AmbientLight.prototype.clone=function(){var e=new c.AmbientLight;return c.Light.prototype.clone.call(this,e),e},c.AreaLight=function(e,t){c.Light.call(this,e),this.normal=new c.Vector3(0,-1,0),this.right=new c.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},c.AreaLight.prototype=Object.create(c.Light.prototype),c.DirectionalLight=function(e,t){c.Light.call(this,e),this.position.set(0,1,0),this.target=new c.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new c.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},c.DirectionalLight.prototype=Object.create(c.Light.prototype),c.DirectionalLight.prototype.clone=function(){var e=new c.DirectionalLight;return c.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},c.HemisphereLight=function(e,t,i){c.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new c.Color(t),this.intensity=void 0!==i?i:1},c.HemisphereLight.prototype=Object.create(c.Light.prototype),c.HemisphereLight.prototype.clone=function(){var e=new c.HemisphereLight;return c.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},c.PointLight=function(e,t,i){c.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},c.PointLight.prototype=Object.create(c.Light.prototype),c.PointLight.prototype.clone=function(){var e=new c.PointLight;return c.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},c.SpotLight=function(e,t,i,n,r){c.Light.call(this,e),this.position.set(0,1,0),this.target=new c.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==r?r:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},c.SpotLight.prototype=Object.create(c.Light.prototype),c.SpotLight.prototype.clone=function(){var e=new c.SpotLight;return c.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},c.Loader=function(e){this.showStatus=e,this.statusDomElement=e?c.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},c.Loader.prototype={constructor:c.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var i=[],n=0;n<e.length;++n)i[n]=c.Loader.prototype.createMaterial(e[n],t);return i},needsTangents:function(e){for(var t=0,i=e.length;i>t;t++){var n=e[t];if(n instanceof c.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function i(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function r(e,t){var r=new Image;r.onload=function(){if(i(this.width)&&i(this.height))e.image=this;else{var t=n(this.width),r=n(this.height);e.image.width=t,e.image.height=r,e.image.getContext("2d").drawImage(this,0,0,t,r)}e.needsUpdate=!0},r.crossOrigin=s.crossOrigin,r.src=t}function o(e,i,n,o,a,s,l){var u=/\.dds$/i.test(n),h=t+"/"+n;if(u){var f=c.ImageUtils.loadCompressedTexture(h);e[i]=f}else{var f=document.createElement("canvas");e[i]=new c.Texture(f)}if(e[i].sourceFile=n,o&&(e[i].repeat.set(o[0],o[1]),1!==o[0]&&(e[i].wrapS=c.RepeatWrapping),1!==o[1]&&(e[i].wrapT=c.RepeatWrapping)),a&&e[i].offset.set(a[0],a[1]),s){var d={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};void 0!==d[s[0]]&&(e[i].wrapS=d[s[0]]),void 0!==d[s[1]]&&(e[i].wrapT=d[s[1]])}l&&(e[i].anisotropy=l),u||r(e[i],h)}function a(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,l="MeshLambertMaterial",u={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var h=e.shading.toLowerCase();"phong"===h?l="MeshPhongMaterial":"basic"===h&&(l="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==c[e.blending]&&(u.blending=c[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(u.transparent=e.transparent),void 0!==e.depthTest&&(u.depthTest=e.depthTest),void 0!==e.depthWrite&&(u.depthWrite=e.depthWrite),void 0!==e.visible&&(u.visible=e.visible),void 0!==e.flipSided&&(u.side=c.BackSide),void 0!==e.doubleSided&&(u.side=c.DoubleSide),void 0!==e.wireframe&&(u.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?u.vertexColors=c.FaceColors:e.vertexColors&&(u.vertexColors=c.VertexColors)),e.colorDiffuse?u.color=a(e.colorDiffuse):e.DbgColor&&(u.color=e.DbgColor),e.colorSpecular&&(u.specular=a(e.colorSpecular)),e.colorAmbient&&(u.ambient=a(e.colorAmbient)),e.transparency&&(u.opacity=e.transparency),e.specularCoef&&(u.shininess=e.specularCoef),e.mapDiffuse&&t&&o(u,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&o(u,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&o(u,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),
e.mapNormal&&t&&o(u,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&o(u,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(u.bumpScale=e.mapBumpScale),e.mapNormal){var f=c.ShaderLib.normalmap,d=c.UniformsUtils.clone(f.uniforms);d.tNormal.value=u.normalMap,e.mapNormalFactor&&d.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),u.map&&(d.tDiffuse.value=u.map,d.enableDiffuse.value=!0),u.specularMap&&(d.tSpecular.value=u.specularMap,d.enableSpecular.value=!0),u.lightMap&&(d.tAO.value=u.lightMap,d.enableAO.value=!0),d.uDiffuseColor.value.setHex(u.color),d.uSpecularColor.value.setHex(u.specular),d.uAmbientColor.value.setHex(u.ambient),d.uShininess.value=u.shininess,void 0!==u.opacity&&(d.uOpacity.value=u.opacity);var p={fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:d,lights:!0,fog:!0},m=new c.ShaderMaterial(p);u.transparent&&(m.transparent=!0)}else var m=new c[l](u);return void 0!==e.DbgName&&(m.name=e.DbgName),m}},c.XHRLoader=function(e){this.manager=void 0!==e?e:c.DefaultLoadingManager},c.XHRLoader.prototype={constructor:c.XHRLoader,load:function(e,t,i,n){var r=this,o=new XMLHttpRequest;void 0!==t&&o.addEventListener("load",function(i){t(i.target.responseText),r.manager.itemEnd(e)},!1),void 0!==i&&o.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&o.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.open("GET",e,!0),o.send(null),r.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},c.ImageLoader=function(e){this.manager=void 0!==e?e:c.DefaultLoadingManager},c.ImageLoader.prototype={constructor:c.ImageLoader,load:function(e,t,i,n){var r=this,o=document.createElement("img");return void 0!==t&&o.addEventListener("load",function(i){r.manager.itemEnd(e),t(this)},!1),void 0!==i&&o.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&o.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.src=e,r.manager.itemStart(e),o},setCrossOrigin:function(e){this.crossOrigin=e}},c.JSONLoader=function(e){c.Loader.call(this,e),this.withCredentials=!1},c.JSONLoader.prototype=Object.create(c.Loader.prototype),c.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},c.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,n,r){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText),l=e.parse(s,n);i(l.geometry,l.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?r&&(0===a&&(a=o.getResponseHeader("Content-Length")),r({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},c.JSONLoader.prototype.parse=function(e,t){function i(t){function i(e,t){return e&1<<t}var n,r,a,s,l,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,C,T,E,A,P,L,D,N=e.faces,R=e.vertices,O=e.normals,F=e.colors,I=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&I++;for(n=0;I>n;n++)o.faceVertexUvs[n]=[]}for(s=0,l=R.length;l>s;)_=new c.Vector3,_.x=R[s++]*t,_.y=R[s++]*t,_.z=R[s++]*t,o.vertices.push(_);for(s=0,l=N.length;l>s;)if(p=N[s++],m=i(p,0),g=i(p,1),v=i(p,3),y=i(p,4),x=i(p,5),b=i(p,6),w=i(p,7),m){if(S=new c.Face3,S.a=N[s],S.b=N[s+1],S.c=N[s+3],C=new c.Face3,C.a=N[s+1],C.b=N[s+2],C.c=N[s+3],s+=4,g&&(d=N[s++],S.materialIndex=d,C.materialIndex=d),a=o.faces.length,v)for(n=0;I>n;n++)for(A=e.uvs[n],o.faceVertexUvs[n][a]=[],o.faceVertexUvs[n][a+1]=[],r=0;4>r;r++)f=N[s++],L=A[2*f],D=A[2*f+1],P=new c.Vector2(L,D),2!==r&&o.faceVertexUvs[n][a].push(P),0!==r&&o.faceVertexUvs[n][a+1].push(P);if(y&&(h=3*N[s++],S.normal.set(O[h++],O[h++],O[h]),C.normal.copy(S.normal)),x)for(n=0;4>n;n++)h=3*N[s++],E=new c.Vector3(O[h++],O[h++],O[h]),2!==n&&S.vertexNormals.push(E),0!==n&&C.vertexNormals.push(E);if(b&&(u=N[s++],T=F[u],S.color.setHex(T),C.color.setHex(T)),w)for(n=0;4>n;n++)u=N[s++],T=F[u],2!==n&&S.vertexColors.push(new c.Color(T)),0!==n&&C.vertexColors.push(new c.Color(T));o.faces.push(S),o.faces.push(C)}else{if(M=new c.Face3,M.a=N[s++],M.b=N[s++],M.c=N[s++],g&&(d=N[s++],M.materialIndex=d),a=o.faces.length,v)for(n=0;I>n;n++)for(A=e.uvs[n],o.faceVertexUvs[n][a]=[],r=0;3>r;r++)f=N[s++],L=A[2*f],D=A[2*f+1],P=new c.Vector2(L,D),o.faceVertexUvs[n][a].push(P);if(y&&(h=3*N[s++],M.normal.set(O[h++],O[h++],O[h])),x)for(n=0;3>n;n++)h=3*N[s++],E=new c.Vector3(O[h++],O[h++],O[h]),M.vertexNormals.push(E);if(b&&(u=N[s++],M.color.setHex(F[u])),w)for(n=0;3>n;n++)u=N[s++],M.vertexColors.push(new c.Color(F[u]));o.faces.push(M)}}function n(){var t,i,n,r,a,s,l,u,h,f;if(e.skinWeights)for(t=0,i=e.skinWeights.length;i>t;t+=2)n=e.skinWeights[t],r=e.skinWeights[t+1],a=0,s=0,o.skinWeights.push(new c.Vector4(n,r,a,s));if(e.skinIndices)for(t=0,i=e.skinIndices.length;i>t;t+=2)l=e.skinIndices[t],u=e.skinIndices[t+1],h=0,f=0,o.skinIndices.push(new c.Vector4(l,u,h,f));o.bones=e.bones,o.animation=e.animation,o.animations=e.animations}function r(t){if(void 0!==e.morphTargets){var i,n,r,a,s,l;for(i=0,n=e.morphTargets.length;n>i;i++)for(o.morphTargets[i]={},o.morphTargets[i].name=e.morphTargets[i].name,o.morphTargets[i].vertices=[],s=o.morphTargets[i].vertices,l=e.morphTargets[i].vertices,r=0,a=l.length;a>r;r+=3){var u=new c.Vector3;u.x=l[r]*t,u.y=l[r+1]*t,u.z=l[r+2]*t,s.push(u)}}if(void 0!==e.morphColors){var i,n,h,f,d,p,m;for(i=0,n=e.morphColors.length;n>i;i++)for(o.morphColors[i]={},o.morphColors[i].name=e.morphColors[i].name,o.morphColors[i].colors=[],d=o.morphColors[i].colors,p=e.morphColors[i].colors,h=0,f=p.length;f>h;h+=3)m=new c.Color(16755200),m.setRGB(p[h],p[h+1],p[h+2]),d.push(m)}}var o=new c.Geometry,a=void 0!==e.scale?1/e.scale:1;if(i(a),n(),r(a),o.computeCentroids(),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===e.materials)return{geometry:o};var s=this.initMaterials(e.materials,t);return this.needsTangents(s)&&o.computeTangents(),{geometry:o,materials:s}},c.LoadingManager=function(e,t,i){var n=this,r=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++},this.itemEnd=function(e){r++,void 0!==n.onProgress&&n.onProgress(e,r,o),r===o&&void 0!==n.onLoad&&n.onLoad()}},c.DefaultLoadingManager=new c.LoadingManager,c.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:c.DefaultLoadingManager},c.BufferGeometryLoader.prototype={constructor:c.BufferGeometryLoader,load:function(e,t,i,n){var r=this,o=new c.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new c.BufferGeometry,i=e.attributes,n=e.offsets,r=e.boundingSphere;for(var o in i){var a=i[o];t.attributes[o]={itemSize:a.itemSize,array:new self[a.type](a.array)}}return void 0!==n&&(t.offsets=JSON.parse(JSON.stringify(n))),void 0!==r&&(t.boundingSphere=new c.Sphere((new c.Vector3).fromArray(void 0!==r.center?r.center:[0,0,0]),r.radius)),t}},c.GeometryLoader=function(e){this.manager=void 0!==e?e:c.DefaultLoadingManager},c.GeometryLoader.prototype={constructor:c.GeometryLoader,load:function(e,t,i,n){var r=this,o=new c.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){}},c.MaterialLoader=function(e){this.manager=void 0!==e?e:c.DefaultLoadingManager},c.MaterialLoader.prototype={constructor:c.MaterialLoader,load:function(e,t,i,n){var r=this,o=new c.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new c[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var i=0,n=e.materials.length;n>i;i++)t.materials.push(this.parse(e.materials[i]));return t}},c.ObjectLoader=function(e){this.manager=void 0!==e?e:c.DefaultLoadingManager},c.ObjectLoader.prototype={constructor:c.ObjectLoader,load:function(e,t,i,n){var r=this,o=new c.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(r.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),i=this.parseMaterials(e.materials),n=this.parseObject(e.object,t,i);return n},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new c.JSONLoader,n=new c.BufferGeometryLoader,r=0,o=e.length;o>r;r++){var a,s=e[r];switch(s.type){case"PlaneGeometry":a=new c.PlaneGeometry(s.width,s.height,s.widthSegments,s.heightSegments);break;case"CircleGeometry":a=new c.CircleGeometry(s.radius,s.segments);break;case"CubeGeometry":a=new c.CubeGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CylinderGeometry":a=new c.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radiusSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new c.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new c.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new c.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new c.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=n.parse(s.data);break;case"Geometry":a=i.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var i=new c.MaterialLoader,n=0,r=e.length;r>n;n++){var o=e[n],a=i.parse(o);a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),t[o.uuid]=a}return t},parseObject:function(){var e=new c.Matrix4;return function(t,i,n){var r;switch(t.type){case"Scene":r=new c.Scene;break;case"PerspectiveCamera":r=new c.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":r=new c.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":r=new c.AmbientLight(t.color);break;case"DirectionalLight":r=new c.DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new c.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":r=new c.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":r=new c.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var o=i[t.geometry],a=n[t.material];void 0===o&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===a&&console.error("THREE.ObjectLoader: Undefined material "+t.material),r=new c.Mesh(o,a);break;default:r=new c.Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var s in t.children)r.add(this.parseObject(t.children[s],i,n));return r}}()},c.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",c.JSONLoader)},c.SceneLoader.prototype={constructor:c.SceneLoader,load:function(e,t,i,n){var r=this,o=new c.XHRLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(i){r.parse(JSON.parse(i),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,i){function n(e,t){return"relativeToHTML"==t?e:L+"/"+e}function r(){o(A.scene,N.objects)}function o(e,t){var i,r,a,s,l,h;for(var f in t){var d=A.objects[f],p=t[f];if(void 0===d){if(p.type&&p.type in P.hierarchyHandlers){if(void 0===p.loading){var y={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},x={};for(var b in p)b in y||(x[b]=p[b]);g=A.materials[p.material],p.loading=!0;var S=P.hierarchyHandlers[p.type].loaderObject;S.options?S.load(n(p.url,N.urlBaseType),u(f,e,g,p)):S.load(n(p.url,N.urlBaseType),u(f,e,g,p),x)}}else if(void 0!==p.geometry){if(m=A.geometries[p.geometry]){var C=!1;if(g=A.materials[p.material],C=g instanceof c.ShaderMaterial,a=p.position,s=p.rotation,l=p.scale,i=p.matrix,h=p.quaternion,p.material||(g=new c.MeshFaceMaterial(A.face_materials[p.geometry])),g instanceof c.MeshFaceMaterial&&0===g.materials.length&&(g=new c.MeshFaceMaterial(A.face_materials[p.geometry])),g instanceof c.MeshFaceMaterial)for(var T=0;T<g.materials.length;T++)C=C||g.materials[T]instanceof c.ShaderMaterial;C&&m.computeTangents(),p.skin?d=new c.SkinnedMesh(m,g):p.morph?(d=new c.MorphAnimMesh(m,g),void 0!==p.duration&&(d.duration=p.duration),void 0!==p.time&&(d.time=p.time),void 0!==p.mirroredLoop&&(d.mirroredLoop=p.mirroredLoop),g.morphNormals&&m.computeMorphNormals()):d=new c.Mesh(m,g),d.name=f,i?(d.matrixAutoUpdate=!1,d.matrix.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])):(d.position.fromArray(a),h?d.quaternion.fromArray(h):d.rotation.fromArray(s),d.scale.fromArray(l)),d.visible=p.visible,d.castShadow=p.castShadow,d.receiveShadow=p.receiveShadow,e.add(d),A.objects[f]=d}}else"DirectionalLight"===p.type||"PointLight"===p.type||"AmbientLight"===p.type?(_=void 0!==p.color?p.color:16777215,M=void 0!==p.intensity?p.intensity:1,"DirectionalLight"===p.type?(a=p.direction,w=new c.DirectionalLight(_,M),w.position.fromArray(a),p.target&&(D.push({object:w,targetName:p.target}),w.target=null)):"PointLight"===p.type?(a=p.position,r=p.distance,w=new c.PointLight(_,M,r),w.position.fromArray(a)):"AmbientLight"===p.type&&(w=new c.AmbientLight(_)),e.add(w),w.name=f,A.lights[f]=w,A.objects[f]=w):"PerspectiveCamera"===p.type||"OrthographicCamera"===p.type?(a=p.position,s=p.rotation,h=p.quaternion,"PerspectiveCamera"===p.type?v=new c.PerspectiveCamera(p.fov,p.aspect,p.near,p.far):"OrthographicCamera"===p.type&&(v=new c.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far)),v.name=f,v.position.fromArray(a),void 0!==h?v.quaternion.fromArray(h):void 0!==s&&v.rotation.fromArray(s),e.add(v),A.cameras[f]=v,A.objects[f]=v):(a=p.position,s=p.rotation,l=p.scale,h=p.quaternion,d=new c.Object3D,d.name=f,d.position.fromArray(a),h?d.quaternion.fromArray(h):d.rotation.fromArray(s),d.scale.fromArray(l),d.visible=void 0!==p.visible?p.visible:!1,e.add(d),A.objects[f]=d,A.empties[f]=d);if(d){if(void 0!==p.userData)for(var E in p.userData){var L=p.userData[E];d.userData[E]=L}if(void 0!==p.groups)for(var T=0;T<p.groups.length;T++){var R=p.groups[T];void 0===A.groups[R]&&(A.groups[R]=[]),A.groups[R].push(f)}}}void 0!==d&&void 0!==p.children&&o(d,p.children)}}function a(e,t,i){A.geometries[i]=e,A.face_materials[i]=t,r()}function s(e,t,i,n,o){var a=o.position,s=o.rotation,l=o.quaternion,u=o.scale;e.position.fromArray(a),l?e.quaternion.fromArray(l):e.rotation.fromArray(s),e.scale.fromArray(u),n&&e.traverse(function(e){e.material=n});var h=void 0!==o.visible?o.visible:!0;e.traverse(function(e){e.visible=h}),i.add(e),e.name=t,A.objects[t]=e,r()}function l(e){return function(t,i){t.name=e,a(t,i,e),S-=1,P.onLoadComplete(),f()}}function u(e,t,i,n){return function(r){var o;o=r.content?r.content:r.dae?r.scene:r,s(o,e,t,i,n),S-=1,P.onLoadComplete(),f()}}function h(e){return function(t,i){t.name=e,A.geometries[e]=t,A.face_materials[e]=i}}function f(){var e={totalModels:T,totalTextures:E,loadedModels:T-S,loadedTextures:E-C};P.callbackProgress(e,A),P.onLoadProgress(),0===S&&0===C&&(d(),t(A))}function d(){for(var e=0;e<D.length;e++){var t=D[e],i=A.objects[t.targetName];i?t.object.target=i:(t.object.target=new c.Object3D,A.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}function p(e,t){if(t(e),void 0!==e.children)for(var i in e.children)p(e.children[i],t)}var m,g,v,y,x,b,w,_,M,S,C,T,E,A,P=this,L=c.Loader.prototype.extractUrlBase(i),D=[],N=e;for(var R in this.geometryHandlers){var O=this.geometryHandlers[R].loaderClass;this.geometryHandlers[R].loaderObject=new O}for(var R in this.hierarchyHandlers){var O=this.hierarchyHandlers[R].loaderClass;this.hierarchyHandlers[R].loaderObject=new O}if(S=0,C=0,A={scene:new c.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},N.transform){var F=N.transform.position,I=N.transform.rotation,k=N.transform.scale;F&&A.scene.position.fromArray(F),I&&A.scene.rotation.fromArray(I),k&&A.scene.scale.fromArray(k),(F||I||k)&&(A.scene.updateMatrix(),A.scene.updateMatrixWorld())}var B,V,U=function(e){C-=e,f(),P.onLoadComplete()},z=function(e){return function(){U(e)}};for(B in N.fogs)V=N.fogs[B],"linear"===V.type?y=new c.Fog(0,V.near,V.far):"exp2"===V.type&&(y=new c.FogExp2(0,V.density)),b=V.color,y.color.setRGB(b[0],b[1],b[2]),A.fogs[B]=y;var $,H;for($ in N.geometries)H=N.geometries[$],H.type in this.geometryHandlers&&(S+=1,P.onLoadStart());for(var j in N.objects)p(N.objects[j],function(e){e.type&&e.type in P.hierarchyHandlers&&(S+=1,P.onLoadStart())});T=S;for($ in N.geometries)if(H=N.geometries[$],"cube"===H.type)m=new c.CubeGeometry(H.width,H.height,H.depth,H.widthSegments,H.heightSegments,H.depthSegments),m.name=$,A.geometries[$]=m;else if("plane"===H.type)m=new c.PlaneGeometry(H.width,H.height,H.widthSegments,H.heightSegments),m.name=$,A.geometries[$]=m;else if("sphere"===H.type)m=new c.SphereGeometry(H.radius,H.widthSegments,H.heightSegments),m.name=$,A.geometries[$]=m;else if("cylinder"===H.type)m=new c.CylinderGeometry(H.topRad,H.botRad,H.height,H.radSegs,H.heightSegs),m.name=$,A.geometries[$]=m;else if("torus"===H.type)m=new c.TorusGeometry(H.radius,H.tube,H.segmentsR,H.segmentsT),m.name=$,A.geometries[$]=m;else if("icosahedron"===H.type)m=new c.IcosahedronGeometry(H.radius,H.subdivisions),m.name=$,A.geometries[$]=m;else if(H.type in this.geometryHandlers){var W={};for(var G in H)"type"!==G&&"url"!==G&&(W[G]=H[G]);var X=this.geometryHandlers[H.type].loaderObject;X.load(n(H.url,N.urlBaseType),l($),W)}else if("embedded"===H.type){var q=N.embeds[H.id],Y="";if(q.metadata=N.metadata,q){var K=this.geometryHandlers.ascii.loaderObject,Z=K.parse(q,Y);h($)(Z.geometry,Z.materials)}}var Q,J;for(Q in N.textures)if(J=N.textures[Q],J.url instanceof Array){C+=J.url.length;for(var ee=0;ee<J.url.length;ee++)P.onLoadStart()}else C+=1,P.onLoadStart();E=C;for(Q in N.textures){if(J=N.textures[Q],void 0!==J.mapping&&void 0!==c[J.mapping]&&(J.mapping=new c[J.mapping]),J.url instanceof Array){for(var te=J.url.length,ie=[],ne=0;te>ne;ne++)ie[ne]=n(J.url[ne],N.urlBaseType);var re=/\.dds$/i.test(ie[0]);x=re?c.ImageUtils.loadCompressedTextureCube(ie,J.mapping,z(te)):c.ImageUtils.loadTextureCube(ie,J.mapping,z(te))}else{var re=/\.dds$/i.test(J.url),oe=n(J.url,N.urlBaseType),ae=z(1);if(x=re?c.ImageUtils.loadCompressedTexture(oe,J.mapping,ae):c.ImageUtils.loadTexture(oe,J.mapping,ae),void 0!==c[J.minFilter]&&(x.minFilter=c[J.minFilter]),void 0!==c[J.magFilter]&&(x.magFilter=c[J.magFilter]),J.anisotropy&&(x.anisotropy=J.anisotropy),J.repeat&&(x.repeat.set(J.repeat[0],J.repeat[1]),1!==J.repeat[0]&&(x.wrapS=c.RepeatWrapping),1!==J.repeat[1]&&(x.wrapT=c.RepeatWrapping)),J.offset&&x.offset.set(J.offset[0],J.offset[1]),J.wrap){var se={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};void 0!==se[J.wrap[0]]&&(x.wrapS=se[J.wrap[0]]),void 0!==se[J.wrap[1]]&&(x.wrapT=se[J.wrap[1]])}}A.textures[Q]=x}var le,ue,he;for(le in N.materials){ue=N.materials[le];for(he in ue.parameters)if("envMap"===he||"map"===he||"lightMap"===he||"bumpMap"===he)ue.parameters[he]=A.textures[ue.parameters[he]];else if("shading"===he)ue.parameters[he]="flat"===ue.parameters[he]?c.FlatShading:c.SmoothShading;else if("side"===he)"double"==ue.parameters[he]?ue.parameters[he]=c.DoubleSide:"back"==ue.parameters[he]?ue.parameters[he]=c.BackSide:ue.parameters[he]=c.FrontSide;else if("blending"===he)ue.parameters[he]=ue.parameters[he]in c?c[ue.parameters[he]]:c.NormalBlending;else if("combine"===he)ue.parameters[he]=ue.parameters[he]in c?c[ue.parameters[he]]:c.MultiplyOperation;else if("vertexColors"===he)"face"==ue.parameters[he]?ue.parameters[he]=c.FaceColors:ue.parameters[he]&&(ue.parameters[he]=c.VertexColors);else if("wrapRGB"===he){var ce=ue.parameters[he];ue.parameters[he]=new c.Vector3(ce[0],ce[1],ce[2])}if(void 0!==ue.parameters.opacity&&ue.parameters.opacity<1&&(ue.parameters.transparent=!0),ue.parameters.normalMap){var fe=c.ShaderLib.normalmap,de=c.UniformsUtils.clone(fe.uniforms),pe=ue.parameters.color,me=ue.parameters.specular,ge=ue.parameters.ambient,ve=ue.parameters.shininess;de.tNormal.value=A.textures[ue.parameters.normalMap],ue.parameters.normalScale&&de.uNormalScale.value.set(ue.parameters.normalScale[0],ue.parameters.normalScale[1]),ue.parameters.map&&(de.tDiffuse.value=ue.parameters.map,de.enableDiffuse.value=!0),ue.parameters.envMap&&(de.tCube.value=ue.parameters.envMap,de.enableReflection.value=!0,de.uReflectivity.value=ue.parameters.reflectivity),ue.parameters.lightMap&&(de.tAO.value=ue.parameters.lightMap,de.enableAO.value=!0),ue.parameters.specularMap&&(de.tSpecular.value=A.textures[ue.parameters.specularMap],de.enableSpecular.value=!0),ue.parameters.displacementMap&&(de.tDisplacement.value=A.textures[ue.parameters.displacementMap],de.enableDisplacement.value=!0,de.uDisplacementBias.value=ue.parameters.displacementBias,de.uDisplacementScale.value=ue.parameters.displacementScale),de.uDiffuseColor.value.setHex(pe),de.uSpecularColor.value.setHex(me),de.uAmbientColor.value.setHex(ge),de.uShininess.value=ve,ue.parameters.opacity&&(de.uOpacity.value=ue.parameters.opacity);var ye={fragmentShader:fe.fragmentShader,vertexShader:fe.vertexShader,uniforms:de,lights:!0,fog:!0};g=new c.ShaderMaterial(ye)}else g=new c[ue.type](ue.parameters);g.name=le,A.materials[le]=g}for(le in N.materials)if(ue=N.materials[le],ue.parameters.materials){for(var xe=[],ne=0;ne<ue.parameters.materials.length;ne++){var be=ue.parameters.materials[ne];xe.push(A.materials[be])}A.materials[le].materials=xe}r(),A.cameras&&N.defaults.camera&&(A.currentCamera=A.cameras[N.defaults.camera]),A.fogs&&N.defaults.fog&&(A.scene.fog=A.fogs[N.defaults.fog]),P.callbackSync(A),f()}},c.TextureLoader=function(e){this.manager=void 0!==e?e:c.DefaultLoadingManager},c.TextureLoader.prototype={constructor:c.TextureLoader,load:function(e,t,i,n){var r=this,o=new c.ImageLoader(r.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){var i=new c.Texture(e);i.needsUpdate=!0,void 0!==t&&t(i)})},setCrossOrigin:function(e){this.crossOrigin=e}},c.Material=function(){this.id=c.MaterialIdCount++,this.uuid=c.Math.generateUUID(),this.name="",this.side=c.FrontSide,this.opacity=1,this.transparent=!1,this.blending=c.NormalBlending,this.blendSrc=c.SrcAlphaFactor,this.blendDst=c.OneMinusSrcAlphaFactor,this.blendEquation=c.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},c.Material.prototype={constructor:c.Material,setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var n=this[t];n instanceof c.Color?n.set(i):n instanceof c.Vector3&&i instanceof c.Vector3?n.copy(i):"overdraw"==t?this[t]=Number(i):this[t]=i}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new c.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.Material.prototype),c.MaterialIdCount=0,c.LineBasicMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},c.LineBasicMaterial.prototype=Object.create(c.Material.prototype),c.LineBasicMaterial.prototype.clone=function(){var e=new c.LineBasicMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},c.LineDashedMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},c.LineDashedMaterial.prototype=Object.create(c.Material.prototype),c.LineDashedMaterial.prototype.clone=function(){var e=new c.LineDashedMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},c.MeshBasicMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=c.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=c.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},c.MeshBasicMaterial.prototype=Object.create(c.Material.prototype),c.MeshBasicMaterial.prototype.clone=function(){var e=new c.MeshBasicMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},c.MeshLambertMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.ambient=new c.Color(16777215),this.emissive=new c.Color(0),this.wrapAround=!1,this.wrapRGB=new c.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=c.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=c.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},c.MeshLambertMaterial.prototype=Object.create(c.Material.prototype),c.MeshLambertMaterial.prototype.clone=function(){var e=new c.MeshLambertMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},c.MeshPhongMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.ambient=new c.Color(16777215),this.emissive=new c.Color(0),this.specular=new c.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new c.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new c.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=c.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=c.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},c.MeshPhongMaterial.prototype=Object.create(c.Material.prototype),c.MeshPhongMaterial.prototype.clone=function(){var e=new c.MeshPhongMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},c.MeshDepthMaterial=function(e){c.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},c.MeshDepthMaterial.prototype=Object.create(c.Material.prototype),c.MeshDepthMaterial.prototype.clone=function(){var e=new c.MeshDepthMaterial;return c.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},c.MeshNormalMaterial=function(e){c.Material.call(this,e),this.shading=c.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},c.MeshNormalMaterial.prototype=Object.create(c.Material.prototype),c.MeshNormalMaterial.prototype.clone=function(){var e=new c.MeshNormalMaterial;return c.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},c.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},c.MeshFaceMaterial.prototype.clone=function(){for(var e=new c.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},c.ParticleSystemMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,
this.vertexColors=!1,this.fog=!0,this.setValues(e)},c.ParticleSystemMaterial.prototype=Object.create(c.Material.prototype),c.ParticleSystemMaterial.prototype.clone=function(){var e=new c.ParticleSystemMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},c.ParticleBasicMaterial=c.ParticleSystemMaterial,c.ShaderMaterial=function(e){c.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=c.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)},c.ShaderMaterial.prototype=Object.create(c.Material.prototype),c.ShaderMaterial.prototype.clone=function(){var e=new c.ShaderMaterial;return c.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=c.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},c.SpriteMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.map=new c.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.alignment=c.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new c.Vector2(0,0),this.uvScale=new c.Vector2(1,1),this.setValues(e),e=e||{},void 0===e.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates)},c.SpriteMaterial.prototype=Object.create(c.Material.prototype),c.SpriteMaterial.prototype.clone=function(){var e=new c.SpriteMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},c.SpriteAlignment={},c.SpriteAlignment.topLeft=new c.Vector2(.5,-.5),c.SpriteAlignment.topCenter=new c.Vector2(0,-.5),c.SpriteAlignment.topRight=new c.Vector2(-.5,-.5),c.SpriteAlignment.centerLeft=new c.Vector2(.5,0),c.SpriteAlignment.center=new c.Vector2(0,0),c.SpriteAlignment.centerRight=new c.Vector2(-.5,0),c.SpriteAlignment.bottomLeft=new c.Vector2(.5,.5),c.SpriteAlignment.bottomCenter=new c.Vector2(0,.5),c.SpriteAlignment.bottomRight=new c.Vector2(-.5,.5),c.SpriteCanvasMaterial=function(e){c.Material.call(this),this.color=new c.Color(16777215),this.program=function(e,t){},this.setValues(e)},c.SpriteCanvasMaterial.prototype=Object.create(c.Material.prototype),c.SpriteCanvasMaterial.prototype.clone=function(){var e=new c.SpriteCanvasMaterial;return c.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},c.ParticleCanvasMaterial=c.SpriteCanvasMaterial,c.Texture=function(e,t,i,n,r,o,a,s,l){this.id=c.TextureIdCount++,this.uuid=c.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new c.UVMapping,this.wrapS=void 0!==i?i:c.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:c.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:c.LinearFilter,this.minFilter=void 0!==o?o:c.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:c.RGBAFormat,this.type=void 0!==s?s:c.UnsignedByteType,this.offset=new c.Vector2(0,0),this.repeat=new c.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},c.Texture.prototype={constructor:c.Texture,clone:function(e){return void 0===e&&(e=new c.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.Texture.prototype),c.TextureIdCount=0,c.CompressedTexture=function(e,t,i,n,r,o,a,s,l,u,h){c.Texture.call(this,null,o,a,s,l,u,n,r,h),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=!1},c.CompressedTexture.prototype=Object.create(c.Texture.prototype),c.CompressedTexture.prototype.clone=function(){var e=new c.CompressedTexture;return c.Texture.prototype.clone.call(this,e),e},c.DataTexture=function(e,t,i,n,r,o,a,s,l,u,h){c.Texture.call(this,null,o,a,s,l,u,n,r,h),this.image={data:e,width:t,height:i}},c.DataTexture.prototype=Object.create(c.Texture.prototype),c.DataTexture.prototype.clone=function(){var e=new c.DataTexture;return c.Texture.prototype.clone.call(this,e),e},c.ParticleSystem=function(e,t){c.Object3D.call(this),this.geometry=void 0!==e?e:new c.Geometry,this.material=void 0!==t?t:new c.ParticleSystemMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1},c.ParticleSystem.prototype=Object.create(c.Object3D.prototype),c.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new c.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,c.Object3D.prototype.clone.call(this,e),e},c.Line=function(e,t,i){c.Object3D.call(this),this.geometry=void 0!==e?e:new c.Geometry,this.material=void 0!==t?t:new c.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:c.LineStrip},c.LineStrip=0,c.LinePieces=1,c.Line.prototype=Object.create(c.Object3D.prototype),c.Line.prototype.clone=function(e){return void 0===e&&(e=new c.Line(this.geometry,this.material,this.type)),c.Object3D.prototype.clone.call(this,e),e},c.Mesh=function(e,t){c.Object3D.call(this),this.geometry=void 0!==e?e:new c.Geometry,this.material=void 0!==t?t:new c.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},c.Mesh.prototype=Object.create(c.Object3D.prototype),c.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},c.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},c.Mesh.prototype.clone=function(e){return void 0===e&&(e=new c.Mesh(this.geometry,this.material)),c.Object3D.prototype.clone.call(this,e),e},c.Bone=function(e){c.Object3D.call(this),this.skin=e,this.skinMatrix=new c.Matrix4},c.Bone.prototype=Object.create(c.Object3D.prototype),c.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,n=this.children.length;for(i=0;n>i;i++)this.children[i].update(this.skinMatrix,t)},c.SkinnedMesh=function(e,t,i){c.Mesh.call(this,e,t),this.useVertexTexture=void 0!==i?i:!0,this.identityMatrix=new c.Matrix4,this.bones=[],this.boneMatrices=[];var n,r,o,a,s,l;if(this.geometry&&void 0!==this.geometry.bones){for(n=0;n<this.geometry.bones.length;n++)o=this.geometry.bones[n],a=o.pos,s=o.rotq,l=o.scl,r=this.addBone(),r.name=o.name,r.position.set(a[0],a[1],a[2]),r.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==l?r.scale.set(l[0],l[1],l[2]):r.scale.set(1,1,1);for(n=0;n<this.bones.length;n++)o=this.geometry.bones[n],r=this.bones[n],-1===o.parent?this.add(r):this.bones[o.parent].add(r);var u=this.bones.length;if(this.useVertexTexture){var h;h=u>256?64:u>64?32:u>16?16:8,this.boneTextureWidth=h,this.boneTextureHeight=h,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new c.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,c.RGBAFormat,c.FloatType),this.boneTexture.minFilter=c.NearestFilter,this.boneTexture.magFilter=c.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*u);this.pose()}},c.SkinnedMesh.prototype=Object.create(c.Mesh.prototype),c.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new c.Bone(this)),this.bones.push(e),e},c.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new c.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];r instanceof c.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var o=0,a=this.bones.length;a>o;o++){var s=new c.Matrix4;s.getInverse(this.bones[o].skinMatrix),this.boneInverses.push(s)}}for(var o=0,a=this.bones.length;a>o;o++)e.multiplyMatrices(this.bones[o].skinMatrix,this.boneInverses[o]),e.flattenToArrayOffset(this.boneMatrices,16*o);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),c.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},c.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof c.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();i!==1/0?t.multiplyScalar(i):t.set(1)}},c.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new c.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),c.Mesh.prototype.clone.call(this,e),e},c.MorphAnimMesh=function(e,t){c.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},c.MorphAnimMesh.prototype=Object.create(c.Mesh.prototype),c.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},c.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},c.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},c.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,n=/([a-z]+)(\d+)/,r=0,o=e.morphTargets.length;o>r;r++){var a=e.morphTargets[r],s=a.name.match(n);if(s&&s.length>1){var l=s[1];s[2];i[l]||(i[l]={start:1/0,end:-(1/0)});var u=i[l];r<u.start&&(u.start=r),r>u.end&&(u.end=r),t||(t=l)}}e.firstAnimation=t},c.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},c.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},c.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var i=this.startKeyframe+c.Math.clamp(Math.floor(this.time/t),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var n=this.time%t/t;this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},c.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new c.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,c.Mesh.prototype.clone.call(this,e),e},c.LOD=function(){c.Object3D.call(this),this.objects=[]},c.LOD.prototype=Object.create(c.Object3D.prototype),c.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},c.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;i>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},c.LOD.prototype.update=function(){var e=new c.Vector3,t=new c.Vector3;return function(i){if(this.objects.length>1){e.getPositionFromMatrix(i.matrixWorld),t.getPositionFromMatrix(this.matrixWorld);var n=e.distanceTo(t);this.objects[0].object.visible=!0;for(var r=1,o=this.objects.length;o>r&&n>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;o>r;r++)this.objects[r].object.visible=!1}}}(),c.LOD.prototype.clone=function(){},c.Sprite=function(e){c.Object3D.call(this),this.material=void 0!==e?e:new c.SpriteMaterial,this.rotation=0},c.Sprite.prototype=Object.create(c.Object3D.prototype),c.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},c.Sprite.prototype.clone=function(e){return void 0===e&&(e=new c.Sprite(this.material)),c.Object3D.prototype.clone.call(this,e),e},c.Particle=c.Sprite,c.Scene=function(){c.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},c.Scene.prototype=Object.create(c.Object3D.prototype),c.Scene.prototype.__addObject=function(e){if(e instanceof c.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof c.Camera||e instanceof c.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var i=0;i<e.children.length;i++)this.__addObject(e.children[i])},c.Scene.prototype.__removeObject=function(e){if(e instanceof c.Light){var t=this.__lights.indexOf(e);if(-1!==t&&this.__lights.splice(t,1),e.shadowCascadeArray)for(var i=0;i<e.shadowCascadeArray.length;i++)this.__removeObject(e.shadowCascadeArray[i])}else if(!(e instanceof c.Camera)){this.__objectsRemoved.push(e);var t=this.__objectsAdded.indexOf(e);-1!==t&&this.__objectsAdded.splice(t,1)}for(var n=0;n<e.children.length;n++)this.__removeObject(e.children[n])},c.Scene.prototype.clone=function(e){return void 0===e&&(e=new c.Scene),c.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},c.Fog=function(e,t,i){this.name="",this.color=new c.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},c.Fog.prototype.clone=function(){return new c.Fog(this.color.getHex(),this.near,this.far)},c.FogExp2=function(e,t){this.name="",this.color=new c.Color(e),this.density=void 0!==t?t:25e-5},c.FogExp2.prototype.clone=function(){return new c.FogExp2(this.color.getHex(),this.density)},c.CanvasRenderer=function(e){function t(){Le.setRGB(0,0,0),De.setRGB(0,0,0),Ne.setRGB(0,0,0);for(var e=0,t=C.length;t>e;e++){var i=C[e],n=i.color;i instanceof c.AmbientLight?Le.add(n):i instanceof c.DirectionalLight?De.add(n):i instanceof c.PointLight&&Ne.add(n)}}function i(e,t,i){for(var n=0,r=C.length;r>n;n++){var o=C[n];if(Se.copy(o.color),o instanceof c.DirectionalLight){var a=Re.getPositionFromMatrix(o.matrixWorld).normalize(),s=t.dot(a);if(0>=s)continue;s*=o.intensity,i.add(Se.multiplyScalar(s))}else if(o instanceof c.PointLight){var a=Re.getPositionFromMatrix(o.matrixWorld),s=t.dot(Re.subVectors(a,e).normalize());if(0>=s)continue;if(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1),0==s)continue;s*=o.intensity,i.add(Se.multiplyScalar(s))}}}function n(e,t,i){p(i.opacity),m(i.blending);var n,r,o,a,s,l,u;if(i instanceof c.SpriteMaterial||i instanceof c.ParticleSystemMaterial)if(void 0!==i.map.image){if(s=i.map.image,l=s.width>>1,u=s.height>>1,o=t.scale.x*ne,a=t.scale.y*re,n=o*l,r=a*u,Pe.min.set(e.x-n,e.y-r),Pe.max.set(e.x+n,e.y+r),Ee.isIntersectionBox(Pe)===!1)return void Pe.makeEmpty();oe.save(),oe.translate(e.x,e.y),oe.rotate(-t.rotation),oe.scale(o,-a),oe.translate(-l,-u),oe.drawImage(s,0,0),oe.restore()}else{if(o=t.object.scale.x,a=t.object.scale.y,o*=t.scale.x*ne,a*=t.scale.y*re,Pe.min.set(e.x-o,e.y-a),Pe.max.set(e.x+o,e.y+a),Ee.isIntersectionBox(Pe)===!1)return void Pe.makeEmpty();b(i.color.getStyle()),oe.save(),oe.translate(e.x,e.y),oe.rotate(-t.rotation),oe.scale(o,a),oe.fillRect(-1,-1,2,2),oe.restore()}else if(i instanceof c.SpriteCanvasMaterial){if(n=t.scale.x*ne,r=t.scale.y*re,Pe.min.set(e.x-n,e.y-r),Pe.max.set(e.x+n,e.y+r),Ee.isIntersectionBox(Pe)===!1)return void Pe.makeEmpty();x(i.color.getStyle()),b(i.color.getStyle()),oe.save(),oe.translate(e.x,e.y),oe.rotate(-t.rotation),oe.scale(n,r),i.program(oe),oe.restore()}}function r(e,t,i,n){if(p(n.opacity),m(n.blending),oe.beginPath(),oe.moveTo(e.positionScreen.x,e.positionScreen.y),oe.lineTo(t.positionScreen.x,t.positionScreen.y),n instanceof c.LineBasicMaterial){if(g(n.linewidth),v(n.linecap),y(n.linejoin),n.vertexColors!==c.VertexColors)x(n.color.getStyle());else{var r=i.vertexColors[0].getStyle(),o=i.vertexColors[1].getStyle();if(r===o)x(r);else{try{var a=oe.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,r),a.addColorStop(1,o)}catch(s){a=r}x(a)}}oe.stroke(),Pe.expandByScalar(2*n.linewidth)}else n instanceof c.LineDashedMaterial&&(g(n.linewidth),v(n.linecap),y(n.linejoin),x(n.color.getStyle()),w(n.dashSize,n.gapSize),oe.stroke(),Pe.expandByScalar(2*n.linewidth),w(null,null))}function o(e,t,n,r,o,d,g,v){if(Q.info.render.vertices+=3,Q.info.render.faces++,p(v.opacity),m(v.blending),L=e.positionScreen.x,D=e.positionScreen.y,N=t.positionScreen.x,R=t.positionScreen.y,O=n.positionScreen.x,F=n.positionScreen.y,a(L,D,N,R,O,F),(v instanceof c.MeshLambertMaterial||v instanceof c.MeshPhongMaterial)&&null===v.map)_e.copy(v.color),Me.copy(v.emissive),v.vertexColors===c.FaceColors&&_e.multiply(g.color),v.wireframe===!1&&v.shading==c.SmoothShading&&3==g.vertexNormalsLength?(ye.copy(Le),xe.copy(Le),be.copy(Le),i(g.v1.positionWorld,g.vertexNormalsModel[0],ye),i(g.v2.positionWorld,g.vertexNormalsModel[1],xe),i(g.v3.positionWorld,g.vertexNormalsModel[2],be),ye.multiply(_e).add(Me),xe.multiply(_e).add(Me),be.multiply(_e).add(Me),we.addColors(xe,be).multiplyScalar(.5),B=f(ye,xe,be,we),h(L,D,N,R,O,F,0,0,1,0,0,1,B)):(ve.copy(Le),i(g.centroidModel,g.normalModel,ve),ve.multiply(_e).add(Me),v.wireframe===!0?s(ve,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):l(ve));else if(v instanceof c.MeshBasicMaterial||v instanceof c.MeshLambertMaterial||v instanceof c.MeshPhongMaterial)null!==v.map?v.map.mapping instanceof c.UVMapping&&(V=g.uvs[0],u(L,D,N,R,O,F,V[r].x,V[r].y,V[o].x,V[o].y,V[d].x,V[d].y,v.map)):null!==v.envMap?v.envMap.mapping instanceof c.SphericalReflectionMapping&&(Re.copy(g.vertexNormalsModelView[r]),U=.5*Re.x+.5,z=.5*Re.y+.5,Re.copy(g.vertexNormalsModelView[o]),$=.5*Re.x+.5,H=.5*Re.y+.5,Re.copy(g.vertexNormalsModelView[d]),j=.5*Re.x+.5,W=.5*Re.y+.5,u(L,D,N,R,O,F,U,z,$,H,j,W,v.envMap)):(ve.copy(v.color),v.vertexColors===c.FaceColors&&ve.multiply(g.color),v.wireframe===!0?s(ve,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):l(ve));else if(v instanceof c.MeshDepthMaterial)I=T.near,k=T.far,ye.r=ye.g=ye.b=1-_(e.positionScreen.z*e.positionScreen.w,I,k),xe.r=xe.g=xe.b=1-_(t.positionScreen.z*t.positionScreen.w,I,k),be.r=be.g=be.b=1-_(n.positionScreen.z*n.positionScreen.w,I,k),we.addColors(xe,be).multiplyScalar(.5),B=f(ye,xe,be,we),h(L,D,N,R,O,F,0,0,1,0,0,1,B);else if(v instanceof c.MeshNormalMaterial){var y;v.shading==c.FlatShading?(y=g.normalModelView,ve.setRGB(y.x,y.y,y.z).multiplyScalar(.5).addScalar(.5),v.wireframe===!0?s(ve,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):l(ve)):v.shading==c.SmoothShading&&(y=g.vertexNormalsModelView[r],ye.setRGB(y.x,y.y,y.z).multiplyScalar(.5).addScalar(.5),y=g.vertexNormalsModelView[o],xe.setRGB(y.x,y.y,y.z).multiplyScalar(.5).addScalar(.5),y=g.vertexNormalsModelView[d],be.setRGB(y.x,y.y,y.z).multiplyScalar(.5).addScalar(.5),we.addColors(xe,be).multiplyScalar(.5),B=f(ye,xe,be,we),h(L,D,N,R,O,F,0,0,1,0,0,1,B))}}function a(e,t,i,n,r,o){oe.beginPath(),oe.moveTo(e,t),oe.lineTo(i,n),oe.lineTo(r,o),oe.closePath()}function s(e,t,i,n){g(t),v(i),y(n),x(e.getStyle()),oe.stroke(),Pe.expandByScalar(2*t)}function l(e){b(e.getStyle()),oe.fill()}function u(e,t,i,n,r,o,a,s,u,h,f,d,p){if(!(p instanceof c.DataTexture||void 0===p.image||0==p.image.width)){if(p.needsUpdate===!0){var m=p.wrapS==c.RepeatWrapping,g=p.wrapT==c.RepeatWrapping;Ce[p.id]=oe.createPattern(p.image,m===!0&&g===!0?"repeat":m===!0&&g===!1?"repeat-x":m===!1&&g===!0?"repeat-y":"no-repeat"),p.needsUpdate=!1}b(void 0===Ce[p.id]?"rgba(0,0,0,1)":Ce[p.id]);var v,y,x,w,_,M,S,C,T=p.offset.x/p.repeat.x,E=p.offset.y/p.repeat.y,A=p.image.width*p.repeat.x,P=p.image.height*p.repeat.y;if(a=(a+T)*A,s=(1-s+E)*P,u=(u+T)*A,h=(1-h+E)*P,f=(f+T)*A,d=(1-d+E)*P,i-=e,n-=t,r-=e,o-=t,u-=a,h-=s,f-=a,d-=s,S=u*d-f*h,0===S){if(void 0===Te[p.id]){var L=document.createElement("canvas");L.width=p.image.width,L.height=p.image.height;var D=L.getContext("2d");D.drawImage(p.image,0,0),Te[p.id]=D.getImageData(0,0,p.image.width,p.image.height).data}var N=Te[p.id],R=4*(Math.floor(a)+Math.floor(s)*p.image.width);return ve.setRGB(N[R]/255,N[R+1]/255,N[R+2]/255),void l(ve)}C=1/S,v=(d*i-h*r)*C,y=(d*n-h*o)*C,x=(u*r-f*i)*C,w=(u*o-f*n)*C,_=e-v*a-x*s,M=t-y*a-w*s,oe.save(),oe.transform(v,y,x,w,_,M),oe.fill(),oe.restore()}}function h(e,t,i,n,r,o,a,s,l,u,h,c,f){var d,p,m,g,v,y,x,b,w=f.width-1,_=f.height-1;a*=w,s*=_,l*=w,u*=_,h*=w,c*=_,i-=e,n-=t,r-=e,o-=t,l-=a,u-=s,h-=a,c-=s,x=l*c-h*u,b=1/x,d=(c*i-u*r)*b,p=(c*n-u*o)*b,m=(l*r-h*i)*b,g=(l*o-h*n)*b,v=e-d*a-m*s,y=t-p*a-g*s,oe.save(),oe.transform(d,p,m,g,v,y),oe.clip(),oe.drawImage(f,0,0),oe.restore()}function f(e,t,i,n){return Y[0]=255*e.r|0,Y[1]=255*e.g|0,Y[2]=255*e.b|0,Y[4]=255*t.r|0,Y[5]=255*t.g|0,Y[6]=255*t.b|0,Y[8]=255*i.r|0,Y[9]=255*i.g|0,Y[10]=255*i.b|0,Y[12]=255*n.r|0,Y[13]=255*n.g|0,Y[14]=255*n.b|0,X.putImageData(q,0,0),Z.drawImage(G,0,0),K}function d(e,t,i){var n,r=t.x-e.x,o=t.y-e.y,a=r*r+o*o;0!==a&&(n=i/Math.sqrt(a),r*=n,o*=n,t.x+=r,t.y+=o,e.x-=r,e.y-=o)}function p(e){le!==e&&(oe.globalAlpha=e,le=e)}function m(e){ue!==e&&(e===c.NormalBlending?oe.globalCompositeOperation="source-over":e===c.AdditiveBlending?oe.globalCompositeOperation="lighter":e===c.SubtractiveBlending&&(oe.globalCompositeOperation="darker"),ue=e)}function g(e){fe!==e&&(oe.lineWidth=e,fe=e)}function v(e){de!==e&&(oe.lineCap=e,de=e)}function y(e){pe!==e&&(oe.lineJoin=e,pe=e)}function x(e){he!==e&&(oe.strokeStyle=e,he=e)}function b(e){ce!==e&&(oe.fillStyle=e,ce=e)}function w(e,t){(me!==e||ge!==t)&&(oe.setLineDash([e,t]),me=e,ge=t)}console.log("THREE.CanvasRenderer",c.REVISION);var _=c.Math.smoothstep;e=e||{};var M,S,C,T,E,A,P,L,D,N,R,O,F,I,k,B,V,U,z,$,H,j,W,G,X,q,Y,K,Z,Q=this,J=new c.Projector,ee=void 0!==e.canvas?e.canvas:document.createElement("canvas"),te=ee.width,ie=ee.height,ne=Math.floor(te/2),re=Math.floor(ie/2),oe=ee.getContext("2d"),ae=new c.Color(0),se=0,le=1,ue=0,he=null,ce=null,fe=null,de=null,pe=null,me=null,ge=0,ve=(new c.RenderableVertex,new c.RenderableVertex,new c.Color),ye=new c.Color,xe=new c.Color,be=new c.Color,we=new c.Color,_e=new c.Color,Me=new c.Color,Se=new c.Color,Ce={},Te={},Ee=new c.Box2,Ae=new c.Box2,Pe=new c.Box2,Le=new c.Color,De=new c.Color,Ne=new c.Color,Re=new c.Vector3,Oe=16;G=document.createElement("canvas"),G.width=G.height=2,X=G.getContext("2d"),X.fillStyle="rgba(0,0,0,1)",X.fillRect(0,0,2,2),q=X.getImageData(0,0,2,2),Y=q.data,K=document.createElement("canvas"),K.width=K.height=Oe,Z=K.getContext("2d"),Z.translate(-Oe/2,-Oe/2),Z.scale(Oe,Oe),Oe--,void 0===oe.setLineDash&&(void 0!==oe.mozDash?oe.setLineDash=function(e){oe.mozDash=null!==e[0]?e:null}:oe.setLineDash=function(){}),this.domElement=ee,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,i){te=e*this.devicePixelRatio,ie=t*this.devicePixelRatio,ne=Math.floor(te/2),re=Math.floor(ie/2),ee.width=te,ee.height=ie,1!==this.devicePixelRatio&&i!==!1&&(ee.style.width=e+"px",ee.style.height=t+"px"),Ee.set(new c.Vector2(-ne,-re),new c.Vector2(ne,re)),Ae.set(new c.Vector2(-ne,-re),new c.Vector2(ne,re)),le=1,ue=0,he=null,ce=null,fe=null,de=null,pe=null},this.setClearColor=function(e,t){ae.set(e),se=void 0!==t?t:1,Ae.set(new c.Vector2(-ne,-re),new c.Vector2(ne,re))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){oe.setTransform(1,0,0,-1,ne,re),Ae.empty()===!1&&(Ae.intersect(Ee),Ae.expandByScalar(2),1>se&&oe.clearRect(0|Ae.min.x,0|Ae.min.y,Ae.max.x-Ae.min.x|0,Ae.max.y-Ae.min.y|0),se>0&&(m(c.NormalBlending),p(1),b("rgba("+Math.floor(255*ae.r)+","+Math.floor(255*ae.g)+","+Math.floor(255*ae.b)+","+se+")"),oe.fillRect(0|Ae.min.x,0|Ae.min.y,Ae.max.x-Ae.min.x|0,Ae.max.y-Ae.min.y|0)),Ae.makeEmpty())},this.render=function(e,i){if(i instanceof c.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),oe.setTransform(1,0,0,-1,ne,re),Q.info.render.vertices=0,Q.info.render.faces=0,M=J.projectScene(e,i,this.sortObjects,this.sortElements),S=M.elements,C=M.lights,T=i,t();for(var a=0,s=S.length;s>a;a++){var l=S[a],u=l.material;if(void 0!==u&&u.visible!==!1){if(Pe.makeEmpty(),l instanceof c.RenderableSprite)E=l,E.x*=ne,E.y*=re,n(E,l,u);else if(l instanceof c.RenderableLine)E=l.v1,A=l.v2,E.positionScreen.x*=ne,E.positionScreen.y*=re,A.positionScreen.x*=ne,A.positionScreen.y*=re,Pe.setFromPoints([E.positionScreen,A.positionScreen]),Ee.isIntersectionBox(Pe)===!0&&r(E,A,l,u);else if(l instanceof c.RenderableFace3){if(E=l.v1,A=l.v2,P=l.v3,E.positionScreen.z<-1||E.positionScreen.z>1)continue;if(A.positionScreen.z<-1||A.positionScreen.z>1)continue;if(P.positionScreen.z<-1||P.positionScreen.z>1)continue;E.positionScreen.x*=ne,E.positionScreen.y*=re,A.positionScreen.x*=ne,A.positionScreen.y*=re,P.positionScreen.x*=ne,P.positionScreen.y*=re,u.overdraw>0&&(d(E.positionScreen,A.positionScreen,u.overdraw),d(A.positionScreen,P.positionScreen,u.overdraw),d(P.positionScreen,E.positionScreen,u.overdraw)),Pe.setFromPoints([E.positionScreen,A.positionScreen,P.positionScreen]),Ee.isIntersectionBox(Pe)===!0&&o(E,A,P,0,1,2,l,u)}Ae.union(Pe)}}oe.setTransform(1,0,0,1,0,0)}},c.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),
map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},c.UniformsUtils={merge:function(e){var t,i,n,r={};for(t=0;t<e.length;t++){n=this.clone(e[t]);for(i in n)r[i]=n[i]}return r},clone:function(e){var t,i,n,r={};for(t in e){r[t]={};for(i in e[t])n=e[t][i],n instanceof c.Color||n instanceof c.Vector2||n instanceof c.Vector3||n instanceof c.Vector4||n instanceof c.Matrix4||n instanceof c.Texture?r[t][i]=n.clone():n instanceof Array?r[t][i]=n.slice():r[t][i]=n}return r}},c.UniformsLib={common:{diffuse:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new c.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new c.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new c.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{
type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new c.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},c.ShaderLib={basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.shadowmap]),vertexShader:[c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",c.ShaderChunk.morphnormal_vertex,c.ShaderChunk.skinnormal_vertex,c.ShaderChunk.defaultnormal_vertex,"#endif",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.worldpos_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.specularmap_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(16777215)},emissive:{type:"c",value:new c.Color(0)},wrapRGB:{type:"v3",value:new c.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_lambert_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.morphnormal_vertex,c.ShaderChunk.skinbase_vertex,c.ShaderChunk.skinnormal_vertex,c.ShaderChunk.defaultnormal_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.worldpos_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.lights_lambert_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.bump,c.UniformsLib.normalmap,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{ambient:{type:"c",value:new c.Color(16777215)},emissive:{type:"c",value:new c.Color(0)},specular:{type:"c",value:new c.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new c.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_phong_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.morphnormal_vertex,c.ShaderChunk.skinbase_vertex,c.ShaderChunk.skinnormal_vertex,c.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",c.ShaderChunk.worldpos_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.lights_phong_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.lights_phong_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.bumpmap_pars_fragment,c.ShaderChunk.normalmap_pars_fragment,c.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",c.ShaderChunk.map_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.specularmap_fragment,c.ShaderChunk.lights_phong_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.particle,c.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",c.ShaderChunk.color_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",c.ShaderChunk.worldpos_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_particle_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",c.ShaderChunk.map_particle_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",c.ShaderChunk.color_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",c.ShaderChunk.color_pars_fragment,c.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",c.ShaderChunk.color_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",c.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:c.UniformsUtils.merge([c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new c.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new c.Color(16777215)},uSpecularColor:{type:"c",value:new c.Color(1118481)},uAmbientColor:{type:"c",value:new c.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new c.Vector2(0,0)},uRepeat:{type:"v2",value:new c.Vector2(1,1)},wrapRGB:{type:"v3",value:new c.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,"void main() {",c.ShaderChunk.skinbase_vertex,c.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,"void main() {",c.ShaderChunk.skinbase_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},c.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Fe.createBuffer(),e.__webglColorBuffer=Fe.createBuffer(),ze.info.memory.geometries++}function i(e){e.__webglVertexBuffer=Fe.createBuffer(),e.__webglColorBuffer=Fe.createBuffer(),e.__webglLineDistanceBuffer=Fe.createBuffer(),ze.info.memory.geometries++}function n(e){e.__webglVertexBuffer=Fe.createBuffer(),e.__webglNormalBuffer=Fe.createBuffer(),e.__webglTangentBuffer=Fe.createBuffer(),e.__webglColorBuffer=Fe.createBuffer(),e.__webglUVBuffer=Fe.createBuffer(),e.__webglUV2Buffer=Fe.createBuffer(),e.__webglSkinIndicesBuffer=Fe.createBuffer(),e.__webglSkinWeightsBuffer=Fe.createBuffer(),e.__webglFaceBuffer=Fe.createBuffer(),e.__webglLineBuffer=Fe.createBuffer();var t,i;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,i=e.numMorphTargets;i>t;t++)e.__webglMorphTargetsBuffers.push(Fe.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,i=e.numMorphNormals;i>t;t++)e.__webglMorphNormalsBuffers.push(Fe.createBuffer());ze.info.memory.geometries++}function r(e,t){var i=e.vertices.length,n=t.material;if(n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var r in n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=Fe.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function o(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i,r(e,t)}function a(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,r(e,t)}function s(e,t){var i=t.geometry,n=e.faces3,r=3*n.length,o=1*n.length,a=3*n.length,s=l(t,e),u=d(s),c=h(s),p=f(s);e.__vertexArray=new Float32Array(3*r),c&&(e.__normalArray=new Float32Array(3*r)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),p&&(e.__colorArray=new Float32Array(3*r)),u&&(i.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*r)),i.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r)),e.__faceArray=new Uint16Array(3*o),e.__lineArray=new Uint16Array(2*a);var m,g;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],m=0,g=e.numMorphTargets;g>m;m++)e.__morphTargetsArrays.push(new Float32Array(3*r));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],m=0,g=e.numMorphNormals;g>m;m++)e.__morphNormalsArrays.push(new Float32Array(3*r));if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var v in s.attributes){var y=s.attributes[v],x={};for(var b in y)x[b]=y[b];if(!x.__webglInitialized||x.createUniqueBuffers){x.__webglInitialized=!0;var w=1;"v2"===x.type?w=2:"v3"===x.type?w=3:"v4"===x.type?w=4:"c"===x.type&&(w=3),x.size=w,x.array=new Float32Array(r*w),x.buffer=Fe.createBuffer(),x.buffer.belongsToAttribute=v,y.needsUpdate=!0,x.__original=y}e.__webglCustomAttributesList.push(x)}}e.__inittedArrays=!0}function l(e,t){return e.material instanceof c.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function u(e){return e&&void 0!==e.shading&&e.shading===c.SmoothShading}function h(e){return e instanceof c.MeshBasicMaterial&&!e.envMap||e instanceof c.MeshDepthMaterial?!1:u(e)?c.SmoothShading:c.FlatShading}function f(e){return e.vertexColors?e.vertexColors:!1}function d(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof c.ShaderMaterial?!0:!1}function p(e){var t,i,n;for(t in e.attributes)n="index"===t?Fe.ELEMENT_ARRAY_BUFFER:Fe.ARRAY_BUFFER,i=e.attributes[t],void 0===i.numItems&&(i.numItems=i.array.length),i.buffer=Fe.createBuffer(),Fe.bindBuffer(n,i.buffer),Fe.bufferData(n,i.array,Fe.STATIC_DRAW)}function m(e,t,i){var n,r,o,a,s,l,u,h,c,f,d,p,m=e.vertices,g=m.length,v=e.colors,y=v.length,x=e.__vertexArray,b=e.__colorArray,w=e.__sortArray,_=e.verticesNeedUpdate,S=(e.elementsNeedUpdate,e.colorsNeedUpdate),C=e.__webglCustomAttributesList;if(i.sortParticles){for(yt.copy(vt),yt.multiply(i.matrixWorld),n=0;g>n;n++)o=m[n],xt.copy(o),xt.applyProjection(yt),w[n]=[xt.z,n];for(w.sort(M),n=0;g>n;n++)o=m[w[n][1]],a=3*n,x[a]=o.x,x[a+1]=o.y,x[a+2]=o.z;for(r=0;y>r;r++)a=3*r,l=v[w[r][1]],b[a]=l.r,b[a+1]=l.g,b[a+2]=l.b;if(C)for(u=0,h=C.length;h>u;u++)if(p=C[u],void 0===p.boundTo||"vertices"===p.boundTo)if(a=0,f=p.value.length,1===p.size)for(c=0;f>c;c++)s=w[c][1],p.array[c]=p.value[s];else if(2===p.size)for(c=0;f>c;c++)s=w[c][1],d=p.value[s],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(c=0;f>c;c++)s=w[c][1],d=p.value[s],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(c=0;f>c;c++)s=w[c][1],d=p.value[s],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(c=0;f>c;c++)s=w[c][1],d=p.value[s],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4}else{if(_)for(n=0;g>n;n++)o=m[n],a=3*n,x[a]=o.x,x[a+1]=o.y,x[a+2]=o.z;if(S)for(r=0;y>r;r++)l=v[r],a=3*r,b[a]=l.r,b[a+1]=l.g,b[a+2]=l.b;if(C)for(u=0,h=C.length;h>u;u++)if(p=C[u],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo))if(f=p.value.length,a=0,1===p.size)for(c=0;f>c;c++)p.array[c]=p.value[c];else if(2===p.size)for(c=0;f>c;c++)d=p.value[c],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(c=0;f>c;c++)d=p.value[c],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(c=0;f>c;c++)d=p.value[c],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(c=0;f>c;c++)d=p.value[c],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4}if((_||i.sortParticles)&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglVertexBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,x,t)),(S||i.sortParticles)&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglColorBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,b,t)),C)for(u=0,h=C.length;h>u;u++)p=C[u],(p.needsUpdate||i.sortParticles)&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,p.buffer),Fe.bufferData(Fe.ARRAY_BUFFER,p.array,t))}function g(e,t){var i,n,r,o,a,s,l,u,h,c,f,d,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,x=g.length,b=e.__vertexArray,w=e.__colorArray,_=e.__lineDistanceArray,M=e.verticesNeedUpdate,S=e.colorsNeedUpdate,C=e.lineDistancesNeedUpdate,T=e.__webglCustomAttributesList;if(M){for(i=0;v>i;i++)o=p[i],a=3*i,b[a]=o.x,b[a+1]=o.y,b[a+2]=o.z;Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglVertexBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,b,t)}if(S){for(n=0;y>n;n++)s=m[n],a=3*n,w[a]=s.r,w[a+1]=s.g,w[a+2]=s.b;Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglColorBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,w,t)}if(C){for(r=0;x>r;r++)_[r]=g[r];Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,_,t)}if(T)for(l=0,u=T.length;u>l;l++)if(d=T[l],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(a=0,c=d.value.length,1===d.size)for(h=0;c>h;h++)d.array[h]=d.value[h];else if(2===d.size)for(h=0;c>h;h++)f=d.value[h],d.array[a]=f.x,d.array[a+1]=f.y,a+=2;else if(3===d.size)if("c"===d.type)for(h=0;c>h;h++)f=d.value[h],
d.array[a]=f.r,d.array[a+1]=f.g,d.array[a+2]=f.b,a+=3;else for(h=0;c>h;h++)f=d.value[h],d.array[a]=f.x,d.array[a+1]=f.y,d.array[a+2]=f.z,a+=3;else if(4===d.size)for(h=0;c>h;h++)f=d.value[h],d.array[a]=f.x,d.array[a+1]=f.y,d.array[a+2]=f.z,d.array[a+3]=f.w,a+=4;Fe.bindBuffer(Fe.ARRAY_BUFFER,d.buffer),Fe.bufferData(Fe.ARRAY_BUFFER,d.array,t)}}function v(e,t,i,n,r){if(e.__inittedArrays){var o,a,s,l,u,p,m,g,v,y,x,b,w,_,M,S,C,T,E,A,P,L,D,N,R,O,F,I,k,B,V,U,z,$,H,j,W,G,X,q,Y,K,Z=h(r),Q=f(r),J=d(r),ee=Z===c.SmoothShading,te=0,ie=0,ne=0,re=0,oe=0,ae=0,se=0,le=0,ue=0,he=0,ce=0,fe=0,de=0,pe=e.__vertexArray,me=e.__uvArray,ge=e.__uv2Array,ve=e.__normalArray,ye=e.__tangentArray,xe=e.__colorArray,be=e.__skinIndexArray,we=e.__skinWeightArray,_e=e.__morphTargetsArrays,Me=e.__morphNormalsArrays,Se=e.__webglCustomAttributesList,Ce=e.__faceArray,Te=e.__lineArray,Ee=t.geometry,Ae=Ee.verticesNeedUpdate,Pe=Ee.elementsNeedUpdate,Le=Ee.uvsNeedUpdate,De=Ee.normalsNeedUpdate,Ne=Ee.tangentsNeedUpdate,Re=Ee.colorsNeedUpdate,Oe=Ee.morphTargetsNeedUpdate,Ie=Ee.vertices,ke=e.faces3,Be=Ee.faces,Ve=Ee.faceVertexUvs[0],Ue=Ee.faceVertexUvs[1],ze=(Ee.colors,Ee.skinIndices),$e=Ee.skinWeights,He=Ee.morphTargets,je=Ee.morphNormals;if(Ae){for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],b=Ie[l.a],w=Ie[l.b],_=Ie[l.c],pe[ie]=b.x,pe[ie+1]=b.y,pe[ie+2]=b.z,pe[ie+3]=w.x,pe[ie+4]=w.y,pe[ie+5]=w.z,pe[ie+6]=_.x,pe[ie+7]=_.y,pe[ie+8]=_.z,ie+=9;Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglVertexBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,pe,i)}if(Oe)for(H=0,j=He.length;j>H;H++){for(ce=0,o=0,a=ke.length;a>o;o++)X=ke[o],l=Be[X],b=He[H].vertices[l.a],w=He[H].vertices[l.b],_=He[H].vertices[l.c],W=_e[H],W[ce]=b.x,W[ce+1]=b.y,W[ce+2]=b.z,W[ce+3]=w.x,W[ce+4]=w.y,W[ce+5]=w.z,W[ce+6]=_.x,W[ce+7]=_.y,W[ce+8]=_.z,r.morphNormals&&(ee?(q=je[H].vertexNormals[X],T=q.a,E=q.b,A=q.c):(T=je[H].faceNormals[X],E=T,A=T),G=Me[H],G[ce]=T.x,G[ce+1]=T.y,G[ce+2]=T.z,G[ce+3]=E.x,G[ce+4]=E.y,G[ce+5]=E.z,G[ce+6]=A.x,G[ce+7]=A.y,G[ce+8]=A.z),ce+=9;Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[H]),Fe.bufferData(Fe.ARRAY_BUFFER,_e[H],i),r.morphNormals&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[H]),Fe.bufferData(Fe.ARRAY_BUFFER,Me[H],i))}if($e.length){for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],N=$e[l.a],R=$e[l.b],O=$e[l.c],we[he]=N.x,we[he+1]=N.y,we[he+2]=N.z,we[he+3]=N.w,we[he+4]=R.x,we[he+5]=R.y,we[he+6]=R.z,we[he+7]=R.w,we[he+8]=O.x,we[he+9]=O.y,we[he+10]=O.z,we[he+11]=O.w,F=ze[l.a],I=ze[l.b],k=ze[l.c],be[he]=F.x,be[he+1]=F.y,be[he+2]=F.z,be[he+3]=F.w,be[he+4]=I.x,be[he+5]=I.y,be[he+6]=I.z,be[he+7]=I.w,be[he+8]=k.x,be[he+9]=k.y,be[he+10]=k.z,be[he+11]=k.w,he+=12;he>0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,be,i),Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,we,i))}if(Re&&Q){for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],m=l.vertexColors,g=l.color,3===m.length&&Q===c.VertexColors?(P=m[0],L=m[1],D=m[2]):(P=g,L=g,D=g),xe[ue]=P.r,xe[ue+1]=P.g,xe[ue+2]=P.b,xe[ue+3]=L.r,xe[ue+4]=L.g,xe[ue+5]=L.b,xe[ue+6]=D.r,xe[ue+7]=D.g,xe[ue+8]=D.b,ue+=9;ue>0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglColorBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,xe,i))}if(Ne&&Ee.hasTangents){for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],v=l.vertexTangents,M=v[0],S=v[1],C=v[2],ye[se]=M.x,ye[se+1]=M.y,ye[se+2]=M.z,ye[se+3]=M.w,ye[se+4]=S.x,ye[se+5]=S.y,ye[se+6]=S.z,ye[se+7]=S.w,ye[se+8]=C.x,ye[se+9]=C.y,ye[se+10]=C.z,ye[se+11]=C.w,se+=12;Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglTangentBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,ye,i)}if(De&&Z){for(o=0,a=ke.length;a>o;o++)if(l=Be[ke[o]],u=l.vertexNormals,p=l.normal,3===u.length&&ee)for(B=0;3>B;B++)U=u[B],ve[ae]=U.x,ve[ae+1]=U.y,ve[ae+2]=U.z,ae+=3;else for(B=0;3>B;B++)ve[ae]=p.x,ve[ae+1]=p.y,ve[ae+2]=p.z,ae+=3;Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglNormalBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,ve,i)}if(Le&&Ve&&J){for(o=0,a=ke.length;a>o;o++)if(s=ke[o],y=Ve[s],void 0!==y)for(B=0;3>B;B++)z=y[B],me[ne]=z.x,me[ne+1]=z.y,ne+=2;ne>0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglUVBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,me,i))}if(Le&&Ue&&J){for(o=0,a=ke.length;a>o;o++)if(s=ke[o],x=Ue[s],void 0!==x)for(B=0;3>B;B++)$=x[B],ge[re]=$.x,ge[re+1]=$.y,re+=2;re>0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglUV2Buffer),Fe.bufferData(Fe.ARRAY_BUFFER,ge,i))}if(Pe){for(o=0,a=ke.length;a>o;o++)Ce[oe]=te,Ce[oe+1]=te+1,Ce[oe+2]=te+2,oe+=3,Te[le]=te,Te[le+1]=te+1,Te[le+2]=te,Te[le+3]=te+2,Te[le+4]=te+1,Te[le+5]=te+2,le+=6,te+=3;Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Fe.bufferData(Fe.ELEMENT_ARRAY_BUFFER,Ce,i),Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Fe.bufferData(Fe.ELEMENT_ARRAY_BUFFER,Te,i)}if(Se)for(B=0,V=Se.length;V>B;B++)if(K=Se[B],K.__original.needsUpdate){if(fe=0,de=0,1===K.size){if(void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],K.array[fe]=K.value[l.a],K.array[fe+1]=K.value[l.b],K.array[fe+2]=K.value[l.c],fe+=3;else if("faces"===K.boundTo)for(o=0,a=ke.length;a>o;o++)Y=K.value[ke[o]],K.array[fe]=Y,K.array[fe+1]=Y,K.array[fe+2]=Y,fe+=3}else if(2===K.size){if(void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],b=K.value[l.a],w=K.value[l.b],_=K.value[l.c],K.array[fe]=b.x,K.array[fe+1]=b.y,K.array[fe+2]=w.x,K.array[fe+3]=w.y,K.array[fe+4]=_.x,K.array[fe+5]=_.y,fe+=6;else if("faces"===K.boundTo)for(o=0,a=ke.length;a>o;o++)Y=K.value[ke[o]],b=Y,w=Y,_=Y,K.array[fe]=b.x,K.array[fe+1]=b.y,K.array[fe+2]=w.x,K.array[fe+3]=w.y,K.array[fe+4]=_.x,K.array[fe+5]=_.y,fe+=6}else if(3===K.size){var We;if(We="c"===K.type?["r","g","b"]:["x","y","z"],void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],b=K.value[l.a],w=K.value[l.b],_=K.value[l.c],K.array[fe]=b[We[0]],K.array[fe+1]=b[We[1]],K.array[fe+2]=b[We[2]],K.array[fe+3]=w[We[0]],K.array[fe+4]=w[We[1]],K.array[fe+5]=w[We[2]],K.array[fe+6]=_[We[0]],K.array[fe+7]=_[We[1]],K.array[fe+8]=_[We[2]],fe+=9;else if("faces"===K.boundTo)for(o=0,a=ke.length;a>o;o++)Y=K.value[ke[o]],b=Y,w=Y,_=Y,K.array[fe]=b[We[0]],K.array[fe+1]=b[We[1]],K.array[fe+2]=b[We[2]],K.array[fe+3]=w[We[0]],K.array[fe+4]=w[We[1]],K.array[fe+5]=w[We[2]],K.array[fe+6]=_[We[0]],K.array[fe+7]=_[We[1]],K.array[fe+8]=_[We[2]],fe+=9;else if("faceVertices"===K.boundTo)for(o=0,a=ke.length;a>o;o++)Y=K.value[ke[o]],b=Y[0],w=Y[1],_=Y[2],K.array[fe]=b[We[0]],K.array[fe+1]=b[We[1]],K.array[fe+2]=b[We[2]],K.array[fe+3]=w[We[0]],K.array[fe+4]=w[We[1]],K.array[fe+5]=w[We[2]],K.array[fe+6]=_[We[0]],K.array[fe+7]=_[We[1]],K.array[fe+8]=_[We[2]],fe+=9}else if(4===K.size)if(void 0===K.boundTo||"vertices"===K.boundTo)for(o=0,a=ke.length;a>o;o++)l=Be[ke[o]],b=K.value[l.a],w=K.value[l.b],_=K.value[l.c],K.array[fe]=b.x,K.array[fe+1]=b.y,K.array[fe+2]=b.z,K.array[fe+3]=b.w,K.array[fe+4]=w.x,K.array[fe+5]=w.y,K.array[fe+6]=w.z,K.array[fe+7]=w.w,K.array[fe+8]=_.x,K.array[fe+9]=_.y,K.array[fe+10]=_.z,K.array[fe+11]=_.w,fe+=12;else if("faces"===K.boundTo)for(o=0,a=ke.length;a>o;o++)Y=K.value[ke[o]],b=Y,w=Y,_=Y,K.array[fe]=b.x,K.array[fe+1]=b.y,K.array[fe+2]=b.z,K.array[fe+3]=b.w,K.array[fe+4]=w.x,K.array[fe+5]=w.y,K.array[fe+6]=w.z,K.array[fe+7]=w.w,K.array[fe+8]=_.x,K.array[fe+9]=_.y,K.array[fe+10]=_.z,K.array[fe+11]=_.w,fe+=12;else if("faceVertices"===K.boundTo)for(o=0,a=ke.length;a>o;o++)Y=K.value[ke[o]],b=Y[0],w=Y[1],_=Y[2],K.array[fe]=b.x,K.array[fe+1]=b.y,K.array[fe+2]=b.z,K.array[fe+3]=b.w,K.array[fe+4]=w.x,K.array[fe+5]=w.y,K.array[fe+6]=w.z,K.array[fe+7]=w.w,K.array[fe+8]=_.x,K.array[fe+9]=_.y,K.array[fe+10]=_.z,K.array[fe+11]=_.w,fe+=12;Fe.bindBuffer(Fe.ARRAY_BUFFER,K.buffer),Fe.bufferData(Fe.ARRAY_BUFFER,K.array,i)}n&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function y(e,t,i){var n,r,o=e.attributes;for(n in o)r=o[n],r.needsUpdate&&("index"===n?(Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,r.buffer),Fe.bufferData(Fe.ELEMENT_ARRAY_BUFFER,r.array,t)):(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.buffer),Fe.bufferData(Fe.ARRAY_BUFFER,r.array,t)),r.needsUpdate=!1),i&&!r.dynamic&&(r.array=null)}function x(e){mt[e]||(Fe.enableVertexAttribArray(e),mt[e]=!0)}function b(){for(var e in mt)mt[e]&&(Fe.disableVertexAttribArray(e),mt[e]=!1)}function w(e,t,i){var n=e.program.attributes;if(-1!==i.morphTargetBase&&n.position>=0?(Fe.bindBuffer(Fe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),x(n.position),Fe.vertexAttribPointer(n.position,3,Fe.FLOAT,!1,0,0)):n.position>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,t.__webglVertexBuffer),x(n.position),Fe.vertexAttribPointer(n.position,3,Fe.FLOAT,!1,0,0)),i.morphTargetForcedOrder.length)for(var r=0,o=i.morphTargetForcedOrder,a=i.morphTargetInfluences;r<e.numSupportedMorphTargets&&r<o.length;)n["morphTarget"+r]>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[r]]),x(n["morphTarget"+r]),Fe.vertexAttribPointer(n["morphTarget"+r],3,Fe.FLOAT,!1,0,0)),n["morphNormal"+r]>=0&&e.morphNormals&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[r]]),x(n["morphNormal"+r]),Fe.vertexAttribPointer(n["morphNormal"+r],3,Fe.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[r]=a[o[r]],r++;else{var s,l,u=[],a=i.morphTargetInfluences,h=a.length;for(l=0;h>l;l++)s=a[l],s>0&&u.push([s,l]);u.length>e.numSupportedMorphTargets?(u.sort(M),u.length=e.numSupportedMorphTargets):u.length>e.numSupportedMorphNormals?u.sort(M):0===u.length&&u.push([0,0]);for(var c,r=0;r<e.numSupportedMorphTargets;)u[r]?(c=u[r][1],n["morphTarget"+r]>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[c]),x(n["morphTarget"+r]),Fe.vertexAttribPointer(n["morphTarget"+r],3,Fe.FLOAT,!1,0,0)),n["morphNormal"+r]>=0&&e.morphNormals&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[c]),x(n["morphNormal"+r]),Fe.vertexAttribPointer(n["morphNormal"+r],3,Fe.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[r]=a[c]):i.__webglMorphTargetInfluences[r]=0,r++}null!==e.program.uniforms.morphTargetInfluences&&Fe.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function _(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function M(e,t){return t[0]-e[0]}function S(e,t,i){if(e.length)for(var n=0,r=e.length;r>n;n++)je=null,qe=null,Je=-1,nt=-1,rt=-1,Ze=-1,Qe=-1,Xe=-1,Ge=-1,wt=!0,e[n].render(t,i,dt,pt),je=null,qe=null,Je=-1,nt=-1,rt=-1,Ze=-1,Qe=-1,Xe=-1,Ge=-1,wt=!0}function C(e,t,i,n,r,o,a,s){var l,u,h,f,d,p,m;t?(d=e.length-1,p=-1,m=-1):(d=0,p=e.length,m=1);for(var g=d;g!==p;g+=m)if(l=e[g],l.render){if(u=l.object,h=l.buffer,s)f=s;else{if(f=l[i],!f)continue;a&&ze.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),ze.setDepthTest(f.depthTest),ze.setDepthWrite(f.depthWrite),re(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}ze.setMaterialFaces(f),h instanceof c.BufferGeometry?ze.renderBufferDirect(n,r,o,f,h,u):ze.renderBuffer(n,r,o,f,h,u)}}function T(e,t,i,n,r,o,a){for(var s,l,u,h=0,c=e.length;c>h;h++)if(s=e[h],l=s.object,l.visible){if(a)u=a;else{if(u=s[t],!u)continue;o&&ze.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),ze.setDepthTest(u.depthTest),ze.setDepthWrite(u.depthWrite),re(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}ze.renderImmediateObject(i,n,r,u,l)}}function E(e){var t=e.object,i=t.material;i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)}function A(e){var t,i,n,r=e.object,o=e.buffer;n=r.material,n instanceof c.MeshFaceMaterial?(i=o.materialIndex,t=n.materials[i],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=n,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function P(e,t){var i,n,r,o,a,s,l={},u=e.morphTargets.length,h=e.morphNormals.length,f=t instanceof c.MeshFaceMaterial;for(e.geometryGroups={},i=0,n=e.faces.length;n>i;i++)r=e.faces[i],o=f?r.materialIndex:0,void 0===l[o]&&(l[o]={hash:o,counter:0}),s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],materialIndex:o,vertices:0,numMorphTargets:u,numMorphNormals:h}),a=3,e.geometryGroups[s].vertices+a>65535&&(l[o].counter+=1,s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],materialIndex:o,vertices:0,numMorphTargets:u,numMorphNormals:h})),e.geometryGroups[s].faces3.push(i),e.geometryGroups[s].vertices+=a;e.geometryGroupsList=[];for(var d in e.geometryGroups)e.geometryGroups[d].id=Ye++,e.geometryGroupsList.push(e.geometryGroups[d])}function L(e,r){var l,u,h,f;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new c.Matrix4,e._normalMatrix=new c.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Ft)),u=e.geometry,void 0===u);else if(u instanceof c.BufferGeometry)p(u);else if(e instanceof c.Mesh){h=e.material,void 0===u.geometryGroups&&P(u,h);for(l in u.geometryGroups)f=u.geometryGroups[l],f.__webglVertexBuffer||(n(f),s(f,e),u.verticesNeedUpdate=!0,u.morphTargetsNeedUpdate=!0,u.elementsNeedUpdate=!0,u.uvsNeedUpdate=!0,u.normalsNeedUpdate=!0,u.tangentsNeedUpdate=!0,u.colorsNeedUpdate=!0)}else e instanceof c.Line?u.__webglVertexBuffer||(i(u),a(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.lineDistancesNeedUpdate=!0):e instanceof c.ParticleSystem&&(u.__webglVertexBuffer||(t(u),o(u,e),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof c.Mesh){if(u=e.geometry,u instanceof c.BufferGeometry)D(r.__webglObjects,u,e);else if(u instanceof c.Geometry)for(l in u.geometryGroups)f=u.geometryGroups[l],D(r.__webglObjects,f,e)}else e instanceof c.Line||e instanceof c.ParticleSystem?(u=e.geometry,D(r.__webglObjects,u,e)):e instanceof c.ImmediateRenderObject||e.immediateRenderCallback?N(r.__webglObjectsImmediate,e):e instanceof c.Sprite?r.__webglSprites.push(e):e instanceof c.LensFlare&&r.__webglFlares.push(e);e.__webglActive=!0}}function D(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,z:0})}function N(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function R(e){var t,i,n,r=e.geometry;if(r instanceof c.BufferGeometry)y(r,Fe.DYNAMIC_DRAW,!r.dynamic);else if(e instanceof c.Mesh){for(var o=0,a=r.geometryGroupsList.length;a>o;o++)t=r.geometryGroupsList[o],n=l(e,t),r.buffersNeedUpdate&&s(t,e),i=n.attributes&&O(n),(r.verticesNeedUpdate||r.morphTargetsNeedUpdate||r.elementsNeedUpdate||r.uvsNeedUpdate||r.normalsNeedUpdate||r.colorsNeedUpdate||r.tangentsNeedUpdate||i)&&v(t,e,Fe.DYNAMIC_DRAW,!r.dynamic,n);r.verticesNeedUpdate=!1,r.morphTargetsNeedUpdate=!1,r.elementsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.tangentsNeedUpdate=!1,r.buffersNeedUpdate=!1,n.attributes&&F(n)}else e instanceof c.Line?(n=l(e,r),i=n.attributes&&O(n),(r.verticesNeedUpdate||r.colorsNeedUpdate||r.lineDistancesNeedUpdate||i)&&g(r,Fe.DYNAMIC_DRAW),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,r.lineDistancesNeedUpdate=!1,n.attributes&&F(n)):e instanceof c.ParticleSystem&&(n=l(e,r),i=n.attributes&&O(n),(r.verticesNeedUpdate||r.colorsNeedUpdate||e.sortParticles||i)&&m(r,Fe.DYNAMIC_DRAW,e),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,n.attributes&&F(n))}function O(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function F(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function I(e,t){e instanceof c.Mesh||e instanceof c.ParticleSystem||e instanceof c.Line?k(t.__webglObjects,e):e instanceof c.Sprite?B(t.__webglSprites,e):e instanceof c.LensFlare?B(t.__webglFlares,e):(e instanceof c.ImmediateRenderObject||e.immediateRenderCallback)&&k(t.__webglObjectsImmediate,e),delete e.__webglActive}function k(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function B(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function V(e,t){e.uniforms=c.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function U(e,t,i,n,r){Ke=0,n.needsUpdate&&(n.program&&Ht(n),ze.initMaterial(n,t,i,r),n.needsUpdate=!1),n.morphTargets&&(r.__webglMorphTargetInfluences||(r.__webglMorphTargetInfluences=new Float32Array(ze.maxMorphTargets)));var o=!1,a=n.program,s=a.uniforms,l=n.uniforms;if(a!==je&&(Fe.useProgram(a),je=a,o=!0),n.id!==Ge&&(Ge=n.id,o=!0),(o||e!==qe)&&(Fe.uniformMatrix4fv(s.projectionMatrix,!1,e.projectionMatrix.elements),e!==qe&&(qe=e)),n.skinning)if(At&&r.useVertexTexture){if(null!==s.boneTexture){var u=Z();Fe.uniform1i(s.boneTexture,u),ze.setTexture(r.boneTexture,u)}null!==s.boneTextureWidth&&Fe.uniform1i(s.boneTextureWidth,r.boneTextureWidth),null!==s.boneTextureHeight&&Fe.uniform1i(s.boneTextureHeight,r.boneTextureHeight)}else null!==s.boneGlobalMatrices&&Fe.uniformMatrix4fv(s.boneGlobalMatrices,!1,r.boneMatrices);return o&&(i&&n.fog&&W(l,i),(n instanceof c.MeshPhongMaterial||n instanceof c.MeshLambertMaterial||n.lights)&&(wt&&(ie(a,t),wt=!1),q(l,_t)),(n instanceof c.MeshBasicMaterial||n instanceof c.MeshLambertMaterial||n instanceof c.MeshPhongMaterial)&&z(l,n),n instanceof c.LineBasicMaterial?$(l,n):n instanceof c.LineDashedMaterial?($(l,n),H(l,n)):n instanceof c.ParticleSystemMaterial?j(l,n):n instanceof c.MeshPhongMaterial?G(l,n):n instanceof c.MeshLambertMaterial?X(l,n):n instanceof c.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=n.opacity):n instanceof c.MeshNormalMaterial&&(l.opacity.value=n.opacity),r.receiveShadow&&!n._shadowPass&&Y(l,t),Q(a,n.uniformsList),(n instanceof c.ShaderMaterial||n instanceof c.MeshPhongMaterial||n.envMap)&&null!==s.cameraPosition&&(xt.getPositionFromMatrix(e.matrixWorld),Fe.uniform3f(s.cameraPosition,xt.x,xt.y,xt.z)),(n instanceof c.MeshPhongMaterial||n instanceof c.MeshLambertMaterial||n instanceof c.ShaderMaterial||n.skinning)&&null!==s.viewMatrix&&Fe.uniformMatrix4fv(s.viewMatrix,!1,e.matrixWorldInverse.elements)),K(s,r),null!==s.modelMatrix&&Fe.uniformMatrix4fv(s.modelMatrix,!1,r.matrixWorld.elements),a}function z(e,t){e.opacity.value=t.opacity,ze.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap),void 0!==i){var n=i.offset,r=i.repeat;e.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof c.WebGLRenderTargetCube?1:-1,ze.gammaInput?e.reflectivity.value=t.reflectivity:e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof c.CubeRefractionMapping}function $(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function H(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function j(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Te.height/2,e.map.value=t.map}function W(e,t){e.fogColor.value=t.color,t instanceof c.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof c.FogExp2&&(e.fogDensity.value=t.density)}function G(e,t){e.shininess.value=t.shininess,ze.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function X(e,t){ze.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function q(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function Y(e,t){if(e.shadowMatrix)for(var i=0,n=0,r=t.length;r>n;n++){var o=t[n];o.castShadow&&(o instanceof c.SpotLight||o instanceof c.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[i]=o.shadowMap,e.shadowMapSize.value[i]=o.shadowMapSize,e.shadowMatrix.value[i]=o.shadowMatrix,e.shadowDarkness.value[i]=o.shadowDarkness,e.shadowBias.value[i]=o.shadowBias,i++)}}function K(e,t){Fe.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Fe.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function Z(){var e=Ke;return e>=Mt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Mt),Ke+=1,e}function Q(e,t){var i,n,r,o,a,s,l,u,h,f,d;for(h=0,f=t.length;f>h;h++)if(o=e.uniforms[t[h][1]])if(i=t[h][0],r=i.type,n=i.value,"i"===r)Fe.uniform1i(o,n);else if("f"===r)Fe.uniform1f(o,n);else if("v2"===r)Fe.uniform2f(o,n.x,n.y);else if("v3"===r)Fe.uniform3f(o,n.x,n.y,n.z);else if("v4"===r)Fe.uniform4f(o,n.x,n.y,n.z,n.w);else if("c"===r)Fe.uniform3f(o,n.r,n.g,n.b);else if("iv1"===r)Fe.uniform1iv(o,n);else if("iv"===r)Fe.uniform3iv(o,n);else if("fv1"===r)Fe.uniform1fv(o,n);else if("fv"===r)Fe.uniform3fv(o,n);else if("v2v"===r){for(void 0===i._array&&(i._array=new Float32Array(2*n.length)),l=0,u=n.length;u>l;l++)d=2*l,i._array[d]=n[l].x,i._array[d+1]=n[l].y;Fe.uniform2fv(o,i._array)}else if("v3v"===r){for(void 0===i._array&&(i._array=new Float32Array(3*n.length)),l=0,u=n.length;u>l;l++)d=3*l,i._array[d]=n[l].x,i._array[d+1]=n[l].y,i._array[d+2]=n[l].z;Fe.uniform3fv(o,i._array)}else if("v4v"===r){for(void 0===i._array&&(i._array=new Float32Array(4*n.length)),l=0,u=n.length;u>l;l++)d=4*l,i._array[d]=n[l].x,i._array[d+1]=n[l].y,i._array[d+2]=n[l].z,i._array[d+3]=n[l].w;Fe.uniform4fv(o,i._array)}else if("m4"===r)void 0===i._array&&(i._array=new Float32Array(16)),n.flattenToArray(i._array),Fe.uniformMatrix4fv(o,!1,i._array);else if("m4v"===r){for(void 0===i._array&&(i._array=new Float32Array(16*n.length)),l=0,u=n.length;u>l;l++)n[l].flattenToArrayOffset(i._array,16*l);Fe.uniformMatrix4fv(o,!1,i._array)}else if("t"===r){if(a=n,s=Z(),Fe.uniform1i(o,s),!a)continue;a.image instanceof Array&&6===a.image.length?pe(a,s):a instanceof c.WebGLRenderTargetCube?me(a,s):ze.setTexture(a,s)}else if("tv"===r){for(void 0===i._array&&(i._array=[]),l=0,u=i.value.length;u>l;l++)i._array[l]=Z();for(Fe.uniform1iv(o,i._array),l=0,u=i.value.length;u>l;l++)a=i.value[l],s=i._array[l],a&&ze.setTexture(a,s)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+r)}function J(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function ee(e,t,i,n){e[t]=i.r*i.r*n,e[t+1]=i.g*i.g*n,e[t+2]=i.b*i.b*n}function te(e,t,i,n){e[t]=i.r*n,e[t+1]=i.g*n,e[t+2]=i.b*n}function ie(e,t){var i,n,r,o,a,s,l,u,h,f=0,d=0,p=0,m=_t,g=m.directional.colors,v=m.directional.positions,y=m.point.colors,x=m.point.positions,b=m.point.distances,w=m.spot.colors,_=m.spot.positions,M=m.spot.distances,S=m.spot.directions,C=m.spot.anglesCos,T=m.spot.exponents,E=m.hemi.skyColors,A=m.hemi.groundColors,P=m.hemi.positions,L=0,D=0,N=0,R=0,O=0,F=0,I=0,k=0,B=0,V=0,U=0,z=0;for(i=0,n=t.length;n>i;i++)if(r=t[i],!r.onlyShadow)if(o=r.color,l=r.intensity,h=r.distance,r instanceof c.AmbientLight){if(!r.visible)continue;ze.gammaInput?(f+=o.r*o.r,d+=o.g*o.g,p+=o.b*o.b):(f+=o.r,d+=o.g,p+=o.b)}else if(r instanceof c.DirectionalLight){if(O+=1,!r.visible)continue;if(bt.getPositionFromMatrix(r.matrixWorld),xt.getPositionFromMatrix(r.target.matrixWorld),bt.sub(xt),bt.normalize(),0===bt.x&&0===bt.y&&0===bt.z)continue;B=3*L,v[B]=bt.x,v[B+1]=bt.y,v[B+2]=bt.z,ze.gammaInput?ee(g,B,o,l*l):te(g,B,o,l),L+=1}else if(r instanceof c.PointLight){if(F+=1,!r.visible)continue;V=3*D,ze.gammaInput?ee(y,V,o,l*l):te(y,V,o,l),xt.getPositionFromMatrix(r.matrixWorld),x[V]=xt.x,x[V+1]=xt.y,x[V+2]=xt.z,b[D]=h,D+=1}else if(r instanceof c.SpotLight){if(I+=1,!r.visible)continue;U=3*N,ze.gammaInput?ee(w,U,o,l*l):te(w,U,o,l),xt.getPositionFromMatrix(r.matrixWorld),_[U]=xt.x,_[U+1]=xt.y,_[U+2]=xt.z,M[N]=h,bt.copy(xt),xt.getPositionFromMatrix(r.target.matrixWorld),bt.sub(xt),bt.normalize(),S[U]=bt.x,S[U+1]=bt.y,S[U+2]=bt.z,C[N]=Math.cos(r.angle),T[N]=r.exponent,N+=1}else if(r instanceof c.HemisphereLight){if(k+=1,!r.visible)continue;if(bt.getPositionFromMatrix(r.matrixWorld),bt.normalize(),0===bt.x&&0===bt.y&&0===bt.z)continue;z=3*R,P[z]=bt.x,P[z+1]=bt.y,P[z+2]=bt.z,a=r.color,s=r.groundColor,ze.gammaInput?(u=l*l,ee(E,z,a,u),ee(A,z,s,u)):(te(E,z,a,l),te(A,z,s,l)),R+=1}for(i=3*L,n=Math.max(g.length,3*O);n>i;i++)g[i]=0;for(i=3*D,n=Math.max(y.length,3*F);n>i;i++)y[i]=0;for(i=3*N,n=Math.max(w.length,3*I);n>i;i++)w[i]=0;for(i=3*R,n=Math.max(E.length,3*k);n>i;i++)E[i]=0;for(i=3*R,n=Math.max(A.length,3*k);n>i;i++)A[i]=0;m.directional.length=L,m.point.length=D,m.spot.length=N,m.hemi.length=R,m.ambient[0]=f,m.ambient[1]=d,m.ambient[2]=p}function ne(e){e!==lt&&(Fe.lineWidth(e),lt=e)}function re(e,t,i){ot!==e&&(e?Fe.enable(Fe.POLYGON_OFFSET_FILL):Fe.disable(Fe.POLYGON_OFFSET_FILL),ot=e),!e||at===t&&st===i||(Fe.polygonOffset(t,i),at=t,st=i)}function oe(e){var t,i,n=[];for(var r in e)t=e[r],t!==!1&&(i="#define "+r+" "+t,n.push(i));return n.join("\n")}function ae(e,t,i,n,r,o,a,s){var l,u,h,f,d,p=[];e?p.push(e):(p.push(t),p.push(i));for(h in o)p.push(h),p.push(o[h]);for(l in a)p.push(l),p.push(a[l]);for(d=p.join(),l=0,u=$e.length;u>l;l++){var m=$e[l];if(m.code===d)return m.usedTimes++,m.program}var g="SHADOWMAP_TYPE_BASIC";a.shadowMapType===c.PCFShadowMap?g="SHADOWMAP_TYPE_PCF":a.shadowMapType===c.PCFSoftShadowMap&&(g="SHADOWMAP_TYPE_PCF_SOFT");var v=oe(o);f=Fe.createProgram();var y=["precision "+Ee+" float;","precision "+Ee+" int;",v,Et?"#define VERTEX_TEXTURES":"",ze.gammaInput?"#define GAMMA_INPUT":"",ze.gammaOutput?"#define GAMMA_OUTPUT":"",ze.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals?"#define USE_MORPHNORMALS":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+g:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),x=["precision "+Ee+" float;","precision "+Ee+" int;",a.bumpMap||a.normalMap?"#extension GL_OES_standard_derivatives : enable":"",v,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",ze.gammaInput?"#define GAMMA_INPUT":"",ze.gammaOutput?"#define GAMMA_OUTPUT":"",ze.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.metal?"#define METAL":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+g:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),b=he("vertex",y+i),w=he("fragment",x+t);Fe.attachShader(f,b),Fe.attachShader(f,w),s&&Fe.bindAttribLocation(f,0,s),Fe.linkProgram(f),Fe.getProgramParameter(f,Fe.LINK_STATUS)||(console.error("Could not initialise shader\nVALIDATE_STATUS: "+Fe.getProgramParameter(f,Fe.VALIDATE_STATUS)+", gl error ["+Fe.getError()+"]"),console.error("Program Info Log: "+Fe.getProgramInfoLog(f))),Fe.deleteShader(w),Fe.deleteShader(b),f.uniforms={},f.attributes={};var _,M,S,C;_=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],a.useVertexTexture?(_.push("boneTexture"),_.push("boneTextureWidth"),_.push("boneTextureHeight")):_.push("boneGlobalMatrices");for(M in n)_.push(M);for(se(f,_),_=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],C=0;C<a.maxMorphTargets;C++)_.push("morphTarget"+C);for(C=0;C<a.maxMorphNormals;C++)_.push("morphNormal"+C);for(S in r)_.push(S);return le(f,_),f.id=He++,$e.push({program:f,code:d,usedTimes:1}),ze.info.memory.programs=$e.length,f}function se(e,t){var i,n,r;for(i=0,n=t.length;n>i;i++)r=t[i],e.uniforms[r]=Fe.getUniformLocation(e,r)}function le(e,t){var i,n,r;for(i=0,n=t.length;n>i;i++)r=t[i],e.attributes[r]=Fe.getAttribLocation(e,r)}function ue(e){for(var t=e.split("\n"),i=0,n=t.length;n>i;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function he(e,t){var i;return"fragment"===e?i=Fe.createShader(Fe.FRAGMENT_SHADER):"vertex"===e&&(i=Fe.createShader(Fe.VERTEX_SHADER)),Fe.shaderSource(i,t),Fe.compileShader(i),Fe.getShaderParameter(i,Fe.COMPILE_STATUS)?i:(console.error(Fe.getShaderInfoLog(i)),console.error(ue(t)),null)}function ce(e){return 0===(e&e-1)}function fe(e,t,i){i?(Fe.texParameteri(e,Fe.TEXTURE_WRAP_S,be(t.wrapS)),Fe.texParameteri(e,Fe.TEXTURE_WRAP_T,be(t.wrapT)),Fe.texParameteri(e,Fe.TEXTURE_MAG_FILTER,be(t.magFilter)),Fe.texParameteri(e,Fe.TEXTURE_MIN_FILTER,be(t.minFilter))):(Fe.texParameteri(e,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(e,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(e,Fe.TEXTURE_MAG_FILTER,xe(t.magFilter)),Fe.texParameteri(e,Fe.TEXTURE_MIN_FILTER,xe(t.minFilter))),Ve&&t.type!==c.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Fe.texParameterf(e,Ve.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Tt)),
t.__oldAnisotropy=t.anisotropy)}function de(e,t){if(e.width<=t&&e.height<=t)return e;var i=Math.max(e.width,e.height),n=Math.floor(e.width*t/i),r=Math.floor(e.height*t/i),o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,n,r),o}function pe(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",It),e.image.__webglTextureCube=Fe.createTexture(),ze.info.memory.textures++),Fe.activeTexture(Fe.TEXTURE0+t),Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof c.CompressedTexture,n=[],r=0;6>r;r++)ze.autoScaleCubemaps&&!i?n[r]=de(e.image[r],Ct):n[r]=e.image[r];var o=n[0],a=ce(o.width)&&ce(o.height),s=be(e.format),l=be(e.type);fe(Fe.TEXTURE_CUBE_MAP,e,a);for(var r=0;6>r;r++)if(i)for(var u,h=n[r].mipmaps,f=0,d=h.length;d>f;f++)u=h[f],e.format!==c.RGBAFormat?Fe.compressedTexImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+r,f,s,u.width,u.height,0,u.data):Fe.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+r,f,s,u.width,u.height,0,s,l,u.data);else Fe.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,s,s,l,n[r]);e.generateMipmaps&&a&&Fe.generateMipmap(Fe.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Fe.activeTexture(Fe.TEXTURE0+t),Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function me(e,t){Fe.activeTexture(Fe.TEXTURE0+t),Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,e.__webglTexture)}function ge(e,t,i){Fe.bindFramebuffer(Fe.FRAMEBUFFER,e),Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function ve(e,t){Fe.bindRenderbuffer(Fe.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.DEPTH_COMPONENT16,t.width,t.height),Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_ATTACHMENT,Fe.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.DEPTH_STENCIL,t.width,t.height),Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_STENCIL_ATTACHMENT,Fe.RENDERBUFFER,e)):Fe.renderbufferStorage(Fe.RENDERBUFFER,Fe.RGBA4,t.width,t.height)}function ye(e){e instanceof c.WebGLRenderTargetCube?(Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,e.__webglTexture),Fe.generateMipmap(Fe.TEXTURE_CUBE_MAP),Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,null)):(Fe.bindTexture(Fe.TEXTURE_2D,e.__webglTexture),Fe.generateMipmap(Fe.TEXTURE_2D),Fe.bindTexture(Fe.TEXTURE_2D,null))}function xe(e){return e===c.NearestFilter||e===c.NearestMipMapNearestFilter||e===c.NearestMipMapLinearFilter?Fe.NEAREST:Fe.LINEAR}function be(e){if(e===c.RepeatWrapping)return Fe.REPEAT;if(e===c.ClampToEdgeWrapping)return Fe.CLAMP_TO_EDGE;if(e===c.MirroredRepeatWrapping)return Fe.MIRRORED_REPEAT;if(e===c.NearestFilter)return Fe.NEAREST;if(e===c.NearestMipMapNearestFilter)return Fe.NEAREST_MIPMAP_NEAREST;if(e===c.NearestMipMapLinearFilter)return Fe.NEAREST_MIPMAP_LINEAR;if(e===c.LinearFilter)return Fe.LINEAR;if(e===c.LinearMipMapNearestFilter)return Fe.LINEAR_MIPMAP_NEAREST;if(e===c.LinearMipMapLinearFilter)return Fe.LINEAR_MIPMAP_LINEAR;if(e===c.UnsignedByteType)return Fe.UNSIGNED_BYTE;if(e===c.UnsignedShort4444Type)return Fe.UNSIGNED_SHORT_4_4_4_4;if(e===c.UnsignedShort5551Type)return Fe.UNSIGNED_SHORT_5_5_5_1;if(e===c.UnsignedShort565Type)return Fe.UNSIGNED_SHORT_5_6_5;if(e===c.ByteType)return Fe.BYTE;if(e===c.ShortType)return Fe.SHORT;if(e===c.UnsignedShortType)return Fe.UNSIGNED_SHORT;if(e===c.IntType)return Fe.INT;if(e===c.UnsignedIntType)return Fe.UNSIGNED_INT;if(e===c.FloatType)return Fe.FLOAT;if(e===c.AlphaFormat)return Fe.ALPHA;if(e===c.RGBFormat)return Fe.RGB;if(e===c.RGBAFormat)return Fe.RGBA;if(e===c.LuminanceFormat)return Fe.LUMINANCE;if(e===c.LuminanceAlphaFormat)return Fe.LUMINANCE_ALPHA;if(e===c.AddEquation)return Fe.FUNC_ADD;if(e===c.SubtractEquation)return Fe.FUNC_SUBTRACT;if(e===c.ReverseSubtractEquation)return Fe.FUNC_REVERSE_SUBTRACT;if(e===c.ZeroFactor)return Fe.ZERO;if(e===c.OneFactor)return Fe.ONE;if(e===c.SrcColorFactor)return Fe.SRC_COLOR;if(e===c.OneMinusSrcColorFactor)return Fe.ONE_MINUS_SRC_COLOR;if(e===c.SrcAlphaFactor)return Fe.SRC_ALPHA;if(e===c.OneMinusSrcAlphaFactor)return Fe.ONE_MINUS_SRC_ALPHA;if(e===c.DstAlphaFactor)return Fe.DST_ALPHA;if(e===c.OneMinusDstAlphaFactor)return Fe.ONE_MINUS_DST_ALPHA;if(e===c.DstColorFactor)return Fe.DST_COLOR;if(e===c.OneMinusDstColorFactor)return Fe.ONE_MINUS_DST_COLOR;if(e===c.SrcAlphaSaturateFactor)return Fe.SRC_ALPHA_SATURATE;if(void 0!==Ue){if(e===c.RGB_S3TC_DXT1_Format)return Ue.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===c.RGBA_S3TC_DXT1_Format)return Ue.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===c.RGBA_S3TC_DXT3_Format)return Ue.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===c.RGBA_S3TC_DXT5_Format)return Ue.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function we(e){if(At&&e&&e.useVertexTexture)return 1024;var t=Fe.getParameter(Fe.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4),n=i;return void 0!==e&&e instanceof c.SkinnedMesh&&(n=Math.min(e.bones.length,n),n<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),n}function _e(e){for(var t=0,i=0,n=0,r=0,o=0,a=e.length;a>o;o++){var s=e[o];s.onlyShadow||(s instanceof c.DirectionalLight&&t++,s instanceof c.PointLight&&i++,s instanceof c.SpotLight&&n++,s instanceof c.HemisphereLight&&r++)}return{directional:t,point:i,spot:n,hemi:r}}function Me(e){for(var t=0,i=0,n=e.length;n>i;i++){var r=e[i];r.castShadow&&(r instanceof c.SpotLight&&t++,r instanceof c.DirectionalLight&&!r.shadowCascade&&t++)}return t}function Se(){try{var e={alpha:Ae,premultipliedAlpha:Pe,antialias:Le,stencil:De,preserveDrawingBuffer:Ne};if(Fe=Te.getContext("webgl",e)||Te.getContext("experimental-webgl",e),null===Fe)throw"Error creating WebGL context."}catch(t){console.error(t)}Ie=Fe.getExtension("OES_texture_float"),ke=Fe.getExtension("OES_texture_float_linear"),Be=Fe.getExtension("OES_standard_derivatives"),Ve=Fe.getExtension("EXT_texture_filter_anisotropic")||Fe.getExtension("MOZ_EXT_texture_filter_anisotropic")||Fe.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Ue=Fe.getExtension("WEBGL_compressed_texture_s3tc")||Fe.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Fe.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Ie||console.log("THREE.WebGLRenderer: Float textures not supported."),Be||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Ve||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Ue||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Fe.getShaderPrecisionFormat&&(Fe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function Ce(){Fe.clearColor(0,0,0,1),Fe.clearDepth(1),Fe.clearStencil(0),Fe.enable(Fe.DEPTH_TEST),Fe.depthFunc(Fe.LEQUAL),Fe.frontFace(Fe.CCW),Fe.cullFace(Fe.BACK),Fe.enable(Fe.CULL_FACE),Fe.enable(Fe.BLEND),Fe.blendEquation(Fe.FUNC_ADD),Fe.blendFunc(Fe.SRC_ALPHA,Fe.ONE_MINUS_SRC_ALPHA),Fe.viewport(ut,ht,ct,ft),Fe.clearColor(Re.r,Re.g,Re.b,Oe)}console.log("THREE.WebGLRenderer",c.REVISION),e=e||{};var Te=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Ee=void 0!==e.precision?e.precision:"highp",Ae=void 0!==e.alpha?e.alpha:!0,Pe=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Le=void 0!==e.antialias?e.antialias:!1,De=void 0!==e.stencil?e.stencil:!0,Ne=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,Re=new c.Color(0),Oe=0;this.domElement=Te,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=c.PCFShadowMap,this.shadowMapCullFace=c.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Fe,Ie,ke,Be,Ve,Ue,ze=this,$e=[],He=0,je=null,We=null,Ge=-1,Xe=null,qe=null,Ye=0,Ke=0,Ze=-1,Qe=-1,Je=-1,et=-1,tt=-1,it=-1,nt=-1,rt=-1,ot=null,at=null,st=null,lt=null,ut=0,ht=0,ct=Te.width,ft=Te.height,dt=0,pt=0,mt={},gt=new c.Frustum,vt=new c.Matrix4,yt=new c.Matrix4,xt=new c.Vector3,bt=new c.Vector3,wt=!0,_t={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};Se(),Ce(),this.context=Fe;var Mt=Fe.getParameter(Fe.MAX_TEXTURE_IMAGE_UNITS),St=Fe.getParameter(Fe.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Ct=(Fe.getParameter(Fe.MAX_TEXTURE_SIZE),Fe.getParameter(Fe.MAX_CUBE_MAP_TEXTURE_SIZE)),Tt=Ve?Fe.getParameter(Ve.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Et=St>0,At=Et&&Ie,Pt=(Ue?Fe.getParameter(Fe.COMPRESSED_TEXTURE_FORMATS):[],Fe.getShaderPrecisionFormat(Fe.VERTEX_SHADER,Fe.HIGH_FLOAT)),Lt=Fe.getShaderPrecisionFormat(Fe.VERTEX_SHADER,Fe.MEDIUM_FLOAT),Dt=(Fe.getShaderPrecisionFormat(Fe.VERTEX_SHADER,Fe.LOW_FLOAT),Fe.getShaderPrecisionFormat(Fe.FRAGMENT_SHADER,Fe.HIGH_FLOAT)),Nt=Fe.getShaderPrecisionFormat(Fe.FRAGMENT_SHADER,Fe.MEDIUM_FLOAT),Rt=(Fe.getShaderPrecisionFormat(Fe.FRAGMENT_SHADER,Fe.LOW_FLOAT),Fe.getShaderPrecisionFormat(Fe.VERTEX_SHADER,Fe.HIGH_INT),Fe.getShaderPrecisionFormat(Fe.VERTEX_SHADER,Fe.MEDIUM_INT),Fe.getShaderPrecisionFormat(Fe.VERTEX_SHADER,Fe.LOW_INT),Fe.getShaderPrecisionFormat(Fe.FRAGMENT_SHADER,Fe.HIGH_INT),Fe.getShaderPrecisionFormat(Fe.FRAGMENT_SHADER,Fe.MEDIUM_INT),Fe.getShaderPrecisionFormat(Fe.FRAGMENT_SHADER,Fe.LOW_INT),Pt.precision>0&&Dt.precision>0),Ot=Lt.precision>0&&Nt.precision>0;"highp"!==Ee||Rt||(Ot?(Ee="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(Ee="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==Ee||Ot||(Ee="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Fe},this.supportsVertexTextures=function(){return Et},this.supportsFloatTextures=function(){return Ie},this.supportsStandardDerivatives=function(){return Be},this.supportsCompressedTextureS3TC=function(){return Ue},this.getMaxAnisotropy=function(){return Tt},this.getPrecision=function(){return Ee},this.setSize=function(e,t,i){Te.width=e*this.devicePixelRatio,Te.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&i!==!1&&(Te.style.width=e+"px",Te.style.height=t+"px"),this.setViewport(0,0,Te.width,Te.height)},this.setViewport=function(e,t,i,n){ut=void 0!==e?e:0,ht=void 0!==t?t:0,ct=void 0!==i?i:Te.width,ft=void 0!==n?n:Te.height,Fe.viewport(ut,ht,ct,ft)},this.setScissor=function(e,t,i,n){Fe.scissor(e,t,i,n)},this.enableScissorTest=function(e){e?Fe.enable(Fe.SCISSOR_TEST):Fe.disable(Fe.SCISSOR_TEST)},this.setClearColor=function(e,t){Re.set(e),Oe=void 0!==t?t:1,Fe.clearColor(Re.r,Re.g,Re.b,Oe)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return Re},this.getClearAlpha=function(){return Oe},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=Fe.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=Fe.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=Fe.STENCIL_BUFFER_BIT),Fe.clear(n)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){je=null,Je=-1,nt=-1,rt=-1,Xe=-1,Ge=-1,wt=!0,Ze=-1,Qe=-1,this.shadowMapPlugin.update(e,t)};var Ft=function(e){var t=e.target;t.removeEventListener("dispose",Ft),Ut(t)},It=function(e){var t=e.target;t.removeEventListener("dispose",It),zt(t),ze.info.memory.textures--},kt=function(e){var t=e.target;t.removeEventListener("dispose",kt),$t(t),ze.info.memory.textures--},Bt=function(e){var t=e.target;t.removeEventListener("dispose",Bt),Ht(t)},Vt=function(e){if(void 0!==e.__webglVertexBuffer&&Fe.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Fe.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Fe.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Fe.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Fe.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Fe.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Fe.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Fe.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Fe.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Fe.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Fe.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Fe.deleteBuffer(e.__webglCustomAttributesList[t].buffer);ze.info.memory.geometries--},Ut=function(e){if(e.__webglInit=void 0,e instanceof c.BufferGeometry){var t=e.attributes;for(var i in t)void 0!==t[i].buffer&&Fe.deleteBuffer(t[i].buffer);ze.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(var n in e.geometryGroups){var r=e.geometryGroups[n];if(void 0!==r.numMorphTargets)for(var o=0,a=r.numMorphTargets;a>o;o++)Fe.deleteBuffer(r.__webglMorphTargetsBuffers[o]);if(void 0!==r.numMorphNormals)for(var o=0,a=r.numMorphNormals;a>o;o++)Fe.deleteBuffer(r.__webglMorphNormalsBuffers[o]);Vt(r)}else Vt(e)},zt=function(e){if(e.image&&e.image.__webglTextureCube)Fe.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Fe.deleteTexture(e.__webglTexture)}},$t=function(e){if(e&&e.__webglTexture)if(Fe.deleteTexture(e.__webglTexture),e instanceof c.WebGLRenderTargetCube)for(var t=0;6>t;t++)Fe.deleteFramebuffer(e.__webglFramebuffer[t]),Fe.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Fe.deleteFramebuffer(e.__webglFramebuffer),Fe.deleteRenderbuffer(e.__webglRenderbuffer)},Ht=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,n,r,o=!1;for(i=0,n=$e.length;n>i;i++)if(r=$e[i],r.program===t){r.usedTimes--,0===r.usedTimes&&(o=!0);break}if(o===!0){var a=[];for(i=0,n=$e.length;n>i;i++)r=$e[i],r.program!==t&&a.push(r);$e=a,Fe.deleteProgram(t),ze.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Fe.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Fe.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Fe.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Fe.createBuffer()),e.hasPositions&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglVertexBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,e.positionArray,Fe.DYNAMIC_DRAW),Fe.enableVertexAttribArray(t.attributes.position),Fe.vertexAttribPointer(t.attributes.position,3,Fe.FLOAT,!1,0,0)),e.hasNormals){if(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===c.FlatShading){var n,r,o,a,s,l,u,h,f,d,p,m,g,v,y=3*e.count;for(v=0;y>v;v+=9)g=e.normalArray,a=g[v],u=g[v+1],d=g[v+2],s=g[v+3],h=g[v+4],p=g[v+5],l=g[v+6],f=g[v+7],m=g[v+8],n=(a+s+l)/3,r=(u+h+f)/3,o=(d+p+m)/3,g[v]=n,g[v+1]=r,g[v+2]=o,g[v+3]=n,g[v+4]=r,g[v+5]=o,g[v+6]=n,g[v+7]=r,g[v+8]=o}Fe.bufferData(Fe.ARRAY_BUFFER,e.normalArray,Fe.DYNAMIC_DRAW),Fe.enableVertexAttribArray(t.attributes.normal),Fe.vertexAttribPointer(t.attributes.normal,3,Fe.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglUvBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,e.uvArray,Fe.DYNAMIC_DRAW),Fe.enableVertexAttribArray(t.attributes.uv),Fe.vertexAttribPointer(t.attributes.uv,2,Fe.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==c.NoColors&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,e.__webglColorBuffer),Fe.bufferData(Fe.ARRAY_BUFFER,e.colorArray,Fe.DYNAMIC_DRAW),Fe.enableVertexAttribArray(t.attributes.color),Fe.vertexAttribPointer(t.attributes.color,3,Fe.FLOAT,!1,0,0)),Fe.drawArrays(Fe.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,o){if(n.visible!==!1){var a,s,l,u,h=U(e,t,i,n,o),f=h.attributes,d=r.attributes,p=!1,m=n.wireframe?1:0,g=16777215*r.id+2*h.id+m;if(g!==Xe&&(Xe=g,p=!0),p&&b(),o instanceof c.Mesh){var v=d.index;if(v){var y=r.offsets;y.length>1&&(p=!0);for(var w=0,_=y.length;_>w;w++){var M=y[w].index;if(p){for(s in f)l=f[s],a=d[s],l>=0&&(a?(u=a.itemSize,Fe.bindBuffer(Fe.ARRAY_BUFFER,a.buffer),x(l),Fe.vertexAttribPointer(l,u,Fe.FLOAT,!1,0,M*u*4)):n.defaultAttributeValues&&(2===n.defaultAttributeValues[s].length?Fe.vertexAttrib2fv(l,n.defaultAttributeValues[s]):3===n.defaultAttributeValues[s].length&&Fe.vertexAttrib3fv(l,n.defaultAttributeValues[s])));Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,v.buffer)}Fe.drawElements(Fe.TRIANGLES,y[w].count,Fe.UNSIGNED_SHORT,2*y[w].start),ze.info.render.calls++,ze.info.render.vertices+=y[w].count,ze.info.render.faces+=y[w].count/3}}else{if(p)for(s in f)"index"!==s&&(l=f[s],a=d[s],l>=0&&(a?(u=a.itemSize,Fe.bindBuffer(Fe.ARRAY_BUFFER,a.buffer),x(l),Fe.vertexAttribPointer(l,u,Fe.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[s]&&(2===n.defaultAttributeValues[s].length?Fe.vertexAttrib2fv(l,n.defaultAttributeValues[s]):3===n.defaultAttributeValues[s].length&&Fe.vertexAttrib3fv(l,n.defaultAttributeValues[s]))));var S=r.attributes.position;Fe.drawArrays(Fe.TRIANGLES,0,S.numItems/3),ze.info.render.calls++,ze.info.render.vertices+=S.numItems/3,ze.info.render.faces+=S.numItems/3/3}}else if(o instanceof c.ParticleSystem){if(p){for(s in f)l=f[s],a=d[s],l>=0&&(a?(u=a.itemSize,Fe.bindBuffer(Fe.ARRAY_BUFFER,a.buffer),x(l),Fe.vertexAttribPointer(l,u,Fe.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[s]&&(2===n.defaultAttributeValues[s].length?Fe.vertexAttrib2fv(l,n.defaultAttributeValues[s]):3===n.defaultAttributeValues[s].length&&Fe.vertexAttrib3fv(l,n.defaultAttributeValues[s])));var S=d.position;Fe.drawArrays(Fe.POINTS,0,S.numItems/3),ze.info.render.calls++,ze.info.render.points+=S.numItems/3}}else if(o instanceof c.Line&&p){for(s in f)l=f[s],a=d[s],l>=0&&(a?(u=a.itemSize,Fe.bindBuffer(Fe.ARRAY_BUFFER,a.buffer),x(l),Fe.vertexAttribPointer(l,u,Fe.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[s]&&(2===n.defaultAttributeValues[s].length?Fe.vertexAttrib2fv(l,n.defaultAttributeValues[s]):3===n.defaultAttributeValues[s].length&&Fe.vertexAttrib3fv(l,n.defaultAttributeValues[s])));var C=o.type===c.LineStrip?Fe.LINE_STRIP:Fe.LINES;ne(n.linewidth);var S=d.position;Fe.drawArrays(C,0,S.numItems/3),ze.info.render.calls++,ze.info.render.points+=S.numItems}}},this.renderBuffer=function(e,t,i,n,r,o){if(n.visible!==!1){var a,s,l,u=U(e,t,i,n,o),h=u.attributes,f=!1,d=n.wireframe?1:0,p=16777215*r.id+2*u.id+d;if(p!==Xe&&(Xe=p,f=!0),f&&b(),!n.morphTargets&&h.position>=0?f&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglVertexBuffer),x(h.position),Fe.vertexAttribPointer(h.position,3,Fe.FLOAT,!1,0,0)):o.morphTargetBase&&w(n,r,o),f){if(r.__webglCustomAttributesList)for(s=0,l=r.__webglCustomAttributesList.length;l>s;s++)a=r.__webglCustomAttributesList[s],h[a.buffer.belongsToAttribute]>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,a.buffer),x(h[a.buffer.belongsToAttribute]),Fe.vertexAttribPointer(h[a.buffer.belongsToAttribute],a.size,Fe.FLOAT,!1,0,0));h.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglColorBuffer),x(h.color),Fe.vertexAttribPointer(h.color,3,Fe.FLOAT,!1,0,0)):n.defaultAttributeValues&&Fe.vertexAttrib3fv(h.color,n.defaultAttributeValues.color)),h.normal>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglNormalBuffer),x(h.normal),Fe.vertexAttribPointer(h.normal,3,Fe.FLOAT,!1,0,0)),h.tangent>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglTangentBuffer),x(h.tangent),Fe.vertexAttribPointer(h.tangent,4,Fe.FLOAT,!1,0,0)),h.uv>=0&&(o.geometry.faceVertexUvs[0]?(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglUVBuffer),x(h.uv),Fe.vertexAttribPointer(h.uv,2,Fe.FLOAT,!1,0,0)):n.defaultAttributeValues&&Fe.vertexAttrib2fv(h.uv,n.defaultAttributeValues.uv)),h.uv2>=0&&(o.geometry.faceVertexUvs[1]?(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglUV2Buffer),x(h.uv2),Fe.vertexAttribPointer(h.uv2,2,Fe.FLOAT,!1,0,0)):n.defaultAttributeValues&&Fe.vertexAttrib2fv(h.uv2,n.defaultAttributeValues.uv2)),n.skinning&&h.skinIndex>=0&&h.skinWeight>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglSkinIndicesBuffer),x(h.skinIndex),Fe.vertexAttribPointer(h.skinIndex,4,Fe.FLOAT,!1,0,0),Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglSkinWeightsBuffer),x(h.skinWeight),Fe.vertexAttribPointer(h.skinWeight,4,Fe.FLOAT,!1,0,0)),h.lineDistance>=0&&(Fe.bindBuffer(Fe.ARRAY_BUFFER,r.__webglLineDistanceBuffer),x(h.lineDistance),Fe.vertexAttribPointer(h.lineDistance,1,Fe.FLOAT,!1,0,0))}if(o instanceof c.Mesh)n.wireframe?(ne(n.wireframeLinewidth),f&&Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer),Fe.drawElements(Fe.LINES,r.__webglLineCount,Fe.UNSIGNED_SHORT,0)):(f&&Fe.bindBuffer(Fe.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),Fe.drawElements(Fe.TRIANGLES,r.__webglFaceCount,Fe.UNSIGNED_SHORT,0)),ze.info.render.calls++,ze.info.render.vertices+=r.__webglFaceCount,ze.info.render.faces+=r.__webglFaceCount/3;else if(o instanceof c.Line){var m=o.type===c.LineStrip?Fe.LINE_STRIP:Fe.LINES;ne(n.linewidth),Fe.drawArrays(m,0,r.__webglLineCount),ze.info.render.calls++}else o instanceof c.ParticleSystem&&(Fe.drawArrays(Fe.POINTS,0,r.__webglParticleCount),ze.info.render.calls++,ze.info.render.points+=r.__webglParticleCount)}},this.render=function(e,t,i,n){if(t instanceof c.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var r,o,a,s,l,u=e.__lights,h=e.fog;for(Ge=-1,wt=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),vt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),gt.setFromMatrix(vt),this.autoUpdateObjects&&this.initWebGLObjects(e),S(this.renderPluginsPre,e,t),ze.info.render.calls=0,ze.info.render.vertices=0,ze.info.render.faces=0,ze.info.render.points=0,this.setRenderTarget(i),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),l=e.__webglObjects,r=0,o=l.length;o>r;r++)a=l[r],s=a.object,a.id=r,a.render=!1,s.visible&&((s instanceof c.Mesh||s instanceof c.ParticleSystem)&&s.frustumCulled&&!gt.intersectsObject(s)||(J(s,t),A(a),a.render=!0,this.sortObjects===!0&&(null!==s.renderDepth?a.z=s.renderDepth:(xt.getPositionFromMatrix(s.matrixWorld),xt.applyProjection(vt),a.z=xt.z))));for(this.sortObjects&&l.sort(_),l=e.__webglObjectsImmediate,r=0,o=l.length;o>r;r++)a=l[r],s=a.object,s.visible&&(J(s,t),E(a));if(e.overrideMaterial){var f=e.overrideMaterial;this.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),this.setDepthTest(f.depthTest),this.setDepthWrite(f.depthWrite),re(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits),C(e.__webglObjects,!1,"",t,u,h,!0,f),T(e.__webglObjectsImmediate,"",t,u,h,!1,f)}else{var f=null;this.setBlending(c.NoBlending),C(e.__webglObjects,!0,"opaque",t,u,h,!1,f),T(e.__webglObjectsImmediate,"opaque",t,u,h,!1,f),C(e.__webglObjects,!1,"transparent",t,u,h,!0,f),T(e.__webglObjectsImmediate,"transparent",t,u,h,!0,f)}S(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==c.NearestFilter&&i.minFilter!==c.LinearFilter&&ye(i),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,i,n,r){var o=U(e,t,i,n,r);Xe=-1,ze.setMaterialFaces(n),r.immediateRenderCallback?r.immediateRenderCallback(o,Fe,gt):r.render(function(e){ze.renderBufferImmediate(e,o,n)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)L(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)I(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,i=e.__webglObjects.length;i>t;t++){var n=e.__webglObjects[t].object;void 0===n.__webglInit&&(void 0!==n.__webglActive&&I(n,e),L(n,e)),R(n)}},this.initMaterial=function(e,t,i,n){e.addEventListener("dispose",Bt);var r,o,a,s,l,u,h;e instanceof c.MeshDepthMaterial?h="depth":e instanceof c.MeshNormalMaterial?h="normal":e instanceof c.MeshBasicMaterial?h="basic":e instanceof c.MeshLambertMaterial?h="lambert":e instanceof c.MeshPhongMaterial?h="phong":e instanceof c.LineBasicMaterial?h="basic":e instanceof c.LineDashedMaterial?h="dashed":e instanceof c.ParticleSystemMaterial&&(h="particle_basic"),h&&V(e,c.ShaderLib[h]),s=_e(t),u=Me(t),l=we(n),a={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof c.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:At&&n&&n.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:u,shadowMapEnabled:this.shadowMapEnabled&&n.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===c.DoubleSide,flipSided:e.side===c.BackSide},e.program=ae(h,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,a,e.index0AttributeName);var f=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var d,p="morphTarget";for(o=0;o<this.maxMorphTargets;o++)d=p+o,f[d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var d,p="morphNormal";for(o=0;o<this.maxMorphNormals;o++)d=p+o,f[d]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(r in e.uniforms)e.uniformsList.push([e.uniforms[r],r])},this.setFaceCulling=function(e,t){e===c.CullFaceNone?Fe.disable(Fe.CULL_FACE):(t===c.FrontFaceDirectionCW?Fe.frontFace(Fe.CW):Fe.frontFace(Fe.CCW),e===c.CullFaceBack?Fe.cullFace(Fe.BACK):e===c.CullFaceFront?Fe.cullFace(Fe.FRONT):Fe.cullFace(Fe.FRONT_AND_BACK),Fe.enable(Fe.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===c.DoubleSide,i=e.side===c.BackSide;Ze!==t&&(t?Fe.disable(Fe.CULL_FACE):Fe.enable(Fe.CULL_FACE),Ze=t),Qe!==i&&(i?Fe.frontFace(Fe.CW):Fe.frontFace(Fe.CCW),Qe=i)},this.setDepthTest=function(e){nt!==e&&(e?Fe.enable(Fe.DEPTH_TEST):Fe.disable(Fe.DEPTH_TEST),nt=e)},this.setDepthWrite=function(e){rt!==e&&(Fe.depthMask(e),rt=e)},this.setBlending=function(e,t,i,n){e!==Je&&(e===c.NoBlending?Fe.disable(Fe.BLEND):e===c.AdditiveBlending?(Fe.enable(Fe.BLEND),Fe.blendEquation(Fe.FUNC_ADD),Fe.blendFunc(Fe.SRC_ALPHA,Fe.ONE)):e===c.SubtractiveBlending?(Fe.enable(Fe.BLEND),Fe.blendEquation(Fe.FUNC_ADD),Fe.blendFunc(Fe.ZERO,Fe.ONE_MINUS_SRC_COLOR)):e===c.MultiplyBlending?(Fe.enable(Fe.BLEND),Fe.blendEquation(Fe.FUNC_ADD),Fe.blendFunc(Fe.ZERO,Fe.SRC_COLOR)):e===c.CustomBlending?Fe.enable(Fe.BLEND):(Fe.enable(Fe.BLEND),Fe.blendEquationSeparate(Fe.FUNC_ADD,Fe.FUNC_ADD),Fe.blendFuncSeparate(Fe.SRC_ALPHA,Fe.ONE_MINUS_SRC_ALPHA,Fe.ONE,Fe.ONE_MINUS_SRC_ALPHA)),Je=e),e===c.CustomBlending?(t!==et&&(Fe.blendEquation(be(t)),et=t),(i!==tt||n!==it)&&(Fe.blendFunc(be(i),be(n)),tt=i,it=n)):(et=null,tt=null,it=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",It),e.__webglTexture=Fe.createTexture(),ze.info.memory.textures++),Fe.activeTexture(Fe.TEXTURE0+t),Fe.bindTexture(Fe.TEXTURE_2D,e.__webglTexture),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,e.flipY),Fe.pixelStorei(Fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Fe.pixelStorei(Fe.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,n=ce(i.width)&&ce(i.height),r=be(e.format),o=be(e.type);fe(Fe.TEXTURE_2D,e,n);var a,s=e.mipmaps;if(e instanceof c.DataTexture)if(s.length>0&&n){for(var l=0,u=s.length;u>l;l++)a=s[l],Fe.texImage2D(Fe.TEXTURE_2D,l,r,a.width,a.height,0,r,o,a.data);e.generateMipmaps=!1}else Fe.texImage2D(Fe.TEXTURE_2D,0,r,i.width,i.height,0,r,o,i.data);else if(e instanceof c.CompressedTexture)for(var l=0,u=s.length;u>l;l++)a=s[l],e.format!==c.RGBAFormat?Fe.compressedTexImage2D(Fe.TEXTURE_2D,l,r,a.width,a.height,0,a.data):Fe.texImage2D(Fe.TEXTURE_2D,l,r,a.width,a.height,0,r,o,a.data);else if(s.length>0&&n){for(var l=0,u=s.length;u>l;l++)a=s[l],Fe.texImage2D(Fe.TEXTURE_2D,l,r,r,o,a);e.generateMipmaps=!1}else Fe.texImage2D(Fe.TEXTURE_2D,0,r,r,o,e.image);e.generateMipmaps&&n&&Fe.generateMipmap(Fe.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Fe.activeTexture(Fe.TEXTURE0+t),Fe.bindTexture(Fe.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof c.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",kt),e.__webglTexture=Fe.createTexture(),ze.info.memory.textures++;var i=ce(e.width)&&ce(e.height),n=be(e.format),r=be(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,e.__webglTexture),fe(Fe.TEXTURE_CUBE_MAP,e,i);for(var o=0;6>o;o++)e.__webglFramebuffer[o]=Fe.createFramebuffer(),e.__webglRenderbuffer[o]=Fe.createRenderbuffer(),Fe.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n,e.width,e.height,0,n,r,null),ge(e.__webglFramebuffer[o],e,Fe.TEXTURE_CUBE_MAP_POSITIVE_X+o),ve(e.__webglRenderbuffer[o],e);i&&Fe.generateMipmap(Fe.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Fe.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=Fe.createRenderbuffer(),Fe.bindTexture(Fe.TEXTURE_2D,e.__webglTexture),fe(Fe.TEXTURE_2D,e,i),Fe.texImage2D(Fe.TEXTURE_2D,0,n,e.width,e.height,0,n,r,null),ge(e.__webglFramebuffer,e,Fe.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_ATTACHMENT,Fe.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Fe.framebufferRenderbuffer(Fe.FRAMEBUFFER,Fe.DEPTH_STENCIL_ATTACHMENT,Fe.RENDERBUFFER,e.__webglRenderbuffer):ve(e.__webglRenderbuffer,e),i&&Fe.generateMipmap(Fe.TEXTURE_2D);t?Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,null):Fe.bindTexture(Fe.TEXTURE_2D,null),Fe.bindRenderbuffer(Fe.RENDERBUFFER,null),Fe.bindFramebuffer(Fe.FRAMEBUFFER,null)}var a,s,l,u,h;e?(a=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,s=e.width,l=e.height,u=0,h=0):(a=null,s=ct,l=ft,u=ut,h=ht),a!==We&&(Fe.bindFramebuffer(Fe.FRAMEBUFFER,a),Fe.viewport(u,h,s,l),We=a),dt=s,pt=l},this.shadowMapPlugin=new c.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new c.SpritePlugin),this.addPostPlugin(new c.LensFlarePlugin)},c.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:c.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:c.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:c.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:c.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new c.Vector2(0,0),this.repeat=new c.Vector2(1,1),this.format=void 0!==i.format?i.format:c.RGBAFormat,this.type=void 0!==i.type?i.type:c.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},c.WebGLRenderTarget.prototype={constructor:c.WebGLRenderTarget,
clone:function(){var e=new c.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.WebGLRenderTarget.prototype),c.WebGLRenderTargetCube=function(e,t,i){c.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},c.WebGLRenderTargetCube.prototype=Object.create(c.WebGLRenderTarget.prototype),c.RenderableVertex=function(){this.positionWorld=new c.Vector3,this.positionScreen=new c.Vector4,this.visible=!0},c.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},c.RenderableFace3=function(){this.id=0,this.v1=new c.RenderableVertex,this.v2=new c.RenderableVertex,this.v3=new c.RenderableVertex,this.centroidModel=new c.Vector3,this.normalModel=new c.Vector3,this.normalModelView=new c.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new c.Vector3,new c.Vector3,new c.Vector3],this.vertexNormalsModelView=[new c.Vector3,new c.Vector3,new c.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=0},c.RenderableObject=function(){this.id=0,this.object=null,this.z=0},c.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new c.Vector2,this.material=null},c.RenderableLine=function(){this.id=0,this.v1=new c.RenderableVertex,this.v2=new c.RenderableVertex,this.vertexColors=[new c.Color,new c.Color],this.material=null,this.z=0},c.GeometryUtils={merge:function(e,t,i){var n,r,o=e.vertices.length,a=(e.faceVertexUvs[0].length,t instanceof c.Mesh?t.geometry:t),s=e.vertices,l=a.vertices,u=e.faces,h=a.faces,f=e.faceVertexUvs[0],d=a.faceVertexUvs[0];void 0===i&&(i=0),t instanceof c.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=(new c.Matrix3).getNormalMatrix(n));for(var p=0,m=l.length;m>p;p++){var g=l[p],v=g.clone();n&&v.applyMatrix4(n),s.push(v)}for(p=0,m=h.length;m>p;p++){var y,x,b,w=h[p],_=w.vertexNormals,M=w.vertexColors;y=new c.Face3(w.a+o,w.b+o,w.c+o),y.normal.copy(w.normal),r&&y.normal.applyMatrix3(r).normalize();for(var S=0,C=_.length;C>S;S++)x=_[S].clone(),r&&x.applyMatrix3(r).normalize(),y.vertexNormals.push(x);y.color.copy(w.color);for(var S=0,C=M.length;C>S;S++)b=M[S],y.vertexColors.push(b.clone());y.materialIndex=w.materialIndex+i,y.centroid.copy(w.centroid),n&&y.centroid.applyMatrix4(n),u.push(y)}for(p=0,m=d.length;m>p;p++){for(var T=d[p],E=[],S=0,C=T.length;C>S;S++)E.push(new c.Vector2(T[S].x,T[S].y));f.push(E)}},randomPointInTriangle:function(){var e=new c.Vector3;return function(t,i,n){var r=new c.Vector3,o=c.Math.random16(),a=c.Math.random16();o+a>1&&(o=1-o,a=1-a);var s=1-o-a;return r.copy(t),r.multiplyScalar(o),e.copy(i),e.multiplyScalar(a),r.add(e),e.copy(n),e.multiplyScalar(s),r.add(e),r}}(),randomPointInFace:function(e,t,i){var n,r,o;return n=t.vertices[e.a],r=t.vertices[e.b],o=t.vertices[e.c],c.GeometryUtils.randomPointInTriangle(n,r,o)},randomPointsInGeometry:function(e,t){function i(e){function t(i,n){if(i>n)return i;var r=i+Math.floor((n-i)/2);return d[r]>e?t(i,r-1):d[r]<e?t(r+1,n):r}var i=t(0,d.length-1);return i}var n,r,o,a,s,l=e.faces,u=e.vertices,h=l.length,f=0,d=[];for(r=0;h>r;r++)n=l[r],o=u[n.a],a=u[n.b],s=u[n.c],n._area=c.GeometryUtils.triangleArea(o,a,s),f+=n._area,d[r]=f;var p,m,g=[],v={};for(r=0;t>r;r++)p=c.Math.random16()*f,m=i(p),g[r]=c.GeometryUtils.randomPointInFace(l[m],e,!0),v[m]?v[m]+=1:v[m]=1;return g},triangleArea:function(){var e=new c.Vector3,t=new c.Vector3;return function(i,n,r){return e.subVectors(n,i),t.subVectors(r,i),e.cross(t),.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new c.Vector3;return i.addVectors(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new c.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},triangulateQuads:function(e){var t,i,n,r,o=[],a=[];for(t=0,i=e.faceVertexUvs.length;i>t;t++)a[t]=[];for(t=0,i=e.faces.length;i>t;t++){var s=e.faces[t];for(o.push(s),n=0,r=e.faceVertexUvs.length;r>n;n++)a[n].push(e.faceVertexUvs[n][t])}e.faces=o,e.faceVertexUvs=a,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()}},c.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i,n){var r=new c.ImageLoader;r.crossOrigin=this.crossOrigin;var o=new c.Texture(void 0,t),a=r.load(e,function(){o.needsUpdate=!0,i&&i(o)});return o.image=a,o.sourceFile=e,o},loadCompressedTexture:function(e,t,i,n){var r=new c.CompressedTexture;r.mapping=t;var o=new XMLHttpRequest;return o.onload=function(){var e=o.response,t=c.ImageUtils.parseDDS(e,!0);r.format=t.format,r.mipmaps=t.mipmaps,r.image.width=t.width,r.image.height=t.height,r.generateMipmaps=!1,r.needsUpdate=!0,i&&i(r)},o.onerror=n,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),r},loadTextureCube:function(e,t,i,n){var r=[];r.loadCount=0;var o=new c.Texture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1;for(var a=0,s=e.length;s>a;++a){var l=new Image;r[a]=l,l.onload=function(){r.loadCount+=1,6===r.loadCount&&(o.needsUpdate=!0,i&&i(o))},l.onerror=n,l.crossOrigin=this.crossOrigin,l.src=e[a]}return o},loadCompressedTextureCube:function(e,t,i,n){var r=[];r.loadCount=0;var o=new c.CompressedTexture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;var a=function(e,t){return function(){var n=e.response,a=c.ImageUtils.parseDDS(n,!0);t.format=a.format,t.mipmaps=a.mipmaps,t.width=a.width,t.height=a.height,r.loadCount+=1,6===r.loadCount&&(o.format=a.format,o.needsUpdate=!0,i&&i(o))}};if(e instanceof Array)for(var s=0,l=e.length;l>s;++s){var u={};r[s]=u;var h=new XMLHttpRequest;h.onload=a(h,u),h.onerror=n;var f=e[s];h.open("GET",f,!0),h.responseType="arraybuffer",h.send(null)}else{var f=e,h=new XMLHttpRequest;h.onload=function(){var e=h.response,t=c.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var n=t.mipmaps.length/t.mipmapCount,a=0;n>a;a++){r[a]={mipmaps:[]};for(var s=0;s<t.mipmapCount;s++)r[a].mipmaps.push(t.mipmaps[a*t.mipmapCount+s]),r[a].format=t.format,r[a].width=t.width,r[a].height=t.height}o.format=t.format,o.needsUpdate=!0,i&&i(o)}},h.onerror=n,h.open("GET",f,!0),h.responseType="arraybuffer",h.send(null)}return o},loadDDSTexture:function(e,t,i,n){var r=[];r.loadCount=0;var o=new c.CompressedTexture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;var a=new XMLHttpRequest;return a.onload=function(){var e=a.response,t=c.ImageUtils.parseDDS(e,!0);if(t.isCubemap)for(var n=t.mipmaps.length/t.mipmapCount,s=0;n>s;s++){r[s]={mipmaps:[]};for(var l=0;l<t.mipmapCount;l++)r[s].mipmaps.push(t.mipmaps[s*t.mipmapCount+l]),r[s].format=t.format,r[s].width=t.width,r[s].height=t.height}else o.image.width=t.width,o.image.height=t.height,o.mipmaps=t.mipmaps;o.format=t.format,o.needsUpdate=!0,i&&i(o)},a.onerror=n,a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null),o},parseDDS:function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}function r(e,t,i,n){for(var r=i*n*4,o=new Uint8Array(e,t,r),a=new Uint8Array(r),s=0,l=0,u=0;n>u;u++)for(var h=0;i>h;h++){var c=o[l];l++;var f=o[l];l++;var d=o[l];l++;var p=o[l];l++,a[s]=d,s++,a[s]=f,s++,a[s]=c,s++,a[s]=p,s++}return a}var o={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},a=542327876,s=131072,l=512,u=4,h=i("DXT1"),f=i("DXT3"),d=i("DXT5"),p=31,m=0,g=1,v=2,y=3,x=4,b=7,w=20,_=21,M=22,S=23,C=24,T=25,E=26,A=28,P=new Int32Array(e,0,p);if(P[m]!==a)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),o;if(!P[w]&u)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),o;var L,D=P[_],N=!1;switch(D){case h:L=8,o.format=c.RGB_S3TC_DXT1_Format;break;case f:L=16,o.format=c.RGBA_S3TC_DXT3_Format;break;case d:L=16,o.format=c.RGBA_S3TC_DXT5_Format;break;default:if(!(32==P[M]&&16711680&P[S]&&65280&P[C]&&255&P[T]&&4278190080&P[E]))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",n(D)),o;N=!0,L=64,o.format=c.RGBAFormat}o.mipmapCount=1,P[v]&s&&t!==!1&&(o.mipmapCount=Math.max(1,P[b])),o.isCubemap=P[A]&l?!0:!1,o.width=P[x],o.height=P[y];for(var R=P[g]+4,O=o.width,F=o.height,I=o.isCubemap?6:1,k=0;I>k;k++){for(var B=0;B<o.mipmapCount;B++){if(N)var V=r(e,R,O,F),U=V.length;else var U=Math.max(4,O)/4*Math.max(4,F)/4*L,V=new Uint8Array(e,R,U);var z={data:V,width:O,height:F};o.mipmaps.push(z),R+=U,O=Math.max(.5*O,1),F=Math.max(.5*F,1)}O=o.width,F=o.height}return o},getNormalMap:function(e,t){var i=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},r=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var o=e.width,a=e.height,s=document.createElement("canvas");s.width=o,s.height=a;var l=s.getContext("2d");l.drawImage(e,0,0);for(var u=l.getImageData(0,0,o,a).data,h=l.createImageData(o,a),c=h.data,f=0;o>f;f++)for(var d=0;a>d;d++){var p=0>d-1?0:d-1,m=d+1>a-1?a-1:d+1,g=0>f-1?0:f-1,v=f+1>o-1?o-1:f+1,y=[],x=[0,0,u[4*(d*o+f)]/255*t];y.push([-1,0,u[4*(d*o+g)]/255*t]),y.push([-1,-1,u[4*(p*o+g)]/255*t]),y.push([0,-1,u[4*(p*o+f)]/255*t]),y.push([1,-1,u[4*(p*o+v)]/255*t]),y.push([1,0,u[4*(d*o+v)]/255*t]),y.push([1,1,u[4*(m*o+v)]/255*t]),y.push([0,1,u[4*(m*o+f)]/255*t]),y.push([-1,1,u[4*(m*o+g)]/255*t]);for(var b=[],w=y.length,_=0;w>_;_++){var M=y[_],S=y[(_+1)%w];M=n(M,x),S=n(S,x),b.push(r(i(M,S)))}for(var C=[0,0,0],_=0;_<b.length;_++)C[0]+=b[_][0],C[1]+=b[_][1],C[2]+=b[_][2];C[0]/=b.length,C[1]/=b.length,C[2]/=b.length;var T=4*(d*o+f);c[T]=(C[0]+1)/2*255|0,c[T+1]=(C[1]+1)/2*255|0,c[T+2]=255*C[2]|0,c[T+3]=255}return l.putImageData(h,0,0),s},generateDataTexture:function(e,t,i){for(var n=e*t,r=new Uint8Array(3*n),o=Math.floor(255*i.r),a=Math.floor(255*i.g),s=Math.floor(255*i.b),l=0;n>l;l++)r[3*l]=o,r[3*l+1]=a,r[3*l+2]=s;var u=new c.DataTexture(r,e,t,c.RGBFormat);return u.needsUpdate=!0,u}},c.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new c.Object3D,n=0,r=t.length;r>n;n++)i.add(new c.Mesh(e,t[n]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var n=new c.Matrix4;n.getInverse(i.matrixWorld),e.applyMatrix(n),t.remove(e),i.add(e)}},c.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,i=this.getFace(),n=this.size/i.resolution,r=0,o=String(e).split(""),a=o.length,s=[];for(t=0;a>t;t++){var l=new c.Path,u=this.extractGlyphPoints(o[t],i,n,r,l);r+=u.offset,s.push(u.path)}var h=r/2;return{paths:s,offset:h}},extractGlyphPoints:function(e,t,i,n,r){var o,a,s,l,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,C=[],T=t.glyphs[e]||t.glyphs["?"];if(T){if(T.o)for(l=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),h=l.length,f=i,d=i,o=0;h>o;)switch(u=l[o++]){case"m":p=l[o++]*f+n,m=l[o++]*d,r.moveTo(p,m);break;case"l":p=l[o++]*f+n,m=l[o++]*d,r.lineTo(p,m);break;case"q":if(g=l[o++]*f+n,v=l[o++]*d,b=l[o++]*f+n,w=l[o++]*d,r.quadraticCurveTo(b,w,g,v),S=C[C.length-1])for(y=S.x,x=S.y,a=1,s=this.divisions;s>=a;a++){var E=a/s;c.Shape.Utils.b2(E,y,b,g),c.Shape.Utils.b2(E,x,w,v)}break;case"b":if(g=l[o++]*f+n,v=l[o++]*d,b=l[o++]*f+n,w=l[o++]*-d,_=l[o++]*f+n,M=l[o++]*-d,r.bezierCurveTo(g,v,b,w,_,M),S=C[C.length-1])for(y=S.x,x=S.y,a=1,s=this.divisions;s>=a;a++){var E=a/s;c.Shape.Utils.b3(E,y,b,_,g),c.Shape.Utils.b3(E,x,w,M,v)}}return{offset:T.ha*i,path:r}}}},c.FontUtils.generateShapes=function(e,t){t=t||{};var i=void 0!==t.size?t.size:100,n=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";c.FontUtils.size=i,c.FontUtils.divisions=n,c.FontUtils.face=r,c.FontUtils.weight=o,c.FontUtils.style=a;for(var s=c.FontUtils.drawText(e),l=s.paths,u=[],h=0,f=l.length;f>h;h++)Array.prototype.push.apply(u,l[h].toShapes());return u},function(e){var t=1e-10,i=function(e,t){var i=e.length;if(3>i)return null;var o,a,s,l=[],u=[],h=[];if(n(e)>0)for(a=0;i>a;a++)u[a]=a;else for(a=0;i>a;a++)u[a]=i-1-a;var c=i,f=2*c;for(a=c-1;c>2;){if(f--<=0)return console.log("Warning, unable to triangulate polygon!"),t?h:l;if(o=a,o>=c&&(o=0),a=o+1,a>=c&&(a=0),s=a+1,s>=c&&(s=0),r(e,o,a,s,c,u)){var d,p,m,g,v;for(d=u[o],p=u[a],m=u[s],l.push([e[d],e[p],e[m]]),h.push([u[o],u[a],u[s]]),g=a,v=a+1;c>v;g++,v++)u[g]=u[v];c--,f=2*c}}return t?h:l},n=function(e){for(var t=e.length,i=0,n=t-1,r=0;t>r;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},r=function(e,i,n,r,o,a){var s,l,u,h,c,f,d,p,m;if(l=e[a[i]].x,u=e[a[i]].y,h=e[a[n]].x,c=e[a[n]].y,f=e[a[r]].x,d=e[a[r]].y,t>(h-l)*(d-u)-(c-u)*(f-l))return!1;var g,v,y,x,b,w,_,M,S,C,T,E,A,P,L;for(g=f-h,v=d-c,y=l-f,x=u-d,b=h-l,w=c-u,s=0;o>s;s++)if(s!==i&&s!==n&&s!==r&&(p=e[a[s]].x,m=e[a[s]].y,_=p-l,M=m-u,S=p-h,C=m-c,T=p-f,E=m-d,L=g*C-v*S,A=b*M-w*_,P=y*E-x*T,L>=-t&&P>=-t&&A>=-t))return!1;return!0};return e.Triangulate=i,e.Triangulate.area=n,e}(c.FontUtils),self._typeface_js={faces:c.FontUtils.faces,loadFace:c.FontUtils.loadFace},c.typeface_js=self._typeface_js,c.Curve=function(){},c.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},c.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},c.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},c.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},c.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},c.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),o+=t.distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n,n},c.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},c.Curve.prototype.getUtoTmapping=function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t?t:e*n[o-1];for(var a,s=0,l=o-1;l>=s;)if(r=Math.floor(s+(l-s)/2),a=n[r]-i,0>a)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]==i){var u=r/(o-1);return u}var h=n[r],c=n[r+1],f=c-h,d=(i-h)/f,u=(r+d)/(o-1);return u},c.Curve.prototype.getTangent=function(e){var t=1e-4,i=e-t,n=e+t;0>i&&(i=0),n>1&&(n=1);var r=this.getPoint(i),o=this.getPoint(n),a=o.clone().sub(r);return a.normalize()},c.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},c.Curve.Utils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e,t,i,n,r){var o=6*e*e-6*e,a=3*e*e-4*e+1,s=-6*e*e+6*e,l=3*e*e-2*e;return o+a+s+l},interpolate:function(e,t,i,n,r){var o=.5*(i-e),a=.5*(n-t),s=r*r,l=r*s;return(2*t-2*i+o+a)*l+(-3*t+3*i-2*o-a)*s+o*r+t}},c.Curve.create=function(e,t){return e.prototype=Object.create(c.Curve.prototype),e.prototype.getPoint=t,e},c.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},c.CurvePath.prototype=Object.create(c.Curve.prototype),c.CurvePath.prototype.add=function(e){this.curves.push(e)},c.CurvePath.prototype.checkConnection=function(){},c.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new c.LineCurve(t,e))},c.CurvePath.prototype.getPoint=function(e){for(var t,i,n=e*this.getLength(),r=this.getCurveLengths(),o=0;o<r.length;){if(r[o]>=n){t=r[o]-n,i=this.curves[o];var a=1-t/i.getLength();return i.getPointAt(a)}o++}return null},c.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},c.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,n=this.curves.length;for(e=0;n>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},c.CurvePath.prototype.getBoundingBox=function(){var e,t,i,n,r,o,a=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=r=Number.POSITIVE_INFINITY;var s,l,u,h,f=a[0]instanceof c.Vector3;for(h=f?new c.Vector3:new c.Vector2,l=0,u=a.length;u>l;l++)s=a[l],s.x>e?e=s.x:s.x<n&&(n=s.x),s.y>t?t=s.y:s.y<r&&(r=s.y),f&&(s.z>i?i=s.z:s.z<o&&(o=s.z)),h.add(s);var d={minX:n,minY:r,maxX:e,maxY:t,centroid:h.divideScalar(u)};return f&&(d.maxZ=i,d.minZ=o),d},c.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},c.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},c.CurvePath.prototype.createGeometry=function(e){for(var t=new c.Geometry,i=0;i<e.length;i++)t.vertices.push(new c.Vector3(e[i].x,e[i].y,e[i].z||0));return t},c.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},c.CurvePath.prototype.getTransformedPoints=function(e,t){var i,n,r=this.getPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},c.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,n,r=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},c.CurvePath.prototype.getWrapPoints=function(e,t){var i,n,r,o,a,s,l=this.getBoundingBox();for(i=0,n=e.length;n>i;i++){r=e[i],o=r.x,a=r.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var u=t.getPoint(s),h=t.getNormalVector(s).multiplyScalar(a);r.x=u.x+h.x,r.y=u.y+h.y}return e},c.Gyroscope=function(){c.Object3D.call(this)},c.Gyroscope.prototype=Object.create(c.Object3D.prototype),c.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},c.Gyroscope.prototype.translationWorld=new c.Vector3,c.Gyroscope.prototype.translationObject=new c.Vector3,c.Gyroscope.prototype.quaternionWorld=new c.Quaternion,c.Gyroscope.prototype.quaternionObject=new c.Quaternion,c.Gyroscope.prototype.scaleWorld=new c.Vector3,c.Gyroscope.prototype.scaleObject=new c.Vector3,c.Path=function(e){c.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},c.Path.prototype=Object.create(c.CurvePath.prototype),c.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},c.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},c.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:c.PathActions.MOVE_TO,args:i})},c.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],o=n[n.length-1],a=new c.LineCurve(new c.Vector2(r,o),new c.Vector2(e,t));this.curves.push(a),this.actions.push({action:c.PathActions.LINE_TO,args:i})},c.Path.prototype.quadraticCurveTo=function(e,t,i,n){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new c.QuadraticBezierCurve(new c.Vector2(a,s),new c.Vector2(e,t),new c.Vector2(i,n));this.curves.push(l),this.actions.push({action:c.PathActions.QUADRATIC_CURVE_TO,args:r})},c.Path.prototype.bezierCurveTo=function(e,t,i,n,r,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],u=s[s.length-1],h=new c.CubicBezierCurve(new c.Vector2(l,u),new c.Vector2(e,t),new c.Vector2(i,n),new c.Vector2(r,o));this.curves.push(h),this.actions.push({action:c.PathActions.BEZIER_CURVE_TO,args:a})},c.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],r=i[i.length-1],o=[new c.Vector2(n,r)];Array.prototype.push.apply(o,e);var a=new c.SplineCurve(o);this.curves.push(a),this.actions.push({action:c.PathActions.CSPLINE_THRU,args:t})},c.Path.prototype.arc=function(e,t,i,n,r,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,i,n,r,o)},c.Path.prototype.absarc=function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},c.Path.prototype.ellipse=function(e,t,i,n,r,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],u=s[s.length-1];this.absellipse(e+l,t+u,i,n,r,o,a)},c.Path.prototype.absellipse=function(e,t,i,n,r,o,a){var s=Array.prototype.slice.call(arguments),l=new c.EllipseCurve(e,t,i,n,r,o,a);this.curves.push(l);var u=l.getPoint(1);s.push(u.x),s.push(u.y),this.actions.push({action:c.PathActions.ELLIPSE,args:s})},c.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],n=0;e>n;n++)i.push(this.getPoint(n/e));return i},c.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,n,r,o,a,s,l,u,h,f,d,p,m,g,v,y,x,b,w=[];for(i=0,n=this.actions.length;n>i;i++)switch(r=this.actions[i],o=r.action,a=r.args,o){case c.PathActions.MOVE_TO:w.push(new c.Vector2(a[0],a[1]));break;case c.PathActions.LINE_TO:w.push(new c.Vector2(a[0],a[1]));break;case c.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],l=a[3],f=a[0],d=a[1],w.length>0?(g=w[w.length-1],p=g.x,m=g.y):(g=this.actions[i-1].args,p=g[g.length-2],m=g[g.length-1]),v=1;e>=v;v++)y=v/e,x=c.Shape.Utils.b2(y,p,f,s),b=c.Shape.Utils.b2(y,m,d,l),w.push(new c.Vector2(x,b));break;case c.PathActions.BEZIER_CURVE_TO:for(s=a[4],l=a[5],f=a[0],d=a[1],u=a[2],h=a[3],w.length>0?(g=w[w.length-1],p=g.x,m=g.y):(g=this.actions[i-1].args,p=g[g.length-2],m=g[g.length-1]),v=1;e>=v;v++)y=v/e,x=c.Shape.Utils.b3(y,p,f,u,s),b=c.Shape.Utils.b3(y,m,d,h,l),w.push(new c.Vector2(x,b));break;case c.PathActions.CSPLINE_THRU:g=this.actions[i-1].args;var _=new c.Vector2(g[g.length-2],g[g.length-1]),M=[_],S=e*a[0].length;M=M.concat(a[0]);var C=new c.SplineCurve(M);for(v=1;S>=v;v++)w.push(C.getPointAt(v/S));break;case c.PathActions.ARC:var T,E=a[0],A=a[1],P=a[2],L=a[3],D=a[4],N=!!a[5],R=D-L,O=2*e;for(v=1;O>=v;v++)y=v/O,N||(y=1-y),T=L+y*R,x=E+P*Math.cos(T),b=A+P*Math.sin(T),w.push(new c.Vector2(x,b));break;case c.PathActions.ELLIPSE:var T,E=a[0],A=a[1],F=a[2],I=a[3],L=a[4],D=a[5],N=!!a[6],R=D-L,O=2*e;for(v=1;O>=v;v++)y=v/O,N||(y=1-y),T=L+y*R,x=E+F*Math.cos(T),b=A+I*Math.sin(T),w.push(new c.Vector2(x,b))}var k=w[w.length-1],B=1e-10;return Math.abs(k.x-w[0].x)<B&&Math.abs(k.y-w[0].y)<B&&w.splice(w.length-1,1),t&&w.push(w[0]),w},c.Path.prototype.toShapes=function(e){var t,i,n,r,o,a=[],s=new c.Path;for(t=0,i=this.actions.length;i>t;t++)n=this.actions[t],o=n.args,r=n.action,r==c.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new c.Path),s[r].apply(s,o);if(0!=s.actions.length&&a.push(s),0==a.length)return[];var l,u,h,f=[];if(1==a.length)return u=a[0],h=new c.Shape,h.actions=u.actions,h.curves=u.curves,f.push(h),f;var d=!c.Shape.Utils.isClockWise(a[0].getPoints());if(d=e?!d:d)for(h=new c.Shape,t=0,i=a.length;i>t;t++)u=a[t],l=c.Shape.Utils.isClockWise(u.getPoints()),l=e?!l:l,l?(h.actions=u.actions,h.curves=u.curves,f.push(h),h=new c.Shape):h.holes.push(u);else{for(h=void 0,t=0,i=a.length;i>t;t++)u=a[t],l=c.Shape.Utils.isClockWise(u.getPoints()),l=e?!l:l,l?(h&&f.push(h),h=new c.Shape,h.actions=u.actions,h.curves=u.curves):h.holes.push(u);f.push(h)}return f},c.Shape=function(){c.Path.apply(this,arguments),this.holes=[]},c.Shape.prototype=Object.create(c.Path.prototype),c.Shape.prototype.extrude=function(e){var t=new c.ExtrudeGeometry(this,e);return t},c.Shape.prototype.makeGeometry=function(e){var t=new c.ShapeGeometry(this,e);return t},c.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},c.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},c.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},c.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},c.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},c.Shape.Utils={removeHoles:function(e,t){var i,n,r,o,a,s,l,u,h,f,d,p,m,g,v,y,x=e.concat(),b=x.concat(),w=[];for(a=0;a<t.length;a++){for(l=t[a],Array.prototype.push.apply(b,l),u=Number.POSITIVE_INFINITY,s=0;s<l.length;s++){d=l[s];var _=[];for(f=0;f<x.length;f++)p=x[f],h=d.distanceToSquared(p),_.push(h),u>h&&(u=h,r=s,o=f)}i=o-1>=0?o-1:x.length-1,n=r-1>=0?r-1:l.length-1;var M=[l[r],x[o],x[i]],S=c.FontUtils.Triangulate.area(M),C=[l[r],l[n],x[o]],T=c.FontUtils.Triangulate.area(C),E=1,A=-1,P=o,L=r;o+=E,r+=A,0>o&&(o+=x.length),o%=x.length,0>r&&(r+=l.length),r%=l.length,i=o-1>=0?o-1:x.length-1,n=r-1>=0?r-1:l.length-1,M=[l[r],x[o],x[i]];var D=c.FontUtils.Triangulate.area(M);C=[l[r],l[n],x[o]];var N=c.FontUtils.Triangulate.area(C);S+T>D+N&&(o=P,r=L,0>o&&(o+=x.length),o%=x.length,0>r&&(r+=l.length),r%=l.length,i=o-1>=0?o-1:x.length-1,n=r-1>=0?r-1:l.length-1),m=x.slice(0,o),g=x.slice(o),v=l.slice(r),y=l.slice(0,r);var R=[l[r],x[o],x[i]],O=[l[r],l[n],x[o]];w.push(R),w.push(O),x=m.concat(v).concat(y).concat(g)}return{shape:x,isolatedPts:w,allpoints:b}},triangulateShape:function(e,t){var i,n,r,o,a,s,l=c.Shape.Utils.removeHoles(e,t),u=l.shape,h=l.allpoints,f=l.isolatedPts,d=c.FontUtils.Triangulate(u,!1),p={};for(i=0,n=h.length;n>i;i++)a=h[i].x+":"+h[i].y,void 0!==p[a]&&console.log("Duplicate point",a),p[a]=i;for(i=0,n=d.length;n>i;i++)for(o=d[i],r=0;3>r;r++)a=o[r].x+":"+o[r].y,s=p[a],void 0!==s&&(o[r]=s);for(i=0,n=f.length;n>i;i++)for(o=f[i],r=0;3>r;r++)a=o[r].x+":"+o[r].y,s=p[a],void 0!==s&&(o[r]=s);return d.concat(f)},isClockWise:function(e){return c.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,n){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,n)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){var i=1-e;return 3*i*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,n,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,n)+this.b3p3(e,r)}},c.LineCurve=function(e,t){this.v1=e,this.v2=t},c.LineCurve.prototype=Object.create(c.Curve.prototype),c.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},c.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},c.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},c.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},c.QuadraticBezierCurve.prototype=Object.create(c.Curve.prototype),c.QuadraticBezierCurve.prototype.getPoint=function(e){var t,i;return t=c.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=c.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new c.Vector2(t,i)},c.QuadraticBezierCurve.prototype.getTangent=function(e){var t,i;t=c.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),i=c.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var n=new c.Vector2(t,i);return n.normalize(),n},c.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},c.CubicBezierCurve.prototype=Object.create(c.Curve.prototype),c.CubicBezierCurve.prototype.getPoint=function(e){var t,i;return t=c.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=c.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new c.Vector2(t,i)},c.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=c.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=c.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new c.Vector2(t,i);return n.normalize(),n},c.SplineCurve=function(e){this.points=void 0==e?[]:e},c.SplineCurve.prototype=Object.create(c.Curve.prototype),c.SplineCurve.prototype.getPoint=function(e){var t,i,n,r=new c.Vector2,o=[],a=this.points;return t=(a.length-1)*e,i=Math.floor(t),n=t-i,o[0]=0==i?i:i-1,o[1]=i,o[2]=i>a.length-2?a.length-1:i+1,o[3]=i>a.length-3?a.length-1:i+2,r.x=c.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,n),r.y=c.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,n),r},c.EllipseCurve=function(e,t,i,n,r,o,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a},c.EllipseCurve.prototype=Object.create(c.Curve.prototype),c.EllipseCurve.prototype.getPoint=function(e){var t,i=this.aEndAngle-this.aStartAngle;0>i&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),t=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-i):this.aStartAngle+e*i;var n=this.aX+this.xRadius*Math.cos(t),r=this.aY+this.yRadius*Math.sin(t);return new c.Vector2(n,r)},c.ArcCurve=function(e,t,i,n,r,o){c.EllipseCurve.call(this,e,t,i,i,n,r,o)},c.ArcCurve.prototype=Object.create(c.EllipseCurve.prototype),c.LineCurve3=c.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new c.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),c.QuadraticBezierCurve3=c.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i,n;return t=c.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=c.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),n=c.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new c.Vector3(t,i,n)}),c.CubicBezierCurve3=c.Curve.create(function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},function(e){var t,i,n;return t=c.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=c.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),n=c.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new c.Vector3(t,i,n)}),c.SplineCurve3=c.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i,n,r=new c.Vector3,o=[],a=this.points;t=(a.length-1)*e,i=Math.floor(t),n=t-i,o[0]=0==i?i:i-1,o[1]=i,o[2]=i>a.length-2?a.length-1:i+1,o[3]=i>a.length-3?a.length-1:i+2;var s=a[o[0]],l=a[o[1]],u=a[o[2]],h=a[o[3]];return r.x=c.Curve.Utils.interpolate(s.x,l.x,u.x,h.x,n),r.y=c.Curve.Utils.interpolate(s.y,l.y,u.y,h.y,n),r.z=c.Curve.Utils.interpolate(s.z,l.z,u.z,h.z,n),r}),c.ClosedSplineCurve3=c.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i,n,r=new c.Vector3,o=[],a=this.points;return t=(a.length-0)*e,i=Math.floor(t),n=t-i,i+=i>0?0:(Math.floor(Math.abs(i)/a.length)+1)*a.length,o[0]=(i-1)%a.length,o[1]=i%a.length,o[2]=(i+1)%a.length,o[3]=(i+2)%a.length,
r.x=c.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,n),r.y=c.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,n),r.z=c.Curve.Utils.interpolate(a[o[0]].z,a[o[1]].z,a[o[2]].z,a[o[3]].z,n),r}),c.AnimationHandler=function(){var e=[],t={},i={};i.update=function(t){for(var i=0;i<e.length;i++)e[i].update(t)},i.addToUpdate=function(t){-1===e.indexOf(t)&&e.push(t)},i.removeFromUpdate=function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},i.add=function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,r(e)},i.get=function(e){return"string"==typeof e?t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},i.parse=function(e){var t=[];if(e instanceof c.SkinnedMesh)for(var i=0;i<e.bones.length;i++)t.push(e.bones[i]);else n(e,t);return t};var n=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)n(e.children[i],t)},r=function(e){if(e.initialized!==!0){for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof c.Quaternion)){var n=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=new c.Quaternion(n[0],n[1],n[2],n[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var r={},i=0;i<e.hierarchy[t].keys.length;i++)for(var o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++){var a=e.hierarchy[t].keys[i].morphTargets[o];r[a]=-1}e.hierarchy[t].usedMorphTargets=r;for(var i=0;i<e.hierarchy[t].keys.length;i++){var s={};for(var a in r){for(var o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++)if(e.hierarchy[t].keys[i].morphTargets[o]===a){s[a]=e.hierarchy[t].keys[i].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[i].morphTargets.length&&(s[a]=0)}e.hierarchy[t].keys[i].morphTargetsInfluences=s}}for(var i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(var i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}var l=parseInt(e.length*e.fps,10);e.JIT={},e.JIT.hierarchy=[];for(var t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(l));e.initialized=!0}};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),c.Animation=function(e,t,i){this.root=e,this.data=c.AnimationHandler.get(t),this.hierarchy=c.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==i?i:c.AnimationHandler.LINEAR,this.points=[],this.target=new c.Vector3},c.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var i,n,r=this.hierarchy.length;for(i=0;r>i;i++){n=this.hierarchy[i],n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey={pos:0,rot:0,scl:0},n.animationCache.nextKey={pos:0,rot:0,scl:0},n.animationCache.originalMatrix=n instanceof c.Bone?n.skinMatrix:n.matrix);var o=n.animationCache.prevKey,a=n.animationCache.nextKey;o.pos=this.data.hierarchy[i].keys[0],o.rot=this.data.hierarchy[i].keys[0],o.scl=this.data.hierarchy[i].keys[0],a.pos=this.getNextKeyWith("pos",i,1),a.rot=this.getNextKeyWith("rot",i,1),a.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,c.AnimationHandler.addToUpdate(this)},c.Animation.prototype.pause=function(){this.isPaused===!0?c.AnimationHandler.addToUpdate(this):c.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},c.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,c.AnimationHandler.removeFromUpdate(this)},c.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t,i,n,r,o,a,s,l,u,h,f,d,p,m,g,v=["pos","rot","scl"];this.data.JIT.hierarchy;this.currentTime+=e*this.timeScale,d=this.currentTime,f=this.currentTime=this.currentTime%this.data.length,h=parseInt(Math.min(f*this.data.fps,this.data.length*this.data.fps),10);for(var y=0,x=this.hierarchy.length;x>y;y++){l=this.hierarchy[y],u=l.animationCache;for(var b=0;3>b;b++){if(t=v[b],a=u.prevKey[t],s=u.nextKey[t],s.time<=d){if(d>f){if(!this.loop)return void this.stop();for(a=this.data.hierarchy[y].keys[0],s=this.getNextKeyWith(t,y,1);s.time<f;)a=s,s=this.getNextKeyWith(t,y,s.index+1)}else do a=s,s=this.getNextKeyWith(t,y,s.index+1);while(s.time<f);u.prevKey[t]=a,u.nextKey[t]=s}l.matrixAutoUpdate=!0,l.matrixWorldNeedsUpdate=!0,i=(f-a.time)/(s.time-a.time),r=a[t],o=s[t],(0>i||i>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+y),i=0>i?0:1),"pos"===t?(n=l.position,this.interpolationType===c.AnimationHandler.LINEAR?(n.x=r[0]+(o[0]-r[0])*i,n.y=r[1]+(o[1]-r[1])*i,n.z=r[2]+(o[2]-r[2])*i):(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",y,a.index-1).pos,this.points[1]=r,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",y,s.index+1).pos,i=.33*i+.33,p=this.interpolateCatmullRom(this.points,i),n.x=p[0],n.y=p[1],n.z=p[2],this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD&&(m=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(m[0],m[1],m[2]),this.target.sub(n),this.target.y=0,this.target.normalize(),g=Math.atan2(this.target.x,this.target.z),l.rotation.set(0,g,0)))):"rot"===t?c.Quaternion.slerp(r,o,l.quaternion,i):"scl"===t&&(n=l.scale,n.x=r[0]+(o[0]-r[0])*i,n.y=r[1]+(o[1]-r[1])*i,n.z=r[2]+(o[2]-r[2])*i)}}}},c.Animation.prototype.interpolateCatmullRom=function(e,t){var i,n,r,o,a,s,l,u,h,c=[],f=[];return i=(e.length-1)*t,n=Math.floor(i),r=i-n,c[0]=0===n?n:n-1,c[1]=n,c[2]=n>e.length-2?n:n+1,c[3]=n>e.length-3?n:n+2,s=e[c[0]],l=e[c[1]],u=e[c[2]],h=e[c[3]],o=r*r,a=r*o,f[0]=this.interpolate(s[0],l[0],u[0],h[0],r,o,a),f[1]=this.interpolate(s[1],l[1],u[1],h[1],r,o,a),f[2]=this.interpolate(s[2],l[2],u[2],h[2],r,o,a),f},c.Animation.prototype.interpolate=function(e,t,i,n,r,o,a){var s=.5*(i-e),l=.5*(n-t);return(2*(t-i)+s+l)*a+(-3*(t-i)-2*s-l)*o+s*r+t},c.Animation.prototype.getNextKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?i=i<n.length-1?i:n.length-1:i%=n.length;i<n.length;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[0]},c.Animation.prototype.getPrevKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[n.length-1]},c.KeyFrameAnimation=function(e,t,i){this.root=e,this.data=c.AnimationHandler.get(t),this.hierarchy=c.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0!==i?i:!0;for(var n=0,r=this.hierarchy.length;r>n;n++){var o=this.data.hierarchy[n].keys,a=this.data.hierarchy[n].sids,s=this.hierarchy[n];if(o.length&&a){for(var l=0;l<a.length;l++){var u=a[l],h=this.getNextKeyWith(u,n,0);h&&h.apply(u)}s.matrixAutoUpdate=!1,this.data.hierarchy[n].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},c.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,n,r,o=this.hierarchy.length;for(i=0;o>i;i++){n=this.hierarchy[i],r=this.data.hierarchy[i],void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n instanceof c.Bone?n.skinMatrix:n.matrix);var a=this.data.hierarchy[i].keys;a.length&&(r.animationCache.prevKey=a[0],r.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,c.AnimationHandler.addToUpdate(this)},c.KeyFrameAnimation.prototype.pause=function(){this.isPaused?c.AnimationHandler.addToUpdate(this):c.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},c.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,c.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var n=i.animationCache.originalMatrix;t instanceof c.Bone?(n.copy(t.skinMatrix),t.skinMatrix=n):(n.copy(t.matrix),t.matrix=n),delete i.animationCache}}},c.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,n,r,o,a,s,l,u=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,s=this.currentTime,a=this.currentTime=this.currentTime%this.data.length,a<this.startTimeMs&&(a=this.currentTime=this.startTimeMs+a),o=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10),l=s>a,l&&!this.loop){for(var h=0,f=this.hierarchy.length;f>h;h++){var d=this.data.hierarchy[h].keys,p=this.data.hierarchy[h].sids,m=d.length-1,g=this.hierarchy[h];if(d.length){for(var v=0;v<p.length;v++){var y=p[v],x=this.getPrevKeyWith(y,h,m);x&&x.apply(y)}this.data.hierarchy[h].node.updateMatrix(),g.matrixWorldNeedsUpdate=!0}}return void this.stop()}if(!(a<this.startTime)){for(var h=0,f=this.hierarchy.length;f>h;h++){n=this.hierarchy[h],r=this.data.hierarchy[h];var d=r.keys,b=r.animationCache;if(this.JITCompile&&void 0!==u[h][o])n instanceof c.Bone?(n.skinMatrix=u[h][o],n.matrixWorldNeedsUpdate=!1):(n.matrix=u[h][o],n.matrixWorldNeedsUpdate=!0);else if(d.length){if(this.JITCompile&&b&&(n instanceof c.Bone?n.skinMatrix=b.originalMatrix:n.matrix=b.originalMatrix),t=b.prevKey,i=b.nextKey,t&&i){if(i.time<=s){if(l&&this.loop)for(t=d[0],i=d[1];i.time<a;)t=i,i=d[t.index+1];else if(!l)for(var w=d.length-1;i.time<a&&i.index!==w;)t=i,i=d[t.index+1];b.prevKey=t,b.nextKey=i}i.time>=a?t.interpolate(i,a):t.interpolate(i,i.time)}this.data.hierarchy[h].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===u[0][o]){this.hierarchy[0].updateMatrixWorld(!0);for(var h=0;h<this.hierarchy.length;h++)this.hierarchy[h]instanceof c.Bone?u[h][o]=this.hierarchy[h].skinMatrix.clone():u[h][o]=this.hierarchy[h].matrix.clone()}}}},c.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i%=n.length;i<n.length;i++)if(n[i].hasTarget(e))return n[i];return n[0]},c.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=i>=0?i:i+n.length;i>=0;i--)if(n[i].hasTarget(e))return n[i];return n[n.length-1]},c.CubeCamera=function(e,t,i){c.Object3D.call(this);var n=90,r=1,o=new c.PerspectiveCamera(n,r,e,t);o.up.set(0,-1,0),o.lookAt(new c.Vector3(1,0,0)),this.add(o);var a=new c.PerspectiveCamera(n,r,e,t);a.up.set(0,-1,0),a.lookAt(new c.Vector3(-1,0,0)),this.add(a);var s=new c.PerspectiveCamera(n,r,e,t);s.up.set(0,0,1),s.lookAt(new c.Vector3(0,1,0)),this.add(s);var l=new c.PerspectiveCamera(n,r,e,t);l.up.set(0,0,-1),l.lookAt(new c.Vector3(0,-1,0)),this.add(l);var u=new c.PerspectiveCamera(n,r,e,t);u.up.set(0,-1,0),u.lookAt(new c.Vector3(0,0,1)),this.add(u);var h=new c.PerspectiveCamera(n,r,e,t);h.up.set(0,-1,0),h.lookAt(new c.Vector3(0,0,-1)),this.add(h),this.renderTarget=new c.WebGLRenderTargetCube(i,i,{format:c.RGBFormat,magFilter:c.LinearFilter,minFilter:c.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,n=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,o,i),i.activeCubeFace=1,e.render(t,a,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,l,i),i.activeCubeFace=4,e.render(t,u,i),i.generateMipmaps=n,i.activeCubeFace=5,e.render(t,h,i)}},c.CubeCamera.prototype=Object.create(c.Object3D.prototype),c.CombinedCamera=function(e,t,i,n,r,o,a){c.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new c.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new c.PerspectiveCamera(i,e/t,n,r),this.zoom=1,this.toPerspective()},c.CombinedCamera.prototype=Object.create(c.Camera.prototype),c.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},c.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,i=this.cameraP.near,n=this.cameraP.far,r=(i+n)/2,o=Math.tan(e/2)*r,a=2*o,s=a*t,l=s/2;o/=this.zoom,l/=this.zoom,this.cameraO.left=-l,this.cameraO.right=l,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},c.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},c.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},c.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},c.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var i=2*c.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i},c.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},c.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},c.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},c.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},c.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},c.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},c.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},c.CircleGeometry=function(e,t,i,n){c.Geometry.call(this),this.radius=e=e||50,this.segments=t=void 0!==t?Math.max(3,t):8,this.thetaStart=i=void 0!==i?i:0,this.thetaLength=n=void 0!==n?n:2*Math.PI;var r,o=[],a=new c.Vector3,s=new c.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),r=0;t>=r;r++){var l=new c.Vector3,u=i+r/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),this.vertices.push(l),o.push(new c.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var h=new c.Vector3(0,0,1);for(r=1;t>=r;r++){var f=r,d=r+1,p=0;this.faces.push(new c.Face3(f,d,p,[h,h,h])),this.faceVertexUvs[0].push([o[r],o[r+1],s])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,e)},c.CircleGeometry.prototype=Object.create(c.Geometry.prototype),c.CubeGeometry=function(e,t,i,n,r,o){function a(e,t,i,n,r,o,a,l){var u,h,f,d=s.widthSegments,p=s.heightSegments,m=r/2,g=o/2,v=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?u="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(u="y",p=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(u="x",d=s.depthSegments);var y=d+1,x=p+1,b=r/d,w=o/p,_=new c.Vector3;for(_[u]=a>0?1:-1,f=0;x>f;f++)for(h=0;y>h;h++){var M=new c.Vector3;M[e]=(h*b-m)*i,M[t]=(f*w-g)*n,M[u]=a,s.vertices.push(M)}for(f=0;p>f;f++)for(h=0;d>h;h++){var S=h+y*f,C=h+y*(f+1),T=h+1+y*(f+1),E=h+1+y*f,A=new c.Vector2(h/d,1-f/p),P=new c.Vector2(h/d,1-(f+1)/p),L=new c.Vector2((h+1)/d,1-(f+1)/p),D=new c.Vector2((h+1)/d,1-f/p),N=new c.Face3(S+v,C+v,E+v);N.normal.copy(_),N.vertexNormals.push(_.clone(),_.clone(),_.clone()),N.materialIndex=l,s.faces.push(N),s.faceVertexUvs[0].push([A,P,D]),N=new c.Face3(C+v,T+v,E+v),N.normal.copy(_),N.vertexNormals.push(_.clone(),_.clone(),_.clone()),N.materialIndex=l,s.faces.push(N),s.faceVertexUvs[0].push([P.clone(),L,D.clone()])}}c.Geometry.call(this);var s=this;this.width=e,this.height=t,this.depth=i,this.widthSegments=n||1,this.heightSegments=r||1,this.depthSegments=o||1;var l=this.width/2,u=this.height/2,h=this.depth/2;a("z","y",-1,-1,this.depth,this.height,l,0),a("z","y",1,-1,this.depth,this.height,-l,1),a("x","z",1,1,this.width,this.depth,u,2),a("x","z",1,-1,this.width,this.depth,-u,3),a("x","y",1,-1,this.width,this.height,h,4),a("x","y",-1,-1,this.width,this.height,-h,5),this.computeCentroids(),this.mergeVertices()},c.CubeGeometry.prototype=Object.create(c.Geometry.prototype),c.CylinderGeometry=function(e,t,i,n,r,o){c.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=i=void 0!==i?i:100,this.radialSegments=n=n||8,this.heightSegments=r=r||1,this.openEnded=o=void 0!==o?o:!1;var a,s,l=i/2,u=[],h=[];for(s=0;r>=s;s++){var f=[],d=[],p=s/r,m=p*(t-e)+e;for(a=0;n>=a;a++){var g=a/n,v=new c.Vector3;v.x=m*Math.sin(g*Math.PI*2),v.y=-p*i+l,v.z=m*Math.cos(g*Math.PI*2),this.vertices.push(v),f.push(this.vertices.length-1),d.push(new c.Vector2(g,1-p))}u.push(f),h.push(d)}var y,x,b=(t-e)/i;for(a=0;n>a;a++)for(0!==e?(y=this.vertices[u[0][a]].clone(),x=this.vertices[u[0][a+1]].clone()):(y=this.vertices[u[1][a]].clone(),x=this.vertices[u[1][a+1]].clone()),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*b).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*b).normalize(),s=0;r>s;s++){var w=u[s][a],_=u[s+1][a],M=u[s+1][a+1],S=u[s][a+1],C=y.clone(),T=y.clone(),E=x.clone(),A=x.clone(),P=h[s][a].clone(),L=h[s+1][a].clone(),D=h[s+1][a+1].clone(),N=h[s][a+1].clone();this.faces.push(new c.Face3(w,_,S,[C,T,A])),this.faceVertexUvs[0].push([P,L,N]),this.faces.push(new c.Face3(_,M,S,[T,E,A])),this.faceVertexUvs[0].push([L,D,N])}if(o===!1&&e>0)for(this.vertices.push(new c.Vector3(0,l,0)),a=0;n>a;a++){var w=u[0][a],_=u[0][a+1],M=this.vertices.length-1,C=new c.Vector3(0,1,0),T=new c.Vector3(0,1,0),E=new c.Vector3(0,1,0),P=h[0][a].clone(),L=h[0][a+1].clone(),D=new c.Vector2(L.u,0);this.faces.push(new c.Face3(w,_,M,[C,T,E])),this.faceVertexUvs[0].push([P,L,D])}if(o===!1&&t>0)for(this.vertices.push(new c.Vector3(0,-l,0)),a=0;n>a;a++){var w=u[s][a+1],_=u[s][a],M=this.vertices.length-1,C=new c.Vector3(0,-1,0),T=new c.Vector3(0,-1,0),E=new c.Vector3(0,-1,0),P=h[s][a+1].clone(),L=h[s][a].clone(),D=new c.Vector2(L.u,1);this.faces.push(new c.Face3(w,_,M,[C,T,E])),this.faceVertexUvs[0].push([P,L,D])}this.computeCentroids(),this.computeFaceNormals()},c.CylinderGeometry.prototype=Object.create(c.Geometry.prototype),c.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(c.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),void this.computeFaceNormals())},c.ExtrudeGeometry.prototype=Object.create(c.Geometry.prototype),c.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;i>n;n++){var r=e[n];this.addShape(r,t)}},c.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function n(e,t,i){return o(e,t,i)}function r(e,t,i){var n=Math.atan2(t.y-e.y,t.x-e.x),r=Math.atan2(i.y-e.y,i.x-e.x);n>r&&(r+=2*Math.PI);var o=(n+r)/2,a=-Math.cos(o),s=-Math.sin(o),l=new c.Vector2(a,s);return l}function o(e,t,i){var n,o,a,s,l,u,h=c.ExtrudeGeometry.__v1,f=c.ExtrudeGeometry.__v2,d=c.ExtrudeGeometry.__v3,p=c.ExtrudeGeometry.__v4,m=c.ExtrudeGeometry.__v5,g=c.ExtrudeGeometry.__v6;return h.set(e.x-t.x,e.y-t.y),f.set(e.x-i.x,e.y-i.y),n=h.normalize(),o=f.normalize(),d.set(-n.y,n.x),p.set(o.y,-o.x),m.copy(e).add(d),g.copy(e).add(p),m.equals(g)?p.clone():(m.copy(t).add(d),g.copy(i).add(p),a=n.dot(p),s=g.sub(m).dot(p),0===a&&(console.log("Either infinite or no solutions!"),0===s?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),l=s/a,0>l?r(e,t,i):(u=n.multiplyScalar(l).add(m),u.sub(e).clone()))}function a(){if(_){var e=0,t=X*e;for(K=0;q>K;K++)G=V[K],h(G[2]+t,G[1]+t,G[0]+t,!0);for(e=S+2*w,t=X*e,K=0;q>K;K++)G=V[K],h(G[0]+t,G[1]+t,G[2]+t,!1)}else{for(K=0;q>K;K++)G=V[K],h(G[2],G[1],G[0],!0);for(K=0;q>K;K++)G=V[K],h(G[0]+X*S,G[1]+X*S,G[2]+X*S,!1)}}function s(){var e=0;for(l(U,e),e+=U.length,D=0,N=k.length;N>D;D++)L=k[D],l(L,e),e+=L.length}function l(e,t){var i,n;for(K=e.length;--K>=0;){i=K,n=K-1,0>n&&(n=e.length-1);var r=0,o=S+2*w;for(r=0;o>r;r++){var a=X*r,s=X*(r+1),l=t+i+a,u=t+n+a,h=t+n+s,c=t+i+s;f(l,u,h,c,e,r,o,i,n)}}}function u(e,t,i){R.vertices.push(new c.Vector3(e,t,i))}function h(i,n,r,o){i+=O,n+=O,r+=O,R.faces.push(new c.Face3(i,n,r,null,null,E));var a=o?P.generateBottomUV(R,e,t,i,n,r):P.generateTopUV(R,e,t,i,n,r);R.faceVertexUvs[0].push(a)}function f(i,n,r,o,a,s,l,u,h){i+=O,n+=O,r+=O,o+=O,R.faces.push(new c.Face3(i,n,o,null,null,A)),R.faces.push(new c.Face3(n,r,o,null,null,A));var f=P.generateSideWallUV(R,e,a,t,i,n,r,o,s,l,u,h);R.faceVertexUvs[0].push([f[0],f[1],f[3]]),R.faceVertexUvs[0].push([f[1],f[2],f[3]])}var d,p,m,g,v,y=void 0!==t.amount?t.amount:100,x=void 0!==t.bevelThickness?t.bevelThickness:6,b=void 0!==t.bevelSize?t.bevelSize:x-2,w=void 0!==t.bevelSegments?t.bevelSegments:3,_=void 0!==t.bevelEnabled?t.bevelEnabled:!0,M=void 0!==t.curveSegments?t.curveSegments:12,S=void 0!==t.steps?t.steps:1,C=t.extrudePath,T=!1,E=t.material,A=t.extrudeMaterial,P=void 0!==t.UVGenerator?t.UVGenerator:c.ExtrudeGeometry.WorldUVGenerator;this.shapebb;C&&(d=C.getSpacedPoints(S),T=!0,_=!1,p=void 0!==t.frames?t.frames:new c.TubeGeometry.FrenetFrames(C,S,!1),m=new c.Vector3,g=new c.Vector3,v=new c.Vector3),_||(w=0,x=0,b=0);var L,D,N,R=this,O=this.vertices.length,F=e.extractPoints(M),I=F.shape,k=F.holes,B=!c.Shape.Utils.isClockWise(I);if(B){for(I=I.reverse(),D=0,N=k.length;N>D;D++)L=k[D],c.Shape.Utils.isClockWise(L)&&(k[D]=L.reverse());B=!1}var V=c.Shape.Utils.triangulateShape(I,k),U=I;for(D=0,N=k.length;N>D;D++)L=k[D],I=I.concat(L);for(var z,$,H,j,W,G,X=I.length,q=V.length,Y=(U.length,180/Math.PI,[]),K=0,Z=U.length,Q=Z-1,J=K+1;Z>K;K++,Q++,J++){Q===Z&&(Q=0),J===Z&&(J=0);U[K],U[Q],U[J];Y[K]=n(U[K],U[Q],U[J])}var ee,te=[],ie=Y.concat();for(D=0,N=k.length;N>D;D++){for(L=k[D],ee=[],K=0,Z=L.length,Q=Z-1,J=K+1;Z>K;K++,Q++,J++)Q===Z&&(Q=0),J===Z&&(J=0),ee[K]=n(L[K],L[Q],L[J]);te.push(ee),ie=ie.concat(ee)}for(z=0;w>z;z++){for(H=z/w,j=x*(1-H),$=b*Math.sin(H*Math.PI/2),K=0,Z=U.length;Z>K;K++)W=i(U[K],Y[K],$),u(W.x,W.y,-j);for(D=0,N=k.length;N>D;D++)for(L=k[D],ee=te[D],K=0,Z=L.length;Z>K;K++)W=i(L[K],ee[K],$),u(W.x,W.y,-j)}for($=b,K=0;X>K;K++)W=_?i(I[K],ie[K],$):I[K],T?(g.copy(p.normals[0]).multiplyScalar(W.x),m.copy(p.binormals[0]).multiplyScalar(W.y),v.copy(d[0]).add(g).add(m),u(v.x,v.y,v.z)):u(W.x,W.y,0);var ne;for(ne=1;S>=ne;ne++)for(K=0;X>K;K++)W=_?i(I[K],ie[K],$):I[K],T?(g.copy(p.normals[ne]).multiplyScalar(W.x),m.copy(p.binormals[ne]).multiplyScalar(W.y),v.copy(d[ne]).add(g).add(m),u(v.x,v.y,v.z)):u(W.x,W.y,y/S*ne);for(z=w-1;z>=0;z--){for(H=z/w,j=x*(1-H),$=b*Math.sin(H*Math.PI/2),K=0,Z=U.length;Z>K;K++)W=i(U[K],Y[K],$),u(W.x,W.y,y+j);for(D=0,N=k.length;N>D;D++)for(L=k[D],ee=te[D],K=0,Z=L.length;Z>K;K++)W=i(L[K],ee[K],$),T?u(W.x,W.y+d[S-1].y,d[S-1].x+j):u(W.x,W.y,y+j)}a(),s()},c.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,n,r,o){var a=e.vertices[n].x,s=e.vertices[n].y,l=e.vertices[r].x,u=e.vertices[r].y,h=e.vertices[o].x,f=e.vertices[o].y;return[new c.Vector2(a,s),new c.Vector2(l,u),new c.Vector2(h,f)]},generateBottomUV:function(e,t,i,n,r,o){return this.generateTopUV(e,t,i,n,r,o)},generateSideWallUV:function(e,t,i,n,r,o,a,s,l,u,h,f){var d=e.vertices[r].x,p=e.vertices[r].y,m=e.vertices[r].z,g=e.vertices[o].x,v=e.vertices[o].y,y=e.vertices[o].z,x=e.vertices[a].x,b=e.vertices[a].y,w=e.vertices[a].z,_=e.vertices[s].x,M=e.vertices[s].y,S=e.vertices[s].z;return Math.abs(p-v)<.01?[new c.Vector2(d,1-m),new c.Vector2(g,1-y),new c.Vector2(x,1-w),new c.Vector2(_,1-S)]:[new c.Vector2(p,1-m),new c.Vector2(v,1-y),new c.Vector2(b,1-w),new c.Vector2(M,1-S)]}},c.ExtrudeGeometry.__v1=new c.Vector2,c.ExtrudeGeometry.__v2=new c.Vector2,c.ExtrudeGeometry.__v3=new c.Vector2,c.ExtrudeGeometry.__v4=new c.Vector2,c.ExtrudeGeometry.__v5=new c.Vector2,c.ExtrudeGeometry.__v6=new c.Vector2,c.ShapeGeometry=function(e,t){c.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},c.ShapeGeometry.prototype=Object.create(c.Geometry.prototype),c.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,n=e.length;n>i;i++)this.addShape(e[i],t);return this},c.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,n,r,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?c.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=(this.shapebb,this.vertices.length),u=e.extractPoints(o),h=u.shape,f=u.holes,d=!c.Shape.Utils.isClockWise(h);if(d){for(h=h.reverse(),i=0,n=f.length;n>i;i++)r=f[i],c.Shape.Utils.isClockWise(r)&&(f[i]=r.reverse());d=!1}var p=c.Shape.Utils.triangulateShape(h,f),m=h;for(i=0,n=f.length;n>i;i++)r=f[i],h=h.concat(r);var g,v,y=h.length,x=p.length;m.length;for(i=0;y>i;i++)g=h[i],this.vertices.push(new c.Vector3(g.x,g.y,0));for(i=0;x>i;i++){v=p[i];var b=v[0]+l,w=v[1]+l,_=v[2]+l;this.faces.push(new c.Face3(b,w,_,null,null,a)),this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,b,w,_))}},c.LatheGeometry=function(e,t,i,n){c.Geometry.call(this),t=t||12,i=i||0,n=n||2*Math.PI;for(var r=1/(e.length-1),o=1/t,a=0,s=t;s>=a;a++)for(var l=i+a*o*n,u=Math.cos(l),h=Math.sin(l),f=0,d=e.length;d>f;f++){var p=e[f],m=new c.Vector3;m.x=u*p.x-h*p.y,m.y=h*p.x+u*p.y,m.z=p.z,this.vertices.push(m)}for(var g=e.length,a=0,s=t;s>a;a++)for(var f=0,d=e.length-1;d>f;f++){var v=f+g*a,y=v,x=v+g,u=v+1+g,b=v+1,w=a*o,_=f*r,M=w+o,S=_+r;this.faces.push(new c.Face3(y,x,b)),this.faceVertexUvs[0].push([new c.Vector2(w,_),new c.Vector2(M,_),new c.Vector2(w,S)]),this.faces.push(new c.Face3(x,u,b)),this.faceVertexUvs[0].push([new c.Vector2(M,_),new c.Vector2(M,S),new c.Vector2(w,S)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},c.LatheGeometry.prototype=Object.create(c.Geometry.prototype),c.PlaneGeometry=function(e,t,i,n){c.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=i||1,this.heightSegments=n||1;var r,o,a=e/2,s=t/2,l=this.widthSegments,u=this.heightSegments,h=l+1,f=u+1,d=this.width/l,p=this.height/u,m=new c.Vector3(0,0,1);for(o=0;f>o;o++)for(r=0;h>r;r++){var g=r*d-a,v=o*p-s;this.vertices.push(new c.Vector3(g,-v,0))}for(o=0;u>o;o++)for(r=0;l>r;r++){var y=r+h*o,x=r+h*(o+1),b=r+1+h*(o+1),w=r+1+h*o,_=new c.Vector2(r/l,1-o/u),M=new c.Vector2(r/l,1-(o+1)/u),S=new c.Vector2((r+1)/l,1-(o+1)/u),C=new c.Vector2((r+1)/l,1-o/u),T=new c.Face3(y,x,w);T.normal.copy(m),T.vertexNormals.push(m.clone(),m.clone(),m.clone()),this.faces.push(T),this.faceVertexUvs[0].push([_,M,C]),T=new c.Face3(x,b,w),T.normal.copy(m),T.vertexNormals.push(m.clone(),m.clone(),m.clone()),this.faces.push(T),this.faceVertexUvs[0].push([M.clone(),S,C.clone()])}this.computeCentroids()},c.PlaneGeometry.prototype=Object.create(c.Geometry.prototype),c.RingGeometry=function(e,t,i,n,r,o){c.Geometry.call(this),e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8,n=void 0!==n?Math.max(3,n):8;var a,s,l=[],u=e,h=(t-e)/n;for(a=0;n>=a;a++){for(s=0;i>=s;s++){var f=new c.Vector3,d=r+s/i*o;f.x=u*Math.cos(d),f.y=u*Math.sin(d),this.vertices.push(f),l.push(new c.Vector2((f.x/u+1)/2,-(f.y/u+1)/2+1))}u+=h}var p=new c.Vector3(0,0,1);for(a=0;n>a;a++){var m=a*i;for(s=0;i>=s;s++){var d=s+m,g=d+a,v=d+i+a,y=d+i+1+a;this.faces.push(new c.Face3(g,v,y,[p,p,p])),this.faceVertexUvs[0].push([l[g],l[v],l[y]]),g=d+a,v=d+i+1+a,y=d+1+a,this.faces.push(new c.Face3(g,v,y,[p,p,p])),this.faceVertexUvs[0].push([l[g],l[v],l[y]])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,u)},c.RingGeometry.prototype=Object.create(c.Geometry.prototype),c.SphereGeometry=function(e,t,i,n,r,o,a){c.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=i=Math.max(2,Math.floor(i)||6),this.phiStart=n=void 0!==n?n:0,this.phiLength=r=void 0!==r?r:2*Math.PI,this.thetaStart=o=void 0!==o?o:0,this.thetaLength=a=void 0!==a?a:Math.PI;var s,l,u=[],h=[];for(l=0;i>=l;l++){var f=[],d=[];for(s=0;t>=s;s++){var p=s/t,m=l/i,g=new c.Vector3;g.x=-e*Math.cos(n+p*r)*Math.sin(o+m*a),g.y=e*Math.cos(o+m*a),g.z=e*Math.sin(n+p*r)*Math.sin(o+m*a),this.vertices.push(g),f.push(this.vertices.length-1),d.push(new c.Vector2(p,1-m))}u.push(f),h.push(d)}for(l=0;l<this.heightSegments;l++)for(s=0;s<this.widthSegments;s++){var v=u[l][s+1],y=u[l][s],x=u[l+1][s],b=u[l+1][s+1],w=this.vertices[v].clone().normalize(),_=this.vertices[y].clone().normalize(),M=this.vertices[x].clone().normalize(),S=this.vertices[b].clone().normalize(),C=h[l][s+1].clone(),T=h[l][s].clone(),E=h[l+1][s].clone(),A=h[l+1][s+1].clone();Math.abs(this.vertices[v].y)===this.radius?(this.faces.push(new c.Face3(v,x,b,[w,M,S])),this.faceVertexUvs[0].push([C,E,A])):Math.abs(this.vertices[x].y)===this.radius?(this.faces.push(new c.Face3(v,y,x,[w,_,M])),this.faceVertexUvs[0].push([C,T,E])):(this.faces.push(new c.Face3(v,y,b,[w,_,S])),this.faceVertexUvs[0].push([C,T,A]),this.faces.push(new c.Face3(y,x,b,[_,M,S])),this.faceVertexUvs[0].push([T.clone(),E,A.clone()]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,e)},c.SphereGeometry.prototype=Object.create(c.Geometry.prototype),c.TextGeometry=function(e,t){t=t||{};var i=c.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),c.ExtrudeGeometry.call(this,i,t)},c.TextGeometry.prototype=Object.create(c.ExtrudeGeometry.prototype),c.TorusGeometry=function(e,t,i,n,r){c.Geometry.call(this);this.radius=e||100,this.tube=t||40,this.radialSegments=i||8,this.tubularSegments=n||6,this.arc=r||2*Math.PI;for(var o=new c.Vector3,a=[],s=[],l=0;l<=this.radialSegments;l++)for(var u=0;u<=this.tubularSegments;u++){var h=u/this.tubularSegments*this.arc,f=l/this.radialSegments*Math.PI*2;o.x=this.radius*Math.cos(h),o.y=this.radius*Math.sin(h);var d=new c.Vector3;d.x=(this.radius+this.tube*Math.cos(f))*Math.cos(h),d.y=(this.radius+this.tube*Math.cos(f))*Math.sin(h),d.z=this.tube*Math.sin(f),this.vertices.push(d),a.push(new c.Vector2(u/this.tubularSegments,l/this.radialSegments)),s.push(d.clone().sub(o).normalize())}for(var l=1;l<=this.radialSegments;l++)for(var u=1;u<=this.tubularSegments;u++){var p=(this.tubularSegments+1)*l+u-1,m=(this.tubularSegments+1)*(l-1)+u-1,g=(this.tubularSegments+1)*(l-1)+u,v=(this.tubularSegments+1)*l+u,y=new c.Face3(p,m,v,[s[p],s[m],s[v]]);y.normal.add(s[p]),y.normal.add(s[m]),y.normal.add(s[v]),y.normal.normalize(),this.faces.push(y),this.faceVertexUvs[0].push([a[p].clone(),a[m].clone(),a[v].clone()]),y=new c.Face3(m,g,v,[s[m],s[g],s[v]]),y.normal.add(s[m]),y.normal.add(s[g]),y.normal.add(s[v]),y.normal.normalize(),this.faces.push(y),this.faceVertexUvs[0].push([a[m].clone(),a[g].clone(),a[v].clone()])}this.computeCentroids()},c.TorusGeometry.prototype=Object.create(c.Geometry.prototype),c.TorusKnotGeometry=function(e,t,i,n,r,o,a){function s(e,t,i,n,r){var o=Math.cos(e),a=Math.sin(e),s=t/i*e,l=Math.cos(s),u=n*(2+l)*.5*o,h=n*(2+l)*a*.5,f=r*n*Math.sin(s)*.5;return new c.Vector3(u,h,f)}c.Geometry.call(this);var l=this;this.radius=e||100,this.tube=t||40,this.radialSegments=i||64,this.tubularSegments=n||8,this.p=r||2,
this.q=o||3,this.heightScale=a||1,this.grid=new Array(this.radialSegments);for(var u=new c.Vector3,h=new c.Vector3,f=new c.Vector3,d=0;d<this.radialSegments;++d){this.grid[d]=new Array(this.tubularSegments);var p=d/this.radialSegments*2*this.p*Math.PI,m=s(p,this.q,this.p,this.radius,this.heightScale),g=s(p+.01,this.q,this.p,this.radius,this.heightScale);u.subVectors(g,m),h.addVectors(g,m),f.crossVectors(u,h),h.crossVectors(f,u),f.normalize(),h.normalize();for(var v=0;v<this.tubularSegments;++v){var y=v/this.tubularSegments*2*Math.PI,x=-this.tube*Math.cos(y),b=this.tube*Math.sin(y),w=new c.Vector3;w.x=m.x+x*h.x+b*f.x,w.y=m.y+x*h.y+b*f.y,w.z=m.z+x*h.z+b*f.z,this.grid[d][v]=l.vertices.push(w)-1}}for(var d=0;d<this.radialSegments;++d)for(var v=0;v<this.tubularSegments;++v){var _=(d+1)%this.radialSegments,M=(v+1)%this.tubularSegments,S=this.grid[d][v],C=this.grid[_][v],T=this.grid[_][M],E=this.grid[d][M],A=new c.Vector2(d/this.radialSegments,v/this.tubularSegments),P=new c.Vector2((d+1)/this.radialSegments,v/this.tubularSegments),L=new c.Vector2((d+1)/this.radialSegments,(v+1)/this.tubularSegments),D=new c.Vector2(d/this.radialSegments,(v+1)/this.tubularSegments);this.faces.push(new c.Face3(S,C,E)),this.faceVertexUvs[0].push([A,P,D]),this.faces.push(new c.Face3(C,T,E)),this.faceVertexUvs[0].push([P.clone(),L,D.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},c.TorusKnotGeometry.prototype=Object.create(c.Geometry.prototype),c.TubeGeometry=function(e,t,i,n,r){function o(e,t,i){return E.vertices.push(new c.Vector3(e,t,i))-1}c.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.radialSegments=n||8,this.closed=r||!1,this.grid=[];var a,s,l,u,h,f,d,p,m,g,v,y,x,b,w,_,M,S,C,T,E=this,A=this.segments+1,P=new c.Vector3,L=new c.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),D=L.tangents,N=L.normals,R=L.binormals;for(this.tangents=D,this.normals=N,this.binormals=R,m=0;A>m;m++)for(this.grid[m]=[],u=m/(A-1),p=e.getPointAt(u),a=D[m],s=N[m],l=R[m],g=0;g<this.radialSegments;g++)h=g/this.radialSegments*2*Math.PI,f=-this.radius*Math.cos(h),d=this.radius*Math.sin(h),P.copy(p),P.x+=f*s.x+d*l.x,P.y+=f*s.y+d*l.y,P.z+=f*s.z+d*l.z,this.grid[m][g]=o(P.x,P.y,P.z);for(m=0;m<this.segments;m++)for(g=0;g<this.radialSegments;g++)v=this.closed?(m+1)%this.segments:m+1,y=(g+1)%this.radialSegments,x=this.grid[m][g],b=this.grid[v][g],w=this.grid[v][y],_=this.grid[m][y],M=new c.Vector2(m/this.segments,g/this.radialSegments),S=new c.Vector2((m+1)/this.segments,g/this.radialSegments),C=new c.Vector2((m+1)/this.segments,(g+1)/this.radialSegments),T=new c.Vector2(m/this.segments,(g+1)/this.radialSegments),this.faces.push(new c.Face3(x,b,_)),this.faceVertexUvs[0].push([M,S,T]),this.faces.push(new c.Face3(b,w,_)),this.faceVertexUvs[0].push([S.clone(),C,T.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},c.TubeGeometry.prototype=Object.create(c.Geometry.prototype),c.TubeGeometry.FrenetFrames=function(e,t,i){function n(){p[0]=new c.Vector3,m[0]=new c.Vector3,o=Number.MAX_VALUE,a=Math.abs(d[0].x),s=Math.abs(d[0].y),l=Math.abs(d[0].z),o>=a&&(o=a,f.set(1,0,0)),o>=s&&(o=s,f.set(0,1,0)),o>=l&&f.set(0,0,1),g.crossVectors(d[0],f).normalize(),p[0].crossVectors(d[0],g),m[0].crossVectors(d[0],p[0])}var r,o,a,s,l,u,h,f=(new c.Vector3,new c.Vector3),d=(new c.Vector3,[]),p=[],m=[],g=new c.Vector3,v=new c.Matrix4,y=t+1,x=1e-4;for(this.tangents=d,this.normals=p,this.binormals=m,u=0;y>u;u++)h=u/(y-1),d[u]=e.getTangentAt(h),d[u].normalize();for(n(),u=1;y>u;u++)p[u]=p[u-1].clone(),m[u]=m[u-1].clone(),g.crossVectors(d[u-1],d[u]),g.length()>x&&(g.normalize(),r=Math.acos(c.Math.clamp(d[u-1].dot(d[u]),-1,1)),p[u].applyMatrix4(v.makeRotationAxis(g,r))),m[u].crossVectors(d[u],p[u]);if(i)for(r=Math.acos(c.Math.clamp(p[0].dot(p[y-1]),-1,1)),r/=y-1,d[0].dot(g.crossVectors(p[0],p[y-1]))>0&&(r=-r),u=1;y>u;u++)p[u].applyMatrix4(v.makeRotationAxis(d[u],r*u)),m[u].crossVectors(d[u],p[u])},c.PolyhedronGeometry=function(e,t,i,n){function r(e){var t=e.normalize().clone();t.index=h.vertices.push(t)-1;var i=s(e)/2/Math.PI+.5,n=l(e)/Math.PI+.5;return t.uv=new c.Vector2(i,1-n),t}function o(e,t,i){var n=new c.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);n.centroid.add(e).add(t).add(i).divideScalar(3),h.faces.push(n);var r=s(n.centroid);h.faceVertexUvs[0].push([u(e.uv,e,r),u(t.uv,t,r),u(i.uv,i,r)])}function a(e,t){for(var i=Math.pow(2,t),n=(Math.pow(4,t),r(h.vertices[e.a])),a=r(h.vertices[e.b]),s=r(h.vertices[e.c]),l=[],u=0;i>=u;u++){l[u]=[];for(var c=r(n.clone().lerp(s,u/i)),f=r(a.clone().lerp(s,u/i)),d=i-u,p=0;d>=p;p++)0==p&&u==i?l[u][p]=c:l[u][p]=r(c.clone().lerp(f,p/d))}for(var u=0;i>u;u++)for(var p=0;2*(i-u)-1>p;p++){var m=Math.floor(p/2);p%2==0?o(l[u][m+1],l[u+1][m],l[u][m]):o(l[u][m+1],l[u+1][m+1],l[u+1][m])}}function s(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function u(e,t,i){return 0>i&&1===e.x&&(e=new c.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new c.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}c.Geometry.call(this),i=i||1,n=n||0;for(var h=this,f=0,d=e.length;d>f;f++)r(new c.Vector3(e[f][0],e[f][1],e[f][2]));for(var p=this.vertices,m=[],f=0,d=t.length;d>f;f++){var g=p[t[f][0]],v=p[t[f][1]],y=p[t[f][2]];m[f]=new c.Face3(g.index,v.index,y.index,[g.clone(),v.clone(),y.clone()])}for(var f=0,d=m.length;d>f;f++)a(m[f],n);for(var f=0,d=this.faceVertexUvs[0].length;d>f;f++){var x=this.faceVertexUvs[0][f],b=x[0].x,w=x[1].x,_=x[2].x,M=Math.max(b,Math.max(w,_)),S=Math.min(b,Math.min(w,_));M>.9&&.1>S&&(.2>b&&(x[0].x+=1),.2>w&&(x[1].x+=1),.2>_&&(x[2].x+=1))}for(var f=0,d=this.vertices.length;d>f;f++)this.vertices[f].multiplyScalar(i);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,i)},c.PolyhedronGeometry.prototype=Object.create(c.Geometry.prototype),c.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var i=(1+Math.sqrt(5))/2,n=[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],r=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];c.PolyhedronGeometry.call(this,n,r,e,t)},c.IcosahedronGeometry.prototype=Object.create(c.Geometry.prototype),c.OctahedronGeometry=function(e,t){var i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],n=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];c.PolyhedronGeometry.call(this,i,n,e,t)},c.OctahedronGeometry.prototype=Object.create(c.Geometry.prototype),c.TetrahedronGeometry=function(e,t){var i=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],n=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];c.PolyhedronGeometry.call(this,i,n,e,t)},c.TetrahedronGeometry.prototype=Object.create(c.Geometry.prototype),c.ParametricGeometry=function(e,t,i){c.Geometry.call(this);var n,r,o,a,s,l=this.vertices,u=this.faces,h=this.faceVertexUvs[0],f=t+1;for(n=0;i>=n;n++)for(s=n/i,r=0;t>=r;r++)a=r/t,o=e(a,s),l.push(o);var d,p,m,g,v,y,x,b;for(n=0;i>n;n++)for(r=0;t>r;r++)d=n*f+r,p=n*f+r+1,m=(n+1)*f+r+1,g=(n+1)*f+r,v=new c.Vector2(r/t,n/i),y=new c.Vector2((r+1)/t,n/i),x=new c.Vector2((r+1)/t,(n+1)/i),b=new c.Vector2(r/t,(n+1)/i),u.push(new c.Face3(d,p,g)),h.push([v,y,b]),u.push(new c.Face3(p,m,g)),h.push([y.clone(),x,b.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},c.ParametricGeometry.prototype=Object.create(c.Geometry.prototype),c.AxisHelper=function(e){e=e||1;var t=new c.Geometry;t.vertices.push(new c.Vector3,new c.Vector3(e,0,0),new c.Vector3,new c.Vector3(0,e,0),new c.Vector3,new c.Vector3(0,0,e)),t.colors.push(new c.Color(16711680),new c.Color(16755200),new c.Color(65280),new c.Color(11206400),new c.Color(255),new c.Color(43775));var i=new c.LineBasicMaterial({vertexColors:c.VertexColors});c.Line.call(this,t,i,c.LinePieces)},c.AxisHelper.prototype=Object.create(c.Line.prototype),c.ArrowHelper=function(e,t,i,n){c.Object3D.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),this.position=t;var r=new c.Geometry;r.vertices.push(new c.Vector3(0,0,0)),r.vertices.push(new c.Vector3(0,1,0)),this.line=new c.Line(r,new c.LineBasicMaterial({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line);var o=new c.CylinderGeometry(0,.05,.25,5,1);o.applyMatrix((new c.Matrix4).makeTranslation(0,.875,0)),this.cone=new c.Mesh(o,new c.MeshBasicMaterial({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i)},c.ArrowHelper.prototype=Object.create(c.Object3D.prototype),c.ArrowHelper.prototype.setDirection=function(){var e,t=new c.Vector3;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),c.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},c.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},c.BoxHelper=function(e){var t=[new c.Vector3(1,1,1),new c.Vector3(-1,1,1),new c.Vector3(-1,-1,1),new c.Vector3(1,-1,1),new c.Vector3(1,1,-1),new c.Vector3(-1,1,-1),new c.Vector3(-1,-1,-1),new c.Vector3(1,-1,-1)];this.vertices=t;var i=new c.Geometry;i.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),c.Line.call(this,i,new c.LineBasicMaterial({color:16776960}),c.LinePieces),void 0!==e&&this.update(e)},c.BoxHelper.prototype=Object.create(c.Line.prototype),c.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,n=t.boundingBox.max,r=this.vertices;r[0].set(n.x,n.y,n.z),r[1].set(i.x,n.y,n.z),r[2].set(i.x,i.y,n.z),r[3].set(n.x,i.y,n.z),r[4].set(n.x,n.y,i.z),r[5].set(i.x,n.y,i.z),r[6].set(i.x,i.y,i.z),r[7].set(n.x,i.y,i.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},c.BoundingBoxHelper=function(e,t){var i=t||8947848;this.object=e,this.box=new c.Box3,c.Mesh.call(this,new c.CubeGeometry(1,1,1),new c.MeshBasicMaterial({color:i,wireframe:!0}))},c.BoundingBoxHelper.prototype=Object.create(c.Mesh.prototype),c.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},c.CameraHelper=function(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){n.vertices.push(new c.Vector3),n.colors.push(new c.Color(t)),void 0===o[e]&&(o[e]=[]),o[e].push(n.vertices.length-1)}var n=new c.Geometry,r=new c.LineBasicMaterial({color:16777215,vertexColors:c.FaceColors}),o={},a=16755200,s=16711680,l=43775,u=16777215,h=3355443;t("n1","n2",a),t("n2","n4",a),t("n4","n3",a),t("n3","n1",a),t("f1","f2",a),t("f2","f4",a),t("f4","f3",a),t("f3","f1",a),t("n1","f1",a),t("n2","f2",a),t("n3","f3",a),t("n4","f4",a),t("p","n1",s),t("p","n2",s),t("p","n3",s),t("p","n4",s),t("u1","u2",l),t("u2","u3",l),t("u3","u1",l),t("c","t",u),t("p","c",h),t("cn1","cn2",h),t("cn3","cn4",h),t("cf1","cf2",h),t("cf3","cf4",h),c.Line.call(this,n,r,c.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},c.CameraHelper.prototype=Object.create(c.Line.prototype),c.CameraHelper.prototype.update=function(){var e=new c.Vector3,t=new c.Camera,i=new c.Projector;return function(){function n(n,o,a,s){e.set(o,a,s),i.unprojectVector(e,t);var l=r.pointMap[n];if(void 0!==l)for(var u=0,h=l.length;h>u;u++)r.geometry.vertices[l[u]].copy(e)}var r=this,o=1,a=1;t.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-o,-a,-1),n("n2",o,-a,-1),n("n3",-o,a,-1),n("n4",o,a,-1),n("f1",-o,-a,1),n("f2",o,-a,1),n("f3",-o,a,1),n("f4",o,a,1),n("u1",.7*o,1.1*a,-1),n("u2",.7*-o,1.1*a,-1),n("u3",0,2*a,-1),n("cf1",-o,0,1),n("cf2",o,0,1),n("cf3",0,-a,1),n("cf4",0,a,1),n("cn1",-o,0,-1),n("cn2",o,0,-1),n("cn3",0,-a,-1),n("cn4",0,a,-1),this.geometry.verticesNeedUpdate=!0}}(),c.DirectionalLightHelper=function(e,t){c.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var i=new c.PlaneGeometry(t,t),n=new c.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new c.Mesh(i,n),this.add(this.lightPlane),i=new c.Geometry,i.vertices.push(new c.Vector3),i.vertices.push(new c.Vector3),i.computeLineDistances(),n=new c.LineBasicMaterial({fog:!1}),n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new c.Line(i,n),this.add(this.targetLine),this.update()},c.DirectionalLightHelper.prototype=Object.create(c.Object3D.prototype),c.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},c.DirectionalLightHelper.prototype.update=function(){var e=new c.Vector3;return function(){e.getPositionFromMatrix(this.light.matrixWorld).negate(),this.lightPlane.lookAt(e),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(e),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),c.FaceNormalsHelper=function(e,t,i,n){this.object=e,this.size=t||1;for(var r=i||16776960,o=n||1,a=new c.Geometry,s=this.object.geometry.faces,l=0,u=s.length;u>l;l++)a.vertices.push(new c.Vector3),a.vertices.push(new c.Vector3);c.Line.call(this,a,new c.LineBasicMaterial({color:r,linewidth:o}),c.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new c.Matrix3,this.update()},c.FaceNormalsHelper.prototype=Object.create(c.Line.prototype),c.FaceNormalsHelper.prototype.update=function(e){var t=new c.Vector3;return function(e){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,n=this.object.geometry.faces,r=this.object.matrixWorld,o=0,a=n.length;a>o;o++){var s=n[o];t.copy(s.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var l=2*o;i[l].copy(s.centroid).applyMatrix4(r),i[l+1].addVectors(i[l],t)}return this.geometry.verticesNeedUpdate=!0,this}}(),c.GridHelper=function(e,t){var i=new c.Geometry,n=new c.LineBasicMaterial({vertexColors:c.VertexColors});this.color1=new c.Color(4473924),this.color2=new c.Color(8947848);for(var r=-e;e>=r;r+=t){i.vertices.push(new c.Vector3(-e,0,r),new c.Vector3(e,0,r),new c.Vector3(r,0,-e),new c.Vector3(r,0,e));var o=0===r?this.color1:this.color2;i.colors.push(o,o,o,o)}c.Line.call(this,i,n,c.LinePieces)},c.GridHelper.prototype=Object.create(c.Line.prototype),c.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},c.HemisphereLightHelper=function(e,t,i,n){c.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new c.Color,new c.Color];var r=new c.SphereGeometry(t,4,2);r.applyMatrix((new c.Matrix4).makeRotationX(-Math.PI/2));for(var o=0,a=8;a>o;o++)r.faces[o].color=this.colors[4>o?0:1];var s=new c.MeshBasicMaterial({vertexColors:c.FaceColors,wireframe:!0});this.lightSphere=new c.Mesh(r,s),this.add(this.lightSphere),this.update()},c.HemisphereLightHelper.prototype=Object.create(c.Object3D.prototype),c.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},c.HemisphereLightHelper.prototype.update=function(){var e=new c.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.getPositionFromMatrix(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),c.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new c.SphereGeometry(t,4,2),n=new c.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),c.Mesh.call(this,i,n),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},c.PointLightHelper.prototype=Object.create(c.Mesh.prototype),c.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},c.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},c.SpotLightHelper=function(e){c.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new c.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new c.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new c.Matrix4).makeRotationX(-Math.PI/2));var i=new c.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new c.Mesh(t,i),this.add(this.cone),this.update()},c.SpotLightHelper.prototype=Object.create(c.Object3D.prototype),c.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},c.SpotLightHelper.prototype.update=function(){var e=new c.Vector3,t=new c.Vector3;return function(){var i=this.light.distance?this.light.distance:1e4,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),e.getPositionFromMatrix(this.light.matrixWorld),t.getPositionFromMatrix(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),c.VertexNormalsHelper=function(e,t,i,n){this.object=e,this.size=t||1;for(var r=i||16711680,o=n||1,a=new c.Geometry,s=(e.geometry.vertices,e.geometry.faces),l=0,u=s.length;u>l;l++)for(var h=s[l],f=0,d=h.vertexNormals.length;d>f;f++)a.vertices.push(new c.Vector3),a.vertices.push(new c.Vector3);c.Line.call(this,a,new c.LineBasicMaterial({color:r,linewidth:o}),c.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new c.Matrix3,this.update()},c.VertexNormalsHelper.prototype=Object.create(c.Line.prototype),c.VertexNormalsHelper.prototype.update=function(e){var t=new c.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,l=0,u=o.length;u>l;l++)for(var h=o[l],c=0,f=h.vertexNormals.length;f>c;c++){var d=h[i[c]],p=r[d],m=h.vertexNormals[c];n[s].copy(p).applyMatrix4(a),t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(n[s]),s+=1,n[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),c.VertexTangentsHelper=function(e,t,i,n){this.object=e,this.size=t||1;for(var r=i||255,o=n||1,a=new c.Geometry,s=(e.geometry.vertices,e.geometry.faces),l=0,u=s.length;u>l;l++)for(var h=s[l],f=0,d=h.vertexTangents.length;d>f;f++)a.vertices.push(new c.Vector3),a.vertices.push(new c.Vector3);c.Line.call(this,a,new c.LineBasicMaterial({color:r,linewidth:o}),c.LinePieces),this.matrixAutoUpdate=!1,this.update()},c.VertexTangentsHelper.prototype=Object.create(c.Line.prototype),c.VertexTangentsHelper.prototype.update=function(e){var t=new c.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,l=0,u=o.length;u>l;l++)for(var h=o[l],c=0,f=h.vertexTangents.length;f>c;c++){var d=h[i[c]],p=r[d],m=h.vertexTangents[c];n[s].copy(p).applyMatrix4(a),t.copy(m).transformDirection(a).multiplyScalar(this.size),t.add(n[s]),s+=1,n[s].copy(t),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),c.WireframeHelper=function(e){for(var t=[0,0],i={},n=function(e,t){return e-t},r=["a","b","c","d"],o=new c.Geometry,a=e.geometry.vertices,s=e.geometry.faces,l=0,u=s.length;u>l;l++)for(var h=s[l],f=0;3>f;f++){t[0]=h[r[f]],t[1]=h[r[(f+1)%3]],t.sort(n);var d=t.toString();void 0===i[d]&&(o.vertices.push(a[t[0]]),o.vertices.push(a[t[1]]),i[d]=!0)}c.Line.call(this,o,new c.LineBasicMaterial({color:16777215}),c.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},c.WireframeHelper.prototype=Object.create(c.Line.prototype),c.ImmediateRenderObject=function(){c.Object3D.call(this),this.render=function(e){}},c.ImmediateRenderObject.prototype=Object.create(c.Object3D.prototype),c.LensFlare=function(e,t,i,n,r){c.Object3D.call(this),this.lensFlares=[],this.positionScreen=new c.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,n,r)},c.LensFlare.prototype=Object.create(c.Object3D.prototype),c.LensFlare.prototype.add=function(e,t,i,n,r,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new c.Color(16777215)),void 0===n&&(n=c.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:r,blending:n})},c.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},c.MorphBlendMesh=function(e,t){c.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,n="__default",r=0,o=i-1,a=i/1;this.createAnimation(n,r,o,a),this.setAnimationWeight(n,1)},c.MorphBlendMesh.prototype=Object.create(c.Mesh.prototype),c.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){var r={startFrame:t,endFrame:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},c.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,n={},r=this.geometry,o=0,a=r.morphTargets.length;a>o;o++){var s=r.morphTargets[o],l=s.name.match(i);if(l&&l.length>1){var u=l[1];l[2];n[u]||(n[u]={start:1/0,end:-(1/0)});var h=n[u];o<h.start&&(h.start=o),o>h.end&&(h.end=o),t||(t=u)}}for(var u in n){var h=n[u];this.createAnimation(u,h.start,h.end,e)}this.firstAnimation=t},c.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},c.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},c.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},c.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},c.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},c.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},c.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},c.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},c.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},c.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},c.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;i>t;t++){var n=this.animationsList[t];if(n.active){var r=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.startFrame+c.Math.clamp(Math.floor(n.time/r),0,n.length-1),a=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var s=n.time%r/r;n.directionBackwards&&(s=1-s),this.morphTargetInfluences[n.currentFrame]=s*a,this.morphTargetInfluences[n.lastFrame]=(1-s)*a}}},c.LensFlarePlugin=function(){function e(e,i){var n=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),a="precision "+i+" float;\n";return t.shaderSource(r,a+e.fragmentShader),t.shaderSource(o,a+e.vertexShader),t.compileShader(r),t.compileShader(o),t.attachShader(n,r),t.attachShader(n,o),t.linkProgram(n),n}var t,i,n,r={};this.init=function(o){t=o.context,i=o,n=o.getPrecision(),r.vertices=new Float32Array(16),r.faces=new Uint16Array(6);var a=0;r.vertices[a++]=-1,r.vertices[a++]=-1,r.vertices[a++]=0,r.vertices[a++]=0,r.vertices[a++]=1,r.vertices[a++]=-1,r.vertices[a++]=1,r.vertices[a++]=0,r.vertices[a++]=1,r.vertices[a++]=1,r.vertices[a++]=1,r.vertices[a++]=1,r.vertices[a++]=-1,r.vertices[a++]=1,r.vertices[a++]=0,r.vertices[a++]=1,a=0,r.faces[a++]=0,r.faces[a++]=1,r.faces[a++]=2,r.faces[a++]=0,r.faces[a++]=2,r.faces[a++]=3,r.vertexBuffer=t.createBuffer(),r.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r.faces,t.STATIC_DRAW),r.tempTexture=t.createTexture(),r.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,r.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,r.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(r.hasVertexTexture=!1,r.program=e(c.ShaderFlares.lensFlare,n)):(r.hasVertexTexture=!0,r.program=e(c.ShaderFlares.lensFlareVertexTexture,n)),r.attributes={},r.uniforms={},r.attributes.vertex=t.getAttribLocation(r.program,"position"),r.attributes.uv=t.getAttribLocation(r.program,"uv"),r.uniforms.renderType=t.getUniformLocation(r.program,"renderType"),r.uniforms.map=t.getUniformLocation(r.program,"map"),r.uniforms.occlusionMap=t.getUniformLocation(r.program,"occlusionMap"),r.uniforms.opacity=t.getUniformLocation(r.program,"opacity"),r.uniforms.color=t.getUniformLocation(r.program,"color"),r.uniforms.scale=t.getUniformLocation(r.program,"scale"),r.uniforms.rotation=t.getUniformLocation(r.program,"rotation"),r.uniforms.screenPosition=t.getUniformLocation(r.program,"screenPosition")},this.render=function(e,n,o,a){var s=e.__webglFlares,l=s.length;if(l){var u=new c.Vector3,h=a/o,f=.5*o,d=.5*a,p=16/a,m=new c.Vector2(p*h,p),g=new c.Vector3(1,1,0),v=new c.Vector2(1,1),y=r.uniforms,x=r.attributes;t.useProgram(r.program),t.enableVertexAttribArray(r.attributes.vertex),t.enableVertexAttribArray(r.attributes.uv),t.uniform1i(y.occlusionMap,0),t.uniform1i(y.map,1),t.bindBuffer(t.ARRAY_BUFFER,r.vertexBuffer),t.vertexAttribPointer(x.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(x.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);var b,w,_,M,S;for(b=0;l>b;b++)if(p=16/a,m.set(p*h,p),M=s[b],u.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),u.applyMatrix4(n.matrixWorldInverse),u.applyProjection(n.projectionMatrix),g.copy(u),v.x=g.x*f+f,v.y=g.y*d+d,r.hasVertexTexture||v.x>0&&v.x<o&&v.y>0&&v.y<a)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,r.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,v.x-8,v.y-8,16,16,0),t.uniform1i(y.renderType,0),t.uniform2f(y.scale,m.x,m.y),t.uniform3f(y.screenPosition,g.x,g.y,g.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,v.x-8,v.y-8,16,16,0),t.uniform1i(y.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,r.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),M.positionScreen.copy(g),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),t.uniform1i(y.renderType,2),t.enable(t.BLEND),w=0,_=M.lensFlares.length;_>w;w++)S=M.lensFlares[w],S.opacity>.001&&S.scale>.001&&(g.x=S.x,g.y=S.y,g.z=S.z,p=S.size*S.scale/a,m.x=p*h,m.y=p,t.uniform3f(y.screenPosition,g.x,g.y,g.z),t.uniform2f(y.scale,m.x,m.y),t.uniform1f(y.rotation,S.rotation),t.uniform1f(y.opacity,S.opacity),t.uniform3f(y.color,S.color.r,S.color.g,S.color.b),i.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),i.setTexture(S.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},c.ShadowMapPlugin=function(){function e(e,t){var i=new c.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var n=i.pointsWorld,r=i.pointsFrustum,o=0;8>o;o++)n[o]=new c.Vector3,r[o]=new c.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return r[0].set(-1,-1,a),r[1].set(1,-1,a),r[2].set(-1,1,a),r[3].set(1,1,a),r[4].set(-1,-1,s),r[5].set(1,-1,s),r[6].set(-1,1,s),r[7].set(1,1,s),i}function t(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var n=e.shadowCascadeNearZ[t],r=e.shadowCascadeFarZ[t],o=i.pointsFrustum;o[0].z=n,o[1].z=n,o[2].z=n,o[3].z=n,o[4].z=r,o[5].z=r,o[6].z=r,o[7].z=r}function i(e,t){var i=t.shadowCamera,n=t.pointsFrustum,r=t.pointsWorld;d.set(1/0,1/0,1/0),p.set(-(1/0),-(1/0),-(1/0));for(var o=0;8>o;o++){var a=r[o];a.copy(n[o]),c.ShadowMapPlugin.__projector.unprojectVector(a,e),a.applyMatrix4(i.matrixWorldInverse),a.x<d.x&&(d.x=a.x),a.x>p.x&&(p.x=a.x),a.y<d.y&&(d.y=a.y),a.y>p.y&&(p.y=a.y),a.z<d.z&&(d.z=a.z),a.z>p.z&&(p.z=a.z)}i.left=d.x,i.right=p.x,i.top=p.y,i.bottom=d.y,i.updateProjectionMatrix()}function n(e){return e.material instanceof c.MeshFaceMaterial?e.material.materials[0]:e.material}var r,o,a,s,l,u,h=new c.Frustum,f=new c.Matrix4,d=new c.Vector3,p=new c.Vector3,m=new c.Vector3;this.init=function(e){r=e.context,o=e;var t=c.ShaderLib.depthRGBA,i=c.UniformsUtils.clone(t.uniforms);a=new c.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),s=new c.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),l=new c.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),u=new c.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),a._shadowPass=!0,s._shadowPass=!0,l._shadowPass=!0,u._shadowPass=!0;
},this.render=function(e,t){o.shadowMapEnabled&&o.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(d,p){var g,v,y,x,b,w,_,M,S,C,T,E,A,P,L=[],D=0,N=null;for(r.clearColor(1,1,1,1),r.disable(r.BLEND),r.enable(r.CULL_FACE),r.frontFace(r.CCW),o.shadowMapCullFace===c.CullFaceFront?r.cullFace(r.FRONT):r.cullFace(r.BACK),o.setDepthTest(!0),g=0,v=d.__lights.length;v>g;g++)if(A=d.__lights[g],A.castShadow)if(A instanceof c.DirectionalLight&&A.shadowCascade)for(b=0;b<A.shadowCascadeCount;b++){var R;if(A.shadowCascadeArray[b])R=A.shadowCascadeArray[b];else{R=e(A,b),R.originalCamera=p;var O=new c.Gyroscope;O.position=A.shadowCascadeOffset,O.add(R),O.add(R.target),p.add(O),A.shadowCascadeArray[b]=R,console.log("Created virtualLight",R)}t(A,b),L[D]=R,D++}else L[D]=A,D++;for(g=0,v=L.length;v>g;g++){if(A=L[g],!A.shadowMap){var F=c.LinearFilter;o.shadowMapType===c.PCFSoftShadowMap&&(F=c.NearestFilter);var I={minFilter:F,magFilter:F,format:c.RGBAFormat};A.shadowMap=new c.WebGLRenderTarget(A.shadowMapWidth,A.shadowMapHeight,I),A.shadowMapSize=new c.Vector2(A.shadowMapWidth,A.shadowMapHeight),A.shadowMatrix=new c.Matrix4}if(!A.shadowCamera){if(A instanceof c.SpotLight)A.shadowCamera=new c.PerspectiveCamera(A.shadowCameraFov,A.shadowMapWidth/A.shadowMapHeight,A.shadowCameraNear,A.shadowCameraFar);else{if(!(A instanceof c.DirectionalLight)){console.error("Unsupported light type for shadow");continue}A.shadowCamera=new c.OrthographicCamera(A.shadowCameraLeft,A.shadowCameraRight,A.shadowCameraTop,A.shadowCameraBottom,A.shadowCameraNear,A.shadowCameraFar)}d.add(A.shadowCamera),d.autoUpdate===!0&&d.updateMatrixWorld()}for(A.shadowCameraVisible&&!A.cameraHelper&&(A.cameraHelper=new c.CameraHelper(A.shadowCamera),A.shadowCamera.add(A.cameraHelper)),A.isVirtual&&R.originalCamera==p&&i(p,A),w=A.shadowMap,_=A.shadowMatrix,M=A.shadowCamera,M.position.getPositionFromMatrix(A.matrixWorld),m.getPositionFromMatrix(A.target.matrixWorld),M.lookAt(m),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),A.cameraHelper&&(A.cameraHelper.visible=A.shadowCameraVisible),A.shadowCameraVisible&&A.cameraHelper.update(),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(M.projectionMatrix),_.multiply(M.matrixWorldInverse),f.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),h.setFromMatrix(f),o.setRenderTarget(w),o.clear(),P=d.__webglObjects,y=0,x=P.length;x>y;y++)T=P[y],E=T.object,T.render=!1,E.visible&&E.castShadow&&((E instanceof c.Mesh||E instanceof c.ParticleSystem)&&E.frustumCulled&&!h.intersectsObject(E)||(E._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,E.matrixWorld),T.render=!0));var k,B,V;for(y=0,x=P.length;x>y;y++)T=P[y],T.render&&(E=T.object,S=T.buffer,k=n(E),B=E.geometry.morphTargets.length>0&&k.morphTargets,V=E instanceof c.SkinnedMesh&&k.skinning,C=E.customDepthMaterial?E.customDepthMaterial:V?B?u:l:B?s:a,S instanceof c.BufferGeometry?o.renderBufferDirect(M,d.__lights,N,C,S,E):o.renderBuffer(M,d.__lights,N,C,S,E));for(P=d.__webglObjectsImmediate,y=0,x=P.length;x>y;y++)T=P[y],E=T.object,E.visible&&E.castShadow&&(E._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,E.matrixWorld),o.renderImmediateObject(M,d.__lights,N,a,E))}var U=o.getClearColor(),z=o.getClearAlpha();r.clearColor(U.r,U.g,U.b,z),r.enable(r.BLEND),o.shadowMapCullFace===c.CullFaceFront&&r.cullFace(r.BACK)}},c.ShadowMapPlugin.__projector=new c.Projector,c.SpritePlugin=function(){function e(e,t){var n=i.createProgram(),r=i.createShader(i.FRAGMENT_SHADER),o=i.createShader(i.VERTEX_SHADER),a="precision "+t+" float;\n";return i.shaderSource(r,a+e.fragmentShader),i.shaderSource(o,a+e.vertexShader),i.compileShader(r),i.compileShader(o),i.attachShader(n,r),i.attachShader(n,o),i.linkProgram(n),n}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var i,n,r,o={};this.init=function(t){i=t.context,n=t,r=t.getPrecision(),o.vertices=new Float32Array(16),o.faces=new Uint16Array(6);var a=0;o.vertices[a++]=-.5,o.vertices[a++]=-.5,o.vertices[a++]=0,o.vertices[a++]=0,o.vertices[a++]=.5,o.vertices[a++]=-.5,o.vertices[a++]=1,o.vertices[a++]=0,o.vertices[a++]=.5,o.vertices[a++]=.5,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=-.5,o.vertices[a++]=.5,o.vertices[a++]=0,o.vertices[a++]=1,a=0,o.faces[a++]=0,o.faces[a++]=1,o.faces[a++]=2,o.faces[a++]=0,o.faces[a++]=2,o.faces[a++]=3,o.vertexBuffer=i.createBuffer(),o.elementBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,o.vertexBuffer),i.bufferData(i.ARRAY_BUFFER,o.vertices,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,o.elementBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,o.faces,i.STATIC_DRAW),o.program=e(c.ShaderSprite.sprite,r),o.attributes={},o.uniforms={},o.attributes.position=i.getAttribLocation(o.program,"position"),o.attributes.uv=i.getAttribLocation(o.program,"uv"),o.uniforms.uvOffset=i.getUniformLocation(o.program,"uvOffset"),o.uniforms.uvScale=i.getUniformLocation(o.program,"uvScale"),o.uniforms.rotation=i.getUniformLocation(o.program,"rotation"),o.uniforms.scale=i.getUniformLocation(o.program,"scale"),o.uniforms.alignment=i.getUniformLocation(o.program,"alignment"),o.uniforms.halfViewport=i.getUniformLocation(o.program,"halfViewport"),o.uniforms.color=i.getUniformLocation(o.program,"color"),o.uniforms.map=i.getUniformLocation(o.program,"map"),o.uniforms.opacity=i.getUniformLocation(o.program,"opacity"),o.uniforms.useScreenCoordinates=i.getUniformLocation(o.program,"useScreenCoordinates"),o.uniforms.sizeAttenuation=i.getUniformLocation(o.program,"sizeAttenuation"),o.uniforms.screenPosition=i.getUniformLocation(o.program,"screenPosition"),o.uniforms.modelViewMatrix=i.getUniformLocation(o.program,"modelViewMatrix"),o.uniforms.projectionMatrix=i.getUniformLocation(o.program,"projectionMatrix"),o.uniforms.fogType=i.getUniformLocation(o.program,"fogType"),o.uniforms.fogDensity=i.getUniformLocation(o.program,"fogDensity"),o.uniforms.fogNear=i.getUniformLocation(o.program,"fogNear"),o.uniforms.fogFar=i.getUniformLocation(o.program,"fogFar"),o.uniforms.fogColor=i.getUniformLocation(o.program,"fogColor"),o.uniforms.alphaTest=i.getUniformLocation(o.program,"alphaTest")},this.render=function(e,r,a,s){var l=e.__webglSprites,u=l.length;if(u){var h=o.attributes,f=o.uniforms,d=.5*a,p=.5*s;i.useProgram(o.program),i.enableVertexAttribArray(h.position),i.enableVertexAttribArray(h.uv),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.bindBuffer(i.ARRAY_BUFFER,o.vertexBuffer),i.vertexAttribPointer(h.position,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(h.uv,2,i.FLOAT,!1,16,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,o.elementBuffer),i.uniformMatrix4fv(f.projectionMatrix,!1,r.projectionMatrix.elements),i.activeTexture(i.TEXTURE0),i.uniform1i(f.map,0);var m=0,g=0,v=e.fog;v?(i.uniform3f(f.fogColor,v.color.r,v.color.g,v.color.b),v instanceof c.Fog?(i.uniform1f(f.fogNear,v.near),i.uniform1f(f.fogFar,v.far),i.uniform1i(f.fogType,1),m=1,g=1):v instanceof c.FogExp2&&(i.uniform1f(f.fogDensity,v.density),i.uniform1i(f.fogType,2),m=2,g=2)):(i.uniform1i(f.fogType,0),m=0,g=0);var y,x,b,w,_=[];for(y=0;u>y;y++)x=l[y],b=x.material,x.visible&&0!==b.opacity&&(b.useScreenCoordinates?x.z=-x.position.z:(x._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,x.matrixWorld),x.z=-x._modelViewMatrix.elements[14]));for(l.sort(t),y=0;u>y;y++)x=l[y],b=x.material,x.visible&&0!==b.opacity&&b.map&&b.map.image&&b.map.image.width&&(i.uniform1f(f.alphaTest,b.alphaTest),b.useScreenCoordinates===!0?(i.uniform1i(f.useScreenCoordinates,1),i.uniform3f(f.screenPosition,(x.position.x*n.devicePixelRatio-d)/d,(p-x.position.y*n.devicePixelRatio)/p,Math.max(0,Math.min(1,x.position.z))),_[0]=n.devicePixelRatio*x.scale.x,_[1]=n.devicePixelRatio*x.scale.y):(i.uniform1i(f.useScreenCoordinates,0),i.uniform1i(f.sizeAttenuation,b.sizeAttenuation?1:0),i.uniformMatrix4fv(f.modelViewMatrix,!1,x._modelViewMatrix.elements),_[0]=x.scale.x,_[1]=x.scale.y),w=e.fog&&b.fog?g:0,m!==w&&(i.uniform1i(f.fogType,w),m=w),i.uniform2f(f.uvScale,b.uvScale.x,b.uvScale.y),i.uniform2f(f.uvOffset,b.uvOffset.x,b.uvOffset.y),i.uniform2f(f.alignment,b.alignment.x,b.alignment.y),i.uniform1f(f.opacity,b.opacity),i.uniform3f(f.color,b.color.r,b.color.g,b.color.b),i.uniform1f(f.rotation,x.rotation),i.uniform2fv(f.scale,_),i.uniform2f(f.halfViewport,d,p),n.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),n.setDepthTest(b.depthTest),n.setDepthWrite(b.depthWrite),n.setTexture(b.map,0),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0));i.enable(i.CULL_FACE)}}},c.DepthPassPlugin=function(){function e(e){return e.material instanceof c.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var t,i,n,r,o,a,s=new c.Frustum,l=new c.Matrix4;this.init=function(e){t=e.context,i=e;var s=c.ShaderLib.depthRGBA,l=c.UniformsUtils.clone(s.uniforms);n=new c.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),r=new c.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),o=new c.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),a=new c.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(u,h){var f,d,p,m,g,v,y,x=null;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),i.setDepthTest(!0),u.autoUpdate===!0&&u.updateMatrixWorld(),h.matrixWorldInverse.getInverse(h.matrixWorld),l.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),s.setFromMatrix(l),i.setRenderTarget(this.renderTarget),i.clear(),y=u.__webglObjects,f=0,d=y.length;d>f;f++)g=y[f],v=g.object,g.render=!1,v.visible&&((v instanceof c.Mesh||v instanceof c.ParticleSystem)&&v.frustumCulled&&!s.intersectsObject(v)||(v._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,v.matrixWorld),g.render=!0));var b,w,_;for(f=0,d=y.length;d>f;f++)if(g=y[f],g.render){if(v=g.object,p=g.buffer,v instanceof c.ParticleSystem&&!v.customDepthMaterial)continue;b=e(v),b&&i.setMaterialFaces(v.material),w=v.geometry.morphTargets.length>0&&b.morphTargets,_=v instanceof c.SkinnedMesh&&b.skinning,m=v.customDepthMaterial?v.customDepthMaterial:_?w?a:o:w?r:n,p instanceof c.BufferGeometry?i.renderBufferDirect(h,u.__lights,x,m,p,v):i.renderBuffer(h,u.__lights,x,m,p,v)}for(y=u.__webglObjectsImmediate,f=0,d=y.length;d>f;f++)g=y[f],v=g.object,v.visible&&(v._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,v.matrixWorld),i.renderImmediateObject(h,u.__lights,x,n,v));var M=i.getClearColor(),S=i.getClearAlpha();t.clearColor(M.r,M.g,M.b,S),t.enable(t.BLEND)}},c.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},c.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","uniform vec2 halfViewport;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = ( position + alignment ) * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + ( rotatedPosition / halfViewport ), screenPosition.z, 1.0 );","} else {","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","finalPosition = projectionMatrix * finalPosition;","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},a("threejs",function(){}),c.TrackballControls=function(e,t){function i(e){f.enabled!==!1&&(window.removeEventListener("keydown",i),g=m,m===d.NONE&&(e.keyCode!==f.keys[d.ROTATE]||f.noRotate?e.keyCode!==f.keys[d.ZOOM]||f.noZoom?e.keyCode!==f.keys[d.PAN]||f.noPan||(m=d.PAN):m=d.ZOOM:m=d.ROTATE))}function n(e){f.enabled!==!1&&(m=g,window.addEventListener("keydown",i,!1))}function r(e){f.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),m===d.NONE&&(m=e.button),m!==d.ROTATE||f.noRotate?m!==d.ZOOM||f.noZoom?m!==d.PAN||f.noPan||(S=C=f.getMouseOnScreen(e.clientX,e.clientY)):b=w=f.getMouseOnScreen(e.clientX,e.clientY):y=x=f.getMouseProjectionOnBall(e.clientX,e.clientY),document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",a,!1))}function o(e){f.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),m!==d.ROTATE||f.noRotate?m!==d.ZOOM||f.noZoom?m!==d.PAN||f.noPan||(C=f.getMouseOnScreen(e.clientX,e.clientY)):w=f.getMouseOnScreen(e.clientX,e.clientY):x=f.getMouseProjectionOnBall(e.clientX,e.clientY))}function a(e){f.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),m=d.NONE,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",a))}function s(e){if(f.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),b.y+=.01*t}}function l(e){if(f.enabled!==!1)switch(e.touches.length){case 1:m=d.TOUCH_ROTATE,y=x=f.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:m=d.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;M=_=Math.sqrt(t*t+i*i);break;case 3:m=d.TOUCH_PAN,S=C=f.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:m=d.NONE}}function u(e){if(f.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:x=f.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;M=Math.sqrt(t*t+i*i);break;case 3:C=f.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY);break;default:m=d.NONE}}function h(e){if(f.enabled!==!1){switch(e.touches.length){case 1:y=x=f.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY);break;case 2:_=M=0;break;case 3:S=C=f.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)}m=d.NONE}}var f=this,d={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new c.Vector3;var p=new c.Vector3,m=d.NONE,g=d.NONE,v=new c.Vector3,y=new c.Vector3,x=new c.Vector3,b=new c.Vector2,w=new c.Vector2,_=0,M=0,S=new c.Vector2,C=new c.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var T={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new c.Vector2((e-f.screen.offsetLeft)/f.radius*.5,(t-f.screen.offsetTop)/f.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var i=new c.Vector3((e-.5*f.screen.width-f.screen.offsetLeft)/f.radius,(.5*f.screen.height+f.screen.offsetTop-t)/f.radius,0),n=i.length();n>1?i.normalize():i.z=Math.sqrt(1-n*n),v.copy(f.object.position).sub(f.target);var r=f.object.up.clone().setLength(i.y);return r.add(f.object.up.clone().cross(v).setLength(i.x)),r.add(v.setLength(i.z)),r},this.rotateCamera=function(){var e=Math.acos(y.dot(x)/y.length()/x.length());if(e){var t=(new c.Vector3).crossVectors(y,x).normalize();quaternion=new c.Quaternion,e*=f.rotateSpeed,quaternion.setFromAxisAngle(t,-e),v.applyQuaternion(quaternion),f.object.up.applyQuaternion(quaternion),x.applyQuaternion(quaternion),f.staticMoving?y.copy(x):(quaternion.setFromAxisAngle(t,e*(f.dynamicDampingFactor-1)),y.applyQuaternion(quaternion))}},this.zoomCamera=function(){if(m===d.TOUCH_ZOOM){var e=_/M;_=M,v.multiplyScalar(e)}else{var e=1+(w.y-b.y)*f.zoomSpeed;1!==e&&e>0&&(v.multiplyScalar(e),f.staticMoving?b.copy(w):b.y+=(w.y-b.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var e=C.clone().sub(S);if(e.lengthSq()){e.multiplyScalar(v.length()*f.panSpeed);var t=v.clone().cross(f.object.up).setLength(e.x);t.add(f.object.up.clone().setLength(e.y)),f.object.position.add(t),f.target.add(t),f.staticMoving?S=C:S.add(e.subVectors(C,S).multiplyScalar(f.dynamicDampingFactor))}},this.checkDistances=function(){f.noZoom&&f.noPan||(f.object.position.lengthSq()>f.maxDistance*f.maxDistance&&f.object.position.setLength(f.maxDistance),v.lengthSq()<f.minDistance*f.minDistance&&f.object.position.addVectors(f.target,v.setLength(f.minDistance)))},this.update=function(){v.subVectors(f.object.position,f.target),f.noRotate||f.rotateCamera(),f.noZoom||f.zoomCamera(),f.noPan||f.panCamera(),f.object.position.addVectors(f.target,v),f.checkDistances(),f.object.lookAt(f.target),p.distanceToSquared(f.object.position)>0&&(f.dispatchEvent(T),p.copy(f.object.position))},this.reset=function(){m=d.NONE,g=d.NONE,f.target.copy(f.target0),f.object.position.copy(f.position0),f.object.up.copy(f.up0),v.subVectors(f.object.position,f.target),f.object.lookAt(f.target),f.dispatchEvent(T),p.copy(f.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",u,!1),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",n,!1),this.handleResize()},c.TrackballControls.prototype=Object.create(c.EventDispatcher.prototype),a("trackballctrl",["threejs"],function(e){return function(){var t;return t||e.trackballctrl}}(this));a("stats",function(){});var f=new function(){var e=this;e.installed=!1,e.raw="",e.major=-1,e.minor=-1,e.revision=-1,e.revisionStr="";var t=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(e){return n(e)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(e){var t="6,0,21";try{e.AllowScriptAccess="always",t=n(e)}catch(i){}return t}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(e){return n(e)}}],n=function(e){var t=-1;try{t=e.GetVariable("$version")}catch(i){}return t},r=function(e){var t=-1;try{t=new ActiveXObject(e)}catch(i){t={activeXError:!0}}return t},o=function(e){var t=e.split(",");return{raw:e,major:parseInt(t[0].split(" ")[1],10),minor:parseInt(t[1],10),revision:parseInt(t[2],10),revisionStr:t[2]}},a=function(e){var t=e.split(/ +/),i=t[2].split(/\./),n=t[3];return{raw:e,major:parseInt(i[0],10),minor:parseInt(i[1],10),revisionStr:n,revision:s(n)}},s=function(t){return parseInt(t.replace(/[a-zA-Z]/g,""),10)||e.revision};e.majorAtLeast=function(t){return e.major>=t},e.minorAtLeast=function(t){return e.minor>=t},e.revisionAtLeast=function(t){return e.revision>=t},e.versionAtLeast=function(t){var n=[e.major,e.minor,e.revision],r=Math.min(n.length,arguments.length);for(i=0;i<r;i++){if(n[i]>=arguments[i]){if(i+1<r&&n[i]==arguments[i])continue;return!0}return!1}},e.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var i="application/x-shockwave-flash",n=navigator.mimeTypes;if(n&&n[i]&&n[i].enabledPlugin&&n[i].enabledPlugin.description){var s=n[i].enabledPlugin.description,l=a(s);e.raw=l.raw,e.major=l.major,e.minor=l.minor,e.revisionStr=l.revisionStr,e.revision=l.revision,e.installed=!0}}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var s=-1,u=0;u<t.length&&-1==s;u++){var h=r(t[u].name);if(!h.activeXError&&(e.installed=!0,s=t[u].version(h),-1!=s)){var l=o(s);e.raw=l.raw,e.major=l.major,e.minor=l.minor,e.revision=l.revision,e.revisionStr=l.revisionStr}}}()};f.JS_RELEASE="1.0.4",a("flash_detect",function(){});var d={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,n=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};d.init(),a("browserdetect",function(){}),a("event",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("EVENT",[function(){return{ON_AINIMATION_PLAYING:"ON_AINIMATION_PLAYING",ON_AINIMATION_COMPLETED:"ON_AINIMATION_COMPLETED",ON_CHANGE_CURRENT_DYNASTY:"ON_CHANGE_CURRENT_DYNASTY",CLEAR_SHOWING_PANELS:"CLEAR_SHOWING_PANELS",ADD_SHOWING_PANEL:"ADD_SHOWING_PANEL",REMOVE_SHOWING_PANEL:"REMOVE_SHOWING_PANEL",MAXIMIZE_TEXT_PANEL:"MAXIMIZE_TEXT_PANEL",MAXIMIZE_VIDEO_PANEL:"MAXIMIZE_VIDEO_PANEL",MAXIMIZE_IMAGE_PANEL:"MAXIMIZE_IMAGE_PANEL",RESTORE_DOWN_TEXT_PANEL:"RESTORE_DOWN_TEXT_PANEL",RESTORE_DOWN_VIDEO_PANEL:"RESTORE_DOWN_VIDEO_PANEL",RESTORE_DOWN_IMAGE_PANEL:"RESTORE_DOWN_IMAGE_PANEL",REMOVE_SHOWING_MAXIMAIZE_PANEL:"REMOVE_SHOWING_MAXIMAIZE_PANEL",PAUSE_ALL_SHOWING_VIDEO_PANEL:"PAUSE_ALL_SHOWING_VIDEO_PANEL",PLAY_ALL_SHOWING_VIDEO_PANEL:"PLAY_ALL_SHOWING_VIDEO_PANEL",PLAY_DYNASTY_INTRO_AUDIO:"PLAY_DYNASTY_INTRO_AUDIO",COMPLETE_DYNASTY_INTRO_AUDIO:"COMPLETE_DYNASTY_INTRO_AUDIO",UPDATE_POINTER_POSITION:"UPDATE_POINTER_POSITION",CHANGING_MAP_COMPLETED:"CHANGING_MAP_COMPLETED",ICONS_FADE_OUT:"ICONS_FADE_OUT",ICONS_FADE_IN:"ICONS_FADE_IN",STOP_CURRENT_INTRO_AUDIO:"STOP_CURRENT_INTRO_AUDIO"}}])}),a("control/earth",["angular","appmodule","angular_resource","threejs","stats","tweenjs"],function(){var e;return e=angular.module("app"),e.factory("EarthControl",["EVENT","SystemParameters","EarthModel","ResourceModel",function(e,t,i,n){return{init:function(e){var r,o,a,l,u,h,f,d,p,m,g,v,y,x,b,w;if(e.earthContainer&&!i.scene)return w=t.SCREENWIDTH,f=t.SCREENHEIGHT,p=.67,y=64,g=6,v=i.scene=new c.Scene,r=i.camera=new c.PerspectiveCamera(45,w/f,.01,100),m=i.renderer=new c.WebGLRenderer,l=function(e,t){return new c.Mesh(new c.SphereGeometry(e,t,t),new c.MeshPhongMaterial({map:c.ImageUtils.loadTexture(n.earthTextures.map.src),bumpMap:c.ImageUtils.loadTexture(n.earthTextures.bumpMap.src),bumpScale:0,specularMap:c.ImageUtils.loadTexture(n.earthTextures.specularMap.src),specular:new c.Color("grey")}))},a=function(e,t){return new c.Mesh(new c.SphereGeometry(e+.003,t,t),new c.MeshPhongMaterial({map:c.ImageUtils.loadTexture(n.earthTextures.clouds.src),transparent:!0}))},u=function(e,t){return new c.Mesh(new c.SphereGeometry(e,t,t),new c.MeshBasicMaterial({map:c.ImageUtils.loadTexture(n.earthTextures.stars.src),side:c.BackSide}))},i.controls=new c.TrackballControls(i.camera),m.setSize(w,f),r.position.z=1.5,v.add(new c.AmbientLight(3355443)),d=new c.DirectionalLight(16777215,1),d.position.set(5,3,5),v.add(d),h=l(p,y),h.rotation.y=g,v.add(h),o=a(p,y),o.rotation.y=g,v.add(o),b=u(90,64),v.add(b),i.light=d,i.earth=h,i.clouds=o,i.stars=b,e.earthContainer.appendChild(m.domElement),i.earth.position.x-=.01,i.clouds.position.x-=.01,i.earth.rotation.y+=9.3,i.earth.rotation.x+=.62,i.earth.rotation.z+=.1,i.origin={rotation:{x:i.earth.rotation.x,y:i.earth.rotation.y,z:i.earth.rotation.z},up:{z:i.earth.up.z}},r.position.z=1.2,(x=function(e){return null==e&&(e=1),i.shapeEarthTween=null,i.shapeEarthTween=new s.Tween({px:i.earth.rotation.x,pz:i.earth.rotation.z,rz:i.earth.up.z}).to({px:i.origin.rotation.x+3e-4*(10*Math.random()+1)*e,pz:i.origin.rotation.z+3e-4*(10*Math.random()+1)*e,rz:i.origin.up.z+.003*(10*Math.random()+1)*e},5500).delay(10).easing(s.Easing.Quadratic.InOut).onUpdate(function(){return i.earth.rotation.x=this.px,i.earth.rotation.z=this.pz,i.earth.up.z=this.rz,i.clouds.rotation.x=this.px,i.clouds.rotation.z=this.pz,i.clouds.up.z=this.rz}).onComplete(function(){return x(-1*e)}).start()})()},update:function(){return i.clouds.rotation.y+=1e-5},draw:function(){return i.renderer?i.renderer.render(i.scene,i.camera):void 0},updateCameraZ:function(e){return i.camera.position.z=e},relocateCamera:function(e){var t,r,o,a;return r=i.camera,a=2e3,o=500,t=new s.Tween({pz:r.position.z}).to({pz:1.5},a).delay(o).easing(s.Easing.Quadratic.InOut).onUpdate(function(){return r.position.z=this.pz}).onComplete(function(){return n.loginAnimationCompleted=!0,e?e():void 0}).start()}}}])}),a("SoundManager",["sound","angular","appmodule"],function(){var e;return e=function(){function e(){}return e.initialised=!1,e.autoplay=!0,e.currentSounds=[],e.player,e.soundManagerReady,e.isFinish,e.init=function(t,i,n){return soundManager.setup({url:document.URL+"/assets/swf",flashVersion:9,debugMode:!1,waitForWindowLoad:!0,useConsole:!0,onready:function(){return e.soundManagerReady=!0,n?n():void 0}})},e.playBgSound=function(t,i,n){var r;return e.soundManagerReady?(r=soundManager.createSound({id:t[i].id,url:t[i].url,autoPlay:!0,autoLoad:!0,stream:!0,useWaveformData:!1,useEQData:!0,volume:10,whileplaying:function(){return n(this.eqData)},onfinish:function(){return i===t.length-1?i=0:i++,e.playBgSound(n,i,t)}}),r.play({autoPlay:!0,autoLoad:!0,stream:!0,useWaveformData:!1,useEQData:!0})):void 0},e.stopIntroAudio=function(e){var t;return t=soundManager.getSoundById(e.audioId),soundManager.stop(e.audioId)},e.playIntroAudio=function(t,i,n){var r;return e.soundManagerReady?(r=soundManager.createSound({id:t.audioId,url:t.audio,autoPlay:!0,autoLoad:!0,useWaveformData:!1,useEQData:!0,volume:80,onfinish:n,whileplaying:function(){return i(this.eqData)}}),e.stopIntroAudio(t),r.play()):void 0},e}()}),a("control/mainscreen",["SoundManager","angular","appmodule","browserdetect"],function(e){var t;return t=angular.module("app"),t.controller("MainScreenCtrl",["$scope","EVENT","CSV","SystemParameters","ResourceModel","EarthModel","PreloadDataService","LoginScreenControl","DynastyIntroAudioControl","EarthControl","NavigationPanelControl","TimelinePanelControl","CategoryPanelControl","DynastyMapControl","MapAreaPanelControl","ShowingPanelsControl","MaximizedPanelControl",function(t,i,n,r,o,a,l,u,h,c,f,d,p,m,g,v,y){var x,b,w,_,M,S,C,T,E,A,P,L;return w=r.bgSounds,
t.context=void 0,t.canvas=void 0,t.mainScreen=null,t.mainScreen=angular.element("#mainScreen"),t.earthContainer=angular.element("#earthContainer"),t.loadDataComplete=!1,t.currentDynasty=o.currentDynasty,t.showingVideoResources=[],t.soudManagerReady=!1,t.eqData=void 0,t.bgSoundOn=!0,t.bg3DearthOn=!0,t.alphaCanvas=!1,t.betaCanvas=!1,t.eqData=[],_=function(){return t.ResourceModel=o,e.init(P),u.init()},P=function(e){return t.eqData=e},t.$watch("earthContainer",function(e){return t.bg3DearthOn&&void 0!==e?t.earthContainer=document.getElementById("earthContainer"):void 0}),t.$watch("mainScreen",function(e){return void 0!==e&&t.earthContainer&&(t.canvas=document.getElementById("mainScreen"),t.canvas)?(r.canvas=t.canvas,T(),window.onload(),l.preloadData(function(){return setTimeout(function(){return t.loadDataComplete=!0,c.init(t)},1e3),_()})):void 0}),S=function(e){var n,o;return o=r.mapAreaPanel.hitspot,n={mapCircle:{x:o.x+o.width/2,y:o.y+o.height,r:o.width/2},cursor:{x:e.x,y:e.y}},t.$emit(i.UPDATE_POINTER_POSITION,n)},T=function(){return t.canvas.onmousedown=function(e){return r.onPlayingAnimation?void 0:(e.preventDefault(),d.handleMouseDown(e,t))},t.canvas.onmousemove=function(e){return r.onPlayingAnimation?void 0:(e.preventDefault(),S(e),d.handleMouseMove(e,t))},t.canvas.onmouseup=function(e){return r.onPlayingAnimation?void 0:(e.preventDefault(),p.handleMouseUp(e,t),d.handleMouseUp(e,t),f.handleMouseUp(e,t),g.handleMouseUp(e,t))}},M=function(){return c.relocateCamera(function(){return t.$emit(i.ON_CHANGE_CURRENT_DYNASTY,{dynastyId:9,height:26,periodId:0,width:26,x:506,y:620})}),e.playBgSound(w,0,P)},window.requestAnimFrame=function(e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/24)}},window.onload=function(){return C(),b()},C=function(){return t.alphaCanvas=document.getElementById("alphaCanvas"),t.alphaContext=t.alphaCanvas.getContext("2d"),t.betaCanvas=document.getElementById("betaCanvas"),t.betaContext=t.betaCanvas.getContext("2d"),t.context=t.canvas.getContext("2d"),r.context=t.context},b=function(){return A(),s.update(),window.requestAnimationFrame(b)},A=function(){return t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.loadDataComplete&&(c.update(),c.draw()),u.drawCover(t),!r.loginScreen.isCoverFadeOut&&t.loadDataComplete&&u.fadeOutColumnCells(M),o.loginAnimationCompleted?(m.draw(t),f.update(t),f.draw(t),p.draw(t),d.draw(t),g.draw(t),h.draw(t)):void 0},t.clearAlphaContext=function(){return t.alphaContext?t.alphaContext.clearRect(0,0,t.alphaCanvas.width,t.alphaCanvas.height):void 0},t.clearBetaContext=function(){return t.betaContext?t.betaContext.clearRect(0,0,t.betaCanvas.width,t.betaCanvas.height):void 0},t.getColor=function(e,t){var i,n;return n=r.colors[e],t||(t=1),i="rgba("+n+","+t+")"},t.getFont=function(e){var t,i,n;return t=e.fontFamily?e.fontFamily:"DEFAULT",i=e.fontSize?e.fontSize:"MIDDLE",n=e.fontWeight?e.fontWeight:"normal",t=r.fontFamily[t],i=r.fontSize[i],n+" "+i+" "+t},t.loadImageData=function(e,t){},t.getImageByName=function(e){var t,i,n,o;for(o=r.images,i=0,n=o.length;n>i;i++)if(t=o[i],t.name.split(".")[0]===e)return t},t.drawParagraph=function(e){var i,n,r,o,a,s,l,u,h,c,f;for(i=t.context,u=e.text.split(" "),r=e.lineHeight?e.lineHeight:12,a=e.lineWidthOffset?e.lineWidthOffset:0,l={text:"",x:e.x,y:e.y,color:e.color,textAlign:e.textAlign,textBaseline:e.textBaseline,fontWeight:e.fontWeight,fontFamily:e.fontFamily,fontSize:e.fontSize},f=[],s=h=0,c=u.length-1;c>=h;s=h+=1)l.text+=u[s]+" ",o=i.measureText(l.text).width,n=function(){return t.drawText(l),l.y+=r,l.text=""},o>=e.width-a&&s>0&&n(),s>=u.length-1?f.push(n()):f.push(void 0);return f},t.drawText=function(e){var i,n,r,o,a;return(r=t.context)?(r.save(),o=e.x,a=e.y,n=e.color?e.color:"WHITE",r.font=t.getFont(e),e.textAlign&&(r.textAlign=e.textAlign),e.textBaseline&&(r.textBaseline=e.textBaseline),i=void 0!==e.alpha?e.alpha:1,e.shadow&&(r.shadowColor=t.getColor(e.shadow.color,e.shadow.alpha),r.shadowOffsetX=e.shadow.offsetX,r.shadowOffsetY=e.shadow.offsetY,r.shadowBlur=e.shadow.blur),r.fillStyle=t.getColor(n,i),r.fillText(e.text,o,a),r.restore(),r.measureText(e.text).width):void 0},t.drawMapIcon=function(e){return r.onMapChangingAnimation?void 0:(e.alpha||(e.alpha=0),t.drawImage(e))},t.drawImage=function(e,i){var n,o,a,s;return(o=i===r.MAINCANVAS?t.context:i===r.ALPHACANVAS?t.alphaContext:i===r.BETACANVAS?t.betaContext:t.context)?(s=e.width?e.width:e.data.width,a=e.height?e.height:e.data.height,n=e.alpha?e.alpha:1,o.save(),o.globalAlpha=n,o.drawImage(e.data,e.x,e.y,s,a),o.globalAlpha=1,o.restore()):void 0},t.drawCSVImage=function(e){var i;return(i=t.context)?(i.save(),i.drawSvg(e.data.src,e.x,e.y,e.width,e.height),i.restore()):void 0},t.drawVideoPanel=function(e){var i;if(e&&e.video&&!e.video.ended)return i=t.context,i.save(),i.drawImage(e.video,e.x,e.y,e.width,e.height),i.restore()},t.drawRetangle=function(e,i){var n,o,a,s,l,u,h,c,f,d,p;return(n=i===r.MAINCANVAS?t.context:i===r.ALPHACANVAS?t.alphaContext:i===r.BETACANVAS?t.betaContext:t.context)?(n.save(),d=e.x,p=e.y,f=e.width,s=e.height,u=e.radius?e.radius:0,c=e.strokeColor?e.strokeColor:"WHITE",l=e.lineWidth?e.lineWidth:1,o=void 0!==e.fillAlpha?e.fillAlpha:1,h=void 0!==e.strokeAlpha?e.strokeAlpha:1,n.beginPath(),n.moveTo(d+u,p),n.lineTo(d+f-u,p),n.quadraticCurveTo(d+f,p,d+f,p+u),n.lineTo(d+f,p+s-u),n.quadraticCurveTo(d+f,p+s,d+f-u,p+s),n.lineTo(d+u,p+s),n.quadraticCurveTo(d,p+s,d,p+s-u),n.lineTo(d,p+u),n.quadraticCurveTo(d,p,d+u,p),n.closePath(),n.strokeStyle=t.getColor(c,h),n.lineWidth=l,n.stroke(),e.fill&&(a=e.fillColor?e.fillColor:"WHITE",n.fillStyle=t.getColor(a,o),n.fillRect(d,p,f,s)),n.restore()):void 0},t.drawPolygon=function(e){var i,n,r,o,a,s,l,u;for(s=e.strokeColor?e.strokeColor:"WHITE",o=e.lineWidth?e.lineWidth:1,a=e.points,i=t.context,i.save(),i.beginPath(),r=l=0,u=a.length-1;u>=l;r=l+=1)0===r?i.moveTo(a[r].x,a[r].y):i.lineTo(a[r].x,a[r].y);return i.closePath(),i.strokeStyle=t.getColor(s),i.lineWidth=o,i.stroke(),e.fill&&(n=e.fillColor?e.fillColor:"WHITE",i.fillStyle=t.getColor(n),i.fill()),i.restore()},t.drawCircle=function(e,i){var n,o,a,s,l,u,h;return(n=i===r.MAINCANVAS?t.context:i===r.ALPHACANVAS?t.alphaContext:i===r.BETACANVAS?t.betaContext:t.context)?(n.save(),u=e.x,h=e.y,s=e.r,a=e.lineWidth?e.lineWidth:1,l=e.strokeColor?e.strokeColor:"WHITE",n.beginPath(),n.arc(u,h,s,2*Math.PI,!1),n.closePath(),n.strokeStyle=l,n.lineWidth=a,n.stroke(),e.fill&&(o=e.fillColor?e.fillColor:"WHITE",n.fillStyle=t.getColor(o),n.fill()),n.restore()):void 0},t.drawLine=function(e){var i,n,r;return i=t.context,i.save(),n=e.lineWidth?e.lineWidth:1,r=e.strokeColor?e.strokeColor:"WHITE",i.beginPath(),i.moveTo(e.startX,e.startY),i.lineTo(e.endX,e.endY),i.closePath(),i.lineWidth=n,i.strokeStyle=t.getColor(r),i.stroke(),i.restore()},t.drawPanelButton=function(e){var i;if(e.visible!==!1)return i=t.context,i.save(),t.drawImage(e),i.restore()},t.createRetangleMask=function(e){var i,n,r,o,a;if(e)return i=t.context,i.save(),o=e.x,a=e.y,r=e.width,n=e.height,i.beginPath(),i.rect(o,a,r,n),i.closePath(),i.clip()},t.endMask=function(){var e;return(e=t.context)?e.restore():void 0},t.loadImageData=function(e,t){return e.data=new Image,e.data.onload=function(){return this.complete&&t?t():void 0},e.data.src=e.url},t.checkMouseAndHitspotCollision=function(e,i){var n,r,o;if(i)return n=t.getMousePosition(e),r=n.x,o=n.y,r>=i.x&&r<=i.x+i.width&&o>=i.y&&o<=i.y+i.height?!0:!1},t.getMousePosition=function(e){var i,n;if(t.canvas)return i=t.canvas.getBoundingClientRect(),n={x:e.clientX-i.left*(t.canvas.width/i.width),y:e.clientY-i.top*(t.canvas.height/i.height)}},x=function(e){return e.editDateTime=Date.now(),o.showingPanels.push(e)},E=function(e){var t,i,n;return o.currentDynasty?(t=o.currentDynastyPeriod,i={scale:o.currentDynasty.mapConfigs[t].scale,mapZ:o.currentDynasty.mapConfigs[t].mapZ},n=new s.Tween(i).to({scale:r.SCALE,mapZ:r.MAP_Z},500).delay(10).easing(s.Easing.Quadratic.InOut).onUpdate(function(){return c.updateCameraZ(i.mapZ),o.currentMapScale=i.scale}).onComplete(function(){return n=null,e?e():void 0}).start()):void(e&&e())},L=function(e){var t,i,n;return o.currentDynasty?(t=o.currentDynastyPeriod,i={scale:o.currentMapScale,mapZ:a.camera.position.z},i.scale===o.currentDynasty.mapConfigs[t].scale?void(e&&e()):n=new s.Tween(i).to({scale:o.currentDynasty.mapConfigs[t].scale,mapZ:o.currentDynasty.mapConfigs[t].mapZ},500).delay(10).easing(s.Easing.Quadratic.InOut).onUpdate(function(){return c.updateCameraZ(i.mapZ),o.currentMapScale=i.scale}).onComplete(function(){return n=null,e?e():void 0}).start()):void(e&&e())},t.$on(i.PLAY_DYNASTY_INTRO_AUDIO,function(t,i){var n,a;return t.preventDefault(),o.currentIntroAudio=i,a=function(){return void 0},n=function(){var t;if(o.currentDynasty.introAudios)return i.state=r.introAudioState.COMPLETED,t=o.currentIntroAudio.id+1,t<o.currentDynasty.introAudios.length?(o.currentIntroAudio=o.currentDynasty.introAudios[t],e.playIntroAudio(o.currentIntroAudio,a,n),h.fadeInText()):(o.currentIntroAudio=void 0,o.drawingIntroText=void 0)},e.playIntroAudio(i,a,n),h.fadeInText()}),t.$on(i.COMPLETE_DYNASTY_INTRO_AUDIO,function(e,t){return e.preventDefault()}),t.$on(i.STOP_CURRENT_INTRO_AUDIO,function(t){return t.preventDefault(),e.stopIntroAudio(o.currentIntroAudio)}),t.$on(i.ON_CHANGE_CURRENT_DYNASTY,function(n,a){return n.preventDefault(),t.$emit(i.CLEAR_SHOWING_PANELS),t.$emit(i.ICONS_FADE_OUT,function(){var n,s,l,u,c,d,p;if(t.$emit(i.ON_AINIMATION_PLAYING),r.onMapChangingAnimation=!0,n=function(){var i,n,s,l,u;for(i=o.currentDynastyId!==a.dynastyId||!o.currentDynastyId,o.currentDynastyId=a.dynastyId,o.currentDynastyPeriod=a.periodId,u=o.dynasties,s=0,l=u.length;l>s;s++)if(n=u[s],n.id===o.currentDynastyId){o.currentDynasty=n,i&&(o.currentIntroAudio&&(e.stopIntroAudio(o.currentIntroAudio),o.currentIntroAudio=void 0,o.drawingIntroText=void 0),h.load(t));break}return m.changeCurrentMap(t,function(){return m.animatingMaps(t,function(){return r.onMapChangingAnimation=!1})}),f.changeCurrentDynasty()},o.currentDynasty){for(s=o.currentDynasty.mapConfigs[o.currentDynastyPeriod],p=o.dynasties,c=0,d=p.length;d>c;c++)if(l=p[c],l.id===a.dynastyId){u=l.mapConfigs[a.periodId];break}if(s.mapZ===u.mapZ)return void n()}return E(n)})}),t.$on(i.ICONS_FADE_OUT,function(e,t){return e.preventDefault(),g.iconsFadeOut(t)}),t.$on(i.ICONS_FADE_IN,function(e,i){return e.preventDefault(),g.iconsFadeIn(t,i)}),t.$on(i.CLEAR_SHOWING_PANELS,function(e){var i,n,a,s,l,u,h,c;for(e.preventDefault(),o.isShowingMaximizedPanel=!1,s=o.showingPanels,l=0,h=s.length;h>l;l++)n=s[l],n.resource.isShowing=!1;for(o.showingPanels=null,o.showingPanels=[],o.showingMaximizedPanel=null,a=r.panelSettings.showingPanelContainers,u=0,c=a.length;c>u;u++)i=a[u],i.panel=void 0;return t.$apply(o.showingPanels)}),t.$on(i.REMOVE_SHOWING_PANEL,function(e,i){var n,a,s,l,u;if(e.preventDefault(),i.panel){if(i.panelContainer)i.panelContainer.panel=void 0;else for(u=r.panelSettings.showingPanelContainers,s=0,l=u.length;l>s;s++)if(n=u[s],n.panel===i.panel){n.panel=void 0;break}return a=i.panel,a.resource.isShowing=!1,o.showingPanels.splice(o.showingPanels.indexOf(a),1),a=void 0,t.$apply(o.showingPanels),i.callback?i.callback():void 0}}),t.$on(i.ADD_SHOWING_PANEL,function(e,i){return e.preventDefault(),o.isShowingMaximizedPanel=!1,i.resource.isShowing=!0,x(i),t.$apply(o.showingPanels)}),t.$on(i.MAXIMIZE_TEXT_PANEL,function(e,n){return e.preventDefault(),o.isShowingMaximizedPanel=!0,t.$emit(i.PAUSE_ALL_SHOWING_VIDEO_PANEL),y.creatingMaximizedTextPanel(t,n,function(){})}),t.$on(i.MAXIMIZE_IMAGE_PANEL,function(e,n){return e.preventDefault(),o.isShowingMaximizedPanel=!0,t.$emit(i.PAUSE_ALL_SHOWING_VIDEO_PANEL),y.creatingMaximizedImagePanel(t,n,function(){})}),t.$on(i.MAXIMIZE_VIDEO_PANEL,function(e,n){return e.preventDefault(),o.isShowingMaximizedPanel=!0,t.$emit(i.PAUSE_ALL_SHOWING_VIDEO_PANEL),y.creatingMaximizedVideoPanel(t,n,function(){return n.video.play()})}),t.$on(i.REMOVE_SHOWING_MAXIMAIZE_PANEL,function(e,n){return e.preventDefault(),o.isShowingMaximizedPanel=!1,o.showingMaximizedPanel=void 0,t.$emit(i.PLAY_ALL_SHOWING_VIDEO_PANEL)}),t.$on(i.PAUSE_ALL_SHOWING_VIDEO_PANEL,function(e){return e.preventDefault(),v.pauseAllPlayingVideo()}),t.$on(i.PLAY_ALL_SHOWING_VIDEO_PANEL,function(e){return e.preventDefault(),v.playAllPausedVideo()}),t.$on(i.ON_AINIMATION_PLAYING,function(e){return e.preventDefault(),r.onPlayingAnimation=!0}),t.$on(i.ON_AINIMATION_COMPLETED,function(e){return e.preventDefault(),r.onPlayingAnimation=!1,t.$emit(i.ICONS_FADE_IN)}),t.$on(i.UPDATE_POINTER_POSITION,function(e,t){return e.preventDefault(),f.updateLocation(t)}),t.$on(i.CHANGING_MAP_COMPLETED,function(e,n){return e.preventDefault(),L(function(){return t.$emit(i.ON_AINIMATION_COMPLETED)})})}])}),a("control/navigationpanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("NavigationPanelControl",["SystemParameters","ResourceModel",function(e,t){return{update:function(t){var i,n;return(i=e.navigationPanel)?(n=function(){var e,n;return(e=i.soundEffect)?(n=function(){var i,n,r,o,a,s,l,u,h,c,f,d,p,m,g,v,y,x,b,w,_,M,S,C;if(u=e.lineChart,o=t.eqData,t.eqData){if(l=o.left,h=o.right,n=0,r=u.cylinders,l&&0!==l.length)for(a=d=0,x=l.length-1;x>=d;a=d+=60)r[n].percentage=1.2*l[a],n++;else for(n=f=0,y=r.length/2-1;y>=f;n=f+=1)r[n].percentage=0;if(h&&0!==h.length){for(C=[],s=g=0,_=h.length-1;_>=g;s=g+=60)r[n].percentage=1.2*h[s],C.push(n++);return C}for(S=[],n=p=b=r.length/2-1,w=r.length-1;w>=p;n=p+=1)S.push(r[n].percentage=0);return S}for(v=u.cylinders,M=[],c=0,m=v.length;m>c;c++)i=v[c],M.push(i.percentage=0);return M})():void 0})():void 0},draw:function(t){var i,n,r;return i=t.canvas,(n=t.context)?(r=function(){var i,n,r,o,a,s,l,u,h,c,f;return(f=e.navigationPanel)?(s=function(){var e,i,n,r,o,a,s;if(e=f.power.percentage,e&&(n=e.chartModel)){for(o=e.value/Math.abs(n.step),s=[],i=a=1;o>=1?o>=a:a>=o;i=o>=1?++a:--a)r={x:n.startX+(n.gap+n.width)*i*n.xOffset,y:n.startY+(n.gap+n.height)*i*n.yOffset,width:n.width,height:n.height,fill:n.fill},s.push(t.drawRetangle(r));return s}},a=function(){var e;return(e=f.location)?(t.drawText(e.n.label),t.drawText(e.n.text),t.drawText(e.e.label),t.drawText(e.e.text),t.drawCircle(e.circle),t.drawCircle(e.pointer)):void 0},l=function(){var e,i,n,r,o;return(n=f.progress)?(t.drawText(n.label),t.drawText(n.percentage),r=n.state,o={startX:r.x,startY:r.y,endX:r.x+r.width,endY:r.y,strokeColor:"WHITE",lineWidth:r.lineWidth},e={startX:r.x,startY:r.y,endX:r.x+r.width*r.complete,endY:r.y,strokeColor:r.completeStrokeColor,lineWidth:r.completeLineWidth},t.drawLine(o),t.drawLine(e),i={x:e.endX-r.pointer.width/2,y:e.endY-r.pointer.height/2,width:r.pointer.width,height:r.pointer.height,fillColor:r.pointer.fillColor,strokeColor:r.pointer.strokeColor,fill:r.pointer.fill},t.drawRetangle(i)):void 0},c=function(){var e,i,n,r,o,a,s,l,u,h;if(a=f.topicStates){for(h=[],l=0,u=a.length;u>l;l++)r=a[l],t.drawText(r.label),s=8,i=6,e=5,n=0,o={x:r.label.x-s-e,y:r.label.y-i*r.statePercentage.completePercentage-n,width:s,height:i*r.statePercentage.completePercentage,fillColor:"SKYBLUE",strokeColor:"SKYBLUE",lineWidth:0,fill:!0},h.push(t.drawRetangle(o));return h}},r=function(){var e,i,n,r,o;if(i=f.folderLabels){for(o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(t.drawText(e));return o}},o=function(e){var i,n,r,o,a,s,l,u,h,c;if(e){for(n=e.cylinders,a=e.startX,s=e.startY,r=e.gap,l=e.width,o=e.height,c=[],u=0,h=n.length;h>u;u++)i=n[u],i.fill=!0,i.lineWidth=1,i.points=[{x:a+r,y:s+o*(1-i.percentage)},{x:a+r,y:s+o},{x:a+r+l,y:s+o},{x:a+r+l,y:s+o*(1-i.percentage)}],t.drawPolygon(i),c.push(a=a+l+r);return c}},h=function(){var e;return(e=f.soundEffect)?(t.drawRetangle(e.retangleMarker),t.drawPolygon(e.polygonMarker),o(e.lineChart)):void 0},n=function(){var e;return(e=f.dateAndTime)?(t.drawRetangle(e.retangle),t.drawText(e.date),t.drawText(e.time)):void 0},u=function(){var e,i,n,r,a;if(i=f.signal){for(a=i.icon.lines,n=0,r=a.length;r>n;n++)e=a[n],t.drawLine(e);return o(i.bar)}},i=function(){var e,i,n,r,o,a,s,l,u,h,c,d;if(i=f.connect){if(void 0===i.bgImage&&(i.bgImage=t.getImageByName("connect")),t.drawImage(i.bgImage),0===i.circles.length)for(o=i.startX,a=i.y,n=i.gap,r=s=0,h=i.totalNumber-1;h>=0?h>=s:s>=h;r=h>=0?++s:--s)i.circles.push({x:o+n,y:a,fill:!1,fillColor:i.fillColor,strokeColor:i.strokeColor,index:r,r:i.r}),o+=n;for(c=i.circles,d=[],l=0,u=c.length;u>l;l++)e=c[l],2===e.index&&(e.fill=!0),d.push(t.drawCircle(e));return d}},void 0===f.bgImage&&(f.bgImage=t.getImageByName("dashboard_bg")),t.drawImage(f.bgImage),void 0===f.spaceship&&(f.spaceship=t.getImageByName("dashboard_spaceship")),t.drawImage(f.spaceship),t.drawText(f.userName),f.title.text&&(f.title.text=f.title.text.toUpperCase(),t.drawText(f.title),t.drawText(f.subTitle),t.drawText(f.startYear),t.drawText(f.startYearPeriod),t.drawText(f.endYear),t.drawText(f.endYearPeriod)),t.drawRetangle(f.power.frame),t.drawText(f.power.label),t.drawText(f.power.percentage),s(),a(),l(),c(),r(),t.drawText(f.level),t.drawText(f.logoutButton),h(),n(),u(),i()):void 0})():void 0},changeCurrentDynasty:function(){var i,n,r,o;return n=e.navigationPanel,n&&t.currentDynasty?(i=t.currentDynasty,o=function(){return n.title.text=i.name},r=function(){var e,r,o,a,s;return s=i.totalPeriod,e=Math.floor(Math.abs(i.endYear-i.startYear)/s),o=t.currentDynastyPeriod,a=i.startYear+e*o,r=o+1!==s?i.startYear+e*(o+1):i.endYear,n.startYear.text=Math.abs(a),n.startYearPeriod.text=a>=0?"DC -":"BC -",n.endYear.text=Math.abs(r),n.endYearPeriod.text=r>=0?"DC":"BC"},o(),r()):void 0},handleMouseUp:function(t,i){var n,r;return(r=e.navigationPanel)?(n=r.logoutButton,i.checkMouseAndHitspotCollision(t,n.hitspot)?alert("logout"):void 0):void 0},updateLocation:function(t){var i,n,r,o,a,s,l,u,h,c;return l=e.navigationPanel.location,h=t.mapCircle,a=t.cursor,i=Math.sqrt(Math.pow(h.x-a.x,2)+Math.pow(h.y-a.y,2)),i<=h.r?c={x:a.x,y:a.y,r:a.r}:(s={x:0,y:0},s.x=h.x+h.r/i*(a.x-h.x),s.y=h.y+h.r/i*(a.y-h.y),c={x:s.x,y:s.y,r:s.r}),u=l.circle,l.pointer.x=u.x-u.r/h.r*(h.x-c.x),l.pointer.y=u.y-u.r/h.r*(h.y-c.y),o=(90*(38-l.pointer.y)/11).toFixed(2),n=182.6,r=(75*(l.pointer.x-n)/11).toFixed(2),l.e.text.text=r,l.n.text.text=o}}}])}),a("control/timelinepanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("TimelinePanelControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{draw:function(e){var n,r,o,a,s,l,u;return r=e.canvas,o=e.context,o&&(u=t.timelinePanel)?(n=function(){return e.createRetangleMask(u.retangleMask)},a=function(){var t,n;return(n=u.progessionBar)?(t=function(){var t,r;return(r=i.dynasties)?(t=function(){var t,o,a,s,l,h,c,f,d,p,m,g,v,y,x,b,w,_;for(l=u.dynastyModel,f=[],u.dynastyHitspots||(u.dynastyHitspots=[]),m=n.x=u.x,g=n.y=u.y,x=0,w=r.length;w>x;x++){for(s=r[x],y=s.totalPeriod,v={x:m,y:g-u.offset/2,color:l.startYear.color,fontWeight:l.startYear.fontWeight,fontFamily:l.startYear.fontFamily,fontSize:l.startYear.fontSize,textAlign:l.startYear.textAlign,text:Math.abs(s.startYear)},e.drawText(v),d={x:v.x+l.width*y+l.marginLeft*(y-1),y:g-u.offset/2,color:l.endYear.color,fontWeight:l.endYear.fontWeight,fontFamily:l.endYear.fontFamily,fontSize:l.endYear.fontSize,textAlign:l.endYear.textAlign,text:Math.abs(s.endYear)},e.drawText(d),c={x:v.x+(d.x-v.x)/2,y:g+l.height+u.offset,color:l.name.color,fontWeight:l.name.fontWeight,fontFamily:l.name.fontFamily,fontSize:l.name.fontSize,textAlign:l.name.textAlign,text:s.name},e.drawText(c),o=function(){var t;return t={x:m,y:g,fillColor:l.fillColor,strokeColor:l.strokeColor,fillAlpha:l.fillAlpha,strokeAlpha:l.strokeAlpha,width:l.width,height:l.height,marginLeft:l.marginLeft,fill:l.fill},e.drawRetangle(t),t},t=function(){var t;return t={x:m,y:g,fillColor:u.currentDynastyModel.fillColor,strokeColor:u.currentDynastyModel.strokeColor,fillAlpha:l.fillAlpha,strokeAlpha:l.strokeAlpha,width:l.width,height:l.height,marginLeft:l.marginLeft,fill:l.fill},e.drawRetangle(t),t},a=function(t){var i,n;return i=u.pointer,n=[],n.push({x:t.x+t.width/2,y:i.y}),n.push({x:t.x+t.width/2-i.width/2,y:i.y+i.height}),n.push({x:t.x+t.width/2+i.width/2,y:i.y+i.height}),i.points=n,e.drawPolygon(i)},p=b=0,_=y-1;_>=b;p=b+=1)s.id===i.currentDynastyId&&p===i.currentDynastyPeriod?(h=t(),a(h)):h=o(),m=h.x+h.width+h.marginLeft,f.push({x:h.x,y:h.y,width:h.width,height:h.height,dynastyId:s.id,periodId:p});m+=n.dyanstyMarginLeft}return u.dynastyHitspots=f})():void 0})():void 0},s=function(){var t,i,n,r,o;return(o=u.timeLine)?(o.x=u.x,t=o.lineBC,t.startX=o.x,t.startY=o.y,t.endX=o.x+t.width,t.endY=t.startY,e.drawLine(t),n=o.textBC,n.x=t.endX+o.textMarginLeft,n.y=t.endY,e.drawText(n),r=o.textDC,r.x=n.x+o.textMiddleSpace,r.y=n.y,e.drawText(r),i=o.lineDC,i.startX=r.x+o.textMarginRight,i.startY=r.y,i.endX=r.x+i.width,i.endY=i.startY,e.drawLine(i)):void 0},l=function(){return e.endMask()},n(),a(),s(),l()):void 0},handleMouseDown:function(e,i){var n;return(n=t.timelinePanel)?i.checkMouseAndHitspotCollision(e,n.hitspot)?(n.mouseDownCoordinate=i.getMousePosition(e),n.mouseCurrentCoordinate=i.getMousePosition(e)):n.mouseCurrentCoordinate=void 0:void 0},handleMouseMove:function(e,i){var n,r,o;return o=t.timelinePanel,n=o.moveRange,o&&o.mouseCurrentCoordinate?(o.mouseMoveCoordinate=i.getMousePosition(e),r=o.mouseMoveCoordinate.x-o.mouseCurrentCoordinate.x,o.x=o.x+r,o.x<=n.min&&(o.x=n.min),o.x>=n.max&&(o.x=n.max),o.mouseCurrentCoordinate=o.mouseMoveCoordinate):void 0},handleMouseUp:function(n,r){var o,a,s,l,u;if(s=t.timelinePanel,s&&(s.mouseCurrentCoordinate=void 0,r.checkMouseAndHitspotCollision(n,s.hitspot))){if(s.mouseUpCoordinate=r.getMousePosition(n),Math.abs(s.mouseUpCoordinate.x-s.mouseDownCoordinate.x)>=2||Math.abs(s.mouseUpCoordinate.y-s.mouseDownCoordinate.y)>=2)return;for(a=s.dynastyHitspots,l=0,u=a.length;u>l;l++)if(o=a[l],r.checkMouseAndHitspotCollision(n,o)){if(i.currentDynastyId===o.dynastyId&&i.currentDynastyPeriod===o.periodId)return;return void r.$emit(e.ON_CHANGE_CURRENT_DYNASTY,o)}}}}}])}),a("control/categorypanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("CategoryPanelControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{draw:function(e){var n,r,o,a,s,l,u,h,c,f,d,p,m,g,v;if(n=e.canvas,s=e.context,s&&(a=t.categoryPanel,a&&(d=i.resourceCategories,d&&(o=a.categoryLabels)))){for(v=[],u=m=0,g=o.length-1;g>=m;u=m+=1)r=o[u],r.enable?(a.enableRetangle.y=r.y-12,a.enableRetangle.innerRetangle.y=r.y-8,e.drawRetangle(a.enableRetangle),e.drawRetangle(a.enableRetangle.innerRetangle),e.drawText(r)):(a.disableRetangle.y=r.y-12,e.drawRetangle(a.disableRetangle),e.drawText(r)),c=-5,f=-13,r.hitspot={x:a.enableRetangle.x+c,y:r.y+f,width:a.panelWidth,height:16},0===u&&(p=r.y-13),u===o.length-1?(l=r.y-13,f=5,h=25,v.push(a.hitspot={x:a.enableRetangle.x+c,y:p-f,height:l-p+h,width:a.panelWidth})):v.push(void 0);return v}},handleMouseUp:function(i,n){var r,o;return(r=t.categoryPanel)?(o=function(t){var i,o,a,s;for(s=r.categoryLabels,o=0,a=s.length;a>o;o++)if(i=s[o],n.checkMouseAndHitspotCollision(t,i.hitspot))return i.enable=!i.enable,void n.$emit(e.CLEAR_SHOWING_PANELS)},n.checkMouseAndHitspotCollision(i,r.hitspot)?o(i):void 0):void 0}}}])}),a("control/mapareapanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("MapAreaPanelControl",["EVENT","SystemParameters","ResourceModel","ShowingPanelsControl","MaximizedPanelControl",function(e,t,i,n,r){return{draw:function(e){var o,a,s,l;return o=e.canvas,a=e.context,a&&(l=t.mapAreaPanel)?(s=function(){var n,r,o,a,s,l,u,h,c,f;if(i.currentDynasty&&i.currentDynasty.enable&&(r=i.currentDynasty,0!==r.categories.length)){for(c=r.categories,f=[],u=0,h=c.length;h>u;u++)n=c[u],(!n.iconName||(a=t.categoryPanel.categoryIndexs.indexOf(n.name),t.categoryPanel.categoryLabels[a].enable))&&f.push(function(){var t,r,a,u;for(a=n.resources,u=[],t=0,r=a.length;r>t;t++)s=a[t],s.iconName&&(l=s.dynastyPeriod,o=i.currentDynastyPeriod,(-1===l||l===o)&&s.icon?u.push(e.drawMapIcon(s.icon)):u.push(void 0));return u}());return f}},s(),n.draw(e),r.draw(e)):void 0},handleMouseUp:function(e,o){var a,s,l,u,h,c,f,d,p,m,g,v,y,x,b,w;if(i.currentDynasty&&(h=t.mapAreaPanel,h&&o.checkMouseAndHitspotCollision(e,h.hitspot))){if(s=!1,i.showingMaximizedPanel&&o.checkMouseAndHitspotCollision(e,i.showingMaximizedPanel.hitspot))return r.handleMouseUp(o,e),void(s=!0);if(i.showingPanels.length>0)for(x=i.showingPanels,d=0,g=x.length;g>d;d++)if(f=x[d],o.checkMouseAndHitspotCollision(e,f.hitspot)){n.handleMouseUp(o,e,f),s=!0;break}for(b=i.currentDynasty.categories,p=0,v=b.length;v>p;p++){if(a=b[p],s)return;if(!a.iconName||(u=t.categoryPanel.categoryIndexs.indexOf(a.name),t.categoryPanel.categoryLabels[u].enable))for(w=a.resources,m=0,y=w.length;y>m;m++)if(c=w[m],!c.isShowing&&c.iconName&&c.icon&&(l={x:c.x,y:c.y,width:c.icon.data.width,height:c.icon.data.height},o.checkMouseAndHitspotCollision(e,l))){s=!0,n.createShowingPanel(o,c);break}}}},handleMouseMove:function(i,n){var r,o;return n.checkMouseAndHitspotCollision(i,t.mapAreaPanel.hitspot)?(o=t.mapAreaPanel.hitspot,r={mapCircle:{x:o.x+o.width/2,y:o.y+o.height,r:o.width/2},cursor:{x:i.x,y:i.y}},n.$emit(e.UPDATE_POINTER_POSITION,r)):void 0},iconsFadeIn:function(e,n){var r,o,a,l,u,h,c,f,d,p,m,g,v,y;if(!i.currentDynasty||!i.currentDynasty.enable)return void(n&&n());if(a=i.currentDynasty,0!==a.categories.length){for(o=function(e){var t,i,n;for(i=0,n=e.length;n>i;i++)if(t=e[i],1!==t.alpha)return},i.iconsTweens=void 0,i.iconsTweens=[],i.animatingIcons=void 0,i.animatingIcons=[],v=a.categories,y=[],m=0,g=v.length;g>m;m++)r=v[m],(!r.iconName||(f=t.categoryPanel.categoryIndexs.indexOf(r.name),t.categoryPanel.categoryLabels[f].enable))&&y.push(function(){var t,n,a,f;for(a=r.resources,f=[],t=0,n=a.length;n>t;t++)d=a[t],d.iconName&&(p=d.dynastyPeriod,l=i.currentDynastyPeriod,-1===p||p===l?(c="mapIcon",d.icon||(d.icon={x:d.x,y:d.y,data:e.getImageByName(c).data,alpha:0}),u=d.y,d.icon.y=u-10,d.icon.alpha=1,i.animatingIcons.push(d.icon),h=new s.Tween(d.icon).to({y:u,alpha:1},500).delay(Math.floor(200*Math.random())+20).easing(s.Easing.Quadratic.InOut).onUpdate(function(){}).onComplete(function(){return o(i.animatingIcons)}).start(),f.push(i.iconsTweens.push(h))):f.push(void 0));return f}());return y}},iconsFadeOut:function(e){var n,r,o,a,l,u,h,c,f,d,p,m;if(!i.currentDynasty||!i.currentDynasty.enable)return void(e&&e());if(r=function(t){var i,n,r;for(n=0,r=t.length;r>n;n++)if(i=t[n],0!==i.alpha)return;return e()},o=i.currentDynasty,0!==o.categories.length){for(i.iconsTweens=void 0,i.iconsTweens=[],i.animatingIcons=void 0,i.animatingIcons=[],p=o.categories,m=[],f=0,d=p.length;d>f;f++)n=p[f],(!n.iconName||(u=t.categoryPanel.categoryIndexs.indexOf(n.name),t.categoryPanel.categoryLabels[u].enable))&&m.push(function(){var e,t,o,u;for(o=n.resources,u=[],e=0,t=o.length;t>e;e++)h=o[e],h.iconName&&(c=h.dynastyPeriod,a=i.currentDynastyPeriod,-1===c||c===a?(i.animatingIcons.push(h.icon),l=new s.Tween(h.icon).to({y:h.y-10,alpha:0},300).delay(10).easing(s.Easing.Quadratic.InOut).onUpdate(function(){}).onComplete(function(){return r(i.animatingIcons)}).start(),u.push(i.iconsTweens.push(l))):u.push(void 0));return u}());return m}}}}])}),a("control/maximizedpanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("MaximizedPanelControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{draw:function(e){var n,r,o,a,s;if(i.showingMaximizedPanel&&(n=e.context))return a=function(t){return t.visible?(e.drawRetangle(t.frame),e.createRetangleMask(t.mask),e.drawParagraph(t.text),e.endMask(),e.drawPanelButton(t.buttonClose),t.buttonMaximize&&e.drawPanelButton(t.buttonMaximize),t.buttonRestoreDown?e.drawPanelButton(t.buttonRestoreDown):void 0):void 0},r=function(t){return t.visible?(e.drawRetangle(t.frame),e.createRetangleMask(t.mask),e.drawImage(t.image),e.endMask(),e.drawPanelButton(t.buttonClose),t.buttonMaximize&&e.drawPanelButton(t.buttonMaximize),t.buttonRestoreDown?e.drawPanelButton(t.buttonRestoreDown):void 0):void 0},s=function(t){return t.visible?(e.drawRetangle(t.frame),e.createRetangleMask(t.mask),e.drawVideoPanel(t),e.endMask(),e.drawPanelButton(t.buttonClose),t.buttonMaximize&&e.drawPanelButton(t.buttonMaximize),t.buttonRestoreDown&&e.drawPanelButton(t.buttonRestoreDown),t.buttonPause&&e.drawPanelButton(t.buttonPause),t.buttonPlay?e.drawPanelButton(t.buttonPlay):void 0):void 0},(o=function(){var e,n;if(i.showingMaximizedPanel)switch(n=i.showingMaximizedPanel.originalPanel.resource.resourceTypeId,e=i.showingMaximizedPanel,n){case t.RESOURCE_TYPE.TEXT:return a(e);case t.RESOURCE_TYPE.IMAGE:return r(e);case t.RESOURCE_TYPE.VIDEO:return s(e);default:return drawResourceTextPanel()}})()},creatingMaximizedTextPanel:function(e,n,r){var o,a,s,l,u,h,c,f;return l=t.panelSettings,s=t.panelSettings.maximizedPanel,h=s.x,c=s.y,o=s.padding,u=s.width,a=s.height,f={visible:!0,originalPanel:n,text:{text:n.resource.description,x:h+o,y:c+o,width:u-2*o,height:a-2*o,color:n.text.color,fontWeight:n.text.fontWeight,fontFamily:n.text.fontFamily,fontSize:s.fontSize,lineHeight:s.lineHeight,textBaseline:n.text.textBaseline,lineWidthOffset:s.lineWidthOffset},frame:{x:h,y:c,width:u,height:a,lineWidth:n.frame.lineWidth,strokeColor:n.frame.strokeColor,strokeAlpha:n.frame.strokeAlpha,fillColor:n.frame.fillColor,fillAlpha:n.frame.fillAlpha,fill:n.frame.fill},mask:{x:h+o,y:c+o,width:u-2*o,height:a-2*o},buttonClose:{data:e.getImageByName(l.buttonClose.buttonName).data,x:h+u-l.maximizedButton.width,y:c,width:l.maximizedButton.width,height:l.maximizedButton.height,hitspot:{x:h+u-l.maximizedButton.width,y:c,width:l.maximizedButton.width,height:l.maximizedButton.height},visible:!0},buttonRestoreDown:{data:e.getImageByName(l.buttonRestoreDown.buttonName).data,x:h+u-l.maximizedButton.width,y:c+l.maximizedButton.height,width:l.maximizedButton.width,height:l.maximizedButton.height,hitspot:{x:h+u-l.maximizedButton.width,y:c+l.maximizedButton.height,width:l.maximizedButton.width,height:l.maximizedButton.height},visible:!0},hitspot:{x:h,y:c,width:u,height:a}},i.showingMaximizedPanel=f,r?r():void 0},creatingMaximizedImagePanel:function(e,n,r){var o,a,s,l,u,h,c,f;return u=t.panelSettings,l=t.panelSettings.maximizedPanel,c=l.x,f=l.y,a=l.padding,h=l.width,s=l.height,o={visible:!0,originalPanel:n,image:{x:c+a,y:f+a,width:h-2*a,height:s-2*a,data:n.image.data},frame:{x:c,y:f,width:h,height:s,lineWidth:n.frame.lineWidth,strokeColor:n.frame.strokeColor,strokeAlpha:n.frame.strokeAlpha,fillColor:n.frame.fillColor,fillAlpha:n.frame.fillAlpha,fill:n.frame.fill},mask:{x:c+a,y:f+a,width:h-2*a,height:s-2*a},buttonClose:{data:e.getImageByName(u.buttonClose.buttonName).data,x:c+h-u.maximizedButton.width,y:f,width:u.maximizedButton.width,height:u.maximizedButton.height,hitspot:{x:c+h-u.maximizedButton.width,y:f,width:u.maximizedButton.width,height:u.maximizedButton.height},visible:!0},buttonRestoreDown:{data:e.getImageByName(u.buttonRestoreDown.buttonName).data,x:c+h-u.maximizedButton.width,y:f+u.maximizedButton.height,width:u.maximizedButton.width,height:u.maximizedButton.height,hitspot:{x:c+h-u.maximizedButton.width,y:f+u.maximizedButton.height,width:u.maximizedButton.width,height:u.maximizedButton.height},visible:!0},hitspot:{x:c,y:f,width:h,height:s}},i.showingMaximizedPanel=o,r?r():void 0},creatingMaximizedVideoPanel:function(e,n,r){var o,a,s,l,u,h,c,f;return u=t.panelSettings,l=t.panelSettings.maximizedPanel,c=l.x,f=l.y,a=l.padding,h=l.width,s=l.height,o={visible:!0,originalPanel:n,videoId:n.videoId,video:n.video,x:c+a,y:f+a,width:h-2*a,height:s-2*a,frame:{x:c,y:f,width:h,height:s,lineWidth:n.frame.lineWidth,strokeColor:n.frame.strokeColor,strokeAlpha:n.frame.strokeAlpha,
fillColor:n.frame.fillColor,fillAlpha:n.frame.fillAlpha,fill:n.frame.fill},mask:{x:c+a,y:f+a,width:h-a,height:s-a},buttonClose:{data:e.getImageByName(u.buttonClose.buttonName).data,x:c+h-u.maximizedButton.width,y:f,width:u.maximizedButton.width,height:u.maximizedButton.height,hitspot:{x:c+h-u.maximizedButton.width,y:f,width:u.maximizedButton.width,height:u.maximizedButton.height},visible:!0},buttonRestoreDown:{data:e.getImageByName(u.buttonRestoreDown.buttonName).data,x:c+h-u.maximizedButton.width,y:f+u.maximizedButton.height,width:u.maximizedButton.width,height:u.maximizedButton.height,hitspot:{x:c+h-u.maximizedButton.width,y:f+u.maximizedButton.height,width:u.maximizedButton.width,height:u.maximizedButton.height},visible:!0},buttonPause:{data:e.getImageByName(u.buttonPause.buttonName).data,x:c+h-u.maximizedButton.width,y:f+2*u.maximizedButton.height-5,width:u.maximizedButton.width,height:u.maximizedButton.height,hitspot:{x:c+h-u.maximizedButton.width,y:f+2*+u.maximizedButton.height,width:u.maximizedButton.width,height:u.maximizedButton.height},visible:!0},buttonPlay:{data:e.getImageByName(u.buttonPlay.buttonName).data,x:c+h-u.maximizedButton.width,y:f+2*u.maximizedButton.height-5,width:u.maximizedButton.width,height:u.maximizedButton.height,hitspot:{x:c+h-u.maximizedButton.width,y:f+2*+u.maximizedButton.height,width:u.maximizedButton.width,height:u.maximizedButton.height},visible:!1},hitspot:{x:c,y:f,width:h,height:s}},i.showingMaximizedPanel=o,r?r():void 0},handleMouseUp:function(t,n){var r,o,a,s;if(i.showingMaximizedPanel){if(o=i.showingMaximizedPanel,t.checkMouseAndHitspotCollision(n,o.buttonClose.hitspot))return r={originalPanel:o.originalPanel},t.$emit(e.REMOVE_SHOWING_MAXIMAIZE_PANEL,r),r={panel:o.originalPanel},void t.$emit(e.REMOVE_SHOWING_PANEL,r);if(t.checkMouseAndHitspotCollision(n,o.buttonRestoreDown.hitspot))return r={originalPanel:o.originalPanel},void t.$emit(e.REMOVE_SHOWING_MAXIMAIZE_PANEL,r);if(null!=(a=o.buttonPlay)?a.visible:void 0){if(t.checkMouseAndHitspotCollision(n,o.buttonPlay.hitspot))return o.video.play(),o.buttonPlay.visible=!1,o.buttonPause.visible=!0}else if((null!=(s=o.buttonPause)?s.visible:void 0)&&t.checkMouseAndHitspotCollision(n,o.buttonPause.hitspot))return o.video.pause(),o.buttonPlay.visible=!0,o.buttonPause.visible=!1}}}}])}),a("control/showingpanels",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("ShowingPanelsControl",["EVENT","SystemParameters","ResourceModel","ShowingTextPanelControl","ShowingVideoPanelControl","ShowingImagePanelControl",function(e,t,i,n,r,o){return{draw:function(e){var n,r,o,a,s;if(0!==i.showingPanels.length&&(n=e.context,n&&!i.isShowingMaximizedPanel))return o=function(t){return t.visible?(e.drawRetangle(t.frame),e.createRetangleMask(t.mask),e.drawParagraph(t.text),e.endMask(),e.drawPanelButton(t.buttonClose),e.drawPanelButton(t.buttonMaximize)):void 0},r=function(t){return t.visible?(e.drawRetangle(t.frame),e.createRetangleMask(t.mask),e.drawImage(t.image),e.endMask(),e.drawPanelButton(t.buttonClose),e.drawPanelButton(t.buttonMaximize)):void 0},a=function(t){return t.visible?(e.drawRetangle(t.frame),e.createRetangleMask(t.mask),e.drawVideoPanel(t),e.endMask(),e.drawPanelButton(t.buttonClose),e.drawPanelButton(t.buttonMaximize),e.drawPanelButton(t.buttonPause),e.drawPanelButton(t.buttonPlay)):void 0},(s=function(){var e,n,s,l,u;for(l=i.showingPanels,u=[],n=0,s=l.length;s>n;n++)switch(e=l[n],e.resource.resourceTypeId){case t.RESOURCE_TYPE.TEXT:u.push(o(e));break;case t.RESOURCE_TYPE.IMAGE:u.push(r(e));break;case t.RESOURCE_TYPE.VIDEO:u.push(a(e));break;default:u.push(o())}return u})()},createShowingPanel:function(a,s){var l,u,h,c,f,d,p,m,g,v;for(c=function(n){var r,o,s,l,u,h;for(s=t.panelSettings.showingPanelContainers,h=[],o=l=0,u=s.length-1;u>=l;o=l+=1){if(s[o].panel===i.showingPanels[0]){r={},r.panel=s[o].panel,r.callback=n,a.$emit(e.REMOVE_SHOWING_PANEL,r);break}h.push(void 0)}return h},h=function(e){var n;return n=i.showingPanels,n.length<t.panelSettings.totalShowingPanel?void e():c(e)},l=function(){var e,i,n,r;for(i=t.panelSettings.showingPanelContainers,e={},n=0,r=i.length;r>n;n++)if(e=i[n],void 0===e.panel)return e},u=function(e){var t;return t={x:e.x,y:e.y}},g=i.resourceTypes,v=[],p=0,m=g.length;m>p;p++){if(f=g[p],f.id===s.resourceTypeId){d=f.name,h(function(){var t,i;switch(t=l(),i=u(t),d){case"text":n.createPanel(a,s,i,t);break;case"video":a.$emit(e.STOP_CURRENT_INTRO_AUDIO),r.createPanel(a,s,i,t);break;case"image":o.createPanel(a,s,i,t);break;default:n.createPanel(a,s,i,t)}});break}v.push(void 0)}return v},handleMouseMove:function(){return void 0},handleMouseUp:function(e,t,a){var s,l,u,h,c,f;if(a.resource){for(s=a.resource,f=i.resourceTypes,h=0,c=f.length;c>h;h++)if(l=f[h],l.id===s.resourceTypeId)switch(u=l.name){case"text":n.handleMouseUp(e,t,a);break;case"video":r.handleMouseUp(e,t,a);break;case"image":o.handleMouseUp(e,t,a);break;default:n.handleMouseUp(e,t,a)}return void 0}},pauseAllPlayingVideo:function(){var e,t,n,r,o;if(0!==i.showingPanels.length){for(r=i.showingPanels,o=[],t=0,n=r.length;n>t;t++)e=r[t],e.video?o.push(e.video.pause()):o.push(void 0);return o}},playAllPausedVideo:function(){var e,t,n,r,o;if(0!==i.showingPanels.length){for(r=i.showingPanels,o=[],t=0,n=r.length;n>t;t++)e=r[t],e.video?o.push(e.video.play()):o.push(void 0);return o}}}}])}),a("control/dynastymap",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("DynastyMapControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{animatingMaps:function(n,r){var o,a,l,u;return a=function(r){return!i.newMap||t.changingMapState.changingCurrentMap||t.changingMapState.changingNewMap?void 0:(i.currentMap={dynasty:i.newMap.dynasty,period:i.newMap.period,mask:i.newMap.mask,outline:i.newMap.outline,contentCircleConfig:i.newMap.contentCircleConfig,outLineWidth:i.newMap.outLineWidth},i.currentMap.contentCircle={x:i.newMap.contentCircle.x,y:i.newMap.contentCircle.y,r:i.newMap.contentCircle.r,fillColor:"PANELBG",strokeColor:"PANELBG",fill:!0,delay:i.newMap.contentCircle.delay},i.currentMap.outlineCircle={x:i.newMap.contentCircle.x,y:i.newMap.contentCircle.y,r:i.newMap.contentCircle.r+i.newMap.outLineWidth,fillColor:"PANELBG",strokeColor:"PANELBG",fill:!0,delay:i.newMap.contentCircle.delay},i.newMap=void 0,n.$emit(e.CHANGING_MAP_COMPLETED),r?r():void 0)},o=function(){return t.changingMapState.changingNewMap||t.changingMapState.changingCurrentMap?void 0:a(r)},u=function(e){var n,r,a,l;return t.changingMapState.changingNewMap&&(null!=(l=i.newMap)?l.contentCircle:void 0)?(r=i.newMap.contentCircle,a=i.newMap.outlineCircle,n=new s.Tween(r).to({r:i.newMap.contentCircleConfig.endR},1e3).delay(5).easing(s.Easing.Quadratic.InOut).onUpdate(function(){return a.r=r.r+i.newMap.outLineWidth}).onComplete(function(){return n=null,t.changingMapState.changingNewMap=!1,o(),e?e():void 0}).start()):void 0},l=function(e){var n,r,a,l;return t.changingMapState.changingCurrentMap&&(null!=(l=i.currentMap)?l.contentCircle:void 0)?(r=i.currentMap.contentCircle,a=i.currentMap.outlineCircle,n=new s.Tween(r).to({r:i.currentMap.contentCircleConfig.startR},1e3).delay(800).easing(s.Easing.Quadratic.InOut).onUpdate(function(){return a.r=r.r+i.currentMap.outLineWidth}).onComplete(function(){return n=null,t.changingMapState.changingCurrentMap=!1,o(),e?e():void 0}).start()):(t.changingMapState.changingCurrentMap=!1,void o())},l(),u()},draw:function(e){var n,r,o,a,s,l;return o=e.context,n=e.alphaContext,r=e.betaContext,o&&n&&r?(a=function(o,a){var s,l,u,h,c,f;return null!=(null!=o?o.contentCircle:void 0)?(a?(s=o.outlineCircle,u=o.outline):(s=o.contentCircle,u=o.mask),h=t.SCREENWIDTH*i.currentMapScale/100,l=t.SCREENHEIGHT*i.currentMapScale/100,c=(t.SCREENWIDTH-h)/2,f=(t.SCREENHEIGHT-l)/2,n.save(),e.clearAlphaContext(),n.drawImage(u.data,c,f,h,l),n.restore(),n.save(),n.globalCompositeOperation="source-atop",e.drawCircle(s,t.ALPHACANVAS),n.restore(),r.save(),r.drawImage(e.alphaCanvas,0,0),r.restore()):void 0},s=!0,r.save(),e.clearBetaContext(),a(i.currentMap,s),a(i.newMap,s),r.restore(),n.save(),e.clearAlphaContext(),n.drawImage(e.betaCanvas,0,0),n.restore(),n.save(),n.globalCompositeOperation="source-atop",l={x:0,y:0,width:e.alphaCanvas.width,height:e.alphaCanvas.height,strokeColor:"SKYBLUE",strokeAlpha:0,fillColor:"SKYBLUE",fill:!0},e.drawRetangle(l,t.ALPHACANVAS),n.restore(),o.save(),o.drawImage(e.alphaCanvas,0,0),o.restore(),r.save(),e.clearBetaContext(),a(i.currentMap),a(i.newMap),r.restore(),o.save(),o.globalCompositeOperation="xor",o.drawImage(e.betaCanvas,0,0),o.globalAlpha=.45,o.globalCompositeOperation="source-over",o.drawImage(e.betaCanvas,0,0),o.globalAlpha=1,o.restore()):void 0},changeCurrentMap:function(e,n){var r,o,a,s;return o=i.currentDynasty,r=i.currentDynastyPeriod,a=o.name+r,s=o.name+r+"_outline",i.newMap={dynasty:o,period:r,mask:e.getImageByName(a),outline:e.getImageByName(s),contentCircleConfig:o.mapConfigs[r],outLineWidth:3},i.newMap.contentCircle={x:i.newMap.contentCircleConfig.startX,y:i.newMap.contentCircleConfig.startY,r:i.newMap.contentCircleConfig.startR,strokeColor:"PANELBG",fillColor:"PANELBG",fill:!0,delay:i.newMap.contentCircleConfig.delay},i.newMap.outlineCircle={x:i.newMap.contentCircleConfig.startX,y:i.newMap.contentCircleConfig.startY,r:i.newMap.contentCircleConfig.startR+i.newMap.outLineWidth,strokeColor:"SKYBLUE",fillColor:"SKYBLUE",fill:!0,delay:i.newMap.contentCircleConfig.delay},t.changingMapState.changingNewMap=!0,i.currentMap?t.changingMapState.changingCurrentMap=!0:t.changingMapState.changingCurrentMap=!1,n?n():void 0}}}])}),a("control/showingtextpanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("ShowingTextPanelControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{draw:function(e){var t,i;t=e.canvas,i=e.context},createPanel:function(i,n,r,o){var a,s,l,u,h;return h=t.panelSettings.textPanel,s=t.panelSettings,l=r.x,u=r.y,a={visible:!0,resource:n,text:{text:n.description,x:l+h.padding,y:u+h.padding,width:h.maxWidth-h.padding,height:h.maxHeight-h.padding,color:h.text.color,fontWeight:h.text.fontWeight,fontFamily:h.text.fontFamily,fontSize:h.text.fontSize,lineHeight:h.text.lineHeight,textBaseline:h.text.textBaseline,lineWidthOffset:h.lineWidthOffset},frame:{x:l,y:u,width:h.maxWidth,height:h.maxHeight,lineWidth:h.frame.lineWidth,strokeColor:h.frame.strokeColor,strokeAlpha:h.frame.strokeAlpha,fillColor:h.frame.fillColor,fillAlpha:h.frame.fillAlpha,fill:h.frame.fill},mask:{x:l+h.padding,y:u+h.padding,width:h.maxWidth-h.padding,height:h.maxHeight-h.padding},buttonClose:{data:i.getImageByName(s.buttonClose.buttonName).data,x:l+s.normalPanel.width-s.buttonClose.width,y:u,width:s.buttonClose.width,height:s.buttonClose.height,hitspot:{x:l+s.normalPanel.width-s.buttonClose.width,y:u,width:s.buttonClose.width,height:s.buttonClose.height},visible:s.buttonClose.visible},buttonMaximize:{data:i.getImageByName(s.buttonMaximize.buttonName).data,x:l+s.normalPanel.width-s.buttonClose.width,y:u+s.buttonClose.height+s.buttonMargin,width:s.buttonMaximize.width,height:s.buttonMaximize.height,hitspot:{x:l+s.normalPanel.width-s.buttonClose.width,y:u+s.buttonClose.height+s.buttonMargin,width:s.buttonMaximize.width,height:s.buttonMaximize.height},visible:s.buttonMaximize.visible},hitspot:{x:l,y:u,width:h.maxWidth,height:h.maxHeight}},o.panel=a,i.$emit(e.ADD_SHOWING_PANEL,a)},handleMouseMove:function(){return void 0},handleMouseUp:function(t,i,n){var r;if(n)return t.checkMouseAndHitspotCollision(i,n.buttonClose.hitspot)&&(r={panel:n},t.$emit(e.REMOVE_SHOWING_PANEL,r)),void(n.buttonMaximize.visible&&t.checkMouseAndHitspotCollision(i,n.buttonMaximize.hitspot)&&t.$emit(e.MAXIMIZE_TEXT_PANEL,n))},handleMouseDown:function(){return void 0}}}])}),a("control/showingimagepanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("ShowingImagePanelControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{draw:function(e){var t,i;t=e.canvas,i=e.context},createPanel:function(i,n,r,o){var a,s,l,u,h,c,f;return a=t.panelSettings.imagePanel,u=t.panelSettings,c=r.x,f=r.y,h=a.maxWidth,l=a.maxHeight,s={visible:!0,resource:n,image:{x:void 0,y:void 0,url:n.description,width:void 0,height:void 0,data:void 0},frame:{x:void 0,y:void 0,width:void 0,height:void 0,lineWidth:a.frame.lineWidth,strokeColor:a.frame.strokeColor,strokeAlpha:a.frame.strokeAlpha,fillColor:a.frame.fillColor,fillAlpha:a.frame.fillAlpha,fill:a.frame.fill},buttonClose:{data:i.getImageByName(u.buttonClose.buttonName).data,x:c+u.normalPanel.width-u.buttonClose.width,y:f,width:u.buttonClose.width,height:u.buttonClose.height,hitspot:{x:c+u.normalPanel.width-u.buttonClose.width,y:f,width:u.buttonClose.width,height:u.buttonClose.height},visible:u.buttonClose.visible},buttonMaximize:{data:i.getImageByName(u.buttonMaximize.buttonName).data,x:c+u.normalPanel.width-u.buttonClose.width,y:f+u.buttonClose.height+u.buttonMargin,width:u.buttonMaximize.width,height:u.buttonMaximize.height,hitspot:{x:c+u.normalPanel.width-u.buttonClose.width,y:f+u.buttonClose.height+u.buttonMargin,width:u.buttonMaximize.width,height:u.buttonMaximize.height},visible:u.buttonMaximize.visible},mask:{},hitspot:{}},i.loadImageData(s.image,function(){return c=r.x,f=r.y,h=a.maxWidth,l=a.maxHeight,s.image.x=c+a.padding,s.image.y=f+a.padding,s.image.width=h-2*a.padding,s.image.height=l-2*a.padding,s.frame.x=c,s.frame.y=f,s.frame.width=h,s.frame.height=l,s.mask.x=c+a.padding,s.mask.y=f+a.padding,s.mask.width=h-a.padding,s.mask.height=l-a.padding,s.hitspot.x=c,s.hitspot.y=f,s.hitspot.width=h,s.hitspot.height=l,o.panel=s,i.$emit(e.ADD_SHOWING_PANEL,s)})},handleMouseMove:function(){return void 0},handleMouseUp:function(t,i,n){var r;if(n)return t.checkMouseAndHitspotCollision(i,n.buttonClose.hitspot)&&(r={panel:n},t.$emit(e.REMOVE_SHOWING_PANEL,r)),void(n.buttonMaximize.visible&&t.checkMouseAndHitspotCollision(i,n.buttonMaximize.hitspot)&&t.$emit(e.MAXIMIZE_IMAGE_PANEL,n))},handleMouseDown:function(){return void 0}}}])}),a("control/showingvideopanel",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("ShowingVideoPanelControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{draw:function(e){var t,i;t=e.canvas,i=e.context},createPanel:function(i,n,r,o){var a,s,l,u,h,c;return c=t.panelSettings.videoPanel,s=t.panelSettings,l=r.x,u=r.y,h="videoResource"+n.id,a={visible:!0,videoId:h,video:void 0,x:l+c.padding,y:u+c.padding,width:c.maxWidth-2*c.padding,height:c.maxHeight-2*c.padding,resource:n,frame:{x:l,y:u,width:c.maxWidth,height:c.maxHeight,lineWidth:c.frame.lineWidth,strokeColor:c.frame.strokeColor,strokeAlpha:c.frame.strokeAlpha,fillColor:c.frame.fillColor,fillAlpha:c.frame.fillAlpha,fill:c.frame.fill},mask:{x:l+c.padding,y:u+c.padding,width:c.maxWidth-2*c.padding,height:c.maxHeight-2*c.padding},hitspot:{x:l,y:u,width:c.maxWidth,height:c.maxHeight},buttonClose:{data:i.getImageByName(s.buttonClose.buttonName).data,x:l+s.normalPanel.width-s.buttonClose.width,y:u,width:s.buttonClose.width,height:s.buttonClose.height,hitspot:{x:l+s.normalPanel.width-s.buttonClose.width,y:u,width:s.buttonClose.width,height:s.buttonClose.height},visible:!0},buttonMaximize:{data:i.getImageByName(s.buttonMaximize.buttonName).data,x:l+s.normalPanel.width-s.buttonClose.width,y:u+s.buttonClose.height+s.buttonMargin,width:s.buttonMaximize.width,height:s.buttonMaximize.height,hitspot:{x:l+s.normalPanel.width-s.buttonClose.width,y:u+s.buttonClose.height+s.buttonMargin,width:s.buttonMaximize.width,height:s.buttonMaximize.height},visible:!0},buttonPause:{data:i.getImageByName(s.buttonPause.buttonName).data,x:l+s.normalPanel.width-s.buttonPause.width,y:u+2*s.buttonPause.height+s.buttonMargin,width:s.buttonPause.width,height:s.buttonPause.height,hitspot:{x:l+s.normalPanel.width-s.buttonPause.width,y:u+2*s.buttonPause.height+s.buttonMargin,width:s.buttonPause.width,height:s.buttonPause.height},visible:!0},buttonPlay:{data:i.getImageByName(s.buttonPlay.buttonName).data,x:l+s.normalPanel.width-s.buttonPlay.width,y:u+2*s.buttonPlay.height+s.buttonMargin,width:s.buttonPlay.width,height:s.buttonPlay.height,hitspot:{x:l+s.normalPanel.width-s.buttonPlay.width,y:u+2*s.buttonPlay.height+s.buttonMargin,width:s.buttonPlay.width,height:s.buttonPlay.height},visible:!1}},o.panel=a,i.$emit(e.ADD_SHOWING_PANEL,a),a.video=document.getElementById(h),a.video?a.video.play():void 0},handleMouseUp:function(t,i,n){var r;if(n)return t.checkMouseAndHitspotCollision(i,n.buttonClose.hitspot)&&(r={panel:n},t.$emit(e.REMOVE_SHOWING_PANEL,r)),n.buttonMaximize.visible&&t.checkMouseAndHitspotCollision(i,n.buttonMaximize.hitspot)&&t.$emit(e.MAXIMIZE_VIDEO_PANEL,n),void(n.buttonPlay.visible?t.checkMouseAndHitspotCollision(i,n.buttonPlay.hitspot)&&(n.video.play(),n.buttonPlay.visible=!1,n.buttonPause.visible=!0):n.buttonPause.visible&&t.checkMouseAndHitspotCollision(i,n.buttonPause.hitspot)&&(n.video.pause(),n.buttonPlay.visible=!0,n.buttonPause.visible=!1))}}}])}),a("control/dynastyintroaudio",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("DynastyIntroAudioControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{load:function(t){var n;return n=i.currentDynasty,n&&n.introduction&&""!==n.introduction?t.$emit(e.PLAY_DYNASTY_INTRO_AUDIO,n.introAudios[0]):void 0},fadeInText:function(){var e,n,r;if(null!=(null!=(r=i.currentIntroAudio)?r.audioId:void 0))return i.drawingIntroText={audioId:i.currentIntroAudio.audioId,text:i.currentIntroAudio.text,x:t.dynastyIntroText.x,y:t.dynastyIntroText.startY,fontWeight:t.dynastyIntroText.fontWeight,fontFamily:t.dynastyIntroText.fontFamily,fontSize:t.dynastyIntroText.fontSize,color:t.dynastyIntroText.color,textAlign:t.dynastyIntroText.textAlign,width:t.dynastyIntroText.width,alpha:0,shadow:t.dynastyIntroText.shadow},e=t.dynastyIntroText.endY,n=new s.Tween(i.drawingIntroText).to({y:e,alpha:1},500).delay(10).easing(s.Easing.Quadratic.InOut).onComplete(function(){}).start()},draw:function(e){var t;if(null!=(null!=(t=i.drawingIntroText)?t.audioId:void 0))return e.drawText(i.drawingIntroText)}}}])}),a("control/loginscreen",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("LoginScreenControl",["EVENT","SystemParameters","ResourceModel",function(e,t,i){return{init:function(){var e,i,n,r,o,a,s,l,u,h,c,f,d,p;for(u=32,l=22,n=32,i=32,a=t.loginScreen.loginRetangleColumns,p=[],r=h=0,f=u-1;f>=h;r=h+=1){for(s={cells:[],completed:!1},o=c=0,d=l-1;d>=c;o=c+=1)e={width:n,height:i,fill:!0,fillColor:"PANELBG",strokeColor:"PANELBG",x:r*n,y:o*i,visible:!0},s.cells.push(e);p.push(a.push(s))}return p},fadeOutColumnCells:function(e){var i,n,r,o,a,s,l,u,h,c;if(o=t.loginScreen.loginRetangleColumns,0!==o.length){for(r=function(){var i,n,r,a;for(i=!0,r=0,a=o.length;a>r;r++)n=o[r],n.completed||(i=!1);return t.loginScreen.isCoverFadeOut=i,i&&e?e():void 0},s=0,u=o.length;u>s;s++)if(a=o[s],!a.completed){for(i=!0,c=a.cells,l=0,h=c.length;h>l;l++)n=c[l],n.visible&&(i=!1,Math.floor(100*Math.random()+1)%20===0&&(n.visible=!1));a.completed=i}return r()}},drawCover:function(e){var n,r,o,a,s,l,u,h,c,f,d,p,m,g;if(s=e.context,s&&(l=t.loginScreen.loginRetangleColumns,0!==l.length)){for(n=e.alphaContext,r=e.betaContext,e.clearBetaContext(),e.clearAlphaContext(),f=0,p=l.length;p>f;f++)if(c=l[f],!c.completed)for(g=c.cells,d=0,m=g.length;m>d;d++)o=g[d],o.visible&&(e.drawRetangle(o),a={width:o.width,height:o.height,fill:!0,fillColor:"SKYBLUE",strokeColor:"SKYBLUE",x:o.x,y:o.y},n.save(),e.drawRetangle(a,t.ALPHACANVAS),n.restore());return r.save(),r.drawImage(e.alphaCanvas,0,0),r.restore(),r.save(),r.globalCompositeOperation="destination-in",h=t.loginScreen.progressBar,u=i.loadPercentage,100>u?h.width=h.maxWidth*(u/100):h.width=h.maxWidth,e.drawRetangle(h,t.BETACANVAS),r.restore(),s.save(),s.drawImage(e.betaCanvas,0,0),s.restore()}}}}])}),a("service/csv",["angular","appmodule","angular_resource","csv2json"],function(){var e;return e=angular.module("app"),e.factory("CSV",["$http",function(e){return{loadImageInfos:function(t){var i;return i="assets/data/csv/images.csv",e.get(i,{transformResponse:function(e){var t;return t=h.csv2json(e,{delim:",",textdelim:'"'})}}).success(function(e,i){return t(e.rows)})}}}])}),a("service/preloaddata",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("PreloadDataService",["SystemParameters","ResourceModel","CSV","$http",function(e,t,i,n){var r,o,a,s,l,u,h,c,f,d;return c=0,r=null,o=function(e){return c+=e,t.loadPercentage=c,c>=125&&r?r():void 0},u=function(e,t){return n.get(e).success(function(e){return t?t(e):void 0})},h=function(){var e,i,n,r,a,s;return i="assets/data/jsons/dynasties.json",e="assets/data/jsons/categories.json",s="assets/data/jsons/resourcetypes.json",n=function(e){return t.dynasties=e,o(20)},a=function(e){return t.resourceCategories=e,o(5)},r=function(e){return t.resourceTypes=e,o(5)},u(i,n),u(e,a),u(s,r)},l=function(){return s(),f()},f=function(){var e,i,n,r,a,s;if(!(null!=t?t.resourceCategoryIcons:void 0)&&(t.resourceCategoryIcons=[],t.resourceCategories)){for(a=t.resourceCategories,s=[],n=0,r=a.length;r>n;n++)e=a[n],e.iconName?(i={},i.data=new Image,i.data.onload=function(){return this.complete?o(1):void 0},i.data.src="assets/images/"+e.iconName+".png",s.push(t.resourceCategoryIcons[e.iconName]=i)):s.push(void 0);return s}},s=function(){var e,i,n,r,a;for(i=[{name:"map",src:"assets/images/2_no_clouds_4k.jpg"},{name:"bumpMap",src:"assets/images/elev_bump_4k.jpg"},{name:"specularMap",src:"assets/images/water_4k.png"},{name:"clouds",src:"assets/images/fair_clouds_4k.png"},{name:"stars",src:"assets/images/galaxy_starfield.png"}],t.earthTextures={},a=[],n=0,r=i.length;r>n;n++)e=i[n],e.data=new Image,e.data.onload=function(){return this.complete?o(1):void 0},e.data.src=e.src,a.push(t.earthTextures[e.name]=e);return a},a=function(t){return i.loadImageInfos(function(t){var i;return l=function(t){var n,r,a,s,l,u;if(s=0,void 0===e.images){for(a=90/t.length,l=0,u=t.length;u>l;l++)r=t[l],r.data=new Image,r.x=r.startX,r.y=r.startY,r.a=1,r.data.onload=function(){return this.complete?(s++,n(),o(a)):void 0},r.data.src="assets/images/"+r.name;return n=function(){return s>=t.length-1?i(t):void 0}}},i=function(t){return e.images=t},l(t)})},d={},d.preloadData=function(t){return c=0,r=t,e.preloadState=e.START,l(),h(),a()},d}])}),a("model/systemparameters",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("SystemParameters",[function(){return{onMapChangingAnimation:!1,bgSounds:[{id:"bgAudio01",url:"assets/audios/bg/01.mp3"},{id:"bgAudio02",url:"assets/audios/bg/01.mp3"},{id:"bgAudio03",url:"assets/audios/bg/01.mp3"},{id:"bgAudio04",url:"assets/audios/bg/01.mp3"},{id:"bgAudio05",url:"assets/audios/bg/01.mp3"},{id:"bgAudio06",url:"assets/audios/bg/01.mp3"}],MAP_Z:1.5,SCALE:100,introAudioState:{INIT:0,LOADED:1,PLAYING:2,COMPLETED:3},dynastyIntroText:{text:"",x:512,startY:605,endY:585,fontWeight:"bold",fontFamily:"PARAGRAPH",fontSize:"INTROTEXT",color:"WHITE",textAlign:"center",shadow:{color:"WHITE",offsetX:.5,offsetY:.5,blur:10,alpha:.5}},MAINCANVAS:0,ALPHACANVAS:1,BETACANVAS:2,onPlayingAnimation:!1,changingMapState:{changingCurrentMap:!1,changingNewMap:!1},RESOURCE_TYPE:{TEXT:1,IMAGE:2,VIDEO:3},preloadState:void 0,START:0,COMPLETE:1,SCREENWIDTH:1024,SCREENHEIGHT:680,colors:{WHITE:"255, 255, 255",SKYBLUE:"1, 255, 255",YELLOW:"255, 255, 0",PANELBG:"0, 0, 0"},fontFamily:{DEFAULT:"hooge0665",PARAGRAPH:"arial",LABEL:"hooge0655"},fontSize:{TINY:"6px",SMALL:"8px",NORMAL:"10px",LARGE:"12px",LARGER:"16px",INTROTEXT:"18px",EXTRALARGE:"18px",TITLE:"22px"},canvas:void 0,context:void 0,loginScreen:{progressBar:{width:0,maxWidth:200,height:10,fill:!0,fillColor:"SKYBLUE",strokeColor:"SKYBLUE",x:412,y:335},loginCover:{fillColor:"PANELBG",strokeColor:"PANELBG",fill:!0},loginRetangleModel:{width:8,height:8,fill:!0,fillColor:"WHITE",strokeColor:"WHITE",visible:!1,fillAlpha:0,strokeAlpha:0},loginRetangleColumns:[],isCoverFadeOut:!1},navigationPanel:{bgImage:void 0,spaceship:void 0,logoutButton:{text:"LOGOUT",x:950,y:40,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",hitspot:{x:948,y:32,width:45,height:10}},title:{text:"",x:540,y:40,fontWeight:"bold",fontFamily:"DEFAULT",fontSize:"TITLE",color:"SKYBLUE",textAlign:"right"},subTitle:{text:"DYNASTY",x:545,y:40,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",textAlign:"left"},userName:{text:"JAKE",x:800,y:92,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"TITLE"},startYear:{text:"",x:509,y:80,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"LARGER",textAlign:"right"},startYearPeriod:{text:"",x:525,y:80,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"TINY",textAlign:"right"},endYear:{text:"",x:585,y:80,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"LARGER",textAlign:"right"},endYearPeriod:{text:"",x:595,y:80,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"TINY",textAlign:"right"},power:{percentage:{text:"60%",value:60,x:151,y:67,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",color:"SKYBLUE",chartModel:{fill:!0,step:20,xOffset:-1,yOffset:0,startX:208.5,startY:65,gap:2,width:3,height:10,color:"SKYBLUE"}},label:{text:"POWER",x:176,y:90,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},frame:{x:180,y:62,width:30,height:16,radius:0,lineWidth:2}},location:{e:{text:{text:"110.32",x:160,y:40,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"TINY"},label:{text:"E",color:"SKYBLUE",x:152,y:40,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"TINY"}},n:{text:{text:"66.32",x:160,y:48,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"TINY"},label:{text:"N",color:"SKYBLUE",x:152,y:48,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"TINY"}},circle:{x:198,y:38,r:11,lineWidth:2},pointer:{x:196,y:36,r:2,fillColor:"SKYBLUE",strokeColor:"SKYBLUE",fill:!0,lineWidth:1},pointerMin:{x:187,y:27},pointerMax:{x:209,y:38},eRange:{min:30,max:180},nRange:{max:90,min:0}},progress:{label:{text:"PROGRESS",x:225,y:50,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},percentage:{text:"75%",x:285,y:50,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",color:"SKYBLUE"},state:{x:224,y:57,complete:.75,width:225,lineWidth:1,completeStrokeColor:"SKYBLUE",completeLineWidth:3,pointer:{x:300,y:60,width:10,height:5,fillColor:"SKYBLUE",strokeColor:"SKYBLUE",fill:!0}}},topicStates:[{label:{text:"HISTORY",x:238,y:70,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},statePercentage:{completePercentage:1}},{label:{text:"SOCIETY",x:315,y:70,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},statePercentage:{completePercentage:.6}},{label:{text:"CULTURE",x:400,y:70,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},statePercentage:{completePercentage:.75}},{label:{text:"MILITARY",x:238,y:82,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},statePercentage:{completePercentage:.4}},{label:{text:"TECHNOLOGY",x:380,y:82,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},statePercentage:{completePercentage:.7}}],folderLabels:[{text:"images/",x:220,y:97,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},{text:"videos/",x:310,y:97,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},{text:"stories/",x:400,y:97,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"}],level:{text:"Advanced level",x:610,y:97,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",color:"SKYBLUE"},soundEffect:{retangleMarker:{x:615,y:32,width:2,height:4,fill:!0},polygonMarker:{points:[{x:618,y:32},{x:622,y:28},{x:622,y:40},{x:618,y:36}],fill:!0,lineWidth:1},underline:{startX:624,startY:40,lineWidth:.5,endX:700,endY:38},lineChart:{startX:624,startY:20,width:5,height:20,gap:2,cylinders:[{percentage:.6},{percentage:.7},{percentage:1},{percentage:.2},{percentage:.3},{percentage:.4},{percentage:.65},{percentage:.8},{percentage:.3},{percentage:.5}]}},dateAndTime:{retangle:{x:705,y:24,width:8,height:16,strokeColor:"YELLOW",fillColor:"YELLOW",fill:!0},date:{x:717,y:30,text:"0897-09-28",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"},time:{text:"23:09:02",x:717,y:40,fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL"}},signal:{icon:{lines:[{startX:870,startY:24,endX:880,endY:24},{startX:870,startY:24,endX:875,endY:30},{startX:880,startY:24,endX:875,endY:30},{startX:875,startY:24,endX:875,endY:40}]},bar:{startX:880,startY:22,width:5,height:18,gap:2,cylinders:[{percentage:.2},{percentage:.4},{percentage:.6},{percentage:.8},{percentage:1}]}},connect:{bgImage:void 0,startX:800,y:35,r:2,totalNumber:6,gap:7,circles:[],strokeColor:"WHITE",fillColor:"WHITE"}},panelSettings:{totalShowingPanel:1,showingPanelContainers:[{x:692,y:105,panel:void 0},{x:507,y:172,panel:void 0},{x:507,y:342,panel:void 0},{x:197,y:342,panel:void 0}],normalPanel:{width:300,height:160},maximizedPanel:{x:132,y:105,width:740,height:460,padding:10,fontSize:"EXTRALARGE",lineHeight:25,lineWidthOffset:350,hitspot:{x:132,y:105,width:740,height:460}},buttonMargin:0,maximizedButton:{width:40,height:40},buttonClose:{buttonName:"buttonClose",image:void 0,x:void 0,y:void 0,width:20,height:20,visible:!0},buttonPlay:{buttonName:"buttonPlay",x:void 0,y:void 0,width:20,height:20,visible:!0},buttonPause:{buttonName:"buttonPause",x:void 0,y:void 0,width:20,height:20,visible:!0},buttonRestoreDown:{buttonName:"buttonRestoreDown",x:void 0,y:void 0,width:20,height:20,visible:!0},buttonMaximize:{buttonName:"buttonMaximize",x:void 0,y:void 0,width:20,height:20,visible:!0},textPanel:{padding:10,maxWidth:300,maxHeight:160,lineWidthOffset:80,visible:!0,buttonClose:{},buttonMaximize:{},buttonRestoreDown:{},text:{text:void 0,x:void 0,y:void 0,width:void 0,height:void 0,color:"WHITE",fontWeight:"normal",fontFamily:"PARAGRAPH",fontSize:"LARGE",textAlign:"left",textBaseline:"hanging",lineHeight:18},frame:{x:void 0,y:void 0,width:void 0,height:void 0,lineWidth:8,strokeColor:"SKYBLUE",strokeAlpha:1,fillColor:"PANELBG",fillAlpha:.95,fill:!0},mask:{x:void 0,y:void 0,width:void 0,height:void 0},hitspot:{}},imagePanel:{padding:5,maxWidth:300,maxHeight:160,visible:!0,buttonClose:{},image:{x:void 0,y:void 0,width:void 0,height:void 0,data:void 0},frame:{x:void 0,y:void 0,width:void 0,height:void 0,lineWidth:8,strokeColor:"SKYBLUE",strokeAlpha:1,fillColor:"PANELBG",fillAlpha:.95,fill:!0},mask:{x:void 0,y:void 0,width:void 0,height:void 0}},videoPanel:{padding:5,maxWidth:300,maxHeight:160,visible:!0,x:void 0,y:void 0,width:void 0,height:void 0,video:void 0,frame:{x:void 0,y:void 0,width:void 0,height:void 0,lineWidth:8,strokeColor:"SKYBLUE",strokeAlpha:1,fillColor:"PANELBG",fillAlpha:.95,fill:!0},mask:{x:void 0,y:void 0,width:void 0,height:void 0},text:{x:0,y:-200,color:"YELLOW",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",textAlign:"right"}}},timelinePanel:{x:0,y:620,offset:10,currentDynastyId:void 0,mouseDownCoordinate:void 0,mouseCurrentCoordinate:void 0,mouseMoveCoordinate:void 0,mouseUpCoordinate:void 0,moveRange:{min:-380,max:180},retangleMask:{x:112,y:600,width:800,height:80},hitspot:{x:112,y:600,width:800,height:80},progessionBar:{x:0,y:void 0,maxLength:630,dyanstyMarginLeft:8},dynastyHitspots:[],dynastyModel:{fillColor:"PANELBG",strokeColor:"SKYBLUE",strokeAlpha:.7,fillAlpha:.7,width:26,height:26,marginLeft:4,fill:!0,yearCharacterWidth:5.5,startYear:{text:void 0,x:0,y:-10,color:"WHITE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",textAlign:"left"},endYear:{text:void 0,x:0,y:-10,color:"WHITE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",textAlign:"right"},name:{x:void 0,y:void 0,color:"WHITE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",textAlign:"center"}},currentDynastyModel:{fillColor:"SKYBLUE",strokeColor:"SKYBLUE"
},pointer:{x:void 0,y:670,fillColor:"SKYBLUE",strokeColor:"SKYBLUE",width:9,height:6,points:[],fill:!0},timeLine:{x:void 0,y:665,textMiddleSpace:20,textMarginLeft:10,textMarginRight:10,lineBC:{startX:void 0,startY:void 0,endX:void 0,endY:void 0,width:290,height:16,radius:0,lineWidth:1},textBC:{text:"BC",x:void 0,y:void 0,color:"YELLOW",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",textAlign:"center",textBaseline:"middle"},textDC:{text:"DC",x:void 0,y:void 0,color:"YELLOW",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"SMALL",textAlign:"center",textBaseline:"middle"},lineDC:{startX:void 0,startY:void 0,endX:void 0,endY:void 0,width:860,height:16,radius:0,lineWidth:1}}},categoryPanel:{panelWidth:120,hitspot:{x:void 0,y:void 0,width:void 0,height:void 0},enableRetangle:{x:10,y:void 0,width:13,height:13,fill:!1,strokeColor:"YELLOW",lineWidth:2,innerRetangle:{x:14,y:void 0,width:5,height:5,fill:!0,strokeColor:"YELLOW",fillColor:"YELLOW",lineWidth:2}},disableRetangle:{x:10,y:void 0,width:13,height:13,fill:!1,strokeColor:"YELLOW",lineWidth:2},categoryIndexs:["history","society","culture","military","technology"],categoryLabels:[{text:"HISTORY",x:30,y:120,enable:!0,color:"SKYBLUE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"NORMAL",hitspot:{}},{text:"SOCIETY",x:30,y:140,enable:!0,color:"SKYBLUE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"NORMAL",hitspot:{}},{text:"CULTURE",x:30,y:160,enable:!0,color:"SKYBLUE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"NORMAL",hitspot:{}},{text:"MILITARY",x:30,y:180,enable:!0,color:"SKYBLUE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"NORMAL",hitspot:{}},{text:"TECHNOLOGY",x:30,y:200,enable:!0,color:"SKYBLUE",fontWeight:"normal",fontFamily:"DEFAULT",fontSize:"NORMAL",hitspot:{}}]},mapAreaPanel:{hitspot:{x:132,y:105,width:860,height:465}}}}])}),a("model/resource",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("ResourceModel",[function(){return{resourceTypes:void 0,resourceCategories:void 0,resourceCategoryIcons:void 0,dynasties:void 0,currentDynasty:void 0,currentDynastyId:void 0,currentDynastyPeriod:void 0,currentMap:void 0,newMap:void 0,showingPanels:[],showingMaximizedPanel:void 0,currentMapScale:100,currentIntroAudio:{id:void 0,audioId:void 0,audio:void 0,text:void 0,state:void 0},drawingIntroText:void 0,loginAnimationCompleted:!1,loadPercentage:0,isShowingMaximizedPanel:!1,isFirstTimeLoading:!1}}])}),a("model/earth",["angular","appmodule","angular_resource"],function(){var e;return e=angular.module("app"),e.factory("EarthModel",[function(){return{camera:void 0,scene:void 0,renderer:void 0,canvas:void 0,light:void 0,earth:void 0,clouds:void 0,stars:void 0,shapeEarthTween:void 0}}])}),r.config({waitSeconds:200,urlArgs:"bust="+(new Date).getTime(),paths:{jquery:"../lib/jquery-1.9.1",bootstrap:"../lib/bootstrap",angular:"../lib/angular",angular_resource:"../lib/angular-resource",browserdetect:"../lib/browserdetect",flash_detect:"../lib/flash_detect",csv2json:"../lib/csvjson",canvg:"../lib/canvas/canvg",rgbcolor:"../lib/canvas/rgbcolor",stackblur:"../lib/canvas/stackblur",threejs:"../lib/threejs/three",stats:"../lib/threejs/stats.min",trackballctrl:"../lib/threejs/trackballcontrol",sound:"../lib/soundmanager2",tweenjs:"../lib/tween"},shim:{angular:{deps:["jquery","canvg","rgbcolor","stackblur","sound"],exports:"angular"},bootstrap:{deps:["jquery"],exports:"bootstrap"},angular_resource:{deps:["angular"],exports:"angular_resource"},trackballctrl:{deps:["threejs"],exports:"trackballctrl"}}}),a("main",["tweenjs","jquery","canvg","rgbcolor","stackblur","angular","csv2json","appmodule","threejs","trackballctrl","stats","sound","flash_detect","browserdetect","event","control/earth","control/mainscreen","control/navigationpanel","control/timelinepanel","control/categorypanel","control/mapareapanel","control/maximizedpanel","control/showingpanels","control/dynastymap","control/showingtextpanel","control/showingimagepanel","control/showingvideopanel","control/dynastyintroaudio","control/loginscreen","service/csv","service/preloaddata","model/systemparameters","model/resource","model/earth"],function(){var e;return e=angular.module("app"),angular.element(document).ready(function(){var e;return e=!("Explorer"===d.browser&&d.version<9),e?angular.bootstrap(document,["app"]):alert("You are using a browser that this course doesn't support, for the best experience please upgrade to Google Chrome 22, Mozilla Firefox 17, Safari 5.1, Internet Explorer 9, or later.")})}),o(["main"])}();